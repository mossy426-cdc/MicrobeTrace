(self["webpackChunkMicrobeTrace"] = self["webpackChunkMicrobeTrace"] || []).push([[792],{

/***/ 94114:
/*!***************************************!*\
  !*** ./src/app/app-routing.module.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AppRoutingModule: () => (/* binding */ AppRoutingModule)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @angular/router */ 95072);
/* harmony import */ var _microbe_trace_next_plugin_component__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./microbe-trace-next-plugin.component */ 24384);




const routes = [{
  path: '',
  component: _microbe_trace_next_plugin_component__WEBPACK_IMPORTED_MODULE_0__.MicrobeTraceNextHomeComponent
}];
let AppRoutingModule = class AppRoutingModule {};
AppRoutingModule = (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.NgModule)({
  imports: [_angular_router__WEBPACK_IMPORTED_MODULE_3__.RouterModule.forRoot(routes, {})],
  exports: [_angular_router__WEBPACK_IMPORTED_MODULE_3__.RouterModule]
})], AppRoutingModule);


/***/ }),

/***/ 20092:
/*!**********************************!*\
  !*** ./src/app/app.component.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AppComponent: () => (/* binding */ AppComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _app_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./app.component.html?ngResource */ 61584);
/* harmony import */ var _app_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./app.component.scss?ngResource */ 8274);
/* harmony import */ var _app_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_app_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @angular/core */ 37580);




let AppComponent = class AppComponent {
  constructor() {
    this.title = 'sample-app';
  }
};
AppComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_3__.Component)({
  selector: 'app-root',
  template: _app_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  styles: [(_app_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
})], AppComponent);


/***/ }),

/***/ 50635:
/*!*******************************!*\
  !*** ./src/app/app.module.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AppModule: () => (/* binding */ AppModule),
/* harmony export */   TestedComponent: () => (/* binding */ TestedComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var _angular_platform_browser_animations__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! @angular/platform-browser/animations */ 43835);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_common__WEBPACK_IMPORTED_MODULE_70__ = __webpack_require__(/*! @angular/common */ 60316);
/* harmony import */ var _app_routing_module__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./app-routing.module */ 94114);
/* harmony import */ var _primeng_themes_lara__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @primeng/themes/lara */ 88435);
/* harmony import */ var primeng_config__WEBPACK_IMPORTED_MODULE_71__ = __webpack_require__(/*! primeng/config */ 62746);
/* harmony import */ var _app_component__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./app.component */ 20092);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jquery */ 93224);
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _angular_common_http__WEBPACK_IMPORTED_MODULE_72__ = __webpack_require__(/*! @angular/common/http */ 46443);
/* harmony import */ var _angular_forms__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! @angular/forms */ 34456);
/* harmony import */ var _shared_utils_utils_module__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @shared/utils/utils.module */ 80907);
/* harmony import */ var _golden_layout_component_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./golden-layout-component.service */ 39107);
/* harmony import */ var _golden_layout_host_component__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./golden-layout-host.component */ 64862);
/* harmony import */ var primeng_button__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! primeng/button */ 49136);
/* harmony import */ var primeng_table__WEBPACK_IMPORTED_MODULE_51__ = __webpack_require__(/*! primeng/table */ 76676);
/* harmony import */ var primeng_fileupload__WEBPACK_IMPORTED_MODULE_50__ = __webpack_require__(/*! primeng/fileupload */ 13209);
/* harmony import */ var primeng_listbox__WEBPACK_IMPORTED_MODULE_52__ = __webpack_require__(/*! primeng/listbox */ 69607);
/* harmony import */ var primeng_radiobutton__WEBPACK_IMPORTED_MODULE_53__ = __webpack_require__(/*! primeng/radiobutton */ 54665);
/* harmony import */ var primeng_calendar__WEBPACK_IMPORTED_MODULE_54__ = __webpack_require__(/*! primeng/calendar */ 41314);
/* harmony import */ var primeng_paginator__WEBPACK_IMPORTED_MODULE_55__ = __webpack_require__(/*! primeng/paginator */ 43157);
/* harmony import */ var primeng_progressbar__WEBPACK_IMPORTED_MODULE_56__ = __webpack_require__(/*! primeng/progressbar */ 21416);
/* harmony import */ var primeng_confirmdialog__WEBPACK_IMPORTED_MODULE_57__ = __webpack_require__(/*! primeng/confirmdialog */ 68160);
/* harmony import */ var primeng_dropdown__WEBPACK_IMPORTED_MODULE_58__ = __webpack_require__(/*! primeng/dropdown */ 26895);
/* harmony import */ var primeng_accordion__WEBPACK_IMPORTED_MODULE_62__ = __webpack_require__(/*! primeng/accordion */ 45206);
/* harmony import */ var primeng_sidebar__WEBPACK_IMPORTED_MODULE_63__ = __webpack_require__(/*! primeng/sidebar */ 97196);
/* harmony import */ var primeng_multiselect__WEBPACK_IMPORTED_MODULE_64__ = __webpack_require__(/*! primeng/multiselect */ 92159);
/* harmony import */ var primeng_slider__WEBPACK_IMPORTED_MODULE_65__ = __webpack_require__(/*! primeng/slider */ 47763);
/* harmony import */ var primeng_tabview__WEBPACK_IMPORTED_MODULE_59__ = __webpack_require__(/*! primeng/tabview */ 634);
/* harmony import */ var primeng_selectbutton__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! primeng/selectbutton */ 69656);
/* harmony import */ var primeng_tree__WEBPACK_IMPORTED_MODULE_60__ = __webpack_require__(/*! primeng/tree */ 18092);
/* harmony import */ var primeng_dialog__WEBPACK_IMPORTED_MODULE_61__ = __webpack_require__(/*! primeng/dialog */ 16280);
/* harmony import */ var primeng_orderlist__WEBPACK_IMPORTED_MODULE_68__ = __webpack_require__(/*! primeng/orderlist */ 60676);
/* harmony import */ var _microbe_trace_next_plugin_component__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./microbe-trace-next-plugin.component */ 24384);
/* harmony import */ var _shared_common_session_app_session_service__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @shared/common/session/app-session.service */ 50686);
/* harmony import */ var _shared_common_ui_app_ui_customization_service__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @shared/common/ui/app-ui-customization.service */ 69720);
/* harmony import */ var _shared_common_nav_app_url_service__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @shared/common/nav/app-url.service */ 81014);
/* harmony import */ var _filesComponent_files_plugin_component__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./filesComponent/files-plugin.component */ 16025);
/* harmony import */ var _visualizationComponents_PhylogeneticComponent_phylogenetic_plugin_component__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./visualizationComponents/PhylogeneticComponent/phylogenetic-plugin.component */ 52516);
/* harmony import */ var _visualizationComponents_TimelineComponent_timeline_component_component__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./visualizationComponents/TimelineComponent/timeline-component.component */ 38510);
/* harmony import */ var _visualizationComponents_TwoDComponent_twoD_plugin_component__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./visualizationComponents/TwoDComponent/twoD-plugin.component */ 27316);
/* harmony import */ var _metronic_app_core_core_module__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @metronic/app/core/core.module */ 73651);
/* harmony import */ var _visualizationComponents_TableComponent_table_plugin_component__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./visualizationComponents/TableComponent/table-plugin-component */ 6811);
/* harmony import */ var _visualizationComponents_MapComponent_map_plugin_component__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./visualizationComponents/MapComponent/map-plugin.component */ 15936);
/* harmony import */ var _visualizationComponents_AlignmentViewComponent_alignment_view_plugin_component__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./visualizationComponents/AlignmentViewComponent/alignment-view-plugin-component */ 20944);
/* harmony import */ var _asymmetrik_ngx_leaflet__WEBPACK_IMPORTED_MODULE_66__ = __webpack_require__(/*! @asymmetrik/ngx-leaflet */ 88355);
/* harmony import */ var _asymmetrik_ngx_leaflet_markercluster__WEBPACK_IMPORTED_MODULE_67__ = __webpack_require__(/*! @asymmetrik/ngx-leaflet-markercluster */ 88611);
/* harmony import */ var _angular_material_button__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! @angular/material/button */ 84175);
/* harmony import */ var _angular_material_input__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! @angular/material/input */ 95541);
/* harmony import */ var _angular_material_menu__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! @angular/material/menu */ 31034);
/* harmony import */ var _angular_material_toolbar__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! @angular/material/toolbar */ 39552);
/* harmony import */ var _angular_material_slider__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! @angular/material/slider */ 64992);
/* harmony import */ var _shared_dnd_directive__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @shared/dnd.directive */ 70515);
/* harmony import */ var _angular_material_select__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! @angular/material/select */ 25175);
/* harmony import */ var _angular_material_icon__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! @angular/material/icon */ 93840);
/* harmony import */ var _angular_material_progress_spinner__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! @angular/material/progress-spinner */ 41134);
/* harmony import */ var _visualizationComponents_CrosstabComponent_crosstab_plugin_component__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./visualizationComponents/CrosstabComponent/crosstab-plugin.component */ 59972);
/* harmony import */ var _visualizationComponents_AggregateComponent_aggregate_component__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./visualizationComponents/AggregateComponent/aggregate.component */ 97214);
/* harmony import */ var _visualizationComponents_BubbleComponent_bubble_component__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./visualizationComponents/BubbleComponent/bubble.component */ 31884);
/* harmony import */ var ngx_bootstrap_tooltip__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ngx-bootstrap/tooltip */ 36465);
/* harmony import */ var ngx_bootstrap_tabs__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ngx-bootstrap/tabs */ 75119);
/* harmony import */ var ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ngx-bootstrap/modal */ 2457);
/* harmony import */ var ngx_bootstrap_dropdown__WEBPACK_IMPORTED_MODULE_48__ = __webpack_require__(/*! ngx-bootstrap/dropdown */ 54195);
/* harmony import */ var ngx_bootstrap_popover__WEBPACK_IMPORTED_MODULE_49__ = __webpack_require__(/*! ngx-bootstrap/popover */ 64393);
/* harmony import */ var _visualizationComponents_GanttComponent_gantt_plugin_component__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./visualizationComponents/GanttComponent/gantt-plugin.component */ 10688);
/* harmony import */ var _visualizationComponents_GanttComponent_gantt_chart_gantt_chart_component__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./visualizationComponents/GanttComponent/gantt-chart/gantt-chart.component */ 57473);
/* harmony import */ var _visualizationComponents_GanttComponent_gantt_chart_gantt_chart_service__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./visualizationComponents/GanttComponent/gantt-chart/gantt-chart.service */ 15013);
/* harmony import */ var _visualizationComponents_HeatmapComponent_heatmap_component__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./visualizationComponents/HeatmapComponent/heatmap.component */ 28775);
/* harmony import */ var _visualizationComponents_WaterfallComponent_waterfall_component__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./visualizationComponents/WaterfallComponent/waterfall.component */ 75312);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_69__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);
/* harmony import */ var plotly_js_dist_min__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! plotly.js-dist-min */ 44616);
/* harmony import */ var plotly_js_dist_min__WEBPACK_IMPORTED_MODULE_28___default = /*#__PURE__*/__webpack_require__.n(plotly_js_dist_min__WEBPACK_IMPORTED_MODULE_28__);
/* harmony import */ var angular_plotly_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! angular-plotly.js */ 59627);












// import { ServiceProxyModule } from '@shared/service-proxies/service-proxy.module';

// import { AbpModule } from 'abp-ng2-module/dist/src/abp.module';
// import { ModalModule, TooltipModule, TabsModule, BsDropdownModule, PopoverModule } from 'ngx-bootstrap';
// import { TableModule } from 'primeng/components/table/table';
// import { FileUploadModule, ListboxModule, RadioButtonModule, CalendarModule, PaginatorModule, ProgressBarModule, ConfirmDialogModule, DropdownModule, AccordionModule, SidebarModule, MultiSelect, MultiSelectModule, SliderModule } from 'primeng/primeng';




























































angular_plotly_js__WEBPACK_IMPORTED_MODULE_29__.PlotlyModule.plotlyjs = plotly_js_dist_min__WEBPACK_IMPORTED_MODULE_28__;
// It is required to have JQuery as global in the window object.
window['$'] = jquery__WEBPACK_IMPORTED_MODULE_3__;
const routerOptions = {
  // Your router configurations
};
// PlotlyModule.plotlyjs = PlotlyJS;
let TestedComponent = class TestedComponent {
  constructor() {}
  static {
    this.ctorParameters = () => [];
  }
};
TestedComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_30__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_31__.Component)({
  template: `<h1>Test2</h1>`,
  selector: `app-tested`
}), (0,tslib__WEBPACK_IMPORTED_MODULE_30__.__metadata)("design:paramtypes", [])], TestedComponent);

let AppModule = class AppModule {};
AppModule = (0,tslib__WEBPACK_IMPORTED_MODULE_30__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_31__.NgModule)({
  declarations: [_app_component__WEBPACK_IMPORTED_MODULE_2__.AppComponent, _microbe_trace_next_plugin_component__WEBPACK_IMPORTED_MODULE_7__.MicrobeTraceNextHomeComponent, _filesComponent_files_plugin_component__WEBPACK_IMPORTED_MODULE_11__.FilesComponent, _visualizationComponents_TwoDComponent_twoD_plugin_component__WEBPACK_IMPORTED_MODULE_14__.TwoDComponent, _visualizationComponents_TableComponent_table_plugin_component__WEBPACK_IMPORTED_MODULE_16__.TableComponent, _golden_layout_host_component__WEBPACK_IMPORTED_MODULE_6__.GoldenLayoutHostComponent, _visualizationComponents_MapComponent_map_plugin_component__WEBPACK_IMPORTED_MODULE_17__.MapComponent, TestedComponent, _shared_dnd_directive__WEBPACK_IMPORTED_MODULE_19__.DndDirective, _visualizationComponents_PhylogeneticComponent_phylogenetic_plugin_component__WEBPACK_IMPORTED_MODULE_12__.PhylogeneticComponent, _visualizationComponents_TimelineComponent_timeline_component_component__WEBPACK_IMPORTED_MODULE_13__.TimelineComponent, _visualizationComponents_AlignmentViewComponent_alignment_view_plugin_component__WEBPACK_IMPORTED_MODULE_18__.AlignmentViewComponent, _visualizationComponents_CrosstabComponent_crosstab_plugin_component__WEBPACK_IMPORTED_MODULE_20__.CrosstabComponent, _visualizationComponents_AggregateComponent_aggregate_component__WEBPACK_IMPORTED_MODULE_21__.AggregateComponent, _visualizationComponents_GanttComponent_gantt_chart_gantt_chart_component__WEBPACK_IMPORTED_MODULE_24__.GanttChartComponent, _visualizationComponents_GanttComponent_gantt_plugin_component__WEBPACK_IMPORTED_MODULE_23__.GanttComponent, _visualizationComponents_HeatmapComponent_heatmap_component__WEBPACK_IMPORTED_MODULE_26__.HeatmapComponent, _visualizationComponents_BubbleComponent_bubble_component__WEBPACK_IMPORTED_MODULE_22__.BubbleComponent, _visualizationComponents_WaterfallComponent_waterfall_component__WEBPACK_IMPORTED_MODULE_27__.WaterfallComponent],
  exports: [primeng_selectbutton__WEBPACK_IMPORTED_MODULE_32__.SelectButtonModule],
  bootstrap: [_app_component__WEBPACK_IMPORTED_MODULE_2__.AppComponent],
  imports: [_angular_platform_browser__WEBPACK_IMPORTED_MODULE_33__.BrowserModule, _angular_platform_browser_animations__WEBPACK_IMPORTED_MODULE_34__.BrowserAnimationsModule, _angular_forms__WEBPACK_IMPORTED_MODULE_35__.FormsModule, _angular_material_button__WEBPACK_IMPORTED_MODULE_36__.MatButtonModule, primeng_button__WEBPACK_IMPORTED_MODULE_37__.ButtonModule, _angular_material_input__WEBPACK_IMPORTED_MODULE_38__.MatInputModule, _angular_material_menu__WEBPACK_IMPORTED_MODULE_39__.MatMenuModule, _angular_material_slider__WEBPACK_IMPORTED_MODULE_40__.MatSliderModule, _angular_material_toolbar__WEBPACK_IMPORTED_MODULE_41__.MatToolbarModule, _angular_material_select__WEBPACK_IMPORTED_MODULE_42__.MatSelectModule, _angular_material_progress_spinner__WEBPACK_IMPORTED_MODULE_43__.MatProgressSpinnerModule, _angular_material_icon__WEBPACK_IMPORTED_MODULE_44__.MatIconModule, ngx_bootstrap_modal__WEBPACK_IMPORTED_MODULE_45__.ModalModule.forRoot(), ngx_bootstrap_tooltip__WEBPACK_IMPORTED_MODULE_46__.TooltipModule.forRoot(), ngx_bootstrap_tabs__WEBPACK_IMPORTED_MODULE_47__.TabsModule.forRoot(), ngx_bootstrap_dropdown__WEBPACK_IMPORTED_MODULE_48__.BsDropdownModule.forRoot(), ngx_bootstrap_popover__WEBPACK_IMPORTED_MODULE_49__.PopoverModule.forRoot(), primeng_fileupload__WEBPACK_IMPORTED_MODULE_50__.FileUploadModule, _app_routing_module__WEBPACK_IMPORTED_MODULE_0__.AppRoutingModule, _shared_utils_utils_module__WEBPACK_IMPORTED_MODULE_4__.UtilsModule, primeng_table__WEBPACK_IMPORTED_MODULE_51__.TableModule, primeng_listbox__WEBPACK_IMPORTED_MODULE_52__.ListboxModule, primeng_radiobutton__WEBPACK_IMPORTED_MODULE_53__.RadioButtonModule, primeng_calendar__WEBPACK_IMPORTED_MODULE_54__.CalendarModule, primeng_paginator__WEBPACK_IMPORTED_MODULE_55__.PaginatorModule, primeng_progressbar__WEBPACK_IMPORTED_MODULE_56__.ProgressBarModule, _metronic_app_core_core_module__WEBPACK_IMPORTED_MODULE_15__.CoreModule, primeng_confirmdialog__WEBPACK_IMPORTED_MODULE_57__.ConfirmDialogModule, primeng_dropdown__WEBPACK_IMPORTED_MODULE_58__.DropdownModule, primeng_tabview__WEBPACK_IMPORTED_MODULE_59__.TabViewModule, primeng_selectbutton__WEBPACK_IMPORTED_MODULE_32__.SelectButtonModule, primeng_tree__WEBPACK_IMPORTED_MODULE_60__.TreeModule, primeng_dialog__WEBPACK_IMPORTED_MODULE_61__.DialogModule, primeng_accordion__WEBPACK_IMPORTED_MODULE_62__.AccordionModule, primeng_sidebar__WEBPACK_IMPORTED_MODULE_63__.SidebarModule, primeng_multiselect__WEBPACK_IMPORTED_MODULE_64__.MultiSelectModule, primeng_slider__WEBPACK_IMPORTED_MODULE_65__.SliderModule, _asymmetrik_ngx_leaflet__WEBPACK_IMPORTED_MODULE_66__.LeafletModule, _asymmetrik_ngx_leaflet_markercluster__WEBPACK_IMPORTED_MODULE_67__.LeafletMarkerClusterModule, primeng_orderlist__WEBPACK_IMPORTED_MODULE_68__.OrderListModule, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_69__.GoogleTagManagerModule.forRoot({
    id: 'G-0MWHB1NG2M'
  }), _angular_common__WEBPACK_IMPORTED_MODULE_70__.CommonModule],
  providers: [(0,primeng_config__WEBPACK_IMPORTED_MODULE_71__.providePrimeNG)({
    theme: {
      preset: _primeng_themes_lara__WEBPACK_IMPORTED_MODULE_1__["default"],
      options: {
        darkModeSelector:  false || 'none'
      }
    }
  }), _shared_common_session_app_session_service__WEBPACK_IMPORTED_MODULE_8__.AppSessionService, _shared_common_ui_app_ui_customization_service__WEBPACK_IMPORTED_MODULE_9__.AppUiCustomizationService, _shared_common_nav_app_url_service__WEBPACK_IMPORTED_MODULE_10__.AppUrlService, _visualizationComponents_GanttComponent_gantt_chart_gantt_chart_service__WEBPACK_IMPORTED_MODULE_25__.GanttChartService, _golden_layout_component_service__WEBPACK_IMPORTED_MODULE_5__.GoldenLayoutComponentService, angular_plotly_js__WEBPACK_IMPORTED_MODULE_29__.PlotlyModule, (0,_angular_common_http__WEBPACK_IMPORTED_MODULE_72__.provideHttpClient)((0,_angular_common_http__WEBPACK_IMPORTED_MODULE_72__.withInterceptorsFromDi)(), (0,_angular_common_http__WEBPACK_IMPORTED_MODULE_72__.withJsonpSupport)())]
})], AppModule);


/***/ }),

/***/ 18784:
/*!*********************************************!*\
  !*** ./src/app/base-component.directive.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   BaseComponentDirective: () => (/* binding */ BaseComponentDirective)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/core */ 37580);


let BaseComponentDirective = class BaseComponentDirective {
  constructor(rootHtmlElement) {
    this.rootHtmlElement = rootHtmlElement;
  }
  setPositionAndSize(left, top, width, height) {
    this.rootHtmlElement.style.left = this.numberToPixels(left);
    this.rootHtmlElement.style.top = this.numberToPixels(top);
    this.rootHtmlElement.style.width = this.numberToPixels(width);
    this.rootHtmlElement.style.height = this.numberToPixels(height);
  }
  setVisibility(visible) {
    if (visible) {
      this.rootHtmlElement.style.display = '';
    } else {
      this.rootHtmlElement.style.display = 'none';
    }
  }
  setZIndex(value) {
    this.rootHtmlElement.style.zIndex = value;
  }
  /**
   * Convert a number to a string and adds 'px' at end of the string
   * @param value a number to be converted into string
   * @returns the string
   */
  numberToPixels(value) {
    return value.toString(10) + 'px';
  }
  static {
    this.ctorParameters = () => [{
      type: HTMLElement
    }];
  }
};
BaseComponentDirective = (0,tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_1__.Directive)(), (0,tslib__WEBPACK_IMPORTED_MODULE_0__.__metadata)("design:paramtypes", [HTMLElement])], BaseComponentDirective);

(function (BaseComponentDirective) {
  const GoldenLayoutContainerTokenName = 'GoldenLayoutContainer';
  BaseComponentDirective.GoldenLayoutContainerInjectionToken = new _angular_core__WEBPACK_IMPORTED_MODULE_1__.InjectionToken(GoldenLayoutContainerTokenName);
})(BaseComponentDirective || (BaseComponentDirective = {}));

/***/ }),

/***/ 32479:
/*!****************************************************!*\
  !*** ./src/app/constants/longStrings.constants.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   HBX2: () => (/* binding */ HBX2),
/* harmony export */   REFERENCE: () => (/* binding */ REFERENCE),
/* harmony export */   WATERMARK: () => (/* binding */ WATERMARK)
/* harmony export */ });
const REFERENCE = 'CCTCAGGTCACTCTTTGGCAACGACCCCTCGTCACAATAAAGATAGGGGGGCAACTAAAGGAAGCTCTATTAGATACAGGAGCAGATGATACAGTATTAGAAGAAATGAGTTTGCCAGGAAGATGGAAACCAAAAATGATAGGGGGAATTGGAGGTTTTATCAAAGTAAGACAGTATGATCAGATACTCATAGAAATCTGTGGACATAAAGCTATAGGTACAGTATTAGTAGGACCTACACCTGTCAACATAATTGGAAGAAATCTGTTGACTCAGATTGGTTGCACTTTAAATTTTCCCATTAGCCCTATTGAGACTGTACCAGTAAAATTAAAGCCAGGAATGGATGGCCCAAAAGTTAAACAATGGCCATTGACAGAAGAAAAAATAAAAGCATTAGTAGAAATTTGTACAGAGATGGAAAAGGAAGGGAAAATTTCAAAAATTGGGCCTGAAAATCCATACAATACTCCAGTATTTGCCATAAAGAAAAAAGACAGTACTAAATGGAGAAAATTAGTAGATTTCAGAGAACTTAATAAGAGAACTCAAGACTTCTGGGAAGTTCAATTAGGAATACCACATCCCGCAGGGTTAAAAAAGAAAAAATCAGTAACAGTACTGGATGTGGGTGATGCATATTTTTCAGTTCCCTTAGATGAAGACTTCAGGAAGTATACTGCATTTACCATACCTAGTATAAACAATGAGACACCAGGGATTAGATATCAGTACAATGTGCTTCCACAGGGATGGAAAGGATCACCAGCAATATTCCAAAGTAGCATGACAAAAATCTTAGAGCCTTTTAGAAAACAAAATCCAGACATAGTTATCTATCAATACATGGATGATTTGTATGTAGGATCTGACTTAGAAATAGGGCAGCATAGAACAAAAATAGAGGAGCTGAGACAACATCTGTTGAGGTGGGGACTTACCACACCAGACAAAAAACATCAGAAAGAACCTCCATTCCTTTGGATGGGTTATGAACTCCATCCTGATAAATGGACAGTACAGCCTATAGTGCTGCCAGAAAAAGACAGCTGGACTGTCAATGACATACAGAAGTTAGTGGGGAAATTGAATTGGGCAAGTCAGATTTACCCAGGGATTAAAGTAAGGCAATTATGTAAACTCCTTAGAGGAACCAAAGCACTAACAGAAGTAATACCACTAACAGAAGAAGCAGAGCTAGAACTGGCAGAAAACAGAGAGATTCTAAAAGAACCAGTACATGGAGTGTATTATGACCCATCAAAAGACTTAATAGCAGAAATACAGAAGCAGGGGCAAGGCCAATGGACATATCAAATTTATCAAGAGCCATTTAAAAATCTGAAAACAGGAAAATATGCAAGAATGAGGGGTGCCCACACTAATGATGTAAAACAATTAACAGAGGCAGTGCAAAAAATAACCACAGAAAGCATAGTAATATGGGGAAAGACTCCTAAATTTAAACTGCCCATACAAAAGGAAACATGGGAAACATGGTGGACAGAGTATTGGCAAGCCACCTGGATTCCTGAGTGGGAGTTTGTTAATACCCCTCCCTTAGTGAAATTATGGTACCAGTTAGAGAAAGAACCCATAGTAGGAGCAGAAACCTTC';
const HBX2 = 'TGGAAGGGCTAATTCACTCCCAACGAAGACAAGATATCCTTGATCTGTGGATCTACCACACACAAGGCTACTTCCCTGATTAGCAGAACTACACACCAGGGCCAGGGATCAGATATCCACTGACCTTTGGATGGTGCTACAAGCTAGTACCAGTTGAGCCAGAGAAGTTAGAAGAAGCCAACAAAGGAGAGAACACCAGCTTGTTACACCCTGTGAGCCTGCATGGAATGGATGACCCGGAGAGAGAAGTGTTAGAGTGGAGGTTTGACAGCCGCCTAGCATTTCATCACATGGCCCGAGAGCTGCATCCGGAGTACTTCAAGAACTGCTGACATCGAGCTTGCTACAAGGGACTTTCCGCTGGGGACTTTCCAGGGAGGCGTGGCCTGGGCGGGACTGGGGAGTGGCGAGCCCTCAGATCCTGCATATAAGCAGCTGCTTTTTGCCTGTACTGGGTCTCTCTGGTTAGACCAGATCTGAGCCTGGGAGCTCTCTGGCTAACTAGGGAACCCACTGCTTAAGCCTCAATAAAGCTTGCCTTGAGTGCTTCAAGTAGTGTGTGCCCGTCTGTTGTGTGACTCTGGTAACTAGAGATCCCTCAGACCCTTTTAGTCAGTGTGGAAAATCTCTAGCAGTGGCGCCCGAACAGGGACCTGAAAGCGAAAGGGAAACCAGAGGAGCTCTCTCGACGCAGGACTCGGCTTGCTGAAGCGCGCACGGCAAGAGGCGAGGGGCGGCGACTGGTGAGTACGCCAAAAATTTTGACTAGCGGAGGCTAGAAGGAGAGAGATGGGTGCGAGAGCGTCAGTATTAAGCGGGGGAGAATTAGATCGATGGGAAAAAATTCGGTTAAGGCCAGGGGGAAAGAAAAAATATAAATTAAAACATATAGTATGGGCAAGCAGGGAGCTAGAACGATTCGCAGTTAATCCTGGCCTGTTAGAAACATCAGAAGGCTGTAGACAAATACTGGGACAGCTACAACCATCCCTTCAGACAGGATCAGAAGAACTTAGATCATTATATAATACAGTAGCAACCCTCTATTGTGTGCATCAAAGGATAGAGATAAAAGACACCAAGGAAGCTTTAGACAAGATAGAGGAAGAGCAAAACAAAAGTAAGAAAAAAGCACAGCAAGCAGCAGCTGACACAGGACACAGCAATCAGGTCAGCCAAAATTACCCTATAGTGCAGAACATCCAGGGGCAAATGGTACATCAGGCCATATCACCTAGAACTTTAAATGCATGGGTAAAAGTAGTAGAAGAGAAGGCTTTCAGCCCAGAAGTGATACCCATGTTTTCAGCATTATCAGAAGGAGCCACCCCACAAGATTTAAACACCATGCTAAACACAGTGGGGGGACATCAAGCAGCCATGCAAATGTTAAAAGAGACCATCAATGAGGAAGCTGCAGAATGGGATAGAGTGCATCCAGTGCATGCAGGGCCTATTGCACCAGGCCAGATGAGAGAACCAAGGGGAAGTGACATAGCAGGAACTACTAGTACCCTTCAGGAACAAATAGGATGGATGACAAATAATCCACCTATCCCAGTAGGAGAAATTTATAAAAGATGGATAATCCTGGGATTAAATAAAATAGTAAGAATGTATAGCCCTACCAGCATTCTGGACATAAGACAAGGACCAAAGGAACCCTTTAGAGACTATGTAGACCGGTTCTATAAAACTCTAAGAGCCGAGCAAGCTTCACAGGAGGTAAAAAATTGGATGACAGAAACCTTGTTGGTCCAAAATGCGAACCCAGATTGTAAGACTATTTTAAAAGCATTGGGACCAGCGGCTACACTAGAAGAAATGATGACAGCATGTCAGGGAGTAGGAGGACCCGGCCATAAGGCAAGAGTTTTGGCTGAAGCAATGAGCCAAGTAACAAATTCAGCTACCATAATGATGCAGAGAGGCAATTTTAGGAACCAAAGAAAGATTGTTAAGTGTTTCAATTGTGGCAAAGAAGGGCACACAGCCAGAAATTGCAGGGCCCCTAGGAAAAAGGGCTGTTGGAAATGTGGAAAGGAAGGACACCAAATGAAAGATTGTACTGAGAGACAGGCTAATTTTTTAGGGAAGATCTGGCCTTCCTACAAGGGAAGGCCAGGGAATTTTCTTCAGAGCAGACCAGAGCCAACAGCCCCACCAGAAGAGAGCTTCAGGTCTGGGGTAGAGACAACAACTCCCCCTCAGAAGCAGGAGCCGATAGACAAGGAACTGTATCCTTTAACTTCCCTCAGGTCACTCTTTGGCAACGACCCCTCGTCACAATAAAGATAGGGGGGCAACTAAAGGAAGCTCTATTAGATACAGGAGCAGATGATACAGTATTAGAAGAAATGAGTTTGCCAGGAAGATGGAAACCAAAAATGATAGGGGGAATTGGAGGTTTTATCAAAGTAAGACAGTATGATCAGATACTCATAGAAATCTGTGGACATAAAGCTATAGGTACAGTATTAGTAGGACCTACACCTGTCAACATAATTGGAAGAAATCTGTTGACTCAGATTGGTTGCACTTTAAATTTTCCCATTAGCCCTATTGAGACTGTACCAGTAAAATTAAAGCCAGGAATGGATGGCCCAAAAGTTAAACAATGGCCATTGACAGAAGAAAAAATAAAAGCATTAGTAGAAATTTGTACAGAGATGGAAAAGGAAGGGAAAATTTCAAAAATTGGGCCTGAAAATCCATACAATACTCCAGTATTTGCCATAAAGAAAAAAGACAGTACTAAATGGAGAAAATTAGTAGATTTCAGAGAACTTAATAAGAGAACTCAAGACTTCTGGGAAGTTCAATTAGGAATACCACATCCCGCAGGGTTAAAAAAGAAAAAATCAGTAACAGTACTGGATGTGGGTGATGCATATTTTTCAGTTCCCTTAGATGAAGACTTCAGGAAGTATACTGCATTTACCATACCTAGTATAAACAATGAGACACCAGGGATTAGATATCAGTACAATGTGCTTCCACAGGGATGGAAAGGATCACCAGCAATATTCCAAAGTAGCATGACAAAAATCTTAGAGCCTTTTAGAAAACAAAATCCAGACATAGTTATCTATCAATACATGGATGATTTGTATGTAGGATCTGACTTAGAAATAGGGCAGCATAGAACAAAAATAGAGGAGCTGAGACAACATCTGTTGAGGTGGGGACTTACCACACCAGACAAAAAACATCAGAAAGAACCTCCATTCCTTTGGATGGGTTATGAACTCCATCCTGATAAATGGACAGTACAGCCTATAGTGCTGCCAGAAAAAGACAGCTGGACTGTCAATGACATACAGAAGTTAGTGGGGAAATTGAATTGGGCAAGTCAGATTTACCCAGGGATTAAAGTAAGGCAATTATGTAAACTCCTTAGAGGAACCAAAGCACTAACAGAAGTAATACCACTAACAGAAGAAGCAGAGCTAGAACTGGCAGAAAACAGAGAGATTCTAAAAGAACCAGTACATGGAGTGTATTATGACCCATCAAAAGACTTAATAGCAGAAATACAGAAGCAGGGGCAAGGCCAATGGACATATCAAATTTATCAAGAGCCATTTAAAAATCTGAAAACAGGAAAATATGCAAGAATGAGGGGTGCCCACACTAATGATGTAAAACAATTAACAGAGGCAGTGCAAAAAATAACCACAGAAAGCATAGTAATATGGGGAAAGACTCCTAAATTTAAACTGCCCATACAAAAGGAAACATGGGAAACATGGTGGACAGAGTATTGGCAAGCCACCTGGATTCCTGAGTGGGAGTTTGTTAATACCCCTCCCTTAGTGAAATTATGGTACCAGTTAGAGAAAGAACCCATAGTAGGAGCAGAAACCTTCTATGTAGATGGGGCAGCTAACAGGGAGACTAAATTAGGAAAAGCAGGATATGTTACTAATAGAGGAAGACAAAAAGTTGTCACCCTAACTGACACAACAAATCAGAAGACTGAGTTACAAGCAATTTATCTAGCTTTGCAGGATTCGGGATTAGAAGTAAACATAGTAACAGACTCACAATATGCATTAGGAATCATTCAAGCACAACCAGATCAAAGTGAATCAGAGTTAGTCAATCAAATAATAGAGCAGTTAATAAAAAAGGAAAAGGTCTATCTGGCATGGGTACCAGCACACAAAGGAATTGGAGGAAATGAACAAGTAGATAAATTAGTCAGTGCTGGAATCAGGAAAGTACTATTTTTAGATGGAATAGATAAGGCCCAAGATGAACATGAGAAATATCACAGTAATTGGAGAGCAATGGCTAGTGATTTTAACCTGCCACCTGTAGTAGCAAAAGAAATAGTAGCCAGCTGTGATAAATGTCAGCTAAAAGGAGAAGCCATGCATGGACAAGTAGACTGTAGTCCAGGAATATGGCAACTAGATTGTACACATTTAGAAGGAAAAGTTATCCTGGTAGCAGTTCATGTAGCCAGTGGATATATAGAAGCAGAAGTTATTCCAGCAGAAACAGGGCAGGAAACAGCATATTTTCTTTTAAAATTAGCAGGAAGATGGCCAGTAAAAACAATACATACTGACAATGGCAGCAATTTCACCGGTGCTACGGTTAGGGCCGCCTGTTGGTGGGCGGGAATCAAGCAGGAATTTGGAATTCCCTACAATCCCCAAAGTCAAGGAGTAGTAGAATCTATGAATAAAGAATTAAAGAAAATTATAGGACAGGTAAGAGATCAGGCTGAACATCTTAAGACAGCAGTACAAATGGCAGTATTCATCCACAATTTTAAAAGAAAAGGGGGGATTGGGGGGTACAGTGCAGGGGAAAGAATAGTAGACATAATAGCAACAGACATACAAACTAAAGAATTACAAAAACAAATTACAAAAATTCAAAATTTTCGGGTTTATTACAGGGACAGCAGAAATCCACTTTGGAAAGGACCAGCAAAGCTCCTCTGGAAAGGTGAAGGGGCAGTAGTAATACAAGATAATAGTGACATAAAAGTAGTGCCAAGAAGAAAAGCAAAGATCATTAGGGATTATGGAAAACAGATGGCAGGTGATGATTGTGTGGCAAGTAGACAGGATGAGGATTAGAACATGGAAAAGTTTAGTAAAACACCATATGTATGTTTCAGGGAAAGCTAGGGGATGGTTTTATAGACATCACTATGAAAGCCCTCATCCAAGAATAAGTTCAGAAGTACACATCCCACTAGGGGATGCTAGATTGGTAATAACAACATATTGGGGTCTGCATACAGGAGAAAGAGACTGGCATTTGGGTCAGGGAGTCTCCATAGAATGGAGGAAAAAGAGATATAGCACACAAGTAGACCCTGAACTAGCAGACCAACTAATTCATCTGTATTACTTTGACTGTTTTTCAGACTCTGCTATAAGAAAGGCCTTATTAGGACACATAGTTAGCCCTAGGTGTGAATATCAAGCAGGACATAACAAGGTAGGATCTCTACAATACTTGGCACTAGCAGCATTAATAACACCAAAAAAGATAAAGCCACCTTTGCCTAGTGTTACGAAACTGACAGAGGATAGATGGAACAAGCCCCAGAAGACCAAGGGCCACAGAGGGAGCCACACAATGAATGGACACTAGAGCTTTTAGAGGAGCTTAAGAATGAAGCTGTTAGACATTTTCCTAGGATTTGGCTCCATGGCTTAGGGCAACATATCTATGAAACTTATGGGGATACTTGGGCAGGAGTGGAAGCCATAATAAGAATTCTGCAACAACTGCTGTTTATCCATTTTCAGAATTGGGTGTCGACATAGCAGAATAGGCGTTACTCGACAGAGGAGAGCAAGAAATGGAGCCAGTAGATCCTAGACTAGAGCCCTGGAAGCATCCAGGAAGTCAGCCTAAAACTGCTTGTACCAATTGCTATTGTAAAAAGTGTTGCTTTCATTGCCAAGTTTGTTTCATAACAAAAGCCTTAGGCATCTCCTATGGCAGGAAGAAGCGGAGACAGCGACGAAGAGCTCATCAGAACAGTCAGACTCATCAAGCTTCTCTATCAAAGCAGTAAGTAGTACATGTAACGCAACCTATACCAATAGTAGCAATAGTAGCATTAGTAGTAGCAATAATAATAGCAATAGTTGTGTGGTCCATAGTAATCATAGAATATAGGAAAATATTAAGACAAAGAAAAATAGACAGGTTAATTGATAGACTAATAGAAAGAGCAGAAGACAGTGGCAATGAGAGTGAAGGAGAAATATCAGCACTTGTGGAGATGGGGGTGGAGATGGGGCACCATGCTCCTTGGGATGTTGATGATCTGTAGTGCTACAGAAAAATTGTGGGTCACAGTCTATTATGGGGTACCTGTGTGGAAGGAAGCAACCACCACTCTATTTTGTGCATCAGATGCTAAAGCATATGATACAGAGGTACATAATGTTTGGGCCACACATGCCTGTGTACCCACAGACCCCAACCCACAAGAAGTAGTATTGGTAAATGTGACAGAAAATTTTAACATGTGGAAAAATGACATGGTAGAACAGATGCATGAGGATATAATCAGTTTATGGGATCAAAGCCTAAAGCCATGTGTAAAATTAACCCCACTCTGTGTTAGTTTAAAGTGCACTGATTTGAAGAATGATACTAATACCAATAGTAGTAGCGGGAGAATGATAATGGAGAAAGGAGAGATAAAAAACTGCTCTTTCAATATCAGCACAAGCATAAGAGGTAAGGTGCAGAAAGAATATGCATTTTTTTATAAACTTGATATAATACCAATAGATAATGATACTACCAGCTATAAGTTGACAAGTTGTAACACCTCAGTCATTACACAGGCCTGTCCAAAGGTATCCTTTGAGCCAATTCCCATACATTATTGTGCCCCGGCTGGTTTTGCGATTCTAAAATGTAATAATAAGACGTTCAATGGAACAGGACCATGTACAAATGTCAGCACAGTACAATGTACACATGGAATTAGGCCAGTAGTATCAACTCAACTGCTGTTAAATGGCAGTCTAGCAGAAGAAGAGGTAGTAATTAGATCTGTCAATTTCACGGACAATGCTAAAACCATAATAGTACAGCTGAACACATCTGTAGAAATTAATTGTACAAGACCCAACAACAATACAAGAAAAAGAATCCGTATCCAGAGAGGACCAGGGAGAGCATTTGTTACAATAGGAAAAATAGGAAATATGAGACAAGCACATTGTAACATTAGTAGAGCAAAATGGAATAACACTTTAAAACAGATAGCTAGCAAATTAAGAGAACAATTTGGAAATAATAAAACAATAATCTTTAAGCAATCCTCAGGAGGGGACCCAGAAATTGTAACGCACAGTTTTAATTGTGGAGGGGAATTTTTCTACTGTAATTCAACACAACTGTTTAATAGTACTTGGTTTAATAGTACTTGGAGTACTGAAGGGTCAAATAACACTGAAGGAAGTGACACAATCACCCTCCCATGCAGAATAAAACAAATTATAAACATGTGGCAGAAAGTAGGAAAAGCAATGTATGCCCCTCCCATCAGTGGACAAATTAGATGTTCATCAAATATTACAGGGCTGCTATTAACAAGAGATGGTGGTAATAGCAACAATGAGTCCGAGATCTTCAGACCTGGAGGAGGAGATATGAGGGACAATTGGAGAAGTGAATTATATAAATATAAAGTAGTAAAAATTGAACCATTAGGAGTAGCACCCACCAAGGCAAAGAGAAGAGTGGTGCAGAGAGAAAAAAGAGCAGTGGGAATAGGAGCTTTGTTCCTTGGGTTCTTGGGAGCAGCAGGAAGCACTATGGGCGCAGCCTCAATGACGCTGACGGTACAGGCCAGACAATTATTGTCTGGTATAGTGCAGCAGCAGAACAATTTGCTGAGGGCTATTGAGGCGCAACAGCATCTGTTGCAACTCACAGTCTGGGGCATCAAGCAGCTCCAGGCAAGAATCCTGGCTGTGGAAAGATACCTAAAGGATCAACAGCTCCTGGGGATTTGGGGTTGCTCTGGAAAACTCATTTGCACCACTGCTGTGCCTTGGAATGCTAGTTGGAGTAATAAATCTCTGGAACAGATTTGGAATCACACGACCTGGATGGAGTGGGACAGAGAAATTAACAATTACACAAGCTTAATACACTCCTTAATTGAAGAATCGCAAAACCAGCAAGAAAAGAATGAACAAGAATTATTGGAATTAGATAAATGGGCAAGTTTGTGGAATTGGTTTAACATAACAAATTGGCTGTGGTATATAAAATTATTCATAATGATAGTAGGAGGCTTGGTAGGTTTAAGAATAGTTTTTGCTGTACTTTCTATAGTGAATAGAGTTAGGCAGGGATATTCACCATTATCGTTTCAGACCCACCTCCCAACCCCGAGGGGACCCGACAGGCCCGAAGGAATAGAAGAAGAAGGTGGAGAGAGAGACAGAGACAGATCCATTCGATTAGTGAACGGATCCTTGGCACTTATCTGGGACGATCTGCGGAGCCTGTGCCTCTTCAGCTACCACCGCTTGAGAGACTTACTCTTGATTGTAACGAGGATTGTGGAACTTCTGGGACGCAGGGGGTGGGAAGCCCTCAAATATTGGTGGAATCTCCTACAGTATTGGAGTCAGGAACTAAAGAATAGTGCTGTTAGCTTGCTCAATGCCACAGCCATAGCAGTAGCTGAGGGGACAGATAGGGTTATAGAAGTAGTACAAGGAGCTTGTAGAGCTATTCGCCACATACCTAGAAGAATAAGACAGGGCTTGGAAAGGATTTTGCTATAAGATGGGTGGCAAGTGGTCAAAAAGTAGTGTGATTGGATGGCCTACTGTAAGGGAAAGAATGAGACGAGCTGAGCCAGCAGCAGATAGGGTGGGAGCAGCATCTCGAGACCTGGAAAAACATGGAGCAATCACAAGTAGCAATACAGCAGCTACCAATGCTGCTTGTGCCTGGCTAGAAGCACAAGAGGAGGAGGAGGTGGGTTTTCCAGTCACACCTCAGGTACCTTTAAGACCAATGACTTACAAGGCAGCTGTAGATCTTAGCCACTTTTTAAAAGAAAAGGGGGGACTGGAAGGGCTAATTCACTCCCAAAGAAGACAAGATATCCTTGATCTGTGGATCTACCACACACAAGGCTACTTCCCTGATTAGCAGAACTACACACCAGGGCCAGGGGTCAGATATCCACTGACCTTTGGATGGTGCTACAAGCTAGTACCAGTTGAGCCAGATAAGATAGAAGAGGCCAATAAAGGAGAGAACACCAGCTTGTTACACCCTGTGAGCCTGCATGGGATGGATGACCCGGAGAGAGAAGTGTTAGAGTGGAGGTTTGACAGCCGCCTAGCATTTCATCACGTGGCCCGAGAGCTGCATCCGGAGTACTTCAAGAACTGCTGACATCGAGCTTGCTACAAGGGACTTTCCGCTGGGGACTTTCCAGGGAGGCGTGGCCTGGGCGGGACTGGGGAGTGGCGAGCCCTCAGATCCTGCATATAAGCAGCTGCTTTTTGCCTGTACTGGGTCTCTCTGGTTAGACCAGATCTGAGCCTGGGAGCTCTCTGGCTAACTAGGGAACCCACTGCTTAAGCCTCAATAAAGCTTGCCTTGAGTGCTTCAAGTAGTGTGTGCCCGTCTGTTGTGTGACTCTGGTAACTAGAGATCCCTCAGACCCTTTTAGTCAGTGTGGAAAATCTCTAGCA';
const WATERMARK = 'data:image/png;base64,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';


/***/ }),

/***/ 69202:
/*!*********************************************************************!*\
  !*** ./src/app/contactTraceCommonServices/color-mapping.service.ts ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ColorMappingService: () => (/* binding */ ColorMappingService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! d3 */ 86164);



/**
 * A dedicated service for node, link, polygon color mapping.
 * It is "pure" in that it does NOT own or mutate your session object.
 * Instead, it expects all required data (arrays, color config, etc.)
 * as method parameters and returns color scales or any updated arrays.
 */
let ColorMappingService = class ColorMappingService {
  constructor() {}
  /**
   * Creates a node color-mapping scale based on a specified "nodeColorVariable"
   * and a set of node items. Rather than referencing session or temp directly,
   * we accept them as parameters.
   *
   * @param nodes An array of node objects
   * @param nodeColorVariable The property name used to categorize node colors
   * @param nodeColors The current palette of colors (e.g. d3.schemeCategory10)
   * @param nodeAlphas The array of alpha (transparency) values
   * @param nodeColorsTable existing table of (variable -> list of assigned colors)
   * @param nodeColorsTableKeys existing table of (variable -> keys domain)
   * @param nodeColorsTableHistory used to persist color assignments over time
   * @param debugMode to enable/disable console logging
   * @returns an object containing:
   *    {
   *      aggregates: Record<string, number>;
   *      colorMap: d3.ScaleOrdinal<string, string>;
   *      alphaMap: d3.ScaleOrdinal<string, number>;
   *      updatedNodeColors: string[];   // possibly expanded to handle more categories
   *      updatedNodeAlphas: number[];   // same as above
   *      updatedColorsTable: any;       // the updated nodeColorsTable
   *      updatedColorsTableKeys: any;   // the updated nodeColorsTableKeys
   *      updatedColorsTableHistory: any;// updated nodeColorsTableHistory
   *    }
   */
  createNodeColorMap(nodes, nodeColorVariable, nodeColors, nodeAlphas, nodeColorsTable, nodeColorsTableKeys, nodeColorsTableHistory, debugMode) {
    // If user hasn't chosen a variable, just return a single uniform color mapping
    if (nodeColorVariable === 'None') {
      const uniformMap = () => nodeColors[0] || '#1f77b4';
      return {
        aggregates: {},
        colorMap: d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal([uniformMap()]).domain([]),
        alphaMap: d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal([1]).domain([]),
        updatedNodeColors: nodeColors,
        updatedNodeAlphas: nodeAlphas,
        updatedColorsTable: nodeColorsTable,
        updatedColorsTableKeys: nodeColorsTableKeys,
        updatedColorsTableHistory: nodeColorsTableHistory
      };
    }
    if (debugMode) {
      console.log('[createNodeColorMap] Starting with variable =', nodeColorVariable);
    }
    // Make sure the color tables exist
    const updatedColorsTable = nodeColorsTable || {};
    const updatedColorsTableKeys = nodeColorsTableKeys || {};
    let updatedNodeColors = [...nodeColors]; // we may expand this array
    let updatedNodeAlphas = [...nodeAlphas]; // same reason
    let updatedColorsTableHistory = nodeColorsTableHistory || {
      'null': '#EAE553'
    };
    // If we already have a stored array of colors for this particular variable
    // (like "nodeColorsTable[myVariable]"), lets reuse them
    if (!updatedColorsTable[nodeColorVariable]) {
      updatedColorsTable[nodeColorVariable] = updatedNodeColors;
    } else {
      updatedNodeColors = [...updatedColorsTable[nodeColorVariable]];
    }
    // Compute aggregates by scanning all node values
    const aggregates = {};
    nodes.forEach(d => {
      const val = d[nodeColorVariable];
      if (!d.visible) {
        // If node is not visible, you can decide to skip or do aggregates[val] = 0;
        return;
      }
      aggregates[val] = (aggregates[val] || 0) + 1;
    });
    const distinctValues = Object.keys(aggregates);
    // Expand color array if needed
    if (distinctValues.length > updatedNodeColors.length) {
      let expandedColors = [];
      let neededTimes = Math.ceil(distinctValues.length / updatedNodeColors.length);
      while (neededTimes-- > 0) {
        expandedColors = expandedColors.concat(updatedNodeColors);
      }
      updatedNodeColors = expandedColors;
    }
    // Expand alpha array if needed
    if (distinctValues.length > updatedNodeAlphas.length) {
      updatedNodeAlphas = updatedNodeAlphas.concat(new Array(distinctValues.length - updatedNodeAlphas.length).fill(1));
    }
    // Maintain color history to keep consistent color assignment
    const historyKeys = Object.keys(updatedColorsTableHistory);
    // For each distinct value, see if we have a color in the history
    distinctValues.forEach((val, i) => {
      const indexInHistory = historyKeys.indexOf(val);
      if (indexInHistory !== -1) {
        // We previously assigned a color to this value
        updatedNodeColors[i] = updatedColorsTableHistory[val];
      } else {
        // Not in history -> record it
        updatedColorsTableHistory[val] = updatedNodeColors[i];
      }
      if (val === 'null') {
        updatedNodeColors[i] = '#EAE553';
      }
    });
    // We store this updated array back into the table
    updatedColorsTableKeys[nodeColorVariable] = distinctValues;
    updatedColorsTable[nodeColorVariable] = updatedNodeColors;
    // Create the scale functions
    const colorMap = d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal(updatedNodeColors).domain(distinctValues);
    const alphaMap = d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal(updatedNodeAlphas).domain(distinctValues);
    if (debugMode) {
      console.log('[createNodeColorMap] Done. Distinct values:', distinctValues);
    }
    return {
      aggregates,
      colorMap,
      alphaMap,
      updatedNodeColors,
      updatedNodeAlphas,
      updatedColorsTable,
      updatedColorsTableKeys,
      updatedColorsTableHistory
    };
  }
  /**
   * Very similar approach for Link Color Mapping
   */
  createLinkColorMap(links, linkColorVariable, linkColors, linkAlphas, linkColorsTable, linkColorsTableKeys, debugMode) {
    // If user hasn't chosen a variable
    if (linkColorVariable === 'None') {
      const uniformLinkColor = linkColors[0] || '#a6cee3';
      return {
        aggregates: {},
        colorMap: d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal([uniformLinkColor]).domain([]),
        alphaMap: d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal([1]).domain([]),
        updatedLinkColors: linkColors,
        updatedLinkAlphas: linkAlphas,
        updatedLinkColorsTable: linkColorsTable,
        updatedLinkColorsTableKeys: linkColorsTableKeys
      };
    }
    if (debugMode) {
      console.log('[createLinkColorMap] Starting, var =', linkColorVariable);
    }
    const updatedLinkColorsTable = linkColorsTable || {};
    const updatedLinkColorsTableKeys = linkColorsTableKeys || {};
    let updatedLinkColors = [...linkColors];
    let updatedLinkAlphas = [...linkAlphas];
    // If no existing color array for the chosen link variable
    if (!updatedLinkColorsTable[linkColorVariable]) {
      updatedLinkColorsTable[linkColorVariable] = updatedLinkColors;
    } else {
      updatedLinkColors = [...updatedLinkColorsTable[linkColorVariable]];
    }
    let multiLinkCount = 0; // Initialize Multi-Link count
    // Collect aggregates
    const aggregates = {};
    links.forEach(l => {
      if (!l.visible) return;
      if (linkColorVariable.toLowerCase() === 'origin') {
        // If origin is an array of strings
        l.origin.forEach(o => {
          aggregates[o] = (aggregates[o] || 0) + 1;
        });
        // Count Multi-Links separately
        if (l.origin.length == 2) {
          multiLinkCount++;
        }
      } else {
        const val = l[linkColorVariable];
        aggregates[val] = (aggregates[val] || 0) + 1;
      }
    });
    // Add Multi-Link to aggregates if it exists
    if (multiLinkCount > 0) {
      aggregates["Duo-Link"] = multiLinkCount;
    }
    // Adjust counts for other links by subtracting Multi-Link count
    Object.keys(aggregates).forEach(key => {
      if (key !== "Duo-Link") {
        aggregates[key] -= multiLinkCount; // Subtract Multi-Link count
      }
    });
    const distinctValues = Object.keys(aggregates);
    // Possibly handle multi-link or other specifics if needed
    // For now, we skip that for clarity. If needed, you can replicate your duo-link logic.
    // Expand link colors if needed
    if (distinctValues.length > updatedLinkColors.length) {
      let expandedColors = [];
      let neededTimes = Math.ceil(distinctValues.length / updatedLinkColors.length);
      while (neededTimes-- > 0) {
        expandedColors = expandedColors.concat(updatedLinkColors);
      }
      updatedLinkColors = expandedColors;
    }
    // Expand link alphas if needed
    if (distinctValues.length > updatedLinkAlphas.length) {
      updatedLinkAlphas = updatedLinkAlphas.concat(new Array(distinctValues.length - updatedLinkAlphas.length).fill(1));
    }
    updatedLinkColorsTableKeys[linkColorVariable] = distinctValues;
    updatedLinkColorsTable[linkColorVariable] = updatedLinkColors;
    const colorMap = d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal(updatedLinkColors).domain(distinctValues);
    const alphaMap = d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal(updatedLinkAlphas).domain(distinctValues);
    if (debugMode) {
      console.log('[createLinkColorMap] Done. Distinct values:', distinctValues);
    }
    return {
      aggregates,
      colorMap,
      alphaMap,
      updatedLinkColors,
      updatedLinkAlphas,
      updatedLinkColorsTable,
      updatedLinkColorsTableKeys
    };
  }
  /**
   * Example: A polygon color map for grouping clusters or polygons, if relevant.
   */
  createPolygonColorMap(polygonGroups, polygonColors, polygonAlphas, debugMode) {
    // If no polygon groups, treat as uniform color
    if (!polygonGroups || polygonGroups.length === 0) {
      return {
        aggregates: {},
        colorMap: d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal([polygonColors[0] || '#bbccee']).domain([]),
        alphaMap: d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal([0.5]).domain([]),
        updatedPolygonColors: polygonColors,
        updatedPolygonAlphas: polygonAlphas
      };
    }
    const aggregates = {};
    polygonGroups.forEach(g => {
      aggregates[g.key] = g.values.length;
    });
    const distinctValues = Object.keys(aggregates);
    let updatedPolygonColors = [...polygonColors];
    let updatedPolygonAlphas = [...polygonAlphas];
    // Expand if necessary
    if (distinctValues.length > updatedPolygonColors.length) {
      let expanded = [];
      let neededTimes = Math.ceil(distinctValues.length / updatedPolygonColors.length);
      while (neededTimes-- > 0) {
        expanded = expanded.concat(updatedPolygonColors);
      }
      updatedPolygonColors = expanded;
    }
    if (distinctValues.length > updatedPolygonAlphas.length) {
      updatedPolygonAlphas = updatedPolygonAlphas.concat(new Array(distinctValues.length - updatedPolygonAlphas.length).fill(0.5));
    }
    const colorMap = d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal(updatedPolygonColors).domain(distinctValues);
    const alphaMap = d3__WEBPACK_IMPORTED_MODULE_0__.scaleOrdinal(updatedPolygonAlphas).domain(distinctValues);
    if (debugMode) {
      console.log('[createPolygonColorMap] done. Distinct values:', distinctValues);
    }
    return {
      aggregates,
      colorMap,
      alphaMap,
      updatedPolygonColors,
      updatedPolygonAlphas
    };
  }
  /**
   * If you had a contrastColor function, just keep it simple:
   */
  contrastColor(hexcolor) {
    const r = parseInt(hexcolor.substr(1, 2), 16);
    const g = parseInt(hexcolor.substr(3, 2), 16);
    const b = parseInt(hexcolor.substr(5, 2), 16);
    const yiq = r * 299 + g * 587 + b * 114;
    return yiq >= 128000 ? '#000000' : '#ffffff';
  }
  static {
    this.ctorParameters = () => [];
  }
};
ColorMappingService = (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.Injectable)({
  providedIn: 'root'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__metadata)("design:paramtypes", [])], ColorMappingService);


/***/ }),

/***/ 16546:
/*!*********************************************************************!*\
  !*** ./src/app/contactTraceCommonServices/common-store.services.ts ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CommonStoreService: () => (/* binding */ CommonStoreService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! rxjs */ 75797);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! rxjs */ 10819);



let CommonStoreService = class CommonStoreService {
  constructor() {
    // ----------------------------
    // State Subjects
    // ----------------------------
    this._linkThreshold$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(0.015);
    this.linkThreshold$ = this._linkThreshold$.asObservable();
    this._networkRendered$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(false);
    this.networkRendered$ = this._networkRendered$.asObservable();
    this._loadingMessageUpdated$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject('');
    this.loadingMessageUpdated$ = this._loadingMessageUpdated$.asObservable();
    this._networkUpdated$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(false);
    this.networkUpdated$ = this._networkUpdated$.asObservable();
    this._settingsLoaded$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(false);
    this.settingsLoaded$ = this._settingsLoaded$.asObservable();
    this._metricChanged$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(null);
    this.metricChanged$ = this._metricChanged$.asObservable();
    this._sessionDestroyed$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(false);
    this.sessionDestroyed$ = this._sessionDestroyed$.asObservable();
    this._newSession$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(false);
    this.newSession$ = this._newSession$.asObservable();
    this._styleFileApplied$ = new rxjs__WEBPACK_IMPORTED_MODULE_1__.Subject();
    this.styleFileApplied$ = this._styleFileApplied$.asObservable();
    this._tableCleared$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(null);
    this.tableCleared$ = this._tableCleared$.asObservable();
    this._statisticsChanged$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(null);
    this.statisticsChanged$ = this._statisticsChanged$.asObservable();
    this._FP_removeFiles$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject(null);
    this.FP_removeFiles$ = this._FP_removeFiles$.asObservable();
    this.currentThresholdStepSize = 0.001;
  }
  /**
   * Generic update method that emits a new value only if it differs
   * from the current value.
   */
  updateValue(subject, newValue) {
    if (subject.value !== newValue) {
      subject.next(newValue);
    }
  }
  // ----------------------------
  // Getters & Setters
  // ----------------------------
  get linkThresholdValue() {
    return this._linkThreshold$.value;
  }
  setLinkThreshold(newThreshold) {
    this.updateValue(this._linkThreshold$, newThreshold);
  }
  get networkRenderedValue() {
    return this._networkRendered$.value;
  }
  setNetworkRendered(isRendered) {
    this.updateValue(this._networkRendered$, isRendered);
  }
  get loadingMessageUpdatedValue() {
    return this._loadingMessageUpdated$.value;
  }
  setLoadingMessageUpdated(message) {
    this.updateValue(this._loadingMessageUpdated$, message);
  }
  get networkUpdatedValue() {
    return this._networkUpdated$.value;
  }
  setNetworkUpdated(isUpdated) {
    this.updateValue(this._networkUpdated$, isUpdated);
  }
  get settingsLoadedValue() {
    return this._settingsLoaded$.value;
  }
  setSettingsLoaded(loaded) {
    this.updateValue(this._settingsLoaded$, loaded);
  }
  get metricChangedValue() {
    return this._metricChanged$.value;
  }
  setMetricChanged(newMetric) {
    this.updateValue(this._metricChanged$, newMetric);
  }
  get sessionDestroyedValue() {
    return this._sessionDestroyed$.value;
  }
  setSessionDestroyed(value) {
    this.updateValue(this._sessionDestroyed$, value);
  }
  get newSessionValue() {
    return this._newSession$.value;
  }
  setNewSession(value) {
    this.updateValue(this._newSession$, value);
  }
  setStyleFileApplied() {
    this._styleFileApplied$.next();
  }
  get tableClearedValue() {
    return this._tableCleared$.value;
  }
  setTableCleared(value) {
    this.updateValue(this._tableCleared$, value);
  }
  get statisticsChangedValue() {
    return this._statisticsChanged$.value;
  }
  setStatisticsChanged(value) {
    this.updateValue(this._statisticsChanged$, value);
  }
  get FP_removeFilesValue() {
    return this._FP_removeFiles$.value;
  }
  setFP_removeFiles(value) {
    this.updateValue(this._FP_removeFiles$, value);
  }
  updatecurrentThresholdStepSize(distanceMetric) {
    this.currentThresholdStepSize = distanceMetric === 'snps' ? 1 : 0.001;
  }
  get currentThresholdStepSizeValue() {
    return this.currentThresholdStepSize;
  }
  static {
    this.ctorParameters = () => [];
  }
};
CommonStoreService = (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_3__.Injectable)({
  providedIn: 'root'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__metadata)("design:paramtypes", [])], CommonStoreService);


/***/ }),

/***/ 42107:
/*!**************************************************************!*\
  !*** ./src/app/contactTraceCommonServices/common.service.ts ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CommonService: () => (/* binding */ CommonService)
/* harmony export */ });
/* harmony import */ var _Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 89204);
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! rxjs */ 75797);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! rxjs */ 43942);
/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! d3 */ 86164);
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! patristic */ 50826);
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(patristic__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! papaparse */ 92853);
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(papaparse__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! lodash */ 46227);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! moment */ 39545);
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _workers_workModule__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../workers/workModule */ 53597);
/* harmony import */ var _shared_utils_local_storage_service__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @shared/utils/local-storage.service */ 47674);
/* harmony import */ var _app_helperClasses_auspiceHandler__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @app/helperClasses/auspiceHandler */ 1481);
/* harmony import */ var _shared_common_app_component_base__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @shared/common/app-component-base */ 2449);
/* harmony import */ var _microbe_trace_next_plugin_visuals__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../microbe-trace-next-plugin-visuals */ 53193);
/* harmony import */ var _angular_common_http__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @angular/common/http */ 46443);
/* harmony import */ var _common_store_services__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./common-store.services */ 16546);
/* harmony import */ var _app_constants_longStrings_constants__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @app/constants/longStrings.constants */ 32479);
/* harmony import */ var _color_mapping_service__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./color-mapping.service */ 69202);
/* harmony import */ var _worker_compute_service__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./worker-compute.service */ 46404);



















let CommonService = class CommonService extends _shared_common_app_component_base__WEBPACK_IMPORTED_MODULE_9__.AppComponentBase {
  setLinkTableElement(element) {
    this.linkElementSource.next(element);
  }
  setNodeTableElement(element) {
    this.nodeElementSource.next(element);
  }
  /**
   * @param injector
   * @param localStorageService
   * @param visuals - this injection allows users to access all the views from commonService (ie. commonService.visuals.twoD)
   * @param http
   */
  constructor(injector, localStorageService, visuals, http, store, colorMappingService, workerComputeService
  // private srv: GoldenLayoutService
  ) {
    super(injector);
    this.localStorageService = localStorageService;
    this.visuals = visuals;
    this.http = http;
    this.store = store;
    this.colorMappingService = colorMappingService;
    this.workerComputeService = workerComputeService;
    this.LoadViewEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_15__.EventEmitter();
    this.decoder = new TextDecoder('utf-8');
    this.r01 = Math.random;
    this.activeTab = 'Files';
    // Set this to true to enable the debug mode/console logs to appear
    this.debugMode = false;
    this.linkElementSource = new rxjs__WEBPACK_IMPORTED_MODULE_16__.BehaviorSubject(null);
    this.nodeElementSource = new rxjs__WEBPACK_IMPORTED_MODULE_16__.BehaviorSubject(null);
    this.currentLinkTableElement = this.linkElementSource.asObservable();
    this.currentNodeTableElement = this.nodeElementSource.asObservable();
    // Using lodash's debounce, for example
    this._debouncedUpdateNetworkVisuals = lodash__WEBPACK_IMPORTED_MODULE_4__.debounce(() => {
      this.updateNetworkVisuals();
    }, 300);
    this.GlobalSettingsModel = {
      SelectedColorNodesByVariable: 'None',
      SelectedColorLinksByVariable: 'None',
      SelectedNodeColorVariable: 'None',
      SelectedLinkColorVariable: '#a6cee3',
      SelectedPruneWityTypesVariable: 'None',
      SelectedStatisticsTypesVariable: 'Hide',
      SelectedClusterMinimumSizeVariable: 0,
      SelectedLinkSortVariable: 'Distance',
      SelectedLinkThresholdVariable: 0.015,
      SelectedDistanceMetricVariable: 'tn93',
      SelectedLinkColorTableTypesVariable: 'Hide',
      SelectedNodeColorTableTypesVariable: 'Hide',
      SelectedColorVariable: '#ff8300',
      SelectedBackgroundColorVariable: '#ffffff',
      SelectedApplyStyleVariable: '',
      SelectedRevealTypesVariable: 'Everything'
    };
    // check for not interfering with networks outside of inital demo
    this.demoNetworkRendered = false;
    /**
     * Returns an object that will eventually be filled with data. It is accessed throught commonService.session.data
     * It will store a list of nodes, links, and clusters as well as fields that can be used for each
     */
    this.dataSkeleton = () => {
      return {
        nodes: [],
        links: [],
        unoNodes: [],
        unoLinks: [],
        clusters: [],
        nodeFields: ['index', '_id', 'selected', 'cluster', 'visible', 'degree', 'origin'],
        nodeExclusions: [],
        linkFields: ['index', 'source', 'target', 'distance', 'visible', 'cluster', 'origin', 'nn', 'directed'],
        clusterFields: ['id', 'nodes', 'links', 'sum_distances', 'links_per_node', 'mean_genetic_distance', 'visible'],
        nodeFilter: {},
        linkFilter: {},
        clusterFilter: {},
        nodeFilteredValues: [],
        linkFilteredValues: [],
        clusterFilteredValues: [],
        nodeTableColumns: [],
        linkTableColumns: [],
        clusterTableColumns: [],
        tree: {},
        newickString: '',
        reference: _app_constants_longStrings_constants__WEBPACK_IMPORTED_MODULE_12__.REFERENCE
      };
    };
    this.watermark = _app_constants_longStrings_constants__WEBPACK_IMPORTED_MODULE_12__.WATERMARK;
    this.HXB2 = _app_constants_longStrings_constants__WEBPACK_IMPORTED_MODULE_12__.HBX2;
    /**
     * @returns an object that stores the common widgets/settings used throughout MicrobeTrace
     */
    this.defaultWidgets = () => {
      return {
        '3DNet-link-tooltip-variable': 'None',
        '3DNet-link-transparency': 0,
        '3DNet-link-width': 1.6,
        '3DNet-node-tooltip-variable': '_id',
        '3DNet-node-radius': 4,
        '3DNet-node-radius-variable': 'None',
        'align-sw': false,
        'align-none': true,
        'alignView-charSetting': 'hide',
        'alignView-colorSchemeName': 'n',
        'alignView-customColorScheme': {
          'A': '#ccff00',
          'C': '#ffff00',
          'G': '#ff9900',
          'T': '#ff6600',
          'ambig': '#ffffff'
        },
        'alignView-labelField': '_id',
        'alignView-rulerMinorInterval': 50,
        'alignView-selectedSize': 's',
        'alignView-showMiniMap': true,
        'alignView-sortField': 'index',
        'alignView-spanWidth': 10,
        'alignView-spanHeight': 16,
        'alignView-topDisplay': 'barplot',
        'ambiguity-resolution-strategy': 'AVERAGE',
        'ambiguity-threshold': 0.015,
        'background-color': '#ffffff',
        'background-color-contrast': '#000000',
        'bubble-x': 'cluster',
        'bubble-y': 'None',
        'bubble-charge': 0.05,
        'bubble-size': 20,
        'bubble-collapsed': false,
        'choropleth-aggregate-as': 'states',
        'choropleth-aggregate-on': 'None',
        'choropleth-basemap-show': false,
        'choropleth-color-high': '#800026',
        'choropleth-color-low': '#ffffcc',
        'choropleth-color-medium': '#fd8d3c',
        'choropleth-satellite-show': false,
        'choropleth-transparency': 0.3,
        'cluster-minimum-size': 1,
        'default-view': '2D Network',
        // 'Phylogenetic Tree' 'Alignment View'
        'default-distance-metric': 'tn93',
        'filtering-epsilon': -8,
        'flow-showNodes': 'selected',
        'gantt-date-list': '',
        'globe-countries-show': false,
        'globe-field-lat': 'None',
        'globe-field-lon': 'None',
        'globe-field-tract': 'None',
        'globe-field-zipcode': 'None',
        'globe-field-county': 'None',
        'globe-field-state': 'None',
        'globe-field-country': 'None',
        'globe-link-show': true,
        'globe-link-transparency': 0,
        'globe-node-jitter': -2,
        'globe-node-show': true,
        'globe-node-transparency': 0,
        'globe-stars-show': true,
        'heatmap-invertX': false,
        'heatmap-invertY': false,
        'heatmap-color-high': '#a50026',
        'heatmap-color-medium': '#ffffbf',
        'heatmap-color-low': '#313695',
        'heatmap-axislabels-show': false,
        'histogram-axis-x': true,
        'histogram-scale-log': false,
        'histogram-variable': 'links-distance',
        'infer-directionality-false': true,
        'link-color': '#a6cee3',
        'link-color-table-counts': true,
        'link-color-table-frequencies': false,
        'link-color-variable': 'None',
        'link-directed': false,
        'link-bidirectional': false,
        'link-label-variable': 'None',
        'link-label-decimal-length': 3,
        'link-length': 0.125,
        'link-opacity': 0,
        'link-show-nn': false,
        'link-sort-variable': 'distance',
        'link-threshold': 0.015,
        'link-tooltip-variable': ['None'],
        'link-width': 3,
        "link-width-max": 27,
        "link-width-min": 3,
        'link-width-variable': 'None',
        'link-width-reciprocal': false,
        'link-origin-array-order': [],
        'map-basemap-show': true,
        'map-collapsing-on': true,
        'map-counties-show': false,
        'map-countries-show': true,
        'map-field-lat': 'None',
        'map-field-lon': 'None',
        'map-field-tract': 'None',
        'map-field-zipcode': 'None',
        'map-field-county': 'None',
        'map-field-state': 'None',
        'map-field-country': 'None',
        'map-link-show': true,
        'map-link-tooltip-variable': 'None',
        'map-link-transparency': 0,
        'map-node-jitter': -2,
        'map-node-show': true,
        'map-node-tooltip-variable': '_id',
        'map-node-transparency': 0,
        'map-satellite-show': false,
        'map-states-show': true,
        "mst-computed": false,
        'network-friction': 0.4,
        'network-gravity': 0.05,
        'network-link-strength': 0.124,
        'node-charge': 200,
        'node-border-width': 2.0,
        'node-color': '#1f77b4',
        'node-color-table-counts': true,
        'node-color-table-frequencies': false,
        'node-color-variable': 'None',
        'node-highlight': false,
        'node-label-size': 16,
        'node-label-variable': 'None',
        'node-label-orientation': 'Right',
        'node-opacity': 0,
        'node-radius': 20,
        'node-radius-variable': 'None',
        "node-radius-min": 20,
        "node-radius-max": 60,
        'node-symbol': 'ellipse',
        'node-symbol-table-counts': true,
        'node-symbol-table-frequencies': false,
        'node-symbol-variable': 'None',
        'node-symbol-table-visible': 'Hide',
        'node-timeline-variable': 'None',
        'node-tooltip-variable': ['_id'],
        'physics-tree-branch-type': 'Straight',
        'physics-tree-charge': 30,
        'physics-tree-friction': 0.05,
        'physics-tree-gravity': 0.05,
        'physics-tree-lateral-strength': 0.025,
        'physics-tree-layout': 'Horizontal',
        'physics-tree-node-label-variable': 'None',
        'physics-tree-tooltip': 'id',
        'physics-tree-type': 'tree',
        'polygon-color': '#bbccee',
        'polygon-color-table-name-sort': 'DESC',
        'polygon-color-table-counts-sort': 'DESC',
        'polygon-color-table-counts': true,
        'polygon-color-table-frequencies': false,
        'polygons-color-show': false,
        'polygons-foci': 'cluster',
        'polygons-gather-force': 0,
        'polygons-label-show': false,
        'polygon-label-orientation': 'top',
        'polygons-label-size': 16,
        'polygons-show': false,
        'polygon-color-table-visible': false,
        'reference-source-file': true,
        'reference-source-first': false,
        'reference-source-consensus': false,
        'scatterplot-xVar': 'index',
        'scatterplot-yVar': 'distance',
        'scatterplot-logScale': false,
        'scatterplot-showNodes': false,
        'search-field': '_id',
        'selected-color': '#ff8300',
        'selected-color-contrast': '#000000',
        'selected-node-stroke-color': '#ff8300',
        'selected-node-stroke-width': '4px',
        'timeline-date-field': 'None',
        'timeline-noncumulative': true,
        'tree-animation-on': true,
        'tree-branch-distances-hide': true,
        'tree-branch-distance-size': 12,
        'tree-branch-nodes-show': false,
        'tree-horizontal-stretch': 1,
        'tree-layout-vertical': false,
        'tree-layout-horizontal': true,
        'tree-layout-circular': false,
        'tree-labels-align': false,
        'tree-labels-show': false,
        'tree-leaf-label-show': false,
        'tree-leaf-label-size': 12,
        'tree-leaf-node-radius-variable': 'None',
        'tree-leaf-node-show': true,
        'tree-leaf-node-size': 9,
        'tree-mode-square': true,
        'tree-mode-smooth': false,
        'tree-mode-straight': false,
        'tree-round-true': false,
        'tree-ruler-show': true,
        'tree-tooltip-show': true,
        'tree-type': 'weighted',
        'tree-vertical-stretch': 1,
        'triangulate-false': true,
        'twoD-settings-visible': 'Hide'
      };
    };
    /**
     * @returns a session object. It has the data object, information on goldenLayout layout, widgets, as well as other settings
     */
    this.sessionSkeleton = () => {
      return {
        data: this.dataSkeleton(),
        files: [],
        layout: {
          content: [{
            type: 'files'
          }],
          type: 'stack'
        },
        messages: [],
        tabLoaded: false,
        meta: {
          loadTime: 0,
          readyTime: Date.now(),
          startTime: 0,
          anySequences: false
        },
        network: {
          allPinned: false,
          timelinePinned: false,
          nodes: [],
          timelineNodes: [],
          initialLoad: false,
          launched: false,
          isFullyLoaded: false,
          rendered: false,
          rendering: false,
          settingsLoaded: false
        },
        state: {
          timeStart: 0,
          timeEnd: new Date(),
          timeTarget: null
        },
        style: {
          linkAlphas: [1],
          linkColors: d3__WEBPACK_IMPORTED_MODULE_1__.schemePaired,
          linkValueNames: {},
          nodeAlphas: [1],
          nodeColors: [d3__WEBPACK_IMPORTED_MODULE_1__.schemeCategory10[0]].concat(d3__WEBPACK_IMPORTED_MODULE_1__.schemeCategory10.slice(2)),
          nodeColorsTable: {},
          nodeColorsTableHistory: {
            'null': '#EAE553'
          },
          nodeColorsTableKeys: {},
          linkColorsTable: {},
          linkColorsTableKeys: {},
          nodeSymbols: ['ellipse', 'triangle', 'rectangle', 'barrel', 'rhomboid', 'diamond', 'pentagon', 'hexagon', 'heptagon', 'octagon', 'star', 'tag', 'vee'],
          nodeSymbolsTable: {},
          nodeSymbolsTableKeys: {},
          nodeValueNames: {},
          polygonAlphas: [0.5],
          polygonColors: ['#bbccee', '#cceeff', '#ccddaa', '#eeeebb', '#ffcccc', '#dddddd'],
          polygonValueNames: {},
          overwrite: {},
          widgets: this.defaultWidgets()
        },
        timeline: 0,
        warnings: []
      };
    };
    /**
     *
     * @returns object found at commonService.temp  which include a matrix for links between nodes and color/alpha mapping functions
     */
    this.tempSkeleton = () => {
      return {
        componentCache: {},
        mapData: {},
        matrix: {},
        messageTimeout: null,
        /* functions in style object get replaced If user decides to color a node, link, or polygon variable.
         * these functions are replaced with one from the d3 package usind d3.scaleOrdinal(...).domain(...)
         */
        style: {
          linkAlphaMap: () => 1 - this.session.style.widgets['link-opacity'],
          linkColorMap: () => this.session.style.widgets['link-color'],
          nodeAlphaMap: () => 1,
          nodeColorMap: () => this.session.style.widgets['node-color'],
          nodeSymbolMap: () => this.session.style.widgets['node-symbol'],
          polygonAlphaMap: () => 0.5,
          polygonColorMap: () => this.session.style.widgets['polygon-color']
        },
        trees: {}
      };
    };
    this.temp = this.tempSkeleton();
    this.session = this.sessionSkeleton();
    this.hasSeq = x => {
      if (x.seq && (x.seq.includes("a") || x.seq.includes("c") || x.seq.includes("g") || x.seq.includes("t") || x.seq.includes("A") || x.seq.includes("C") || x.seq.includes("G") || x.seq.includes("T"))) {
        return true;
      }
      return false;
    };
    // updatePinNodes(copy: boolean) {
    //     let nodes =  this.session.network.nodes;
    //     let n = nodes.length;
    //     for (let i = 0; i < n; i++) {
    //         const node = nodes[i]; 
    //         if (copy && node.fixed) node.preFixed = true;
    //         if (!copy &&  this.session.network.timelineNodes[i].preFixed) {
    //             node.fixed = true;
    //             node.fx = node.x;
    //             node.fy = node.y;
    //         }
    //     }
    // }
    /**
     * @returns {any[]} Returns an array with a copy of each node object // TODO:: Do we need this?
     */
    this.getNetworkNodes = () => {
      let nodes = this.session.network.nodes;
      let n = nodes.length;
      let out = [];
      for (let i = 0; i < n; i++) {
        const node = nodes[i];
        out.push(JSON.parse(JSON.stringify(node)));
      }
      return out;
    };
    //debugger;
    // (window as any).context = ((window as any).context == undefined ? {} : (window as any).context);
    this.computer = new _workers_workModule__WEBPACK_IMPORTED_MODULE_6__.WorkerModule();
    this.resetData();
    console.log('Constructor: Temp initialized:', this.temp);
    // this.initialize();
  }
  ngOnInit() {
    this.initialize();
  }
  /**
   * Sets (window as any).context.commonSerive = this; and also calls reset() which sets commonService.temp and commonService.session back to default values (except
   * temp.mapData, session.files, session.meta)
   */
  initialize() {
    this.reset();
  }
  /**
   * Capitalizes the first letter of a string
   * @param s - Expects a string
   * @returns - the string with first letter capitalized. If typeof s != string returns empty string
   */
  capitalize(s) {
    if (typeof s !== 'string') return '';
    return s.charAt(0).toUpperCase() + s.slice(1);
  }
  /**
   * Set commonService.session and commonService.temp back to default values
   */
  clearData() {
    this.session = this.sessionSkeleton();
    this.temp = this.tempSkeleton();
  }
  /**
   * Update Legacy Node Symbols if loading new files
   */
  updateLegacyNodeSymbols() {
    this.session.style.nodeSymbols = ['ellipse', 'square', 'triangle', 'hexagon', 'diamond', 'barrel', 'pentagon', 'octagon', 'star', 'tag', 'vee'];
  }
  /**
   * @returns a default node object
   */
  defaultNode() {
    return {
      index: this.session.data.nodes.length,
      _id: '',
      selected: false,
      cluster: 1,
      visible: true,
      degree: 0,
      data: {},
      origin: [],
      hasDistance: false
    };
  }
  cleanupData() {
    this.session.data = this.sessionSkeleton().data;
    this.temp = this.tempSkeleton();
    // Clear node and link storage if they are no longer needed
    this.session.data.nodes = [];
    this.session.data.links = [];
    this.temp.matrix = {};
    // Reset visualization states
    this.session.network.isFullyLoaded = false;
  }
  // public cleanupWorkers(): void {
  //     console.log("Terminating Web Workers...");
  //     if (this.computer) {
  //         if (this.computer.compute_linksWorker) this.computer.compute_linksWorker.terminate();
  //         if (this.computer.compute_mstWorker) this.computer.compute_mstWorker.terminate();
  //         if (this.computer.compute_nnWorker) this.computer.compute_nnWorker.terminate();
  //         if (this.computer.compute_directionalityWorker) this.computer.compute_directionalityWorker.terminate();
  //         if (this.computer.compute_treeWorker) this.computer.compute_treeWorker.terminate();
  //         if (this.computer.compute_triangulationWorker) this.computer.compute_triangulationWorker.terminate();
  //         if (this.computer.compute_parse_csv_matrixWorker) this.computer.compute_parse_csv_matrixWorker.terminate();
  //         if (this.computer.compute_parse_fastaWorker) this.computer.compute_parse_fastaWorker.terminate();
  //     }
  // }
  onNewSession() {
    this.store.setNewSession(true);
    this.reset();
  }
  onSessionDestroyed() {
    this.reset();
    this.store.setSessionDestroyed(true);
  }
  onStyleFileApplied() {
    this.store.setStyleFileApplied();
  }
  onTableCleared(tableId) {
    this.store.setTableCleared(tableId);
  }
  onStatisticsChanged(statisticsType) {
    this.store.setStatisticsChanged(statisticsType);
  }
  /**
   * XXXXX Not currently used; not sure of future use XXXXX
   * @returns boolean
   */
  onlyUnique(value, index, self) {
    return self.indexOf(value) === index;
  }
  /**
   * Checks if an array or string contains a specified value.
   * @param container - Where to search such as a []
   * @param {any} value - The value to search for.
   * @returns {boolean} - `true` if the `container` parameter contains the `value` parameter, and `false` otherwise.
   */
  includes(container, value) {
    let returnValue = false;
    const pos = container.indexOf(value);
    if (pos >= 0) {
      returnValue = true;
    }
    return returnValue;
  }
  /**
   * Sanitizes user input to prevent cross-site scripting (XSS) attacks.
   * @param {string|number|boolean} t - The user input to be sanitized.
   * @param {boolean} [e=0 | false] - An optional parameter that specifies whether to encode the sanitized output as HTML entities.
   * @returns {string} - The sanitized output.
   */
  filterXSS(t, e = 0) {
    const argType = typeof t;
    if (argType === 'object') {
      return JSON.stringify(t);
    } else if (argType === 'number' || argType === 'boolean') {
      const tempT = t.toString();
      t = tempT;
    } else if (argType != 'string' && argType != 'number') t = '';
    const i = t.replace(/javascript/gi, 'j&#97;vascript').replace(/expression/gi, 'expr&#101;ssion').replace(/onload/gi, 'onlo&#97;d').replace(/script/gi, '&#115;cript').replace(/onerror/gi, 'on&#101;rror');
    return e === !0 ? i : i.replace(/>/g, '&gt;').replace(/</g, '&lt;');
  }
  /**
   * @param {any} a an input value
   * @returns {boolean} whether a is a number
   */
  isNumber(a) {
    return typeof a == 'number';
  }
  /**
   * Adds a new node to an array of nodes.
   * @param {Node} newNode - The new node to be added to the array.
   * @param {boolean | null} [check=null] - An optional parameter that specifies whether to check for duplicates before adding the new node.
   * @returns {number} - `1` if a new node was added to the array, `0` otherwise.
   */
  addNode(newNode, check = null) {
    //  If _id, set id to _id 
    if (newNode._id) {
      if (typeof newNode._id !== 'string') {
        newNode._id = newNode._id.toString();
      }
      newNode._id = newNode._id.trim();
      newNode.id = newNode._id;
    } else if (newNode.id) {
      if (typeof newNode.id !== 'string') {
        newNode.id = newNode.id.toString();
      }
      newNode.id = newNode.id.trim();
      newNode._id = newNode.id;
    }
    if (this.session.data.nodeExclusions.indexOf(newNode._id) > -1) {
      return 0;
    }
    if (check) {
      let nodes = this.session.data.nodes;
      const n = nodes.length;
      for (let i = 0; i < n; i++) {
        const node = nodes[i];
        if (node._id == newNode._id) {
          newNode.origin = this.uniq(newNode.origin.concat(node.origin));
          Object.assign(node, newNode);
          return 0;
        }
      }
    }
    let newElement = Object.assign(this.defaultNode(), newNode);
    if (Object.prototype.hasOwnProperty.call(newNode, 'data') && Object.prototype.hasOwnProperty.call(newNode.data, 'data')) {
      newElement.data = newNode.data.data;
    }
    this.session.data.nodes.push(newElement);
    return 1;
  }
  /**
   * Adds a new link to an array of links.
   * @param {Object} newLink- The new link to be added to the array.
   * @param {boolean | null} [check=null] - An optional parameter that specifies whether to check for duplicates before adding the new link.
   * @returns {number} - `1` if a new link was added to the array, `0` otherwise.
   */
  addLink(newLink, check = true) {
    const serv = this;
    const matrix = serv.temp.matrix;
    if (newLink.source === "MZ798055" && newLink.target === "MZ375596" || newLink.source === "MZ7375596" && newLink.target === "MZ798055") {
      console.log('new link 111: ', JSON.stringify(newLink));
    }
    // Trim ids to remove whitespace
    if (typeof newLink.source == 'number') {
      newLink.source = newLink.source.toString().trim();
    } else {
      newLink.source = newLink.source.trim();
    }
    if (typeof newLink.target == 'number') {
      newLink.target = newLink.target.toString().trim();
    } else {
      newLink.target = newLink.target.trim();
    }
    if (!matrix[newLink.source]) {
      matrix[newLink.source] = {};
    }
    if (!matrix[newLink.target]) {
      matrix[newLink.target] = {};
    }
    // If source and target are the same, don't add the link
    if (newLink.source == newLink.target) return 0;
    const ids = [newLink.source, newLink.target].sort();
    const id = `${ids[0]}-${ids[1]}`;
    let linkIsNew = 1;
    const sdlinks = serv.session.data.links;
    if (matrix[newLink.source][newLink.target]) {
      const oldLink = matrix[newLink.source][newLink.target];
      // Ensure id is consistent during merge ---
      newLink.id = oldLink.id || id; // Prefer existing ID
      let myorigin = this.uniq(newLink.origin.concat(oldLink.origin));
      // console.log(JSON.stringify(myorigin));
      // Ensure no empty origins
      myorigin = myorigin.filter(origin => origin != '');
      // --- Start: Logic to manage global origin order ---
      if (myorigin.length > 1) {
        let globalOrder = this.session.style.widgets['link-origin-array-order'];
        // If the global order hasn't been established yet OR if the current combination has more origins
        // than the currently stored global order (indicating a new origin was added to this combo),
        // establish/update the global order based on this link's final merged origins.
        // This assumes the first time a multi-origin link is fully formed defines the order.
        if (globalOrder.length === 0 || myorigin.length > globalOrder.length) {
          // Simple update: just use the current merged order.
          // If more complex order logic is needed (e.g., specific file types first), implement here.
          this.session.style.widgets['link-origin-array-order'] = [...myorigin]; // Use spread to create a new array reference
          console.log('UPDATED Global link-origin-array-order:', this.session.style.widgets['link-origin-array-order']);
        }
        // Ensure this link's origin uses the established global order if it matches the length
        // (setLinkVisibility will handle applying it finally)
        else if (myorigin.length === globalOrder.length) {
          // If lengths match, we assume it's the same combination.
          // No action needed here, setLinkVisibility will apply the global order.
        } else {
          // This case (myorigin.length < globalOrder.length) might indicate an issue
          // or a different combination. Log it for debugging if needed.
          console.warn("Mismatched origin lengths during merge, global order might be incorrect.", myorigin, globalOrder);
        }
      }
      // Ensure new link keeps distance if already defined previously
      if (oldLink.hasDistance) {
        newLink.hasDistance = true;
        newLink['distance'] = oldLink['distance'];
        newLink.distanceOrigin = oldLink.distanceOrigin;
      }
      oldLink["origin"] = myorigin;
      newLink["origin"] = myorigin;
      // console.log("old link isL " + `${JSON.stringify(oldLink)} ${JSON.stringify(newLink)}`);
      // Only override if new isn't directed and old may be, and ensure its in the right direction
      if (oldLink.directed) {
        newLink.directed = true;
        newLink.source = oldLink.source;
        newLink.target = oldLink.target;
      }
      lodash__WEBPACK_IMPORTED_MODULE_4__.merge(oldLink, newLink);
      oldLink.origin = myorigin;
      if (newLink["bidirectional"]) {
        oldLink["bidirectional"] = true;
      }
      linkIsNew = 0;
    } else if (serv.temp.matrix[newLink.target][newLink.source]) {
      console.warn("This scope should be unreachable. If you're using this code, something's wrong.");
      const oldLink = matrix[newLink.target][newLink.source];
      // Ensure id is consistent during merge ---
      newLink.id = oldLink.id || id; // Prefer existing ID
      const origin = this.uniq(newLink.origin.concat(oldLink.origin));
      if (origin.length > 1) {
        newLink.hasDistance = true;
      }
      Object.assign(oldLink, newLink, {
        origin: origin
      });
      linkIsNew = 0;
    } else {
      // Assign stableId to the new link object ---
      newLink.id = id;
      if (newLink.hasDistance || newLink.origin.length > 1) {
        newLink = Object.assign({
          index: sdlinks.length,
          source: "",
          target: "",
          visible: false,
          cluster: 1,
          origin: [],
          hasDistance: true
        }, newLink);
      } else {
        newLink = Object.assign({
          index: sdlinks.length,
          source: "",
          target: "",
          visible: false,
          cluster: 1,
          origin: [],
          hasDistance: false
        }, newLink);
      }
      // Always add the new link without merging
      sdlinks.push(newLink);
      matrix[newLink.source][newLink.target] = newLink;
      matrix[newLink.target][newLink.source] = newLink;
      linkIsNew = 1;
    }
    if (!this.session.style.widgets['link-origin-array-order']) {
      this.session.style.widgets['link-origin-array-order'] = [];
    }
    if (newLink.origin.length > 1 && this.session.style.widgets['link-origin-array-order'].length === 0) {
      this.session.style.widgets['link-origin-array-order'] = newLink.origin;
    }
    if (newLink.source === "MZ798055" && newLink.target === "MZ375596" || newLink.source === "MZ375596" && newLink.target === "MZ798055") {
      console.log('new link 222: ', JSON.stringify(newLink));
    }
    return linkIsNew;
    // TODO Remove when not needed
    // this.session.data.linkFilteredValues = [...this.session.data.links];
    // return linkIsNew;
  }
  /**
   * Removes duplicate elements from an array.
   * @param {Array} a - The array to be processed.
   * @returns {Array} - The array containing only the unique elements of the input array `a`.
   */
  uniq(a) {
    const seen = {};
    const out = [];
    const len = a.length;
    let j = 0;
    for (let i = 0; i < len; i++) {
      const item = a[i];
      if (seen[item] !== 1) {
        seen[item] = 1;
        out[j++] = item;
      }
    }
    return out;
  }
  getSelectedNode(nodes) {
    return nodes.find(node => node.selected);
  }
  getColorByIndex(index) {
    let variable = this.session.style.widgets['node-color-variable'];
    let color = this.session.style.widgets['node-color'];
    if (variable == 'None') {
      return color;
    } else {
      return this.temp.style.nodeColorMap(this.session.data.nodes[index][variable]);
    }
  }
  convertToGraphDataArray(microbeData) {
    console.log('--- TWOD convertToGraphDataArray called');
    const nodes = microbeData.nodes.map(node => ({
      ...node,
      // Spread existing properties
      id: node._id,
      // Ensure the id property is set correctly
      group: node.cluster,
      color: this.getColorByIndex(node.index),
      // Add or override the color property
      label: this.session.style.widgets['node-label-variable'] === 'None' ? '' : node.label,
      // Ensure label is defined
      nodeSize: node.nodeSize ?? 20,
      // Default node size
      borderWidth: node.borderWidth ?? this.session.style.widgets['node-border-width'] ?? 1 // Default border width
    }));
    const links = microbeData.links.map((link, i) => ({
      ...link,
      // Spread existing properties
      id: link.id,
      //'edge-' + i, // If 
      source: link.source,
      // Ensure source is correctly set
      target: link.target,
      // Ensure target is correctly set
      group: link.cluster ?? null,
      // Ensure group is set, default to null if undefined
      chapter: link.distance ? link.distance.toString() : null,
      // Convert distance to string for chapter
      linkWidth: 1,
      label: link.label ?? '',
      // Ensure label is defined
      borderWidth: link.borderWidth ?? 1 // Default border width for links
    }));
    console.log('--- TWOD convertToGraphDataArray end, ', links);
    return {
      nodes,
      links
    };
  }
  /**
   * I think this function allows users to import an svg image into MT. Not sure if it currently works.
   * @param svg
   */
  processSVG(svg) {
    const nodes = [];
    const $xml = document.getElementById(svg);
    if ($xml.find('#edges').length) {
      $xml.find('#nodes circle').each((i, node) => {
        const $node = document.getElementById(node);
        const gephid = $node.attr('class');
        nodes.push(gephid);
        this.addNode({
          id: gephid + '',
          color: $node.attr('fill'),
          size: parseFloat($node.attr('r')),
          origin: ['Scraped Gephi SVG']
        }, false);
      });
      this.session.data.nodeFields.push('color');
      this.session.data.nodeFields.push('size');
      $xml.find('#edges path').each((i, link) => {
        const $link = $(link);
        const coords = $link.attr('class').split(' ');
        const base = {
          source: coords[0] + '',
          target: coords[1] + '',
          color: $link.attr('stroke'),
          origin: ['Scraped MicrobeTrace SVG']
        };
        base[this.session.style.widgets['default-distance-metric']] = 0;
        this.addLink(base, true);
      });
      this.session.data.linkFields.push('color');
    } else {
      $xml.find('.nodes g').each((i, node) => {
        nodes.push($(node).attr('transform').slice(10, -1).split(',').map(parseFloat));
        this.addNode({
          id: i + '',
          origin: ['Scraped SVG']
        }, false);
      });
      $xml.find('line').each((i, link) => {
        const $l = document.getElementById(link);
        const source = nodes.findIndex(d => {
          return Math.abs(d[0] - parseFloat($l.attr('x1'))) < 0.0001 && Math.abs(d[1] - parseFloat($l.attr('y1'))) < 0.0001;
        });
        const target = nodes.findIndex(d => {
          return Math.abs(d[0] - parseFloat($l.attr('x2'))) < 0.0001 && Math.abs(d[1] - parseFloat($l.attr('y2'))) < 0.0001;
        });
        if (source < 0 || target < 0) return;
        const base = {
          source: source + '',
          target: target + '',
          origin: ['Scraped SVG']
        };
        base[this.session.style.widgets['default-distance-metric']] = 0;
        this.addLink(base, true);
      });
    }
    this.runHamsters();
  }
  /**
   * Loads JSON, MicrobeTrace, or HivTrace files into MicrobeTrace
   * @param json
   * @param {string} extension file extension such as json, hivtrace, or microbetrace
   */
  processJSON(json, extension) {
    if (this.debugMode) {
      console.log("Trying to process JSON file");
    }
    let data;
    try {
      if (json.result) {
        data = JSON.parse(json.result);
      } else {
        data = JSON.parse(json);
      }
    } catch (error) {
      // abp.notify.error(
      //     'File Not Recognized! Are you certain this is a MicrobeTrace Session or HIV-TRACE Output File?'
      // );
      console.error(error);
      return;
    }
    if (extension == 'microbetrace') {
      this.session = this.sessionSkeleton();
      return this.applySession(data);
    } else {
      if (data.meta && data.tree) {
        // this.applyAuspice(data);
      } else {
        if (data.version) {
          this.applyGHOST(data);
        } else {
          console.log("Trying to load HIVTrace file");
          this.applyHIVTrace(data);
        }
      }
    }
  }
  /**
   * Updates commonService.session with information from stashObject. Variables updated include data, files, state, style, and layout.
   */
  applySession(stashObject) {
    var _this = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      //If anything here seems eccentric, assume it's to maintain compatibility with
      //session files from older versions of MicrobeTrace.
      $("#launch").prop("disabled", true);
      // Set to false to indicate that the network is not fully loaded  as new network is launching
      _this.session.network.isFullyLoaded = false;
      // launching new network, so set network rendered to false to start loading modal
      _this.store.setNetworkRendered(false);
      _this.store.setSettingsLoaded(false);
      console.log('applySession - temp:', _this.temp);
      $(document).trigger("stop-force-simulation"); // stop previous network ticks so previous polygon won't show up
      $(document).off('.2d');
      if (_this.debugMode) {
        console.log('applying session:', stashObject);
      }
      if (stashObject.session) {} else {
        stashObject = {
          tabs: [{
            label: 'Files',
            templateRef: null,
            tabTitle: 'Files',
            isActive: true,
            componentRef: null
          }],
          session: stashObject
        };
      }
      const oldSession = stashObject.session;
      console.log('this.temp: ', _this.temp);
      _this.temp.matrix = [];
      _this.session.files = oldSession.files;
      _this.session.state = oldSession.state;
      _this.session.style = oldSession.style;
      _this.session.meta.startTime = Date.now();
      if (oldSession.layout) {
        _this.session.layout = oldSession.layout;
      }
      console.log('applySession called 2');
      // layout.root.removeChild(layout.root.contentItems[0]);
      const nodes = oldSession.data.nodes,
        links = oldSession.data.links,
        n = nodes.length,
        m = links.length;
      for (let i = 0; i < n; i++) _this.addNode(nodes[i]);
      for (let j = 0; j < m; j++) {
        // Add distance property for files saved prior to distance visibility fix
        if (links[j].origin.includes('Genetic Distance')) {
          links[j].hasDistance = true;
          links[j].distanceOrigin = 'Genetic Distance';
        } else if (links[j].distance && links[j].distance > 0) {
          links[j].hasDistance = true;
        }
        _this.addLink(links[j]);
      }
      // for (let j = 0; j < m; j++) this.addLink(links[j]);
      ['nodeFields', 'linkFields', 'clusterFields', 'nodeExclusions'].forEach(v => {
        if (oldSession.data[v]) _this.session.data[v] = _this.uniq(_this.session.data[v].concat(oldSession.data[v]));
      });
      // TODO: See about this process data functionality.  DO we need this?
      _this.processData();
      if (oldSession.network) _this.session.network = oldSession.network;
      // Set to false to indicate that the network is not fully loaded  as new network is launching
      _this.session.network.isFullyLoaded = false;
      if (oldSession.data.geoJSONLayerName !== "") {
        _this.session.data['geoJSON'] = oldSession.data.geoJSON;
        _this.session.data['geoJSONLayerName'] = oldSession.data.geoJSONLayerName;
      }
      _this.applyStyle(_this.session.style);
      console.log('applySession end');
      // TODO: Review if this is necessary
      // if (!links[0]['distance']) {
      //     if (links[0]['tn93']) {
      //         this.session.style.widgets['link-sort-variable'] = 'tn93';
      //     } else {
      //         this.session.style.widgets['link-sort-variable'] = 'snps';
      //     }
      // }
      _this.finishUp();
    })();
  }
  /**
   * XXXXX Review if function is necessary XXXXX
   * Sets session.data.nodeFilteredValues = session.data.nodes
   * TODO:: DO WE NEED NODE FILTERED VALUES?
   */
  processData() {
    let nodes = this.session.data.nodes;
    if (this.debugMode) {
      console.log('processing data: ', nodes);
    }
    this.session.data.nodeFilteredValues = nodes;
    // TODO:: DO WE NEED THIS
    //Add links for nodes with no edges
    // this.uniqueNodes.forEach(x => {
    //     this.commonService.addLink(Object.assign({
    //         source: '' + x,
    //         target: '' + x,
    //         origin: origin,
    //         visible: true,
    //         distance: 0,
    //     }, 'generated'));
    // })
  }
  /**
   * Updates session.style with information from style object parameter, also updated Link Color Map, Node Color Map, and Polygon Color Map Functions
   */
  applyStyle(style) {
    if (this.debugMode) {
      console.log('---- applying style: ', style);
    }
    this.session.style = style;
    this.session.style.widgets = Object.assign({}, this.defaultWidgets(), style.widgets);
    // if(this.debugMode) {
    console.log('creating link/node/polygon colorMap style: ', style);
    // }
    this.createLinkColorMap();
    this.createNodeColorMap();
    this.createPolygonColorMap();
    // finds id s in template/html where id=widget name, updated the value to the new value in the style file
    // let $id = null;
    // for (let id in this.session.style.widgets) {
    //     $id = $("#" + id);
    //     if ($id.length > 0) {
    //         if (this.includes(["radio", "checkbox"], ($id[0].type))) {
    //             if (this.session.style.widgets[id]) $id.trigger("click");
    //         } else {
    //             if (id == 'default-distance-metric') {
    //                 $id.val(this.session.style.widgets[id].toLowerCase());
    //                 $("#" + id+'2').val(this.session.style.widgets[id].toLowerCase());
    //             } else {
    //                 $id.val(this.session.style.widgets[id]);
    //             }                    
    //         }
    //     }
    // }
    console.log('--- applyStyle called');
    this.onStyleFileApplied();
    if (this.debugMode) {
      console.log('---- Apply Style File Done');
    }
    // TODO: See if this is needed
    // this.visuals.microbeTrace.homepageTabs.forEach(tab => {
    //     if (tab.componentRef && tab.componentRef.instance.updateVisualization) {
    //         tab.componentRef.instance.applyStyleFileSettings();
    //     }
    // })
    // Need session applied variable since this will break restoring full microbe trace file vs loading a style file
    // if (!sessionApplied) {
    // // Trigger global style updates
    // $("#node-color-variable").trigger("change");
    // $("#node-color-border").trigger("change");
    // $("#link-color-variable").trigger("change");
    // $("#selected-color").trigger("change");
    // $("#background-color").trigger("change");
    // // 2d Network Specific
    // $('#node-radius-variable').trigger("change");
    // $('#node-symbol-variable').trigger("change");
    // $('#node-label-variable').trigger("change");
    // } else {
    // sessionApplied = false;
    // }
  }
  applyHIVTrace(hivtrace) {
    console.log("Running applyHIVTrace");
    this.resetData();
    this.session.meta.startTime = Date.now();
    hivtrace["trace_results"]["Nodes"].forEach(node => {
      let newNode = {
        _id: node.id,
        origin: "HIVTRACE Import"
      };
      if (Object.prototype.hasOwnProperty.call(node, "patient_attributes")) {
        console.log("had patient_attributes");
        newNode = JSON.parse(JSON.stringify(node.patient_attributes));
        Object.keys(hivtrace["trace_results"]["Nodes"][0]["patient_attributes"]).forEach(key => {
          if (!this.session.data.nodeFields.includes(key)) this.session.data.nodeFields.push(key);
        });
      }
      this.addNode(newNode, false);
    });
    this.processData();
    let n = hivtrace["trace_results"]["Edges"].length;
    let metric = this.session.style.widgets['default-distance-metric'];
    for (let i = 0; i < n; i++) {
      const link = hivtrace["trace_results"]["Edges"][i];
      const newLink = {
        source: "" + link.sequences[0],
        target: "" + link.sequences[1],
        origin: ["HIVTRACE Import"],
        visible: true
      };
      newLink[metric] = parseFloat(link.length);
      newLink["distance"] = newLink[metric];
      this.addLink(newLink, false);
    }
    this.session.data.linkFields.push(metric);
    this.runHamsters();
  }
  applyGHOST(ghost) {
    this.session = this.sessionSkeleton();
    this.session.meta.startTime = Date.now();
    ghost["samples"].forEach(node => {
      const newNode = JSON.parse(JSON.stringify(node));
      newNode.origin = ["GHOST Import"];
      newNode.genotypes = JSON.stringify(newNode.genotypes);
      newNode._id = "" + newNode._id;
      this.addNode(newNode, false);
    });
    ["genotypes", "group", "_id", "name"].forEach(key => {
      if (!this.session.data.nodeFields.includes(key)) {
        this.session.data.nodeFields.push(key);
      }
    });
    const links = ghost["links"];
    const n = links.length;
    for (let i = 0; i < n; i++) {
      const link = links[i];
      const newLink = Object.assign({}, link, {
        source: "" + link.source,
        target: "" + link.target,
        distance: parseFloat(link.dist),
        origin: ["GHOST Import"],
        visible: true
      });
      this.addLink(newLink, false);
    }
    ["density", "dist", "shared", "src_genotype", "src_haps", "tgt_genotype", "tgt_haps"].forEach(key => {
      if (!this.session.data.linkFields.includes(key)) this.session.data.linkFields.push(key);
    });
    this.runHamsters();
  }
  getURL() {
    const params = new URLSearchParams(window.location.search);
    return params.get('url');
  }
  applyAuspice(auspice) {
    return new Promise(resolve => {
      const auspiceHandler = new _app_helperClasses_auspiceHandler__WEBPACK_IMPORTED_MODULE_8__["default"](this);
      const auspiceData = auspiceHandler.run(auspice);
      resolve(auspiceData);
    });
  }
  openAuspiceUrl(url) {
    return new Promise(resolve => {
      let auspiceDataHolder = {};
      this.http.get(url).subscribe(data => {
        auspiceDataHolder = {
          tree: data["tree"],
          meta: data["meta"],
          version: data["version"]
        };
        // const auspiceHandler = new AuspiceHandler(this);
        // const auspiceData = auspiceHandler.run(auspiceDataHolder);
        resolve(auspiceDataHolder);
      });
    });
    this._debouncedUpdateNetworkVisuals();
    this.updateStatistics();
  }
  /**
   * Decodes the given `x` using the utf-8 TextDecoder object.
   * @param {ArrayBuffer} x - The data to be decoded.
   * @returns {string} - The decoded string.
   */
  decode(x) {
    return this.decoder.decode(x);
  }
  /**
  * Asynchronously parses fasta text on another thread to generate an array of nodes with id and seq
  * @param {string} text fasta string
  * @returns {Promise<Array>} A Promise that resolves to an array of nodes with id and seq.
  */
  parseFASTA(text) {
    return new Promise(resolve => {
      const fastaWorker = this.computer.getParseFastaWorker();
      fastaWorker.postMessage({
        data: text
      });
      const sub = fastaWorker.onmessage().subscribe(response => {
        let nodes = JSON.parse(this.decode(new Uint8Array(response.data.nodes)));
        if (this.debugMode) {
          console.log("FASTA Transit time: ", (Date.now() - response.data.start).toLocaleString(), "ms");
        }
        resolve(nodes);
        fastaWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  fromWorker(worker) {
    return new rxjs__WEBPACK_IMPORTED_MODULE_17__.Observable(observer => {
      const messageHandler = event => observer.next(event);
      const errorHandler = error => observer.error(error);
      worker.addEventListener('message', messageHandler);
      worker.addEventListener('error', errorHandler);
      // Cleanup function
      return () => {
        worker.removeEventListener('message', messageHandler);
        worker.removeEventListener('error', errorHandler);
        worker.terminate();
      };
    });
  }
  /**
   * Asynchronously parses csv matrix file content and adds nodes and links to session.data
   * @param {string} file content from csv matrix file
   * @returns {Promise} A Promise that resolves to an object with {numberOfNodesAdded, numberOfLinksAdded, totalNumberofNodes, totalNumberofLinks}
  parseCSVMatrix(file) {
      return new Promise((resolve, reject) => {
          let check = this.session.files.length > 1;
          const origin = [file.name];
          let nn = 0, nl = 0;
  
          //  Create a New Worker Before Use
          let compute_parse_csv_matrixWorker = this.computer.getParseCsvMatrixWorker(); //new Worker(new URL('../workers/parse-csv-matrix.worker.js', import.meta.url));
  
          compute_parse_csv_matrixWorker.postMessage(file.contents);
  
          // Convert worker messages to Observable
          const workerObservable = this.fromWorker(this.computer.compute_parse_csv_matrixWorker);
  
          const sub = workerObservable.subscribe({
              next: (response: MessageEvent<any>) => {
                  const data = JSON.parse(
                      this.decode(new Uint8Array(response.data.data))
                  );
                  console.log(
                      'CSV Matrix Transit time:',
                      (Date.now() - response.data.start).toLocaleString(),
                      'ms'
                  );
  
                  const start = Date.now();
                  const nodes = data.nodes;
                  const tn = nodes.length;
                  for (let i = 0; i < tn; i++) {
                      nn += this.addNode(
                          {
                              _id: this.filterXSS(nodes[i]),
                              origin: origin,
                          },
                          check
                      );
                  }
                  const links = data.links;
                  const tl = links.length;
                  for (let j = 0; j < tl; j++) {
                      nl += this.addLink(
                          Object.assign(links[j], {
                              origin: origin,
                              hasDistance: true,
                              distanceOrigin: origin,
                          }),
                          check
                      );
                  }
  
                  console.log(
                      'CSV Matrix Merge time:',
                      (Date.now() - start).toLocaleString(),
                      'ms'
                  );
  
                  resolve({ nn, nl, tn, tl });
  
                  //  Terminate Worker After Processing
                  this.computer.compute_parse_csv_matrixWorker.terminate();
  
                  //  Reinitialize Worker for Next Dataset
                  setTimeout(() => {
                      compute_parse_csv_matrixWorker = this.computer.getParseCsvMatrixWorker();
                      console.log("Worker reinitialized for next dataset.");
                  }, 100);
  
                  sub.unsubscribe();
              },
              error: (err: ErrorEvent) => {
                  console.error('Worker error:', err);
                  reject(err);
  
                  //  Ensure Worker Terminates on Error
                  this.computer.compute_parse_csv_matrixWorker.terminate();
                  sub.unsubscribe();
  
                  //  Reinitialize Worker on Error
                  setTimeout(() => {
                      compute_parse_csv_matrixWorker = this.computer.getParseCsvMatrixWorker();
                      console.log("Worker reinitialized after error.");
                  }, 100);
              }
          });
      });
  };
   */
  /**
   * XXXXX function not currently called XXXXX
   * @param auspiceData
   * @returns
   */
  auspiceCallBack(auspiceData) {
    this.clearData();
    this.session = this.sessionSkeleton();
    this.session.meta.startTime = Date.now();
    this.session.data.tree = auspiceData['tree'];
    this.session.data.newickString = auspiceData['newick'];
    let nodeCount = 0;
    auspiceData['nodes'].forEach(node => {
      if (!/NODE0*/.exec(node.id)) {
        const nodeKeys = Object.keys(node);
        nodeKeys.forEach(key => {
          if (this.session.data.nodeFields.indexOf(key) === -1) {
            this.session.data.nodeFields.push(key);
          }
          if (!Object.prototype.hasOwnProperty.call(node, 'origin')) {
            node.origin = [];
          }
          nodeCount += this.addNode(node, true);
        });
      }
    });
    let linkCount = 0;
    auspiceData['links'].forEach(link => {
      linkCount += this.addLink(link, true);
    });
    this.runHamsters();
    // this.showMessage(` - Parsed ${nodeCount} New Nodes and ${linkCount} new Links from Auspice file.`);
    this.processData();
    return nodeCount;
  }
  /**
   * Generates new sequences
   * ported from https://github.com/CDCgov/SeqSpawnR/blob/91d5857dbda5998839a002fbecae0f494dca960a/R/SequenceSpawner.R
   * @param {string} idPrefix - prefix to label generated sequences
   * @param {number} count - number of sequences to generate
   * @param {number} snps - number of snps to add to a new sequence is random value from 0 - snps
   * @param {string} seed -reference sequence for generating new sequences
   * @returns list of objects representings seq, each seq objects has {id: string, seq: string}
   */
  generateSeqs(idPrefix, count, snps, seed) {
    const start = Date.now();
    if (!count) count = 1000;
    if (!snps) snps = 100;
    if (!seed) seed = this.session.data.reference;
    const sampleCodons = ["GCA", "GCC", "GCG", "GCT", "AAC", "AAT", "GAC", "GAT", "TGC", "TGT", "GAC", "GAT", "GAA", "GAG", "TTC", "TTT", "GGA", "GGC", "GGG", "GGT", "CAC", "CAT", "ATA", "ATC", "ATT", "AAA", "AAG", "CTA", "CTC", "CTG", "CTT", "TTA", "TTG", "ATG", "AAC", "AAT", "CCA", "CCC", "CCG", "CCT", "CAA", "CAG", "AGA", "AGG", "CGA", "CGC", "CGG", "CGT", "AGC", "AGT", "TCA", "TCC", "TCG", "TCT", "ACA", "ACC", "ACG", "ACT", "GTA", "GTC", "GTG", "GTT", "TGG", "TAC", "TAT", "CAA", "CAG", "GAA", "GAG"];
    const sampleSNPs = ["A", "C", "G", "T"];
    const sample = (vec, nCodons) => {
      const samples = [];
      for (let x = 0; x < nCodons; x++) {
        let idx = Math.floor(this.r01() * vec.length);
        samples.push(vec[idx]);
      }
      return samples;
    };
    const seqs = [];
    seqs.push({
      id: idPrefix + "0",
      seq: seed
    });
    while (seqs.length < count) {
      // number codons to vary
      let nCodons = Math.floor(this.r01() * 10) + 1;
      // randomly select this many to check for existence
      const randomCodonSet = sample(sampleCodons, nCodons).join("");
      // try again if not present
      if (seqs[seqs.length - 1].seq.indexOf(randomCodonSet) == -1) continue;
      // sequence to mutate
      let oldseed = seqs[Math.floor(this.r01() * seqs.length)].seq;
      // select codons to replace randomCodonSet
      const replacementCodonSet = sample(sampleCodons, nCodons).join("");
      // replace codon set
      let newseed = oldseed.replace(randomCodonSet, replacementCodonSet);
      // add snp substitutions randomly across entire sequence
      // - randomly sample addedSNP
      // - randomly pick SNPS to replace
      let addedSNPs = Math.floor(this.r01() * snps);
      for (let j = 0; j < addedSNPs; j++) {
        let randomSNP = sample(sampleSNPs, 1)[0];
        let locOfSNP = Math.floor(this.r01() * seed.length);
        newseed = newseed.substr(0, locOfSNP) + randomSNP + newseed.substr(locOfSNP + 1);
      }
      seqs.push({
        id: idPrefix + "" + seqs.length,
        seq: newseed
      });
    }
    if (this.debugMode) {
      console.log("Sequence spawn time:", (Date.now() - start).toLocaleString(), 'ms');
    }
    return seqs;
  }
  // Align function using a fresh align worker
  align(params) {
    return new Promise(resolve => {
      if (params.aligner === "none") {
        return resolve(params.nodes);
      }
      const n = params.nodes.length;
      const referenceLength = params.reference.length;
      // Get a fresh align worker.
      const alignWorker = this.computer.getAlignWorker();
      alignWorker.postMessage(params);
      const sub = alignWorker.onmessage().subscribe(response => {
        let subset = JSON.parse(this.decode(new Uint8Array(response.data.nodes)));
        console.log("Alignment transit time: ", (Date.now() - response.data.start).toLocaleString(), "ms");
        const start = Date.now();
        let minPadding = Infinity;
        let d = null;
        for (let i = 0; i < n; i++) {
          d = subset[i];
          if (!d._seq) d._seq = "";
          if (minPadding > d._padding) minPadding = d._padding;
        }
        for (let j = 0; j < n; j++) {
          d = subset[j];
          d._seq = "-".repeat(d._padding - minPadding) + d._seq;
          if (d._seq.length > referenceLength) {
            d._seq = d._seq.substring(0, referenceLength);
          } else {
            d._seq = d._seq.padEnd(referenceLength, "-");
          }
        }
        this.session.data.nodeFields.push('_score', '_padding', '_cigar');
        console.log("Alignment Padding time: ", (Date.now() - start).toLocaleString(), "ms");
        resolve(subset);
        // Terminate the worker and unsubscribe.
        alignWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  // Compute consensus using a fresh consensus worker
  computeConsensus(nodes = null) {
    if (!nodes) {
      nodes = this.session.data.nodes.filter(d => d.seq);
    }
    return new Promise(resolve => {
      const consensusWorker = this.computer.getConsensusWorker();
      consensusWorker.postMessage({
        data: nodes
      });
      const sub = consensusWorker.onmessage().subscribe(response => {
        if (this.debugMode) {
          console.log("Consensus Transit time: ", (Date.now() - response.data.start).toLocaleString(), "ms");
        }
        resolve(this.decode(new Uint8Array(response.data.consensus)));
        consensusWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  // Compute ambiguity counts using a fresh ambiguity counts worker
  computeAmbiguityCounts() {
    return new Promise(resolve => {
      let nodes = this.session.data.nodes;
      let subset = nodes.filter(d => d.seq);
      const subsetLength = subset.length;
      const ambiguityWorker = this.computer.getAmbiguityCountsWorker();
      ambiguityWorker.postMessage(subset);
      const sub = ambiguityWorker.onmessage().subscribe(response => {
        console.log("Ambiguity Count Transit time: ", (Date.now() - response.data.start).toLocaleString(), "ms");
        const start = Date.now();
        const dists = new Float32Array(response.data.counts);
        for (let j = 0; j < subsetLength; j++) {
          nodes[subset[j].index]._ambiguity = dists[j];
        }
        this.session.data.nodeFields.push('_ambiguity');
        console.log("Ambiguity Count Merge time: ", (Date.now() - start).toLocaleString(), "ms");
        resolve();
        ambiguityWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  // Compute consensus distances using a fresh consensus worker
  computeConsensusDistances() {
    return new Promise(resolve => {
      let start = Date.now();
      let nodes = this.session.data.nodes;
      let nodesLength = nodes.length;
      let subset = [];
      for (let i = 0; i < nodesLength; i++) {
        const node = nodes[i];
        if (node.seq) {
          subset.push({
            index: i,
            seq: node.seq
          });
        } else {
          subset.push({
            index: i,
            seq: ""
          });
        }
      }
      let subsetLength = subset.length;
      const consensusWorker = this.computer.getConsensusWorker();
      consensusWorker.postMessage({
        data: {
          consensus: this.session.data['consensus'],
          subset: subset,
          start: start
        }
      });
      const sub = consensusWorker.onmessage().subscribe(response => {
        const dists = new Uint16Array(response.data.dists);
        console.log("Consensus Difference Transit time: ", (Date.now() - response.data.start).toLocaleString(), "ms");
        start = Date.now();
        for (let j = 0; j < subsetLength; j++) {
          nodes[subset[j].index]._diff = dists[j];
        }
        this.session.data.nodeFields.push('_diff');
        console.log("Consensus Difference Merge time: ", (Date.now() - start).toLocaleString(), "ms");
        resolve();
        consensusWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  // Compute links using a fresh links worker
  computeLinks(subset) {
    return new Promise(resolve => {
      let k = 0;
      const linksWorker = this.computer.getLinksWorker();
      linksWorker.postMessage({
        nodes: subset,
        metric: this.session.style.widgets['default-distance-metric'],
        strategy: this.session.style.widgets["ambiguity-resolution-strategy"],
        threshold: this.session.style.widgets["ambiguity-threshold"]
      });
      const sub = linksWorker.onmessage().subscribe(response => {
        let dists = this.session.style.widgets['default-distance-metric'].toLowerCase() === 'snps' ? new Uint16Array(response.data.links) : new Float32Array(response.data.links);
        if (this.debugMode) {
          console.log("Links Transit time: ", (Date.now() - response.data.start).toLocaleString(), "ms");
        }
        let start = Date.now();
        let check = this.session.files.length > 1;
        let n = subset.length;
        let l = 0;
        console.log('link same compute---', n);
        for (let i = 0; i < n; i++) {
          const sourceID = subset[i]._id;
          for (let j = 0; j < i; j++) {
            let targetID = subset[j]._id;
            k += this.addLink({
              source: sourceID,
              target: targetID,
              distance: dists[l++],
              origin: ['Genetic Distance'],
              distanceOrigin: 'Genetic Distance',
              hasDistance: true,
              directed: false
            }, check);
          }
        }
        if (this.debugMode) {
          console.log("Links Merge time: ", (Date.now() - start).toLocaleString(), "ms");
        }
        resolve(k);
        linksWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  getDM() {
    const start = Date.now();
    return new Promise(resolve => {
      let dm = '';
      if (this.session.data['newick']) {
        let treeObj = patristic__WEBPACK_IMPORTED_MODULE_2__.parseNewick(this.session.data['newick']);
        dm = treeObj.toMatrix();
      } else {
        let labels = this.session.data.nodes.filter(this.hasSeq).map(d => d.id);
        if (labels.length === 0) labels = this.session.data.nodes.filter(this.hasSeq).map(d => d._id);
        //console.log("Before sorting: " + labels);
        //labels = labels.sort();
        //console.log("After sorting: " + labels);
        let metric = this.session.style.widgets['link-sort-variable'];
        const n = labels.length;
        dm = new Array(n);
        const m = new Array(n);
        for (let i = 0; i < n; i++) {
          dm[i] = new Array(n);
          dm[i][i] = 0;
          let source = labels[i];
          let row = this.temp.matrix[source];
          if (row) {
            for (let j = 0; j < i; j++) {
              const link = row[labels[j]];
              if (link) {
                dm[i][j] = dm[j][i] = link[metric];
              } else {
                dm[i][j] = dm[j][i] = null;
              }
            }
          }
        }
      }
      // console.log('matrixx: ',  JSON.stringify(this.temp.matrix));
      if (this.debugMode) {
        console.log("DM Compute time: ", (Date.now() - start).toLocaleString(), "ms");
      }
      resolve(dm);
    });
  }
  computeTree() {
    if (this.debugMode) {
      console.log('computing tree');
    }
    console.log('------------------------------------------------------');
    return new Promise(resolve => {
      if (this.temp.treeObj) {
        return resolve(this.temp.treeObj.toNewick());
      } else if (this.session.data['newick']) {
        return resolve(this.session.data['newick']);
      } else {
        this.getDM().then(dm => {
          // Get a fresh tree worker from the factory.
          const treeWorker = this.computer.getTreeWorker();
          treeWorker.postMessage({
            labels: this.session.data.nodes.filter(this.hasSeq).map(a => a._id),
            matrix: dm,
            round: this.session.style.widgets["tree-round"]
          });
          const sub = treeWorker.onmessage().subscribe(response => {
            // Decode the result from the worker.
            const treeObj = this.decode(new Uint8Array(response.data.tree));
            const treeString = patristic__WEBPACK_IMPORTED_MODULE_2__.parseJSON(treeObj).toNewick();
            if (this.debugMode) {
              console.log('Tree Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
            }
            // Clean up: terminate the worker and unsubscribe.
            treeWorker.terminate();
            sub.unsubscribe();
            return resolve(treeString);
          });
        });
      }
    });
  }
  computeDirectionality() {
    return new Promise(resolve => {
      const directionalityWorker = this.computer.getDirectionalityWorker();
      directionalityWorker.postMessage({
        links: this.session.data.links,
        tree: this.temp.tree
      });
      const sub = directionalityWorker.onmessage().subscribe(response => {
        const flips = new Uint8Array(response.data.output);
        if (this.debugMode) {
          console.log("Directionality Transit time: ", (Date.now() - response.data.start).toLocaleString(), "ms");
        }
        const start = Date.now();
        const n = flips.length;
        for (let i = 0; i < n; i++) {
          if (flips[i]) {
            let fliplink = this.session.data.links[i];
            let fliptemp = fliplink.source;
            fliplink.source = fliplink.target;
            fliplink.target = fliptemp;
            fliplink.directed = true;
          }
        }
        if (this.debugMode) {
          console.log("Directionality Integration time: ", (Date.now() - start).toLocaleString(), "ms");
        }
        resolve();
        directionalityWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  computeMST() {
    return new Promise((resolve, reject) => {
      const links = this.session.data.links;
      const found = links.find(l => l.source === "MZ712879" && l.target === "MZ745515" || l.source === "MZ745515" && l.target === "MZ712879");
      console.log(" common service Found link in links array?", found);
      const mstWorker = this.computer.getMSTWorker();
      mstWorker.postMessage({
        links: this.session.data.links,
        matrix: this.temp.matrix,
        epsilon: this.session.style.widgets["filtering-epsilon"],
        metric: this.session.style.widgets['link-sort-variable']
      });
      const sub = mstWorker.onmessage().subscribe(response => {
        if (response.data === "Error") {
          return reject("MST washed out");
        }
        const output = new Uint8Array(response.data.links);
        if (this.debugMode) {
          console.log("MST Transit time: ", (Date.now() - response.data.start).toLocaleString(), "ms");
        }
        const start = Date.now();
        let links = this.session.data.links;
        const numLinks = links.length;
        console.log('-----setting NN');
        for (let i = 0; i < numLinks; i++) {
          links[i].nn = output[i] ? true : false;
          if (output[i] ? true : false) {
            console.log('-- NN true: ', lodash__WEBPACK_IMPORTED_MODULE_4__.cloneDeep(links[i]));
          }
        }
        if (this.debugMode) {
          console.log("MST Merge time: ", (Date.now() - start).toLocaleString(), "ms");
        }
        resolve();
        mstWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  computeNN() {
    return this.workerComputeService.computeNN(this.session, this.temp);
  }
  computeTriangulation() {
    this.workerComputeService.computeTriangulation(this.session, this.temp, this.addLink.bind(this)).then(() => {
      // continue processing after triangulation is complete
    }).catch(error => {
      console.error('Error in triangulation:', error);
    });
  }
  runHamsters() {
    var _this2 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      console.log('running hamsters');
      if (!_this2.session.style.widgets['triangulate-false']) _this2.computeTriangulation();
      // this.computeNN();
      console.log('run ham computeTree');
      yield _this2.computeTree();
      console.log('compute tree end');
      if (!_this2.session.style.widgets['infer-directionality-false']) _this2.computeDirectionality();
      _this2.finishUp();
    })();
  }
  /**
   * Sets node/link values to null when they aren't present. Check each field in nodeField and linkFields, and if the key includes 'date', sets any null or empty string
   * value to the min date value found. Populates options for #search-field, #link-sort-variable, #node-color-variable, #link-color-variable, set value for #default-distance-metric.
   * Next calls updateThresholdHistogram, tagClusters, setClusterVisibility, setLinkVisibilty, setNodeVisibility functions. Updates network statistic table.
   * Launches default view.
   */
  finishUp() {
    var _this3 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      clearTimeout(_this3.temp.messageTimeout);
      console.log('----- finishUp called');
      console.log('----- finishUp -- node/link fields');
      // cycles through each node and link and if variable in nodeFields/linkFields not a key for the node/link, it is added with value of null
      ["node", "link"].forEach(v => {
        let n = _this3.session.data[v + "s"].length;
        let fields = _this3.session.data[v + "Fields"];
        for (let i = 0; i < n; i++) {
          let d = _this3.session.data[v + "s"][i];
          fields.forEach(field => {
            if (!(field in d)) d[field] = null;
          });
        }
      });
      console.log('----- finishUp -- patch missing date fields');
      // patch missing date fields to earliest date in the the data
      let fields = _this3.session.data["nodeFields"];
      let nodeSkeleton = _this3.dataSkeleton();
      let fieldsToCheck = fields.filter(f => !nodeSkeleton.nodeFields.includes(f) && f != '_ambiguity' && f != '_diff');
      let n = _this3.session.data.nodes.length;
      let k = fieldsToCheck.length;
      // for each field in fieldsToCheck (fieldsToCheck are nodeFields that are not default from dataSkeleton() and also not '_ambiguity' and not '_diff' )
      for (let j = 0; j < k; j++) {
        const field = fieldsToCheck[j];
        const times = [];
        // for each node check if node[field] is valid time and if so push to times []
        for (let i = 0; i < n; i++) {
          let node = _this3.session.data.nodes[i];
          if (node[field] != null) {
            const time = moment__WEBPACK_IMPORTED_MODULE_5___default()(node[field]);
            if (time.isValid() && isNaN(node[field]))
              //#315
              times.push(time.toDate());
          }
        }
        // If column has the word date in it, date expected to be in column 
        if (field.toLowerCase().includes("date")) {
          const minTime = Math.min(...times);
          const minTimeString = new Date(minTime).toString();
          // for each node d, if d[field] == null or empty string ("", " ", "  " ...) set d[field] to minTimeString
          _this3.session.data.nodes.forEach(d => {
            if (d[field] == null || d[field] && String(d[field]).trim() == "" || d[field] == 'null') {
              d[field] = minTimeString;
            }
          });
        }
      }
      ;
      // TODO:: See if this is needed
      // this.foldMultiSelect();
      console.log('----- finishUp -- search fields, color variable sort varialbe, distance UI');
      $("#search-field").html(_this3.session.data.nodeFields.map(field => '<option value="' + field + '">' + _this3.titleize(field) + "</option>").join("\n")).val(_this3.session.style.widgets["search-field"]);
      $("#search-form").css("display", "flex");
      $("#link-sort-variable").html(_this3.session.data.linkFields.map(field => '<option value="' + field + '">' + _this3.titleize(field) + "</option>").join("\n")).val(_this3.session.style.widgets["link-sort-variable"]);
      $("#node-color-variable").html("<option selected>None</option>" + _this3.session.data.nodeFields.map(field => '<option value="' + field + '">' + _this3.titleize(field) + "</option>").join("\n")).val(_this3.session.style.widgets["node-color-variable"]);
      $("#default-distance-metric").val(_this3.session.style.widgets["default-distance-metric"]);
      $("#link-color-variable").html("<option>None</option>" + _this3.session.data.linkFields.map(field => '<option value="' + field + '">' + _this3.titleize(field) + "</option>").join("\n")).val(_this3.session.style.widgets["link-color-variable"]);
      try {
        // TODO:: Refactoring asses need for this
        // this.updateThresholdHistogram();
        console.log('updateThresholdHistogram called');
      } catch (error) {
        console.error(error);
        $("#loading-information-modal").hide();
      }
      console.log('----- finishUp -- setLinkVisibility before updating network');
      _this3.setLinkVisibility(true);
      // $("#SettingsTab").attr("data-target", "#global-settings-modal");
      console.log('----- finishUp -- updateNetworkVisuals');
      _this3.updateNetworkVisuals(true);
      // TODO is this needed?
      // setTimeout(() => {
      // if(this.debugMode) {
      //     console.log('ilaunching view: ',this.session.style.widgets['default-view']);
      // }
      // console.log('----- finishUp called Launch Emit');
      // this.launchView(this.session.style.widgets['default-view']);
      // TODO:: Do we need this?
      //this.launchView('Aggregate');
      //setTimeout(() => { $('#overlay button').click()}, 100)
      // currently loading all views isn't ready and is leading to bugs where default data is seeping in when new data is loaded
      //delayFunction(10, loadOtherViews) 
      // function convertName(s: string) {
      //     // can't do alignment view yet;
      //     if (s == 'geo_map') {
      //         return 'Map';
      //     } else if (s == 'table') {
      //         return 'Table'
      //     } else if (s == 'timeline') {
      //         return 'Epi Curve' 
      //     } else if (s == '2d_network') {
      //         return '2D Network'
      //     } else if (s == 'sequences') {
      //         //return 'Alignment View';
      //         return false;
      //         // need to add crosstab as well and fix alignment view; they are not being added to cs.session.layout.content;
      //         // on another note it doesn't close all previous view when new data is added from overlay
      //     } else if (s == 'phylogenetic_tree') {
      //         return 'Phylogenetic Tree'
      //     } else {
      //         console.log(`view ${s} is not currently defined`);
      //         return false;
      //     }
      // }
      // async function delayFunction(x, callback) {
      //     await new Promise(resolve => setTimeout(resolve, x)).then(() => {
      //         callback();
      //     })
      // }
      // async function loadOtherViews() {
      //     this.session.layout.content.forEach(async view => {
      //         let viewName = convertName(view.type)
      //         if (view.type == this.session.style.widgets['default-view']) {
      //             return;
      //         } else if (viewName){
      //             this.visuals.microbeTrace.Viewclick(viewName);
      //         }
      //         if (viewName == 'Epi Curve') {
      //             this.visuals.epiCurve.viewActive = false;
      //         }
      //     })
      //     this.visuals.microbeTrace.Viewclick(convertName( this.session.style.widgets['default-view']))
      // }
      // }, 1000);
      $(".hideForHIVTrace").css("display", "flex");
      _this3.store.updatecurrentThresholdStepSize(_this3.session.style.widgets["default-distance-metric"]);
    })();
  }
  updateNetworkVisuals(silent = false) {
    this.tagClusters().then(() => {
      this.setClusterVisibility(true);
      this.setNodeVisibility(true);
      this.setLinkVisibility(true);
      this.updateStatistics();
      if (!silent) this.store.setNetworkUpdated(true);
      console.log('---- Update network visuals end');
      console.log('---- Update network visuals end isFullyLoaded: ', this.session.network.isFullyLoaded);
      // If network wasn't loaded already, launch default view
      if (!this.session.network.isFullyLoaded) {
        this.session.meta.loadTime = Date.now() - this.session.meta.startTime;
        console.log("Total load time Update Network:", this.session.meta.loadTime.toLocaleString(), "ms");
        this.launchView(this.session.style.widgets['default-view']);
        console.log('---- Update network visuals end Total ');
      }
      //   $(document).trigger("node-visibility");
      //   $(document).trigger("network-visuals-updated");
    });
  }
  foldMultiSelect() {
    this.foldRaces();
    this.foldExposures();
  }
  foldRaces() {
    if (this.session.data.nodeFields.find(x => x === "Race")) {
      return;
    }
    this.session.data.nodeFields.push("Race");
    this.session.data.nodeFields.push("RaceDetails");
    const races = [{
      id: "RaceAsian",
      displayValue: "Asian"
    }, {
      id: "RaceAmericanIndian",
      displayValue: "American Indian"
    }, {
      id: "RaceBlack",
      displayValue: "Black"
    }, {
      id: "RaceWhite",
      displayValue: "White"
    }, {
      id: "RaceNativeHawaiian",
      displayValue: "Native Hawaiian"
    }];
    if (this.session.data.nodes) {
      this.session.data.nodes.forEach(node => {
        if (!node.Race) {
          let selectedRace = "";
          const raceDetails = [];
          races.forEach(race => {
            if (node[race.id] && node[race.id].toLowerCase() === "true") {
              raceDetails.push(race.displayValue);
              if (!selectedRace) {
                selectedRace = race.displayValue;
              } else {
                selectedRace = "Mixed";
              }
            }
            //Remove race properties
            delete node[race.id];
          });
          node.Race = selectedRace;
          node.RaceDetails = raceDetails.join(" | ");
        }
      });
    }
    //Remove race fields from nodeFields
    races.forEach(race => {
      this.session.data.nodeFields = this.session.data.nodeFields.filter(x => x != race.id);
    });
  }
  foldExposures() {
    if (this.session.data.nodeFields.find(x => x === "Exposure")) {
      return;
    }
    this.session.data.nodeFields.push("Exposure");
    this.session.data.nodeFields.push("ExposureDetails");
    const exposures = [{
      id: "ExposureInfoDomesticTraveled",
      displayValue: "Domestic Traveled"
    }, {
      id: "ExposureInfoInternationalTraveled",
      displayValue: "International Traveled"
    }, {
      id: "ExposureInfoCorrectionalFacility",
      displayValue: "Correctional Facility"
    }, {
      id: "ExposureInfoCovidAnimal",
      displayValue: "Covid Animal"
    }, {
      id: "ExposureInfoCruiseShipTraveled",
      displayValue: "Cruise Ship Traveled"
    }, {
      id: "ExposureInfoWorkplace",
      displayValue: "Workplace"
    }, {
      id: "ExposureInfoWorkplaceIsCriticalInfra",
      displayValue: "Workplace Is Critical Infra"
    }, {
      id: "ExposureInfoWorkplaceSetting",
      displayValue: "Workplace Setting"
    }, {
      id: "ExposureInfoAdultLivingFacility",
      displayValue: "Adult Living Facility"
    }, {
      id: "ExposureInfoSchool",
      displayValue: "School"
    }, {
      id: "ExposureInfoKnownCovid19ContactnCoVID",
      displayValue: "Known Covid19 Contact nCoVID"
    }];
    if (this.session.data.nodes) {
      this.session.data.nodes.forEach((node, index) => {
        if (!node.Exposure) {
          let selectedRace = "";
          const exposureDetails = [];
          exposures.forEach(exposure => {
            if (exposure.id != "ExposureInfoWorkplaceIsCriticalInfra" && exposure.id != "ExposureInfoWorkplaceSetting" && node[exposure.id] && node[exposure.id].toLowerCase() === "true") {
              if (exposure.id === "ExposureInfoWorkplace") {
                exposureDetails.push(`${exposure.displayValue} {"Is the workplace critical infrastructure" : "${this.session.data.nodes[index].ExposureInfoWorkplaceIsCriticalInfra}", "Workplace Setting" : "${this.session.data.nodes[index].ExposureInfoWorkplaceSetting}"}`);
              } else {
                exposureDetails.push(exposure.displayValue);
              }
              if (!selectedRace) {
                selectedRace = exposure.displayValue;
              } else {
                selectedRace = "Multiple";
              }
            }
            //Remove exposure properties
            delete node[exposure.id];
          });
          node.Exposure = selectedRace;
          node.ExposureDetails = exposureDetails.join(" | ");
        }
      });
    }
    //Remove exposure fields from nodeFields
    exposures.forEach(exposure => {
      this.session.data.nodeFields = this.session.data.nodeFields.filter(x => x != exposure.id);
    });
  }
  /**
   * Gets a list of all visible node objects
   * @param {boolean} [copy=false] - optional boolean value to set if you want to deepcopy the nodes
   * @returns a list of node objects
   */
  getVisibleNodes(copy = false) {
    let nodes = this.session.data.nodeFilteredValues;
    let n = nodes.length;
    let out = [];
    for (let i = 0; i < n; i++) {
      const node = nodes[i];
      if (node.visible) {
        if (copy) {
          out.push(JSON.parse(JSON.stringify(node)));
        } else {
          out.push(node);
        }
      }
    }
    return out;
  }
  /**
   * Gets a list of all visible links objects; Similar to twoD.getVlinks(), and twoD.getLLinks()
   *
   * A link that has multiple origin is stored as a single object
   *
   * Each link's source and target are strings of the node _id
   * @param {boolean} [copy=false] - optional boolean value to set if you want to deepcopy the links
   * @returns a array of link objects;
   */
  getVisibleLinks(copy = false) {
    let links = this.session.data.links;
    let n = links.length;
    let out = [],
      link = null;
    if (copy) {
      for (let i = 0; i < n; i++) {
        link = links[i];
        if (link.visible) out.push(JSON.parse(JSON.stringify(link)));
      }
    } else {
      for (let j = 0; j < n; j++) {
        link = links[j];
        if (link.visible) out.push(link);
      }
    }
    if (this.debugMode) {
      console.log('get visible links: ', lodash__WEBPACK_IMPORTED_MODULE_4__.cloneDeep(out));
    }
    return out;
  }
  /**
   * Gets a list of all visible cluster objects
   * @param {boolean} [copy=false] - optional boolean value to set if you want to deepcopy the cluster
   * @returns a list of cluster objects
   */
  getVisibleClusters(copy = false) {
    let clusters = this.session.data.clusters;
    if (this.debugMode) {
      console.log('get vis: ', clusters);
    }
    const n = clusters.length;
    const out = [];
    let cluster = null;
    if (copy) {
      for (let i = 0; i < n; i++) {
        cluster = clusters[i];
        if (cluster.visible) out.push(JSON.parse(JSON.stringify(cluster)));
      }
    } else {
      for (let j = 0; j < n; j++) {
        cluster = clusters[j];
        if (cluster.visible) out.push(cluster);
      }
    }
    return out;
  }
  /**
   * updates the network statistics table with number of visible nodes, visible links, clusters, and selected links
   * @returns undefined
   */
  updateStatistics() {
    if ($("#network-statistics-hide").is(":checked")) return;
    let vnodes = this.getVisibleNodes();
    let vlinks = this.getVisibleLinks();
    console.log('vLinksStats', vlinks.length);
    let linkCount = 0;
    let clusterCount = 0;
    if (this.session.style.widgets["timeline-date-field"] == 'None') {
      linkCount = vlinks.length;
      // const minSize = this.session.style.widgets['cluster-minimum-size'];
      clusterCount = this.session.data.clusters.filter(cluster => cluster.visible && cluster.nodes > 1).length;
    } else {
      let n = vlinks.length;
      for (let i = 0; i < n; i++) {
        const src = vnodes.find(d => d._id == vlinks[i].source || d.id == vlinks[i].source);
        const tgt = vnodes.find(d => d._id == vlinks[i].target || d.id == vlinks[i].target);
        if (src && tgt) linkCount++;
      }
      n = vnodes.length;
      const clusters = {};
      for (let i = 0; i < n; i++) {
        const id = vnodes[i].cluster;
        if (clusters[id]) clusters[id]++;else clusters[id] = 1;
      }
      clusterCount = this.session.data.clusters.filter(cluster => clusters[cluster.id] && clusters[cluster.id] > 2 && cluster.visible && cluster.nodes > 1).length;
    }
    const singletons = vnodes.filter(d => d.degree == 0).length;
    $("#numberOfSelectedNodes").text(vnodes.filter(d => d.selected).length.toLocaleString());
    $("#numberOfNodes").text(vnodes.length.toLocaleString());
    $("#numberOfVisibleLinks").text(linkCount.toLocaleString());
    $("#numberOfSingletonNodes").text(singletons.toLocaleString());
    $("#numberOfDisjointComponents").text(clusterCount);
  }
  /**
    * Delegates creation of the node color scales to ColorMappingService.
    * The rest of the code that was here (big D3 logic, etc.) is removed.
    */
  createNodeColorMap() {
    // 1) Gather the parameters from session & temp
    const nodeColorVariable = this.session.style.widgets['node-color-variable'];
    const nodes = this.session.data.nodes;
    // The arrays and tables you use to store color config
    const nodeColors = this.session.style.nodeColors; // e.g. [ "#1f77b4", ... ]
    const nodeAlphas = this.session.style.nodeAlphas; // e.g. [ 1, 1, ... ]
    const nodeColorsTable = this.session.style.nodeColorsTable; // e.g. { varName: [ ... ] }
    const nodeColorsTableKeys = this.session.style.nodeColorsTableKeys;
    const nodeColorsTableHistory = this.session.style.nodeColorsTableHistory;
    // 2) Call your new colorMappingService
    const result = this.colorMappingService.createNodeColorMap(nodes, nodeColorVariable, nodeColors, nodeAlphas, nodeColorsTable, nodeColorsTableKeys, nodeColorsTableHistory, this.debugMode);
    // 3) Store the results back into session & temp
    this.temp.style.nodeColorMap = result.colorMap;
    this.temp.style.nodeAlphaMap = result.alphaMap;
    // And also store the updated arrays/tables
    this.session.style.nodeColors = result.updatedNodeColors;
    this.session.style.nodeAlphas = result.updatedNodeAlphas;
    this.session.style.nodeColorsTable = result.updatedColorsTable;
    this.session.style.nodeColorsTableKeys = result.updatedColorsTableKeys;
    this.session.style.nodeColorsTableHistory = result.updatedColorsTableHistory;
    // 4) Return the aggregates (if needed by your caller)
    return result.aggregates;
  }
  /**
   * updates the functions that set the color and transparency of the links [commonService.temp.style.linkColorMap() and commonService.temp.style.linkAlphaMap()]
   * @returns {Object} where keys are the values to group (ie. origin A, origin B) and values are counts of the number of links for each key
   */
  createLinkColorMap() {
    // 1) Gather
    const linkColorVariable = this.session.style.widgets['link-color-variable'];
    console.log('create link color map: ', linkColorVariable);
    if (linkColorVariable == "None") {
      this.temp.style.linkColorMap = () => this.session.style.widgets["link-color"];
      this.temp.style.linkAlphaMap = () => 1 - this.session.style.widgets["link-opacity"];
      return [];
    }
    const links = this.getVisibleLinks();
    let linkColors;
    if (this.session.style.linkColorsTable && this.session.style.linkColorsTable[linkColorVariable]) {
      linkColors = this.session.style.linkColorsTable[linkColorVariable];
    } else if (linkColorVariable == 'source' || linkColorVariable == 'target') {
      this.session.style.linkColorsTable = {};
      this.session.style.linkColorsTableKeys = {};
      linkColors = this.session.style.linkColorsTable[linkColorVariable] = [d3__WEBPACK_IMPORTED_MODULE_1__.schemeCategory10[0]].concat(d3__WEBPACK_IMPORTED_MODULE_1__.schemeCategory10.slice(2));
      this.session.style.linkColors = [d3__WEBPACK_IMPORTED_MODULE_1__.schemeCategory10[0]].concat(d3__WEBPACK_IMPORTED_MODULE_1__.schemeCategory10.slice(2));
    } else if (this.session.style.linkColors) {
      this.session.style.linkColorsTable = {};
      this.session.style.linkColorsTableKeys = {};
      linkColors = this.session.style.linkColors;
    } else {
      this.session.style.linkColorsTable = {};
      this.session.style.linkColorsTableKeys = {};
      linkColors = this.session.style.linkColorsTable[linkColorVariable] = d3__WEBPACK_IMPORTED_MODULE_1__.schemePaired;
      this.session.style.linkColors = d3__WEBPACK_IMPORTED_MODULE_1__.schemePaired;
    }
    const linkAlphas = this.session.style.linkAlphas; // e.g. [1, 1, ...]
    const linkColorsTable = this.session.style.linkColorsTable;
    const linkColorsTableKeys = this.session.style.linkColorsTableKeys;
    // 2) Delegate to colorMappingService
    const result = this.colorMappingService.createLinkColorMap(links, linkColorVariable, linkColors, linkAlphas, linkColorsTable, linkColorsTableKeys, this.debugMode);
    // 3) Store updated scales back into session & temp
    this.temp.style.linkColorMap = result.colorMap;
    this.temp.style.linkAlphaMap = result.alphaMap;
    // store the updated arrays
    this.session.style.linkColors = result.updatedLinkColors;
    this.session.style.linkAlphas = result.updatedLinkAlphas;
    this.session.style.linkColorsTable = result.updatedLinkColorsTable;
    this.session.style.linkColorsTableKeys = result.updatedLinkColorsTableKeys;
    console.log('create link color map 1: ', this.session.style.linkColorsTable);
    console.log('create link color map 2: ', this.session.style.linkColorsTableKeys);
    console.log('create link color map 3: ', this.session.style.linkColors);
    console.log('create link color map 4: ', this.session.style.linkAlphas);
    return result.aggregates;
  }
  /**
   * updates the functions that set the color and transparency of the polygons [commonService.temp.style.polygonColorMap() and commonService.temp.style.polygonAlphaMap()]
   * @returns {Object} where keys are the values to group (ie. subtype B,C,D...) and values are counts of the number of node for each key
   */
  createPolygonColorMap() {
    // If you store your polygonGroups in this.temp, do:
    if (!this.temp.polygonGroups || !this.session.style.widgets['polygons-color-show']) {
      this.temp.style.polygonColorMap = () => this.session.style.widgets['polygon-color'];
      // return [];
    }
    // If this.session.style.widgets['polygons-color-show', we need 
    let polygonGroups = this.temp.polygonGroups || [];
    let polygonColors = this.session.style.polygonColors;
    if (!polygonColors || polygonColors.length === 0) {
      polygonColors = ['#bbccee', '#cceeff', '#ccddaa', '#eeeebb', '#ffcccc', '#dddddd'];
    }
    const polygonAlphas = this.session.style.polygonAlphas;
    // If polygonGroups length is 0 but polygons-color-show is true, we need to create the groups via going through the visible nodes, and grouping them by cluster id in the format { key: clusterId, values: [nodeId1, nodeId2, ...] }
    if (polygonGroups.length === 0 && this.session.style.widgets['polygons-color-show']) {
      // Create the groups by going through visible nodes, and creating the keys of the group by the unique values of node['polygon-foci']
      const groupMap = new Map();
      this.getVisibleNodes().forEach(node => {
        const polygonFoci = node['polygon-foci'];
        if (!groupMap.has(polygonFoci)) {
          groupMap.set(polygonFoci, []);
        }
        groupMap.get(polygonFoci).push(node);
      });
      polygonGroups = Array.from(groupMap.entries()).map(([key, values]) => ({
        key,
        values: values.map(node => node.id)
      }));
      this.temp.polygonGroups = polygonGroups;
      this.session.style.widgets['polygon-color-table-visible'] = true;
    }
    const result = this.colorMappingService.createPolygonColorMap(polygonGroups, polygonColors, polygonAlphas, this.debugMode);
    this.temp.style.polygonColorMap = result.colorMap;
    this.temp.style.polygonAlphaMap = result.alphaMap;
    this.session.style.polygonColors = result.updatedPolygonColors;
    this.session.style.polygonAlphas = result.updatedPolygonAlphas;
    return result.aggregates;
  }
  /**
   * Set commonService.session and commonService.temp back to default values; However keeps previous values for commonService.temp.mapData, commonService.session.files,
   * and commonService.session.meta
   */
  reset() {
    //debugger;
    // $("#network-statistics-hide").parent().trigger("click");
    // $("#SettingsTab").attr("data-target", "#sequence-controls-modal");
    const mapData = this.temp.mapData;
    this.temp = this.tempSkeleton();
    this.temp.mapData = mapData;
    const files = this.session.files;
    const meta = this.session.meta;
    this.session = this.sessionSkeleton();
    if (this.debugMode) {
      console.log('reset called: ', this.session.style.linkColors);
    }
    this.session.files = files;
    this.session.meta = meta;
    //this.layout.unbind("stateChanged");
    //this.layout.root.replaceChild(this.layout.root.contentItems[0], {
    //    type: "stack",
    //    content: []
    //});
    //this.session.layout.contentItems = [];
    //this.launchView("files");
  }
  /**
   * Sets the following objects back to default values: commonService.temp.matrix, commonService.temp.tree, commonService.session.data, commonService.session.network,
   * commonService.session.style.widgets. Filters 'Demo_outbreak_NodeList.csv' from files
   */
  resetData() {
    const newTempSkeleton = this.tempSkeleton();
    this.temp.matrix = newTempSkeleton.matrix;
    this.temp.trees = newTempSkeleton.trees;
    const files = this.session.files.filter(obj => obj.name !== 'Demo_outbreak_NodeList.csv');
    const meta = this.session.meta;
    if (this.debugMode) {
      console.log('reset data called');
      // console.log('session files1', JSON.stringify(this.visuals.microbeTrace.commonService.session.files));
      console.log('session files2', JSON.stringify(this.session.files));
      console.log('session data files: ', JSON.stringify(files));
      console.log('session data matrix: ', JSON.stringify(this.temp.matrix));
      console.log('session data nodes: ', JSON.stringify(this.session.data.nodes));
      console.log('session data nodes common: ', JSON.stringify(this.session.data.nodes));
    }
    const newSessionSkeleton = this.sessionSkeleton();
    this.session.data = newSessionSkeleton.data;
    this.session.network = newSessionSkeleton.network;
    this.session.files = files;
    this.session.meta = meta;
    this.session.style.widgets = this.defaultWidgets();
    // default values are 'tn93' and 0.015, so not sure if this if statement is every true
    if (this.session.style.widgets['default-distance-metric'] !== 'snps' && this.session.style.widgets['link-threshold'] >= 1) {
      this.visuals.microbeTrace.SelectedLinkThresholdVariable = this.session.style.widgets['link-threshold'];
      this.visuals.microbeTrace.onLinkThresholdChanged();
    }
  }
  getJurisdictions() {
    const path = `${this.appRootUrl()}assets/common/data/state_county_fips.csv`; // Refactor appRootUrl if necessary
    return this.http.get(path, {
      responseType: 'text'
    }).toPromise().then(response => {
      return papaparse__WEBPACK_IMPORTED_MODULE_3__.parse(response, {
        header: true
      }).data;
    }).catch(error => {
      console.error('Error fetching jurisdictions:', error);
      throw error;
    });
    // let options : any = {
    //     observe: "response",
    //     responseType: "blob",
    //     headers: new HttpHeaders({
    //         "Accept": "application/json"
    //     })
    // };
    // return this.http.request("get", path/*, options_*/).pipe(map((fileContents:any)=>{
    //     return Papa.parse(fileContents, {header: true}).data;
    // }));
    // $.get(path, response => {
    //     this.temp.mapData[name] = Papa.parse(response, { header: true }).data;
    //     resolve(this.temp.mapData[name]);
    // });
  }
  getMapData(type) {
    return new Promise(resolve => {
      const parts = type.split(".");
      const name = parts[0],
        format = parts[1];
      if (this.temp.mapData[name]) {
        return resolve(this.temp.mapData[name]);
      }
      let path;
      switch (name) {
        case "zipcodes":
          if (format == "csv") {
            path = 'assets/common/data/zipcodes.csv';
            return this.http.get(path, {
              responseType: 'text'
            }).toPromise().then(response => {
              this.temp.mapData[name] = papaparse__WEBPACK_IMPORTED_MODULE_3__.parse(response, {
                header: true
              }).data;
              return this.temp.mapData[name];
            });
          }
          break;
        case "countries":
          if (format == "json") {
            path = 'assets/common/data/countries.json';
            return this.http.get(path).toPromise().then(response => {
              this.temp.mapData[name] = response;
              return this.temp.mapData[name];
            });
          }
          break;
        case "counties":
          if (format == "json") {
            path = 'assets/common/data/counties.json';
            return this.http.get(path).toPromise().then(response => {
              this.temp.mapData[name] = response;
              return this.temp.mapData[name];
            });
          }
          break;
        case "states":
          if (format == "json") {
            // let path = /*this.appRootUrl() +*/ 'assets/common/data/states.json';
            path = 'assets/common/data/states.json';
            return this.http.get(path).toPromise().then(response => {
              this.temp.mapData[name] = response;
              return this.temp.mapData[name];
            });
          }
          break;
        case "land":
          if (format == "json") {
            path = 'assets/common/data/land.json';
            return this.http.get(path).toPromise().then(response => {
              this.temp.mapData[name] = response;
              return this.temp.mapData[name];
            });
            // $.get(path, response => {
            //     resolve(this.temp.mapData[name]);
            // });
          }
          break;
        case "stars":
          if (format == "json") {
            let path = /*this.appRootUrl() +*/'assets/common/data/stars.json';
            return this.http.get(path).toPromise().then(response => {
              this.temp.mapData[name] = response;
              return this.temp.mapData[name];
            });
            // $.get(path, response => {
            //     this.temp.mapData[name] = response;
            //     resolve(this.temp.mapData[name]);
            // });
          }
          break;
      }
      //$.get("data/" + type, response => {
      //    debugger;
      //    if (format == "csv") {
      //        this.temp.mapData[name] = new Papa().parse(response, { header: true }).data;
      //    }
      //    if (format == "json") {
      //        this.temp.mapData[name] = response;
      //    }
      //    resolve(this.temp.mapData[name]);
      //});
    });
  }
  /**
   * XXXXX Not currently used; not sure future use XXXXX
   * Predicts whether white or black is most contrasting color
   * @param {string} hexcolor - hexcode representation of a color (ie. '#1e9d00')
   * @returns {string} - for hex representation of color (white or black)
   */
  contrastColor(hexcolor) {
    const r = parseInt(hexcolor.substr(1, 2), 16);
    const g = parseInt(hexcolor.substr(3, 2), 16);
    const b = parseInt(hexcolor.substr(5, 2), 16);
    const yiq = r * 299 + g * 587 + b * 114;
    return yiq >= 128000 ? "#000000" : "#ffffff";
  }
  /**
  *  XXXXX Not currently being executed. It's in the codebase but hidden behind comments XXXXX
  *	Returns the last element of an array
  * @param ra - an array (potentially could take other datatypes as well)
  * @returns {any} the last element in an array
  */
  peek(ra) {
    return ra[ra.length - 1];
  }
  launchView(view, callback = null) {
    this.LoadViewEvent.emit(view);
  }
  /**
   * Gives the size of a variable in MB
   * @param thing
   * @returns {string} Size of thing in MB as a string ('4MB')
   */
  size(thing) {
    if (!thing) thing = this.session;
    return (JSON.stringify(thing).length / 1024 / 1024).toLocaleString() + 'MB';
  }
  /**
   * Converts commonly used titles to a standard output; for less common titles nothing is changed
   * @param {string} title
   */
  titleize(title) {
    const small = title.toLowerCase().replace(/_/g, " ");
    if (small == "null") return "(Empty)";
    if (small == "id" || small == " id") return "ID";
    if (small == "tn93") return "TN93";
    if (small == "snps") return "SNPs";
    if (small == "2d network") return "2D Network";
    if (small == "3d network") return "3D Network";
    if (small == "geo map") return "Map";
    if (small == "nn") return "Nearest Neighbor";
    return title;
    return small.replace(/(?:^|\s|-)\S/g, c => c.toUpperCase());
  }
  /**
   * Set up the clusters; new clusters are created as needed; node.cluster is set to cluster id.
   * When a node is found that isn't in tempnodes, a cluster is created and a depth-first search is preformed.
   * During DFS, nodes are added to tempnodes, the node.cluster is assigned and information in cluster is updated
   */
  tagClusters() {
    return new Promise(resolve => {
      let start = Date.now();
      let clusters = this.session.data.clusters = [];
      let nodes = this.session.data.nodes,
        links = this.session.data.links,
        labels = nodes.map(d => d._id);
      const numNodes = nodes.length,
        numLinks = links.length;
      let tempnodes = this.temp.nodes = [];
      let lsv = this.session.style.widgets["link-sort-variable"];
      /**
       * A function that performs a depth-first search.
       * @param id - The ID of the node to start the search from.
       * @param cluster - The cluster to search in.
       * @returns {void}
       */
      const DFS = (id, cluster) => {
        // if id is found in tempNode exit function
        if (tempnodes.indexOf(id) >= 0) return;
        // else add it, and continue DFS
        tempnodes.push(id);
        let node = {};
        for (let i = 0; i < numNodes; i++) {
          const d = nodes[i];
          if (!d._id) {
            d._id = d.id;
          }
          if (d._id == id) {
            node = d;
            break;
          }
        }
        const clusterID = cluster.id;
        node.cluster = clusterID;
        cluster.nodes++;
        let row = this.temp.matrix[id];
        if (!row) return;
        for (let j = 0; j < numNodes; j++) {
          const l = row[labels[j]];
          if (!l) continue;
          if (!l.visible) continue;
          l.cluster = clusterID;
          cluster.links++;
          cluster.sum_distances += l[lsv];
          if (tempnodes.length == numNodes) return;
          // recursively call DFS on both source and target
          DFS(l.source, cluster);
          DFS(l.target, cluster);
        }
      }; // DFS function close
      for (let k = 0; k < numNodes; k++) {
        const d = nodes[k];
        d.degree = 0;
        const id = d._id;
        // if id isn't in temp nodes, add new cluster and do DFS
        if (tempnodes.indexOf(id) == -1) {
          const cluster = {
            id: clusters.length > 0 ? clusters.length : 0,
            nodes: 0,
            links: 0,
            sum_distances: 0,
            links_per_node: 0,
            mean_genetic_distance: undefined,
            visible: true
          };
          clusters.push(cluster);
          DFS(id, cluster);
          if (tempnodes.length == numNodes) break;
        }
      }
      if (this.debugMode) {
        console.log("Cluster Tagging time:", (Date.now() - start).toLocaleString(), "ms");
      }
      start = Date.now();
      //This is O(N^3)
      //TODO: Refactor using temp.matrix to get O(N^2)
      for (let m = 0; m < numLinks; m++) {
        const l = links[m];
        if (!l.visible) continue;
        let s = false,
          t = false;
        for (let n = 0; n < numNodes; n++) {
          const node = nodes[n];
          if (l.source == node._id) {
            s = true;
            node.degree++;
          }
          if (l.target == node._id) {
            t = true;
            node.degree++;
          }
          if (s && t) break;
        }
      }
      // console.log('clustersssss: ' , clusters);
      clusters.forEach(c => {
        c.links = c.links / 2;
        c.links_per_node = c.links / c.nodes;
        c.mean_genetic_distance = c.sum_distances / 2 / c.links;
      });
      if (this.debugMode) {
        console.log("Degree Computation time:", (Date.now() - start).toLocaleString(), "ms");
      }
      resolve();
    });
  }
  /**
   * Sets node visibility to true when it cluster is visible
   * @param {boolean} silent - whether to trigger node-visibility event (True doesn't trigger, False does)
   */
  setNodeVisibility(silent) {
    console.log('--- Set node viz called');
    let start = Date.now();
    let dateField = this.session.style.widgets["timeline-date-field"];
    let nodes = this.session.data.nodes,
      clusters = this.session.data.clusters;
    let n = nodes.length;
    for (let i = 0; i < n; i++) {
      const node = nodes[i];
      node.visible = true;
      const cluster = clusters[node.cluster];
      if (cluster) {
        // TODO: uncomment if something breaks since this was defaulted to visible
        // cluster.visible = true;
        // console.log('setting cluster vis: ', cluster);
        // console.log('setting node vis: ', node.visible);
        node.visible = node.visible && cluster.visible;
      }
      if (dateField != "None") {
        node.visible = node.visible && (moment__WEBPACK_IMPORTED_MODULE_5___default()(this.session.state.timeEnd).toDate() >= moment__WEBPACK_IMPORTED_MODULE_5___default()(node[dateField]).toDate() || node[dateField] == null);
      }
      // if (node._id === "NIMR_NG894803") {
      //     console.log('setting node vis 2: ', _.cloneDeep(node));
      // }
    }
    if (!silent) {
      console.log('--- Set node viz NOT SILENT trigger node-visibility');
      $(document).trigger("node-visibility");
    }
    if (this.debugMode) {
      console.log('--- Set node viz nodes length: ', nodes.filter(n => n.visible).length);
      console.log("Node Visibility Setting time:", (Date.now() - start).toLocaleString(), "ms");
    }
  }
  /**
   * Sets link visibility based on distance, link-threshold, nearestNeighbor setting, etc...
   * @param {boolean} silent - whether to trigger link-visibility event (True doesn't trigger, False does)
   * @param {boolean} [checkCluster=true] - defaults to true; whether to include cluster.visibility when setting link.visibility
   */
  setLinkVisibility(silent, checkCluster = true) {
    let start = Date.now();
    let metric = this.session.style.widgets["link-sort-variable"],
      threshold = this.session.style.widgets["link-threshold"],
      showNN = this.session.style.widgets["link-show-nn"];
    let links = this.session.data.links;
    let clusters = this.session.data.clusters;
    let n = links.length;
    const globalOriginOrder = this.session.style.widgets['link-origin-array-order']; // Get the global order once
    if (this.debugMode) {
      console.log(`Setting Link Visibility with ${metric} ${threshold} ${showNN}`);
      console.log('Global Origin Order:', globalOriginOrder); // Log global order
    }
    //log all links that are visible and their origin
    //console.log('--- visible links1 (Start): ', _.cloneDeep(links.filter(l => l.visible)));
    for (let i = 0; i < n; i++) {
      const link = links[i]; // Reference to the object in session.data.links
      // *** Step 1: Use a copy for checks ***
      let finalOrigins = [...link.origin]; // Copy origins for visibility logic
      let visible = true;
      let overrideNN = false;
      let originWasFiltered = false; // *** Step 2: Add flag ***
      // Add back the distance origin to the *copy* if it was removed (Safeguard)
      // Check against original link.origin, add to finalOrigins if needed
      if (link.distanceOrigin && !link.origin.includes(link.distanceOrigin)) {
        if (!finalOrigins.includes(link.distanceOrigin)) {
          // Avoid duplicates in copy
          finalOrigins.push(link.distanceOrigin);
        }
      }
      // Also ensure distanceOrigin exists in original if it should
      if (link.distanceOrigin && !link.origin.includes(link.distanceOrigin)) {
        link.origin.push(link.distanceOrigin); // Ensure original has it too if missing
      }
      // Visibility Logic based on metric/threshold/hasDistance
      if (link[metric] == null) {
        // No distance value for the current metric
        // Check for non-distance origins using the *copy*
        if (finalOrigins.filter(fileName => !link.distanceOrigin || !fileName.includes(link.distanceOrigin)).length > 0) {
          // Filter the *copy* for visibility check
          finalOrigins = finalOrigins.filter(fileName => !link.distanceOrigin || !fileName.includes(link.distanceOrigin));
          originWasFiltered = true; // *** Mark as filtered ***
          overrideNN = true;
          visible = true;
        } else {
          visible = false;
        }
      } else {
        // Has a distance value for the current metric
        if (link.hasDistance) {
          visible = link[metric] <= threshold;
          if (!visible) {
            // Distance is above threshold. Check for other origins using the *copy*.
            if (finalOrigins.filter(fileName => {
              const hasAuspice = /[Aa]uspice/.test(fileName); // Preserved Auspice check
              const includesDistanceOrigin = link.distanceOrigin && fileName.includes(link.distanceOrigin);
              return fileName && !includesDistanceOrigin && !hasAuspice;
            }).length > 0) {
              // Filter the *copy* for visibility check
              finalOrigins = finalOrigins.filter(fileName => {
                const hasAuspice = /[Aa]uspice/.test(fileName);
                const includesDistanceOrigin = link.distanceOrigin && fileName.includes(link.distanceOrigin);
                return fileName && !includesDistanceOrigin && !hasAuspice;
              });
              originWasFiltered = true; // *** Mark as filtered ***
              overrideNN = true;
              visible = true;
            }
            // If only distance origin existed and it's above threshold, 'visible' remains false.
          }
        } else {
          // Has a distance value but hasDistance is false? Treat as always visible.
          overrideNN = true;
          visible = true;
        }
      }
      // NN Pruning Logic
      if (visible && showNN && !overrideNN) {
        const wasVisible = visible;
        visible = visible && link.nn;
        if (!visible && wasVisible) {
          // Check if NN made it invisible
          // Check *copy* for other origins
          if (finalOrigins.filter(fileName => !link.distanceOrigin || !fileName.includes(link.distanceOrigin)).length > 0) {
            // Filter the *copy*
            finalOrigins = finalOrigins.filter(fileName => !link.distanceOrigin || !fileName.includes(link.distanceOrigin));
            originWasFiltered = true; // *** Mark as filtered ***
            visible = true; // Keep visible due to non-distance origin
          }
        }
      }
      // Cluster Visibility Check
      const cluster = clusters[link.cluster];
      if (cluster && checkCluster) {
        visible = visible && cluster.visible;
      }
      // --- Step 3: Apply Final Origin Array Conditionally ---
      if (visible) {
        if (originWasFiltered) {
          // If filtering occurred *during visibility checks*, assign the filtered result
          link.origin = finalOrigins;
        } else if (link.origin.length > 1 && globalOriginOrder.length > 1) {
          // If NO filtering occurred, it's visible, has multiple origins,
          // and global order exists, apply the global order.
          // Check if the link's current origins fundamentally match the global order content
          // (ignoring order initially) to prevent applying the wrong order set.
          const linkOriginSet = new Set(link.origin);
          const globalOrderSet = new Set(globalOriginOrder);
          if (linkOriginSet.size === globalOrderSet.size && [...linkOriginSet].every(item => globalOrderSet.has(item))) {
            link.origin = globalOriginOrder;
          } else {
            // Log a warning if sets don't match - indicates potential issue in global order management
            console.warn("Link origin set doesn't match global order set. Not applying global order.", link.id, link.origin, globalOriginOrder);
            // Keep link.origin as it was after addLink
          }
        }
        // If visible and single origin, or global order not set/relevant,
        // link.origin correctly retains its value from addLink.
      }
      // If not visible, link.origin is left as is.
      link.visible = visible; // Set final visibility
    } // End of loop
    //log all links that are visible and their origin
    //console.log('--- visible links (End of setLinkVisibility): ', _.cloneDeep(links.filter(l => l.visible)));
    if (!silent) {
      // $(document).trigger("link-visibility");
    }
    if (this.debugMode) {
      console.log("Link Visibility Setting time:", (Date.now() - start).toLocaleString(), "ms");
    }
  }
  /**
   * Set the visibility of each cluster based on if cluster size is greater than cluster-minimum-size
   * @param {boolean} silent whether to trigger cluster-visibility event (True doesn't trigger, False does)
   */
  setClusterVisibility(silent) {
    //let start = Date.now();
    let min = this.session.style.widgets["cluster-minimum-size"];
    let clusters = this.session.data.clusters;
    let n = clusters.length;
    console.log('cluster nodes ', clusters);
    for (let i = 0; i < n; i++) {
      const cluster = clusters[i];
      cluster.visible = cluster.nodes >= min;
    }
    if (!silent) $(document).trigger("cluster-visibility"); //$window.trigger("cluster-visibility");
    // console.log("Cluster Visibility Setting time:", (Date.now() - start).toLocaleString(), "ms");
  }
  /**
   * Creates and updates the threshold histogram that is found in global settings.
   * Clicking on the histogram will update the link threshold
   * @param [histogram] - optional parameter
   */
  updateThresholdHistogram(histogram) {
    var _this4 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      let width = 260,
        height = 48,
        svg = null;
      // Update histogram so that it can be altered outside of the main wrapper 
      if (histogram) {
        _this4.thresholdHistogram = histogram;
      }
      svg = d3__WEBPACK_IMPORTED_MODULE_1__.select(_this4.thresholdHistogram).html(null).attr("width", width).attr("height", height);
      // add all link distances to data, find max and min distances
      let lsv = _this4.session.style.widgets["link-sort-variable"],
        n = _this4.session.data.links.length,
        max = Number.MIN_SAFE_INTEGER,
        min = Number.MAX_SAFE_INTEGER,
        data = Array(n),
        dist = null;
      for (let i = 0; i < n; i++) {
        dist = _this4.session.data.links[i][lsv];
        data[i] = dist;
        if (dist < min) min = dist;
        if (dist > max) max = dist;
      }
      // Add all link distances to data, find max and min distances
      // const links = this.session.data.links;
      // const lsv = this.session.style.widgets["link-sort-variable"];
      // const n = links.length;
      // let max = -Infinity;
      // let min = Infinity;
      // const data: number[] = new Array(n);
      // let dist: number;
      // First pass: Compute min and max distances without storing them in a separate array
      // for (let i = 0; i < n; i++) {
      //     const dist = typeof links[i][lsv] === 'string' ? parseFloat(links[i][lsv]) : links[i][lsv];
      //     // Update min and max
      //     if (dist < min) {
      //         min = dist;
      //     }
      //     if (dist > max) {
      //         max = dist;
      //     }
      // }
      let range = max - min;
      let ticks = 40;
      const x = d3__WEBPACK_IMPORTED_MODULE_1__.scaleLinear().domain([min, max]).range([0, width]);
      const bins = d3__WEBPACK_IMPORTED_MODULE_1__.histogram().domain(x.domain()).thresholds(x.ticks(ticks))(data);
      const y = d3__WEBPACK_IMPORTED_MODULE_1__.scaleLinear().domain([0, d3__WEBPACK_IMPORTED_MODULE_1__.max(bins, d => d.length)]).range([height, 0]);
      const bar = svg.selectAll(".bar").data(bins).enter().append("g").attr("class", "bar").attr("transform", d => "translate(" + x(d.x0) + "," + y(d.length) + ")");
      bar.append("rect").attr("x", 1).attr("width", 6).attr("height", d => height - y(d.length));
      let that = _this4;
      /**
       * Uses the position on the histogram to set the link thresehold value
       */
      function updateThreshold() {
        let xc = d3__WEBPACK_IMPORTED_MODULE_1__.mouse(svg.node())[0];
        let decimalPlaces = that.session.style.widgets['default-distance-metric'].toLowerCase() === "tn93" ? 3 : 0;
        that.session.style.widgets["link-threshold"] = xc / width * range * 1.05 + min;
        $("#link-threshold").val(parseFloat(that.session.style.widgets["link-threshold"].toFixed(decimalPlaces)));
      }
      svg.on("click", () => {
        updateThreshold();
        _this4._debouncedUpdateNetworkVisuals();
      });
      svg.on("mouseover", () => {
        let xc = d3__WEBPACK_IMPORTED_MODULE_1__.mouse(svg.node())[0];
        $('#filtering-threshold').prop('title', "Whats the maximum genetic distance you're willing to call a link? " + (_this4.session.style.widgets['default-distance-metric'].toLowerCase() === "tn93" ? (xc / width * range * 1.05 + min).toLocaleString() : Math.round(xc / width * range * 1.05 + min).toLocaleString()));
      });
      svg.on("mousedown", () => {
        d3__WEBPACK_IMPORTED_MODULE_1__.event.preventDefault();
        svg.on("mousemove", updateThreshold);
        svg.on("mouseup mouseleave", () => {
          _this4._debouncedUpdateNetworkVisuals();
          svg.on("mousemove", null).on("mouseup", null).on("mouseleave", null);
        });
      });
      data = [];
    })();
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_15__.Injector
    }, {
      type: _shared_utils_local_storage_service__WEBPACK_IMPORTED_MODULE_7__.LocalStorageService
    }, {
      type: _microbe_trace_next_plugin_visuals__WEBPACK_IMPORTED_MODULE_10__.MicrobeTraceNextVisuals
    }, {
      type: _angular_common_http__WEBPACK_IMPORTED_MODULE_18__.HttpClient
    }, {
      type: _common_store_services__WEBPACK_IMPORTED_MODULE_11__.CommonStoreService
    }, {
      type: _color_mapping_service__WEBPACK_IMPORTED_MODULE_13__.ColorMappingService
    }, {
      type: _worker_compute_service__WEBPACK_IMPORTED_MODULE_14__.WorkerComputeService
    }];
  }
  static {
    this.propDecorators = {
      LoadViewEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_15__.Output
      }]
    };
  }
};
CommonService = (0,tslib__WEBPACK_IMPORTED_MODULE_19__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_15__.Directive)(), (0,_angular_core__WEBPACK_IMPORTED_MODULE_15__.Injectable)({
  providedIn: 'root'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_19__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_15__.Injector, _shared_utils_local_storage_service__WEBPACK_IMPORTED_MODULE_7__.LocalStorageService, _microbe_trace_next_plugin_visuals__WEBPACK_IMPORTED_MODULE_10__.MicrobeTraceNextVisuals, _angular_common_http__WEBPACK_IMPORTED_MODULE_18__.HttpClient, _common_store_services__WEBPACK_IMPORTED_MODULE_11__.CommonStoreService, _color_mapping_service__WEBPACK_IMPORTED_MODULE_13__.ColorMappingService, _worker_compute_service__WEBPACK_IMPORTED_MODULE_14__.WorkerComputeService
// private srv: GoldenLayoutService
])], CommonService);


/***/ }),

/***/ 70616:
/*!**************************************************************!*\
  !*** ./src/app/contactTraceCommonServices/export.service.ts ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ExportService: () => (/* binding */ ExportService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! rxjs */ 10819);



let ExportService = class ExportService {
  constructor() {
    this.exportRequestedSource = new rxjs__WEBPACK_IMPORTED_MODULE_0__.Subject();
    this.exportRequested$ = this.exportRequestedSource.asObservable();
    this.exportSVGSource = new rxjs__WEBPACK_IMPORTED_MODULE_0__.Subject();
    this.exportSVG$ = this.exportSVGSource.asObservable();
    this.exportOptions = {
      filename: 'network_export',
      filetype: 'png',
      scale: 1,
      quality: 0.92
    };
  }
  /**
   * Sets the export options.
   * @param options ExportOptions object containing user-selected options.
   */
  setExportOptions(options) {
    this.exportOptions = {
      ...options
    };
  }
  /**
   * Retrieves the current export options.
   * @returns ExportOptions object.
   */
  getExportOptions() {
    return this.exportOptions;
  }
  /**
   * Notifies subscribers that an export has been requested.
   * @param element The HTMLDivElement(s) to export.
   * @param exportNodeTable Flag for exporting the node table.
   * @param exportLinkTable Flag for exporting the link table.
   */
  requestExport(element, exportNodeTable, exportLinkTable) {
    this.exportRequestedSource.next({
      element,
      exportNodeTable,
      exportLinkTable
    });
  }
  /**
   * Notifies subscribers that an SVG export has been requested.
   * @param element The HTMLTableElement(s) to export.
   * @param mainSVGString The main SVG string.
   * @param exportNodeTable Flag for exporting the node table.
   * @param exportLinkTable Flag for exporting the link table.
   */
  requestSVGExport(element, mainSVGString, exportNodeTable, exportLinkTable) {
    this.exportSVGSource.next({
      element,
      mainSVGString,
      exportNodeTable,
      exportLinkTable
    });
  }
  /**
   * Converts an HTMLTableElement into an SVG representation.
   * @param tableElement The HTMLTableElement (for example, a Node Color Table).
   * @returns An object containing the SVG string (<g>...</g>), width, and height.
   */
  exportTableAsSVG(tableElement, hasHeaderRow = false) {
    const rows = tableElement.rows;
    let tableData = [];
    let widthOffsets = [10];
    let heightOffsets = [15];
    for (let i = 0; i < rows.length; i++) {
      const cells = rows[i].cells;
      const rowData = [];
      for (let j = 0; j < cells.length; j++) {
        if (i === 0) {
          widthOffsets.push(widthOffsets[j] + cells[j].offsetWidth + 15);
        }
        if (j === 0) {
          heightOffsets.push(heightOffsets[i] + cells[0].offsetHeight);
        }
        if (window.getComputedStyle(cells[j]).display === 'none') {
          continue;
        }
        if (cells[j].querySelector('p-dropdown')) {
          if (cells[j].querySelector('p-dropdown div a').className == 'rhombus') {
            rowData.push('shapeRhombus');
          } else if (cells[j].querySelector('p-dropdown div a').className == 'tag') {
            rowData.push('shapeTag');
          } else if (cells[j].querySelector('p-dropdown div a').className == 'barrel') {
            rowData.push('shapeBarrel');
          } else {
            rowData.push(cells[j].querySelector('p-dropdown div').innerHTML.replace(/&nbsp;/g, ' '));
          }
        } else if (cells[j].querySelector('input[type="color"]')) {
          let color = cells[j].querySelector('input[type="color"]').value;
          rowData.push(color);
        } else {
          rowData.push(cells[j].innerText.replace('', ''));
        }
      }
      tableData.push(rowData);
    }
    let out = `<g><rect x="0" y="0" width="${widthOffsets[widthOffsets.length - 1] - 20}" height="${heightOffsets[heightOffsets.length - 1] - 10}" stroke="black" stroke-width="1"></rect>`;
    tableData.forEach((row, rowIndex) => {
      row.forEach((cell, colIndex) => {
        if (cell.length === 7 && cell[0] === '#') {
          out += `<rect x="${widthOffsets[colIndex]}" y="${heightOffsets[rowIndex] - 12}" width="20" height="20" fill="${cell}"></rect>`;
        } else if (cell === 'shapeRhombus') {
          out += `<g font-family="Roboto, 'Helvetica Neue', sans-serif" font-size="16" fill="black">
            <text x="${widthOffsets[colIndex]}" y="${heightOffsets[rowIndex] - 12}" fill="black" rotate="80"></text>
            <text x="${widthOffsets[colIndex] + 15}" y="${heightOffsets[rowIndex]}">(Rhombus)</text>
            </g>`;
        } else if (cell === 'shapeTag') {
          out += `<g font-family="Roboto, 'Helvetica Neue', sans-serif" font-size="16" fill="black">
            <text x="${widthOffsets[colIndex]}" y="${heightOffsets[rowIndex] - 12}" fill="black" rotate="90"></text>
            <text x="${widthOffsets[colIndex] + 15}" y="${heightOffsets[rowIndex]}">(Tag)</text>
            </g>`;
        } else if (cell === 'shapeBarrel') {
          out += `<g font-family="Roboto, 'Helvetica Neue', sans-serif" font-size="16" fill="black">
            <rect x="${widthOffsets[colIndex]}" y="${heightOffsets[rowIndex] - 12}" fill="black" width="12" height="12" rx="4" ry="4"/>
            <text x="${widthOffsets[colIndex] + 15}" y="${heightOffsets[rowIndex]}">(Barrel)</text>
            </g>`;
        } else if (hasHeaderRow && rowIndex === 0) {
          out += `<text x="${widthOffsets[colIndex]}" y="${heightOffsets[rowIndex]}" font-family="Roboto, 'Helvetica Neue', sans-serif" font-size="16" fill="black" font-weight="bold">${cell}</text>`;
        } else {
          out += `<text x="${widthOffsets[colIndex]}" y="${heightOffsets[rowIndex]}" font-family="Roboto, 'Helvetica Neue', sans-serif" font-size="16" fill="black">${cell}</text>`;
        }
      });
    });
    out += '</g>';
    return {
      svg: out,
      width: widthOffsets[widthOffsets.length - 1] - 20,
      height: heightOffsets[heightOffsets.length - 1] - 10
    };
  }
  /**
   * Extracts the SVG from a DOM element with CSS included.
   * @param svgNode The SVG HTMLElement (for example, obtained via document.getElementById('network')).
   * @returns A string containing the complete SVG code with CSS.
   */
  unparseSVG(svgNode) {
    svgNode.setAttribute("xlink", "http://www.w3.org/1999/xlink");
    const selectorTextArr = [];
    // Add the parent element's ID and classes.
    selectorTextArr.push("#" + svgNode.id);
    const nClasses = svgNode.classList.length;
    for (let c = 0; c < nClasses; c++) {
      const classSelector = "." + svgNode.classList[c];
      if (!selectorTextArr.includes(classSelector)) {
        selectorTextArr.push(classSelector);
      }
    }
    // Add children element IDs and classes.
    const nodes = svgNode.getElementsByTagName("*");
    const nNodes = nodes.length;
    for (let i = 0; i < nNodes; i++) {
      const child = nodes[i];
      const childId = child.id;
      if (childId && !selectorTextArr.includes("#" + childId)) {
        selectorTextArr.push("#" + childId);
      }
      const classes = child.classList;
      for (let d = 0; d < classes.length; d++) {
        const classSelector = "." + classes[d];
        if (!selectorTextArr.includes(classSelector)) {
          selectorTextArr.push(classSelector);
        }
      }
    }
    // Extract CSS rules for the selectors.
    let extractedCSSText = "";
    const nStylesheets = document.styleSheets.length;
    for (let j = 0; j < nStylesheets; j++) {
      const s = document.styleSheets[j];
      try {
        if (!s.cssRules) continue;
      } catch (e) {
        if (e.name !== "SecurityError") throw e;
        continue;
      }
      const cssRules = s.cssRules;
      const nRules = cssRules.length;
      for (let r = 0; r < nRules; r++) {
        const rule = cssRules[r];
        if (!rule.selectorText) continue;
        if (selectorTextArr.some(selector => rule.selectorText.includes(selector))) {
          extractedCSSText += rule.cssText;
        }
      }
    }
    const styleElement = document.createElement("style");
    styleElement.setAttribute("type", "text/css");
    styleElement.innerHTML = extractedCSSText;
    const refNode = svgNode.hasChildNodes() ? svgNode.children[0] : null;
    svgNode.insertBefore(styleElement, refNode);
    const serializer = new XMLSerializer();
    return serializer.serializeToString(svgNode);
  }
  static {
    this.ctorParameters = () => [];
  }
};
ExportService = (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.Injectable)({
  providedIn: 'root'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__metadata)("design:paramtypes", [])], ExportService);


/***/ }),

/***/ 46404:
/*!**********************************************************************!*\
  !*** ./src/app/contactTraceCommonServices/worker-compute.service.ts ***!
  \**********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   WorkerComputeService: () => (/* binding */ WorkerComputeService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs */ 43942);
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! patristic */ 50826);
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(patristic__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _workers_workModule__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../workers/workModule */ 53597);





/**
 * This service delegates all Worker-based computations.
 * It expects a 'session' object with the same structure
 * that CommonService uses (so we can push nodeFields, etc.).
 */
let WorkerComputeService = class WorkerComputeService {
  constructor(computer) {
    this.computer = computer;
  }
  /**
   * Helper that converts a Workers events into an RxJS Observable.
   */
  fromWorker(worker) {
    return new rxjs__WEBPACK_IMPORTED_MODULE_2__.Observable(observer => {
      // If the worker implements addEventListener, use it.
      if (typeof worker.addEventListener === 'function') {
        const messageHandler = event => observer.next(event);
        const errorHandler = error => observer.error(error);
        worker.addEventListener('message', messageHandler);
        worker.addEventListener('error', errorHandler);
        return () => {
          worker.removeEventListener('message', messageHandler);
          worker.removeEventListener('error', errorHandler);
          worker.terminate();
        };
      } else {
        // Fallback for InlineWorker (or any non-standard worker)
        // Use the onmessage and onerror properties.
        worker.onmessage = event => observer.next(event);
        worker.onerror = error => observer.error(error);
        return () => {
          // If your InlineWorker provides a terminate() method, call it.
          if (typeof worker.terminate === 'function') {
            worker.terminate();
          }
        };
      }
    });
  }
  /**
   * Align sequences using a worker.
   * We push the extra node fields (_score, _padding, _cigar)
   * just like the old CommonService code did.
   */
  align(session, params) {
    return new Promise(resolve => {
      if (params.aligner === 'none') {
        return resolve(params.nodes);
      }
      const n = params.nodes.length;
      const referenceLength = params.reference.length;
      const alignWorker = this.computer.getAlignWorker();
      alignWorker.postMessage(params);
      const sub = this.fromWorker(alignWorker).subscribe(response => {
        const decoder = new TextDecoder('utf-8');
        const subset = JSON.parse(decoder.decode(new Uint8Array(response.data.nodes)));
        if (session.debugMode) {
          console.log('Alignment transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
        }
        const start = Date.now();
        let minPadding = Infinity;
        for (let i = 0; i < n; i++) {
          const d = subset[i];
          if (!d._seq) d._seq = '';
          if (minPadding > d._padding) {
            minPadding = d._padding;
          }
        }
        // Pad all sequences
        for (let j = 0; j < n; j++) {
          const d = subset[j];
          d._seq = '-'.repeat(d._padding - minPadding) + d._seq;
          if (d._seq.length > referenceLength) {
            d._seq = d._seq.substring(0, referenceLength);
          } else {
            d._seq = d._seq.padEnd(referenceLength, '-');
          }
        }
        // Just like in old code, push the new nodeFields
        session.data.nodeFields.push('_score', '_padding', '_cigar');
        if (session.debugMode) {
          console.log('Alignment Padding time: ', (Date.now() - start).toLocaleString(), 'ms');
        }
        resolve(subset);
        alignWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  /**
   * Compute consensus from a set of nodes that have .seq.
   */
  computeConsensus(session, nodes) {
    return new Promise(resolve => {
      const consensusWorker = this.computer.getConsensusWorker();
      consensusWorker.postMessage({
        data: nodes
      });
      const sub = this.fromWorker(consensusWorker).subscribe(response => {
        if (session.debugMode) {
          console.log('Consensus Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
        }
        const decoder = new TextDecoder('utf-8');
        const consensus = decoder.decode(new Uint8Array(response.data.consensus));
        resolve(consensus);
        consensusWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  /**
   * Compute ambiguity counts. Also push "_ambiguity" into nodeFields
   * like the old code did.
   */
  computeAmbiguityCounts(session) {
    return new Promise(resolve => {
      const nodes = session.data.nodes;
      const subset = nodes.filter(d => d.seq);
      const subsetLength = subset.length;
      const ambiguityWorker = this.computer.getAmbiguityCountsWorker();
      ambiguityWorker.postMessage(subset);
      const sub = this.fromWorker(ambiguityWorker).subscribe(response => {
        if (session.debugMode) {
          console.log('Ambiguity Count Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
        }
        const start = Date.now();
        const dists = new Float32Array(response.data.counts);
        // Assign each nodes ._ambiguity
        for (let j = 0; j < subsetLength; j++) {
          nodes[subset[j].index]._ambiguity = dists[j];
        }
        // In old code, we also do: session.data.nodeFields.push('_ambiguity');
        session.data.nodeFields.push('_ambiguity');
        if (session.debugMode) {
          console.log('Ambiguity Count Merge time: ', (Date.now() - start).toLocaleString(), 'ms');
        }
        resolve();
        ambiguityWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  /**
   * Compute consensus distances. Also push "_diff" field.
   */
  computeConsensusDistances(session) {
    return new Promise(resolve => {
      const start = Date.now();
      const nodes = session.data.nodes;
      const subset = [];
      // Build subset array
      for (let i = 0; i < nodes.length; i++) {
        subset.push({
          index: i,
          seq: nodes[i].seq || ''
        });
      }
      const consensusWorker = this.computer.getConsensusWorker();
      consensusWorker.postMessage({
        data: {
          consensus: session.data['consensus'] || null,
          // or pass actual consensus if you have it
          subset: subset,
          start: start
        }
      });
      const sub = this.fromWorker(consensusWorker).subscribe(response => {
        const dists = new Uint16Array(response.data.dists);
        if (session.debugMode) {
          console.log('Consensus Difference Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
        }
        const mergeStart = Date.now();
        for (let j = 0; j < subset.length; j++) {
          nodes[subset[j].index]._diff = dists[j];
        }
        // old code: session.data.nodeFields.push('_diff');
        session.data.nodeFields.push('_diff');
        if (session.debugMode) {
          console.log('Consensus Difference Merge time: ', (Date.now() - mergeStart).toLocaleString(), 'ms');
        }
        resolve();
        consensusWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  /**
   * Compute links using default-distance-metric.
   * The old code used subset plus calls addLink on session.
   * So we do the same: we loop through the pairs and call session.addLink(...) for each distance.
   */
  /**
    * Compute links using a worker.
    * Note: We now pass an addLink callback so that we can call
    * the original addLink logic from CommonService.
    */
  computeLinks(session, subset, addLink) {
    return new Promise(resolve => {
      let k = 0;
      const metric = session.style.widgets['default-distance-metric'];
      const linksWorker = this.computer.getLinksWorker();
      linksWorker.postMessage({
        nodes: subset,
        metric: metric,
        strategy: session.style.widgets["ambiguity-resolution-strategy"],
        threshold: session.style.widgets["ambiguity-threshold"]
      });
      const sub = this.fromWorker(linksWorker).subscribe(response => {
        // Choose the proper typed array based on metric
        const dists = metric.toLowerCase() === 'snps' ? new Uint16Array(response.data.links) : new Float32Array(response.data.links);
        if (session.debugMode) {
          console.log('Links Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
        }
        const start = Date.now();
        const checkFlag = session.files.length > 1;
        let l = 0;
        // For each pair (i,j) with i > j, add a link using the provided addLink callback.
        for (let i = 0; i < subset.length; i++) {
          const sourceID = subset[i]._id;
          for (let j = 0; j < i; j++) {
            k += addLink({
              source: sourceID,
              target: subset[j]._id,
              distance: dists[l++],
              origin: ['Genetic Distance'],
              distanceOrigin: 'Genetic Distance',
              hasDistance: true,
              directed: false
            }, checkFlag);
          }
        }
        if (session.debugMode) {
          console.log('Links Merge time: ', (Date.now() - start).toLocaleString(), 'ms');
        }
        resolve(k);
        linksWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  /**
   * Rebuild old getDM logic.
   * If session.data['newick'], parse. Otherwise build matrix from session.temp.matrix.
   */
  getDM(session) {
    return new Promise(resolve => {
      const start = Date.now();
      let dm;
      if (session.data['newick']) {
        const treeObj = patristic__WEBPACK_IMPORTED_MODULE_0__.parseNewick(session.data['newick']);
        dm = treeObj.toMatrix();
      } else {
        let labels = session.data.nodes.map(d => d._id).sort();
        const metric = session.style.widgets['link-sort-variable'];
        const n = labels.length;
        dm = new Array(n);
        for (let i = 0; i < n; i++) {
          dm[i] = new Array(n);
          dm[i][i] = 0;
          const source = labels[i];
          const row = session.temp.matrix[source];
          if (!row) {
            console.error(`Incompletely populated temp.matrix! Could not find: ${source}`);
            continue;
          }
          for (let j = 0; j < i; j++) {
            const link = row[labels[j]];
            if (link) {
              dm[i][j] = dm[j][i] = link[metric];
            } else {
              dm[i][j] = dm[j][i] = null;
            }
          }
        }
      }
      if (session.debugMode) {
        console.log('DM Compute time: ', (Date.now() - start).toLocaleString(), 'ms');
      }
      resolve(dm);
    });
  }
  /**
   * Compute an NJ/UPGMA tree.
   * We do the same patristic-based approach from the old code.
   */
  computeTree(session) {
    return new Promise(resolve => {
      if (session.temp.treeObj) {
        // If we already have a treeObj, just use it
        return resolve(session.temp.treeObj.toNewick());
      } else if (session.data['newick']) {
        // If we already have a newick string
        return resolve(session.data['newick']);
      } else {
        // Otherwise, build from DM
        this.getDM(session).then(dm => {
          const treeWorker = this.computer.getTreeWorker();
          treeWorker.postMessage({
            labels: session.data.nodes.map(a => a._id),
            matrix: dm,
            round: session.style.widgets["tree-round"]
          });
          const sub = this.fromWorker(treeWorker).subscribe(response => {
            const decoder = new TextDecoder('utf-8');
            const treeObjJSON = decoder.decode(new Uint8Array(response.data.tree));
            const treeString = patristic__WEBPACK_IMPORTED_MODULE_0__.parseJSON(treeObjJSON).toNewick();
            if (session.debugMode) {
              console.log('Tree Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
            }
            resolve(treeString);
            treeWorker.terminate();
            sub.unsubscribe();
          });
        });
      }
    });
  }
  /**
   * Compute directionality, flipping links if needed.
   */
  computeDirectionality(session) {
    return new Promise(resolve => {
      const directionalityWorker = this.computer.getDirectionalityWorker();
      directionalityWorker.postMessage({
        links: session.data.links,
        tree: session.temp.tree
      });
      const sub = this.fromWorker(directionalityWorker).subscribe(response => {
        const flips = new Uint8Array(response.data.output);
        if (session.debugMode) {
          console.log('Directionality Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
        }
        const start = Date.now();
        for (let i = 0; i < flips.length; i++) {
          if (flips[i]) {
            const fliplink = session.data.links[i];
            const fliptemp = fliplink.source;
            fliplink.source = fliplink.target;
            fliplink.target = fliptemp;
            fliplink.directed = true;
          }
        }
        if (session.debugMode) {
          console.log('Directionality Integration time: ', (Date.now() - start).toLocaleString(), 'ms');
        }
        resolve();
        directionalityWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  /**
   * Compute MST, storing an nn:true property on any MST edges, like old code.
   */
  computeMST(session, temp) {
    return new Promise((resolve, reject) => {
      const mstWorker = this.computer.getMSTWorker();
      mstWorker.postMessage({
        links: session.data.links,
        matrix: temp.matrix,
        epsilon: session.style.widgets["filtering-epsilon"],
        metric: session.style.widgets['link-sort-variable']
      });
      const sub = this.fromWorker(mstWorker).subscribe(response => {
        if (response.data === "Error") {
          return reject('MST washed out');
        }
        const output = new Uint8Array(response.data.links);
        if (session.debugMode) {
          console.log('MST Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
        }
        const start = Date.now();
        for (let i = 0; i < session.data.links.length; i++) {
          session.data.links[i].nn = output[i] ? true : false;
        }
        if (session.debugMode) {
          console.log('MST Merge time: ', (Date.now() - start).toLocaleString(), 'ms');
        }
        resolve();
        mstWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  /**
   * Compute NN, storing nn:true on the nearest neighbor edges.
   */
  computeNN(session, temp) {
    return new Promise((resolve, reject) => {
      const nnWorker = this.computer.getNNWorker();
      nnWorker.postMessage({
        links: session.data.links,
        matrix: temp.matrix,
        // use temp.matrix (not session.temp)
        epsilon: session.style.widgets["filtering-epsilon"],
        metric: session.style.widgets["link-sort-variable"]
      });
      const sub = this.fromWorker(nnWorker).subscribe(response => {
        if (response.data === 'Error') {
          return reject('Nearest Neighbor washed out');
        }
        const output = new Uint8Array(response.data.links);
        if (session.debugMode) {
          console.log('NN Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
        }
        const start = Date.now();
        // Loop over all links in session.data.links and update the nn property.
        for (let i = 0; i < session.data.links.length; i++) {
          session.data.links[i].nn = output[i] ? true : false;
        }
        if (session.debugMode) {
          console.log('NN Merge time: ', (Date.now() - start).toLocaleString(), 'ms');
        }
        resolve();
        nnWorker.terminate();
        sub.unsubscribe();
      });
    });
  }
  /**
   * Compute Triangulation, adding invisible placeholders for missing edges, etc.
   */
  computeTriangulation(session, temp, addLink) {
    return new Promise((resolve, reject) => {
      const metric = session.style.widgets['link-sort-variable'];
      this.getDM(session).then(dm => {
        const triangulationWorker = this.computer.getTriangulationWorker();
        triangulationWorker.postMessage({
          matrix: dm
        });
        const sub = this.fromWorker(triangulationWorker).subscribe(response => {
          if (response.data === 'Error') {
            return reject('Triangulation washed out');
          }
          if (session.debugMode) {
            console.log('Triangulation Transit time: ', (Date.now() - response.data.start).toLocaleString(), 'ms');
          }
          const mergeStart = Date.now();
          const decoder = new TextDecoder('utf-8');
          const matrixObj = JSON.parse(decoder.decode(new Uint8Array(response.data.matrix)));
          // Use the labels from the temp object (not session.temp)
          const labels = Object.keys(temp.matrix);
          const n = labels.length;
          for (let i = 0; i < n; i++) {
            const source = labels[i];
            const row = temp.matrix[source];
            for (let j = 0; j < i; j++) {
              const target = labels[j];
              // If the temporary matrix is missing an entry, call the addLink callback.
              if (!row[target]) {
                addLink({
                  source: source,
                  target: target,
                  origin: ['Triangulation'],
                  visible: false
                }, false // or whatever "check" flag you need
                );
              }
              // Update the distance for this metric.
              row[target][metric] = matrixObj[i][j];
            }
          }
          if (session.debugMode) {
            console.log('Triangulation Merge time: ', (Date.now() - mergeStart).toLocaleString(), 'ms');
          }
          resolve();
          triangulationWorker.terminate();
          sub.unsubscribe();
        });
      });
    });
  }
  static {
    this.ctorParameters = () => [{
      type: _workers_workModule__WEBPACK_IMPORTED_MODULE_1__.WorkerModule
    }];
  }
};
WorkerComputeService = (0,tslib__WEBPACK_IMPORTED_MODULE_3__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_4__.Injectable)({
  providedIn: 'root'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_3__.__metadata)("design:paramtypes", [_workers_workModule__WEBPACK_IMPORTED_MODULE_1__.WorkerModule])], WorkerComputeService);


/***/ }),

/***/ 16025:
/*!**********************************************************!*\
  !*** ./src/app/filesComponent/files-plugin.component.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   FilesComponent: () => (/* binding */ FilesComponent)
/* harmony export */ });
/* harmony import */ var _Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 89204);
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _files_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./files-plugin.component.html?ngResource */ 96303);
/* harmony import */ var _files_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./files-plugin.component.less?ngResource */ 94908);
/* harmony import */ var _files_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_files_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! xlsx */ 13857);
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! papaparse */ 92853);
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(papaparse__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var fileto__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! fileto */ 93471);
/* harmony import */ var fileto__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(fileto__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _visualizationComponents_AlignmentViewComponent_generateAlignmentViewCanvas__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../visualizationComponents/AlignmentViewComponent/generateAlignmentViewCanvas */ 81200);
/* harmony import */ var tn93__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! tn93 */ 29432);
/* harmony import */ var tn93__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(tn93__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! patristic */ 50826);
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(patristic__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! lodash */ 46227);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_10__);
/* harmony import */ var _shared_utils_event_emitter_service__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @shared/utils/event-emitter.service */ 44734);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! rxjs */ 10819);
/* harmony import */ var _app_contactTraceCommonServices_common_store_services__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @app/contactTraceCommonServices/common-store.services */ 16546);




















// import { ComponentContainer } from 'golden-layout';
// import { ConsoleReporter } from 'jasmine';
let FilesComponent = class FilesComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_12__.BaseComponentDirective {
  constructor(container, elRef, eventEmitterService, commonService, cdr, store) {
    super(elRef.nativeElement);
    this.container = container;
    this.eventEmitterService = eventEmitterService;
    this.commonService = commonService;
    this.cdr = cdr;
    this.store = store;
    this.LoadDefaultVisualizationEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_14__.EventEmitter();
    this.SelectedDefaultDistanceMetricVariable = "tn93";
    this.SelectedAmbiguityResolutionStrategyVariable = "AVERAGE";
    this.SelectedAmbiguityThresholdVariable = 0.015;
    this.SelectedDefaultDistanceThresholdVariable = 0.015;
    this.SelectedDefaultViewVariable = "2D Network";
    this.SelectedGenerateNumberVariable = 100;
    this.DirectionalityTypes = [{
      label: 'Off',
      value: 'Off'
    }, {
      label: 'Inferred',
      value: 'Inferred'
    }];
    this.SelectedDirectionalityTypeVariable = "Off";
    this.TriangulationTypes = [{
      label: 'Off',
      value: 'Off'
    }, {
      label: 'On',
      value: 'On'
    }];
    this.SelectedTriangulationTypeVariable = "Off";
    this.AutostashingTypes = [{
      label: 'Off',
      value: 'Off'
    }, {
      label: 'On',
      value: 'On'
    }];
    this.SelectedAutostashingTypeVariable = "Off";
    this.AlignTypes = [{
      label: 'None',
      value: 'None'
    }, {
      label: 'Smith-Waterman',
      value: 'Smith-Waterman'
    }];
    this.SelectedAlignTypeVariable = "None";
    this.isLoadingFiles = false;
    this.ReferenceTypes = [{
      label: 'LoadFrom FASTA',
      value: 'LoadFrom FASTA'
    }, {
      label: 'First Sequence',
      value: 'First Sequence'
    }, {
      label: 'Consensus',
      value: 'Consensus'
    }];
    this.SelectedReferenceTypeVariable = "LoadFrom FASTA";
    this.SelectedRefSeqFileLoadVariable = "";
    this.RefSeqIDTypes = [];
    this.SelectedRefSeqIDVariable = "";
    this.SelectedAlignerMatchVariable = "1";
    this.SelectedAlignerMismatchVariable = 1;
    this.SelectedAlignerGapOVariable = 5;
    this.SelectedAlignerGapEVariable = 2;
    this.IsReferenceSourceSelected = false;
    this.IsReferenceOptionsSelected = true;
    this.SelectedAuditEmptyVariable = true;
    this.SelectedAuditGapsVariable = true;
    this.SelectedAuditRNAVariable = true;
    this.SelectedAuditAminoAcidsVariable = true;
    this.SelectedAuditCIGARVariable = true;
    this.SelectedAuditMalformedVariable = true;
    this.IsDataAvailable = false;
    this.displayFileSettings = false;
    this.displaySequenceSettings = false;
    this.displayloadingInformationModal = false;
    this.nodeIds = [];
    this.edgeIds = [];
    this.uniqueNodes = [];
    this.uniqueEdgeNodes = [];
    this.destroy$ = new rxjs__WEBPACK_IMPORTED_MODULE_15__.Subject();
    /**
     * Updates SelectedDefaultDistanceThresholdVariable, microbeTrace.SelectedLinkThresholdVariable, and link-threshold widget values.
     * Then calls microbeTrace.onLinkThresholdChanged clusters, nodes, and links as well as visualizations and statistics
     * @param {string} e string representation of link threshold such as '7'
     */
    this.onLinkThresholdChange = e => {
      if (this.commonService.debugMode) {
        console.log('changing link threshold');
      }
      this.SelectedDefaultDistanceThresholdVariable = parseFloat(e);
      this.store.setLinkThreshold(parseFloat(e));
    };
    /**
     * Updates this.SelectedDefaultDistanceMetricVariable, microbeTrace.SelectedDistanceMetricVariable, and default-distance-metric widget.
     * Updates link-threshold variable to default values and updates clusters, nodes, links as well as visualizations and statitistics
     * @param {string} e such as 'snps'
     */
    this.onDistanceMetricChange = e => {
      if (this.commonService.debugMode) {
        console.log('distance ch:', e);
      }
      this.SelectedDefaultDistanceMetricVariable = e;
      this.store.updatecurrentThresholdStepSize(e.toLowerCase());
      if (e.toLowerCase() === 'snps') {
        if (this.commonService.debugMode) {
          console.log("saw snps");
        }
        $('#default-distance-threshold').attr('step', 1).val(16).trigger('change');
        $("#ambiguities-row").slideUp();
        this.commonService.session.style.widgets['default-distance-metric'] = 'snps';
        this.store.setMetricChanged('snps');
        this.onLinkThresholdChange('16');
      } else {
        $('#default-distance-threshold').attr('step', 0.001).val(0.015).trigger('change');
        $("#ambiguities-row").slideDown();
        this.commonService.session.style.widgets['default-distance-metric'] = 'tn93';
        this.store.setMetricChanged('tn93');
        this.onLinkThresholdChange('0.015');
      }
    };
    // this.title = this.container.title;
    this.id = this.container.parent.id;
  }
  ngOnInit() {
    this.RefSeqIDTypes.push({
      label: 'Pol',
      value: this.commonService.HXB2.substr(2000, 2100)
    });
    this.RefSeqIDTypes.push({
      label: 'Complete',
      value: this.commonService.HXB2
    });
    this.SelectedDefaultDistanceThresholdVariable = this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable;
    this.SelectedDefaultDistanceMetricVariable = this.commonService.GlobalSettingsModel.SelectedDistanceMetricVariable;
    this.commonService.LoadViewEvent.subscribe(v => {
      this.loadDefaultVisualization(v);
    });
    this.commonService.session.data.reference = this.commonService.HXB2.substr(2000, 2100);
    if (this.eventEmitterService.subsVar == undefined) {
      this.eventEmitterService.subsVar = this.eventEmitterService.invokeFirstComponentFunction.subscribe(name => {
        this.processFile();
      });
    }
    // Subscribe to new session event
    this.store.newSession$.subscribe(() => {
      this.removeAllFiles();
    });
    // Subscribe to style file applied event
    this.store.styleFileApplied$.subscribe(() => {
      this.applyStyleFileSettings();
    });
    this.store.FP_removeFiles$.subscribe(() => {
      this.commonService.session.files.forEach(file => {
        this.removeFile(file.name, false);
      });
    });
    // TODO: the rest of ngOnInit can be revised to take advantage of angular features
    $('.alignConfigRow').hide();
    $('#align-sw').parent().on('click', () => {
      this.commonService.session.style.widgets['align-sw'] = true;
      this.commonService.session.style.widgets['align-none'] = false;
      $('.alignConfigRow, #reference-file-row').slideDown();
      $('#alignment-preview').slideUp(function () {
        //debugger;
        $(this).empty().show();
      });
    });
    $('#align-none').parent().on('click', () => {
      this.commonService.session.style.widgets['align-sw'] = false;
      this.commonService.session.style.widgets['align-none'] = true;
      $('.alignConfigRow, #reference-file-row').slideUp();
      $('#alignment-preview').slideUp(function () {
        //debugger;
        $(this).empty().show();
      });
    });
    $('#reference-source-file').parent().on('click', () => {
      //debugger;
      this.commonService.session.style.widgets['reference-source-file'] = true;
      this.commonService.session.style.widgets['reference-source-first'] = false;
      this.commonService.session.style.widgets['reference-source-consensus'] = false;
      this.commonService.session.data.reference = $('#refSeqID').val().toString();
      //debugger;
      if (!this.commonService.session.style.widgets['align-none']) $('#reference-file-row').slideDown();
    });
    $('#reference-source-first').parent().on('click', () => {
      this.commonService.session.style.widgets['reference-source-file'] = false;
      this.commonService.session.style.widgets['reference-source-first'] = true;
      this.commonService.session.style.widgets['reference-source-consensus'] = false;
      $('#reference-file-row').slideUp();
    });
    $('#reference-source-consensus').parent().on('click', () => {
      this.commonService.session.style.widgets['reference-source-file'] = false;
      this.commonService.session.style.widgets['reference-source-first'] = false;
      this.commonService.session.style.widgets['reference-source-consensus'] = true;
      $('#reference-file-row').slideUp();
    });
    $('#reference-file-row').hide();
    $('#refSeqFileLoad').on('change', () => {
      //debugger;
      const file = this.commonService.session.files[0]; //this.files[0];
      let reader = new FileReader();
      reader.onloadend = e => {
        if (e.target.readyState === FileReader.DONE) {
          this.commonService.parseFASTA(e.target.result).then(nodes => {
            $('#refSeqID').html(nodes.map((d, i) => `
                                <option value="${this.commonService.filterXSS(d.seq)}" ${i === 0 ? "selected" : ""}>${this.commonService.filterXSS(d.id)}</option>
                              `)).trigger('change');
          });
          $('label[for="refSeqFileLoad"]').text(this.commonService.filterXSS(file.name));
        }
      };
      reader.readAsText(file);
    });
    $('#refSeqID').html(`
          <option value="${this.commonService.HXB2.substr(2000, 2100)}" selected>Pol</option>
          <option value="${this.commonService.HXB2}">Complete</option>
        `).on('change', e => {
      //debugger;
      this.commonService.session.data.reference = e.data; // this.value;
    });
    $('#alignment-preview').on('click', () => {
      this.readFastas().then(data => {
        if (this.commonService.session.style.widgets['reference-source-first']) {
          //debugger;
          this.commonService.session.data.reference = ""; //nodes[0].seq;
        }
        if (this.commonService.session.style.widgets['reference-source-consensus']) {
          this.commonService.computeConsensus().then(consensus => this.commonService.session.data.reference = consensus);
        }
        this.updatePreview(data);
      });
    });
    const auditBlock = $('#audited-sequences');
    const logAudit = (parentContext, id, type) => {
      const match = auditBlock.find(`[data-id="${id}"]`);
      const button = $(`<button class="btn btn-warning btn-sm audit-exclude" data-id="${id}">Exclude</button>`).on('click', function () {
        const thi$ = $(this);
        const id = thi$.data('id');
        if (thi$.text() === 'Exclude') {
          parentContext.commonService.session.data.nodeExclusions.push(id);
          thi$.removeClass('btn-warning').addClass('btn-success').text('Include');
        } else {
          parentContext.commonService.session.data.nodeExclusions.splice(parentContext.commonService.session.data.nodeExclusions.indexOf(id), 1);
          thi$.removeClass('btn-success').addClass('btn-warning').text('Exclude');
        }
      });
      const row = $(`<div class="alert alert-warning w-100 d-flex justify-content-between" role="alert"><span>${id} appears to be ${type}.</span></div>`);
      row.append(button);
      auditBlock.append(row);
    };
    $('#audit-launcher').on('click', () => {
      this.readFastas().then(data => {
        const start = Date.now();
        const isGaps = /^-+$/;
        const isRNA = /^[ACGURYMKWSBDHVN-]+$/;
        const isAA = /^[ARNDCQEGHILKMFPSTWYVBZN]+$/;
        const isDNA = /^[ACGTRYMKWSBDHVN-]+$/;
        const isCIGAR = /^[0-9MIDNSHP=X]+$/;
        const isMalformed = /[^ACGTURYMKWSBDHVNQEILFPZX0-9-]+/;
        const checkEmpty = $('#audit-empty').is(':checked');
        const checkGaps = $('#audit-gaps').is(':checked');
        const checkRNA = $('#audit-RNA').is(':checked');
        const checkAA = $('#audit-amino-acids').is(':checked');
        const checkCIGAR = $('#audit-CIGAR').is(':checked');
        const checkMalformed = $('#audit-malformed').is(':checked');
        // const any = false;
        data.forEach(d => {
          const seq = d.seq,
            id = d.id;
          if (checkEmpty && seq === '') logAudit(this, id, 'empty');
          if (checkGaps && isGaps.test(seq)) logAudit(this, id, 'all gaps');
          if (checkRNA && isRNA.test(seq) && !isGaps.test(seq)) logAudit(this, id, 'RNA');
          if (checkAA && isAA.test(seq) && !isDNA.test(seq)) logAudit(this, id, 'amino acids');
          if (checkCIGAR && isCIGAR.test(seq)) logAudit(this, id, 'a CIGAR');
          if (checkMalformed && isMalformed.test(seq)) logAudit(this, id, 'malformed');
        });
        console.log('Sequence Auditing time:', (Date.now() - start).toLocaleString(), 'ms');
      });
    });
    $('#audit-toggle-all').on('click', () => {
      $('.audit-exclude').trigger('click');
    });
    $('#default-distance-metric').change(e => {
      //debugger;
      const lsv = e.data ? e.data : 'tn93';
      this.commonService.localStorageService.setItem('default-distance-metric', lsv);
      $('#default-distance-metric').val(lsv);
      console.log(lsv);
      if (lsv.toLowerCase() === 'snps') {
        $('#ambiguities-row').slideUp();
        $('#default-distance-threshold') //, #link-threshold')
        .attr('step', 1).val(16);
        this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable = 16;
        console.log('default-distance-metric change file-plugin.component.ts snps');
        this.store.setLinkThreshold(16);
      } else {
        $('#ambiguities-row').slideDown();
        $('#default-distance-threshold') //, #link-threshold')
        .attr('step', 0.001).val(0.015);
        this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable = 0.015;
        console.log('default-distance-metric change file-plugin.component.ts tn93');
        this.store.setLinkThreshold(0.015);
      }
      this.commonService.session.style.widgets['default-distance-metric'] = lsv;
      this.commonService.GlobalSettingsModel.SelectedDefaultDistanceMetricVariable = lsv;
    });
    let cachedLSV = "";
    this.commonService.localStorageService.getItem('default-distance-metric', result => {
      cachedLSV = result;
      if (cachedLSV) {
        $('#default-distance-metric').val(cachedLSV).trigger('change');
      }
    });
    $('#ambiguity-resolution-strategy').on('change', e => {
      //debugger;
      const v = e.data; //this.value;
      this.commonService.session.style.widgets['ambiguity-resolution-strategy'] = v;
      if (v === 'HIVTRACE-G') {
        $('#ambiguity-threshold-row').slideDown();
      } else {
        $('#ambiguity-threshold-row').slideUp();
      }
    }).change();
    $('#ambiguity-threshold').on('change', e => {
      //debugger;
      const v = e.data; //this.value;
      this.commonService.session.style.widgets['ambiguity-threshold'] = v;
    });
    let cachedView = "";
    this.commonService.localStorageService.getItem('default-view', result => {
      cachedView = result;
    });
    $('#default-view').on('change', e => {
      //debugger;
      const v = e.data; // this.value;
      this.commonService.localStorageService.setItem('default-view', v);
      this.commonService.session.style.widgets['default-view'] = v;
      this.commonService.session.layout.content[0].type = v;
    }).val(cachedView ? cachedView : this.commonService.session.style.widgets['default-view']).trigger('change');
    //$('#generate-sequences').on('click', () => {
    //    $('#file-prompt').remove();
    //    $('#launch').prop('disabled', false).focus();
    //    this.processFile(new File([Papa.unparse(this.commonService.generateSeqs('gen-' + this.commonService.session.meta.readyTime + '-', parseFloat($('#generate-number').val().toString()), 20))], 'generatedNodes.csv'));
    //});
    $('#infer-directionality-false').parent().on('click', () => {
      //debugger;
      this.commonService.session.style.widgets['infer-directionality-false'] = true;
    });
    $('#infer-directionality').parent().on('click', () => {
      //debugger;
      this.commonService.session.style.widgets['infer-directionality-false'] = false;
    });
    $('#triangulate-false').parent().on('click', () => {
      //debugger;
      this.commonService.session.style.widgets['triangulate-false'] = true;
    });
    $('#triangulate').parent().on('click', () => {
      //debugger;
      this.commonService.session.style.widgets['triangulate-false'] = false;
    });
    $('#stash-auto-yes').parent().on('click', () => {
      //debugger;
      this.commonService.localStorageService.setItem('stash-auto', 'true');
    });
    if (localStorage.getItem('stash-auto') === 'true') {
      $('#stash-auto-yes').parent().trigger('click');
    }
    $('#stash-auto-no').parent().on('click', () => {
      //debugger;
      if (this.commonService.temp.autostash) clearInterval(this.commonService.temp.autostash.interval);
      this.commonService.localStorageService.setItem('stash-auto', 'false');
    });
    if (this.commonService.session.network.launched) {
      $('#launch').text('Update');
    }
    // $.getJSON("../assets/outbreak.microbetrace", (window as any).context.commonService.applySession);
    // Use this when building production (.ie gh-pages branch)
    if (!this.auspiceUrlVal) {
      this.auspiceUrlVal = this.commonService.getURL();
    }
    if (!this.commonService.session.network.initialLoad && !this.auspiceUrlVal) {
      console.log('launching outbreak');
      $.getJSON("COVID_DummySession.microbetrace", this.commonService.applySession.bind(this.commonService)).then(() => {
        this.populateTable();
      });
      this.commonService.session.network.launched = true;
      this.commonService.session.network.initialLoad = true;
    }
    //   setTimeout(() => {
    //     this.populateTable();
    // }, 2000);
    // console.log('session: ', this.commonService?.session?.files, this.commonService.session.files.length);
  }
  ngOnDestroy() {
    console.log('---files-plugin.component.ts ngOnDestroy');
    this.destroy$.next();
    this.destroy$.complete();
    //unsubscribe on destroy of files tab
    // this.eventEmitterService.subsVar = this.eventEmitterService.    
    // invokeFirstComponentFunction.subscribe((name:string) => {    
    //   this.processFile();    
    // });   
    this.eventEmitterService.invokeFirstComponentFunction.unsubscribe();
    this.store.setNewSession(false);
    this.store.setStyleFileApplied();
    this.store.setFP_removeFiles(false);
    this.commonService.LoadViewEvent.unsubscribe();
  }
  /**
   * For each file in commonService.session.files, addToTable(file)
   */
  populateTable() {
    const fileTableRows = $(".file-table-row");
    fileTableRows.slideUp(() => fileTableRows.remove());
    let files = (0,lodash__WEBPACK_IMPORTED_MODULE_10__.cloneDeep)(this.commonService.session.files);
    console.log('---  Populate TABLE Row Files 2: ', files);
    console.log('--- files table 2 : ', $(".file-table-row"));
    if (files && files.length > 0) {
      console.log('--- Populate for: ', files);
      for (let i = 0; i < files.length; i++) {
        this.addToTable(files[i]);
      }
      console.log('--- GetFile Content Populate TABLE End: ', $(".file-table-row"));
    }
  }
  /**
   * Toggles the value of multiple variables associated with sequence setting audit including:
   * SelectedAuditEmptyVariable, SelectedAuditGapsVariable, SelectedAuditRNAVariable,
   * SelectedAuditAminoAcidsVariable, SelectedAuditCIGARVariable, SelectedAuditMalformedVariable
   */
  toglleAll() {
    this.SelectedAuditEmptyVariable = !this.SelectedAuditEmptyVariable;
    this.SelectedAuditGapsVariable = !this.SelectedAuditGapsVariable;
    this.SelectedAuditRNAVariable = !this.SelectedAuditRNAVariable;
    this.SelectedAuditAminoAcidsVariable = !this.SelectedAuditAminoAcidsVariable;
    this.SelectedAuditCIGARVariable = !this.SelectedAuditCIGARVariable;
    this.SelectedAuditMalformedVariable = !this.SelectedAuditMalformedVariable;
  }
  /**
   * XXXXX
   */
  run() {}
  /**
   * Updates isDataAvaible variable based on if any nodes under commonService.session.data
   *
   * XXXXX not used XXXXX
   */
  InitView() {
    this.IsDataAvailable = this.commonService.session.data.nodes.length === 0 ? false : true;
  }
  /**
   * @returns {string} "state is here"
   */
  handleContainerStateRequestEvent() {
    return "state is here";
  }
  /**
   * Updated default-view widget and localStorageService
   */
  changeDefaultView(e) {
    const v = e.target.selectedOptions[0].innerText;
    this.commonService.localStorageService.setItem('default-view', v);
    this.commonService.session.style.widgets['default-view'] = v;
    this.commonService.session.layout.content[0].type = v;
  }
  /**
   * Opens/Closes the settings window
   */
  openSettings() {
    this.displayFileSettings = !this.displayFileSettings;
  }
  /**
   * Opens/Closes Sequence Controls modal/dialog box
   */
  showSequenceSettings() {
    this.displaySequenceSettings = !this.displaySequenceSettings;
  }
  /**
   * Sets commonService.session.messages and this.messages to empty arrays []. Clears and closes loading-information modal.
   * Emits a LoadDefaultVisualizationEvent.
   * @param e
   */
  loadDefaultVisualization(e) {
    console.log('---loadDefaultVisualization Called - stop loading modal');
    $('#launch').prop('disabled', false).focus();
    this.displayloadingInformationModal = false;
    console.log('---loadDefaultVisualization End - Lodi');
    this.LoadDefaultVisualizationEvent.emit(e);
  }
  /**
   * Adds msg to this.messages and commonService.session.messages.
   * Updates messages on loading-information modal based on commonService.session.message
   * @param {string} msg message to add to messages arrays
   */
  showMessage(msg) {
    this.store.setLoadingMessageUpdated(msg);
  }
  /**
   * Resets the value of session.data, temp.trees if previously launched (or more if not previously launched). Retains the values of following
   * widgets: link-threshold, default-distance-metric, ambiguity-resolution-strategy, and default view.
   * Calls creatLaunchSequences to process the data files loaded.
   */
  launchClick() {
    // Set to false to indicate that the network is not fully loaded  as new network is launching
    this.commonService.session.network.isFullyLoaded = false;
    // launching new network, so set network rendered to false to start loading modal
    this.store.setNetworkRendered(false);
    this.store.setNetworkUpdated(false);
    this.store.setSettingsLoaded(false);
    this.commonService.cleanupData();
    this.commonService.updateLegacyNodeSymbols();
    const thresholdOnLaunch = this.commonService.session.style.widgets["link-threshold"];
    const metricOnLaunch = this.commonService.session.style.widgets["default-distance-metric"];
    const ambiguityOnLaunch = this.commonService.session.style.widgets["ambiguity-resolution-strategy"];
    const viewOnLaunch = this.commonService.session.style.widgets["default-view"];
    console.log('launch click');
    if (this.commonService.session.network.launched) {
      console.log('launch click launched ', this.commonService.session.network.launched);
      this.commonService.resetData();
      $('#launch').text('Update');
      // this.visuals.twoD.isLoading = true;
    } else if (!this.commonService.session.network.launched) {
      console.log('launch click not launched ', this.commonService.session.network.launched);
      this.commonService.resetData();
      this.commonService.session.network.launched = true;
    }
    this.commonService.session.style.widgets["link-threshold"] = thresholdOnLaunch;
    this.commonService.session.style.widgets["default-distance-metric"] = metricOnLaunch;
    this.commonService.session.style.widgets["ambiguity-resolution-strategy"] = ambiguityOnLaunch;
    this.commonService.session.style.widgets["default-view"] = viewOnLaunch;
    this.commonService.session.messages = [];
    this.messages = [];
    console.log('session files', this.commonService.session.files);
    // this.displayloadingInformationModal = true;
    this.showMessage("Starting...");
    setTimeout(() => {
      // Process the data files loaded.
      this.creatLaunchSequences();
    }, 1000);
  }
  /**
   * Processes all files in following order (auspice, newick, matrix, link, node, fasta).
   * Adds/Updates nodes and links. After processing all files, calls processData.
   */
  creatLaunchSequences() {
    this.commonService.session.meta.startTime = Date.now();
    $('#launch').prop('disabled', true);
    // $('#loading-information').html('');
    this.commonService.temp.messageTimeout = setTimeout(() => {
      $('#loadCancelButton').slideDown();
      // abp.notify.warn('If you stare long enough, you can reverse the DNA Molecule\'s spin direction');
    }, 20000);
    const nFiles = this.commonService.session.files.length - 1;
    const check = nFiles > 0;
    // sorts files based on hierarchy
    const hierarchy = ['auspice', 'newick', 'matrix', 'link', 'node', 'fasta'];
    this.commonService.session.files.sort((a, b) => hierarchy.indexOf(a.format) - hierarchy.indexOf(b.format));
    this.commonService.session.meta.anySequences = this.commonService.session.files.some(file => file.format === "fasta" || file.format === "node" && file.field2 !== "None");
    this.commonService.session.files.forEach((file, fileNum) => {
      const start = Date.now();
      const origin = [file.name];
      if (file.format === 'auspice') {
        this.showMessage(`Parsing ${file.name} as Auspice...`);
        // this.commonService.localStorageService.setItem('default-view', 'phylogenetic-tree');
        // this.commonService.localStorageService.setItem('default-distance-metric', 'SNPs');
        this.commonService.applyAuspice(file.contents).then(auspiceData => {
          this.commonService.clearData();
          this.commonService.session = this.commonService.sessionSkeleton();
          console.log(auspiceData["tree"]["children"][0]);
          // This is a bizarre line, but I need to check if the div values are more or less than one. The first one is always zero, so we need to go to the second one
          if (auspiceData["tree"]["children"][0]["data"]["div"] > 0 && auspiceData["tree"]["children"][0]["data"]["div"] < 1) {
            this.commonService.session.style.widgets['default-distance-metric'] = 'tn93';
            this.SelectedDefaultDistanceMetricVariable = 'tn93';
            this.onDistanceMetricChange('tn93');
            this.store.setMetricChanged('tn93');
            this.commonService.GlobalSettingsModel.SelectedDistanceMetricVariable = 'tn93';
            $('#default-distance-metric').val('tn93').trigger('change');
            $('#default-distance-threshold').attr('step', 1).val(0.015).trigger('change');
            this.commonService.session.style.widgets['link-threshold'] = 0.015;
            this.SelectedDefaultDistanceThresholdVariable = '0.015';
            this.onLinkThresholdChange('0.015');
            this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable = 0.015;
          } else {
            this.commonService.session.style.widgets['default-distance-metric'] = 'snps';
            this.store.setMetricChanged('snps');
            this.SelectedDefaultDistanceMetricVariable = 'snps';
            this.onDistanceMetricChange('snps');
            this.commonService.GlobalSettingsModel.SelectedDistanceMetricVariable = 'snps';
            $('#default-distance-metric').val('SNPs').trigger('change');
            $('#default-distance-threshold').attr('step', 1).val(7).trigger('change');
            this.commonService.session.style.widgets['link-threshold'] = 7;
            this.SelectedDefaultDistanceThresholdVariable = '7';
            this.onLinkThresholdChange('7');
            this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable = 7;
          }
          this.commonService.session.meta.startTime = Date.now();
          this.commonService.session.data.tree = auspiceData['tree'];
          this.commonService.session.data.newickString = auspiceData['newick'];
          let nodeCount = 0;
          const nodeRegex = /^NODE_[0-9]{7}$/i;
          auspiceData['nodes'].forEach(node => {
            if (!nodeRegex.test(node.id) && node.id !== 'wrapper') {
              const nodeKeys = Object.keys(node);
              nodeKeys.forEach(key => {
                if (this.commonService.session.data.nodeFields.indexOf(key) === -1) {
                  this.commonService.session.data.nodeFields.push(key);
                }
                if (!Object.prototype.hasOwnProperty.call(node, 'origin')) {
                  node.origin = [];
                }
                nodeCount += this.commonService.addNode(node, true);
              });
            }
          });
          let linkCount = 0;
          auspiceData['links'].forEach(link => {
            linkCount += this.commonService.addLink(link, true);
          });
          this.commonService.runHamsters();
          this.showMessage(` - Parsed ${nodeCount} New Nodes and ${linkCount} new Links from Auspice file.`);
          if (fileNum === nFiles) this.processData();
          return nodeCount;
        });
        this.commonService._debouncedUpdateNetworkVisuals();
        this.commonService.updateStatistics();
        if (this.commonService.debugMode) {
          console.log(this.commonService.session);
        }
      } else if (file.format === 'fasta') {
        this.showMessage(`Parsing ${file.name} as FASTA...`);
        let newNodes = 0;
        this.commonService.parseFASTA(file.contents).then(seqs => {
          const n = seqs.length;
          for (let i = 0; i < n; i++) {
            const node = seqs[i];
            if (!node) continue;
            newNodes += this.commonService.addNode({
              _id: this.commonService.filterXSS(node.id),
              seq: this.commonService.filterXSS(node.seq),
              origin: origin
            }, check);
          }
          console.log('FASTA Merge time:', (Date.now() - start).toLocaleString(), 'ms');
          this.showMessage(` - Parsed ${newNodes} New, ${seqs.length} Total Nodes from FASTA.`);
          if (fileNum === nFiles) this.processData();
        });
      } else if (file.format === 'link') {
        this.showMessage(`Parsing ${file.name} as Link List...`);
        let l = 0;
        const sources = [];
        const targets = [];
        /**
         * Processes and then adds link. updates value of l
         * @param {object} link
         */
        const forEachLink = link => {
          const keys = Object.keys(link);
          const n = keys.length;
          const safeLink = {};
          // for each key in link object
          for (let i = 0; i < n; i++) {
            let key = this.commonService.filterXSS(keys[i]);
            // console.log('key is: ',key);
            if (key === "distance") {
              // console.log('key is distance');
              link[key] = parseFloat(link[key]);
            } else if (key === 'origin') {
              // related to zenhub#810: link list csv was exported from table view and unable to be loaded correctly; this code create a new linkField when it runs into field called origin 
              link['originColumnFromFile'] = link['origin'].split('\n');
              safeLink['originColumnFromFile'] = link['originColumnFromFile'];
              link['origin'] = origin;
              if (!this.commonService.includes(this.commonService.session.data.linkFields, 'originColumnFromFile')) {
                this.commonService.session.data.linkFields.push('originColumnFromFile');
              }
            }
            safeLink[key] = link[key];
            // console.log('safelink key is: ',safeLink[key]);
            // console.log('safelink is: x',safeLink);
            if (!this.commonService.includes(this.commonService.session.data.linkFields, key)) {
              this.commonService.session.data.linkFields.push(key);
            }
          }
          const src = '' + safeLink[file.field1];
          const tgt = '' + safeLink[file.field2];
          sources.push(src);
          targets.push(tgt);
          const srcIndex = targets.findIndex(t => t == src);
          const tgtIndex = sources.findIndex(s => s == tgt);
          // console.log("safe link is: ",safeLink);
          // Link is the same -> bidirectional
          if (srcIndex != -1 && tgtIndex != -1) {
            // Set distance if distance set (field 3)
            l += this.commonService.addLink(Object.assign({
              source: '' + safeLink[file.field1],
              target: '' + safeLink[file.field2],
              origin: origin,
              visible: true,
              directed: file.field3 == 'None' ? true : false,
              bidirectional: file.field3 == 'None' ? true : false,
              distance: file.field3 == 'None' ? 0 : parseFloat(safeLink[file.field3]),
              hasDistance: file.field3 == 'None' ? false : true,
              distanceOrigin: file.field3 == 'None' ? '' : file.name
            }, safeLink), check);
          } else {
            // console.log("distance is: ", file.field3 != 'distance' ? 0 : parseFloat(safeLink[file.field3]))
            // TODO uncomment when testing adding new link
            //  console.log('adding 2: ', _.cloneDeep(Object.assign({
            //         source: '' + safeLink[file.field1],
            //         target: '' + safeLink[file.field2],
            //         origin: origin,
            //         visible: true,
            //         directed : file.field3 != 'distance' ? true : false,
            //         bidirectional: file.field3 != 'distance' ? true : false,
            //         distance: file.field3 != 'distance' ? 0 : parseFloat(safeLink[file.field3]),
            //         hasDistance : file.field3 != 'distance' ? false : true,
            //         distanceOrigin: file.field3 != 'distance' ? '' : file.name
            //       }, safeLink)));
            l += this.commonService.addLink(Object.assign({
              source: '' + safeLink[file.field1],
              target: '' + safeLink[file.field2],
              origin: origin,
              visible: true,
              directed: file.field3 == 'None' ? true : false,
              distance: file.field3 == 'None' ? 0 : parseFloat(safeLink[file.field3]),
              hasDistance: file.field3 == 'None' ? false : true,
              distanceOrigin: file.field3 == 'None' ? '' : file.name
            }, safeLink), check);
          }
          //  console.log('matrixx1: ',  JSON.stringify((window as any).context.commonService.temp.matrix));
        };
        if (file.extension === 'xls' || file.extension === 'xlsx') {
          const workbook = xlsx__WEBPACK_IMPORTED_MODULE_16__.read(file.contents, {
            type: 'array'
          });
          const data = xlsx__WEBPACK_IMPORTED_MODULE_16__.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
          data.map(forEachLink);
          this.showMessage(` - Parsed ${l} New, ${data.length} Total Links from Link Excel Table.`);
          let n = 0,
            t = 0;
          const nodeIDs = [];
          const k = data.length;
          // for each line or excel file, check if node exist, if not add it
          for (let i = 0; i < k; i++) {
            const l = data[i];
            const f1 = l[file.field1];
            if (nodeIDs.indexOf(f1) === -1) {
              t++;
              nodeIDs.push(f1);
              n += this.commonService.addNode({
                _id: '' + f1,
                origin: origin
              }, true);
            }
            const f2 = l[file.field2];
            if (nodeIDs.indexOf(f2) === -1) {
              t++;
              nodeIDs.push(f2);
              n += this.commonService.addNode({
                _id: '' + f2,
                origin: origin
              }, true);
            }
          }
          console.log('Link Excel Parse time:', (Date.now() - start).toLocaleString(), 'ms');
          this.showMessage(` - Parsed ${n} New, ${t} Total Nodes from Link Excel Table.`);
          if (fileNum === nFiles) this.processData();
        } else if (file.extension === 'json') {
          const results = JSON.parse(file.contents);
          if (!results || results.length === 0) return;
          const data = results;
          data.map(forEachLink);
          this.showMessage(` - Parsed ${l} New, ${data.length} Total Links from Link JSON.`);
          if (data.length > 0) Object.keys(data[0]).forEach(key => {
            const safeKey = this.commonService.filterXSS(key);
            if (!this.commonService.includes(this.commonService.session.data.linkFields, safeKey)) {
              this.commonService.session.data.linkFields.push(safeKey);
            }
          });
          let newNodes = 0,
            totalNodes = 0;
          const n = data.length;
          const nodeIDs = [];
          // for each object in json, check if node exist, if not add it
          for (let i = 0; i < n; i++) {
            const l = data[i];
            const f1 = l[file.field1];
            if (nodeIDs.indexOf(f1) === -1) {
              totalNodes++;
              newNodes += this.commonService.addNode({
                _id: '' + f1,
                origin: origin
              }, true);
            }
            const f2 = l[file.field2];
            if (nodeIDs.indexOf(f2) === -1) {
              totalNodes++;
              newNodes += this.commonService.addNode({
                _id: '' + f2,
                origin: origin
              }, true);
            }
          }
          console.log('Link JSON Parse time:', (Date.now() - start).toLocaleString(), 'ms');
          this.showMessage(` - Parsed ${newNodes} New, ${totalNodes} Total Nodes from Link JSON.`);
          if (fileNum === nFiles) this.processData();
        } else {
          papaparse__WEBPACK_IMPORTED_MODULE_4__.parse(file.contents, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            complete: results => {
              const data = results.data;
              data.map(forEachLink);
              this.showMessage(` - Parsed ${l} New, ${data.length} Total Links from Link CSV.`);
              results.meta.fields.forEach(key => {
                const safeKey = this.commonService.filterXSS(key);
                if (!this.commonService.includes(this.commonService.session.data.linkFields, safeKey)) {
                  this.commonService.session.data.linkFields.push(safeKey);
                }
              });
              let newNodes = 0,
                totalNodes = 0;
              const n = data.length;
              const nodeIDs = [];
              for (let i = 0; i < n; i++) {
                const l = data[i];
                const f1 = l[file.field1];
                if (nodeIDs.indexOf(f1) === -1) {
                  totalNodes++;
                  newNodes += this.commonService.addNode({
                    _id: '' + f1,
                    origin: origin
                  }, true);
                }
                const f2 = l[file.field2];
                if (nodeIDs.indexOf(f2) === -1) {
                  totalNodes++;
                  newNodes += this.commonService.addNode({
                    _id: '' + f2,
                    origin: origin
                  }, true);
                }
              }
              console.log('Link CSV Parse time:', (Date.now() - start).toLocaleString(), 'ms');
              this.showMessage(` - Parsed ${newNodes} New, ${totalNodes} Total Nodes from Link CSV.`);
              if (fileNum === nFiles) this.processData();
            }
          });
        }
      } else if (file.format === 'node') {
        this.showMessage(`Parsing ${file.name} as Node List...`);
        if (this.commonService.debugMode) {
          console.log(file.field1);
        }
        let m = 0;
        const n = 0;
        if (file.extension === 'xls' || file.extension === 'xlsx') {
          const workbook = xlsx__WEBPACK_IMPORTED_MODULE_16__.read(file.contents, {
            type: 'array'
          });
          const data = xlsx__WEBPACK_IMPORTED_MODULE_16__.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {
            raw: false,
            dateNF: 'yyyy-mm-dd'
          });
          data.forEach(node => {
            let safeNode = {
              _id: this.commonService.filterXSS('' + node[file.field1]),
              seq: file.field2 === 'None' ? '' : this.commonService.filterXSS(node[file.field2]),
              origin: origin
            };
            Object.keys(node).forEach(key => {
              let safeKey = this.commonService.filterXSS(key);
              if (!this.commonService.includes(this.commonService.session.data.nodeFields, safeKey)) {
                this.commonService.session.data.nodeFields.push(safeKey);
              }
              safeNode[safeKey] = this.commonService.filterXSS(node[key]);
            });
            m += this.commonService.addNode(safeNode, check);
          });
          console.log('Node Excel Parse time:', (Date.now() - start).toLocaleString(), 'ms');
          this.showMessage(` - Parsed ${m} New, ${n} Total Nodes from Node Excel Table.`);
          if (fileNum === nFiles) this.processData();
        } else if (file.extension === 'json') {
          const results = JSON.parse(file.contents);
          if (!results || results.length === 0) return;
          results.forEach(data => {
            const node = data; //data[0]             
            if (node[file.field1] && node[file.field1].toString().trim()) {
              let safeNode = {
                _id: this.commonService.filterXSS('' + node[file.field1]),
                seq: file.field2 === 'None' ? '' : this.commonService.filterXSS(node[file.field2]),
                origin: origin
              };
              Object.keys(node).forEach(key => {
                let safeKey = this.commonService.filterXSS(key);
                if (!this.commonService.includes(this.commonService.session.data.nodeFields, safeKey)) {
                  this.commonService.session.data.nodeFields.push(safeKey);
                }
                safeNode[safeKey] = this.commonService.filterXSS(node[key]);
              });
              m += this.commonService.addNode(safeNode, check);
            }
          });
          console.log('Node JSON Parse time:', (Date.now() - start).toLocaleString(), 'ms');
          this.showMessage(` - Parsed ${m} New, ${n} Total Nodes from Node JSON.`);
          if (fileNum === nFiles) this.processData();
        } else {
          papaparse__WEBPACK_IMPORTED_MODULE_4__.parse(file.contents, {
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            step: data => {
              const node = data.data;
              if (node[file.field1] && node[file.field1].toString().trim()) {
                let safeNode = {
                  _id: this.commonService.filterXSS('' + node[file.field1]),
                  seq: file.field2 === 'None' ? '' : this.commonService.filterXSS(node[file.field2]),
                  origin: origin
                };
                Object.keys(node).forEach(key => {
                  let safeKey = this.commonService.filterXSS(key);
                  if (!this.commonService.includes(this.commonService.session.data.nodeFields, safeKey)) {
                    this.commonService.session.data.nodeFields.push(safeKey);
                  }
                  safeNode[safeKey] = this.commonService.filterXSS(node[key]);
                });
                m += this.commonService.addNode(safeNode, check);
              }
            },
            complete: () => {
              console.log('Node CSV Parse time:', (Date.now() - start).toLocaleString(), 'ms');
              this.showMessage(` - Parsed ${m} New, ${n} Total Nodes from Node CSV.`);
              if (fileNum === nFiles) this.processData();
            }
          });
        }
      } else if (file.format === 'matrix') {
        this.showMessage(`Parsing ${file.name} as Distance Matrix...`);
        if (file.extension === 'xls' || file.extension === 'xlsx') {
          const workbook = xlsx__WEBPACK_IMPORTED_MODULE_16__.read(file.contents, {
            type: 'array'
          });
          const data = xlsx__WEBPACK_IMPORTED_MODULE_16__.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {
            header: 1
          });
          let nodeIDs = [],
            nn = 0,
            nl = 0;
          data.forEach((row, i) => {
            if (i === 0) {
              nodeIDs = row;
              nodeIDs.forEach((cell, k) => {
                if (k > 0) {
                  nn += this.commonService.addNode({
                    _id: this.commonService.filterXSS('' + cell),
                    origin: origin
                  }, check);
                }
              });
            } else {
              const source = this.commonService.filterXSS('' + row[0]);
              row.forEach((cell, j) => {
                if (j === 0) return;
                const target = this.commonService.filterXSS('' + nodeIDs[j]);
                if (source === target) return;
                nl += this.commonService.addLink({
                  source: source,
                  target: target,
                  origin: origin,
                  distance: parseFloat(cell),
                  directed: false,
                  hasDistance: true,
                  distanceOrigin: file.name
                }, check);
              });
            }
          });
          console.log('Distance Matrix Excel Parse time:', (Date.now() - start).toLocaleString(), 'ms');
          this.showMessage(` - Parsed ${nn} New, ${data.length - 1} Total Nodes from Excel Distance Matrix.`);
          this.showMessage(` - Parsed ${nl} New, ${((data.length - 1) ** 2 - (data.length - 1)) / 2} Total Links from Excel Distance Matrix.`);
          if (fileNum === nFiles) this.processData();
        } else {
          // file.format === "matrix" && file.extension === "csv"
          let start = Date.now();
          let nodeIDs, n;
          let links = [];
          let output;
          papaparse__WEBPACK_IMPORTED_MODULE_4__.parse(file.contents, {
            skipEmptyLines: "greedy",
            chunk: result => {
              const rowsInChunk = result.data.length;
              for (let rowInChunk = 0; rowInChunk < rowsInChunk; rowInChunk++) {
                const row = result.data[rowInChunk];
                if (nodeIDs) {
                  const source = "" + row[0];
                  for (let j = 1; j < rowsInChunk + 1; j++) {
                    const target = "" + nodeIDs[j];
                    if (source == target) continue;
                    links.push({
                      source: source,
                      target: target,
                      distance: parseFloat(row[j])
                    });
                  }
                } else {
                  nodeIDs = row;
                  n = nodeIDs.length;
                }
              }
            },
            complete: function () {
              console.log("CSV Matrix Parse time: ", (Date.now() - start).toLocaleString(), "ms");
              start = Date.now();
              output = {
                links: links,
                nodes: nodeIDs.slice(1)
              };
              console.log(output);
              close();
            }
          });
          let nn = 0,
            nl = 0;
          const results = {
            data: output,
            start: start
          };
          const f_nodes = output.nodes;
          const tn = f_nodes.length;
          for (let i = 0; i < tn; i++) {
            console.log(f_nodes[i]);
            if (f_nodes[i]) {
              nn += this.commonService.addNode({
                _id: this.commonService.filterXSS(f_nodes[i]),
                origin: origin
              }, check);
            }
          }
          const f_links = output.links;
          const tl = f_links.length;
          let skip = 0;
          console.log(tl + " links");
          for (let j = 0; j < tl; j++) {
            console.log(this.commonService.session.data.links.length);
            console.log(f_links[j]);
            const reversed = this.commonService.session.data.links.filter(x => x["source"] === f_links[j]["target"] && x["target"] === f_links[j]["source"]);
            const existing = this.commonService.session.data.links.filter(x => x["source"] === f_links[j]["source"] && x["target"] === f_links[j]["target"]);
            if (existing.length > 0 || reversed.length > 0) {
              skip++;
              console.log(`${skip}th skip - ${f_links[j]["source"]} and ${f_links[j]["target"]}`);
              continue;
            }
            if (f_links[j]["source"] == "undefined" || f_links[j]["target"] == "undefined") {
              console.log("skipping undefined source or target");
              continue;
            }
            nl += this.commonService.addLink({
              source: f_links[j]["source"],
              target: f_links[j]["target"],
              distance: f_links[j]["distance"],
              origin: origin,
              hasDistance: true,
              distanceOrigin: origin
            }, check);
          }
          console.log('CSV Matrix Merge time:', (Date.now() - start).toLocaleString(), 'ms');
          this.showMessage(` - Parsed ${nn} New, ${tn} Total Nodes from Distance Matrix.`);
          this.showMessage(` - Parsed ${nl} New, ${tl} Total Links from Distance Matrix.`);
          if (fileNum === nFiles) this.processData();
          //this.commonService.parseCSVMatrix(file).then((o: any) => {
          //});
        }
      } else {
        // if(file.format === 'newick'){
        this.commonService.resetData();
        let links = 0;
        let newLinks = 0;
        let newNodes = 0;
        this.commonService.session.data.newickString = file.contents;
        const tree = patristic__WEBPACK_IMPORTED_MODULE_9__.parseNewick(file.contents);
        let m = tree.toMatrix(),
          matrix = m.matrix,
          labels = m.ids.map(this.commonService.filterXSS),
          n = labels.length;
        for (let i = 0; i < n; i++) {
          const source = labels[i];
          newNodes += this.commonService.addNode({
            _id: source,
            origin: origin
          }, check);
          for (let j = 0; j < i; j++) {
            newLinks += this.commonService.addLink({
              source: source,
              target: labels[j],
              origin: origin,
              distance: parseFloat(matrix[i][j]),
              distanceOrigin: file.name,
              hasDistance: true
            }, check);
            links++;
          }
        }
        console.log('Newick Tree Parse time:', (Date.now() - start).toLocaleString(), 'ms');
        this.showMessage(` - Parsed ${newNodes} New, ${n} Total Nodes from Newick Tree.`);
        this.showMessage(` - Parsed ${newLinks} New, ${links} Total Links from Newick Tree.`);
        if (fileNum === nFiles) this.processData();
      }
    });
  }
  /**
   * Adds links for nodes with no edge?
   * Then calls processSequence
   */
  processData() {
    let nodes = this.commonService.session.data.nodes;
    if (this.commonService.debugMode) {
      console.log(nodes);
    }
    this.commonService.session.data.nodeFilteredValues = nodes;
    //Add links for nodes with no edges
    // TODO: This was here before but not sure why we needed this
    // this.uniqueNodes.forEach(x => {
    //   console.log('link same 4: ', x);
    //   this.commonService.addLink(Object.assign({
    //     source: '' + x,
    //     target: '' + x,
    //     origin: origin,
    //     visible: true,
    //     distance: 0,
    //   }, 'generated'));
    // });
    this.processSequence();
  }
  /**
   * If sequences are present, processes them by aligning if needed, computing consensus, consensus distances, ambiguity counts, and then links
   */
  processSequence() {
    var _this = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      if (!_this.commonService.session.meta.anySequences) return _this.commonService.runHamsters();
      _this.commonService.session.data.nodeFields.push('seq');
      let subset = [];
      console.log('link same nodes22: ', _this.commonService.session.data.nodes.length, _this.commonService.session.data.nodes);
      let nodes = _this.commonService.session.data.nodes;
      const n = nodes.length;
      const gapString = '-'.repeat(_this.commonService.session.data.reference.length);
      for (let i = 0; i < n; i++) {
        const d = nodes[i];
        if (!d.seq) {
          d.seq = gapString;
        } else {
          subset.push(d);
        }
      }
      console.log('link same nodes33: ', subset);
      if (_this.commonService.session.style.widgets['align-sw']) {
        _this.showMessage('Aligning Sequences...');
        let output = yield _this.commonService.session.align({
          reference: _this.commonService.session.data.reference,
          isLocal: $('#localAlign').is(':checked'),
          match: [$('#alignerMatch').val(), $('#alignerMismatch').val()].map(parseFloat),
          gap: [$('#alignerGapO').val(), $('#alignerGapE').val()].map(parseFloat),
          nodes: subset
        });
        const start = Date.now();
        const m = subset.length;
        for (let j = 0; j < m; j++) {
          Object.assign(subset[j], output[j]);
        }
        console.log("Alignment Merge time: ", (Date.now() - start).toLocaleString(), "ms");
      }
      const start = Date.now();
      for (let k = 0; k < n; k++) {
        const node = nodes[k];
        node['_seqInt'] = tn93__WEBPACK_IMPORTED_MODULE_8__.toInts(node['seq']);
      }
      console.log("Integer Sequence Translation time: ", (Date.now() - start).toLocaleString(), "ms");
      _this.commonService.session.data.consensus = yield _this.commonService.computeConsensus();
      yield _this.commonService.computeConsensusDistances();
      subset.sort((a, b) => a['_diff'] - b['_diff']);
      if (_this.commonService.session.style.widgets['ambiguity-resolution-strategy']) {
        yield _this.commonService.computeAmbiguityCounts();
      }
      _this.showMessage('Computing Links based on Genomic Proximity...');
      const k = yield _this.commonService.computeLinks(subset);
      _this.showMessage(` - Found ${k} New Links from Genomic Proximity`);
      _this.commonService.runHamsters();
      _this.showMessage("Finishing...");
      // this.displayloadingInformationModal = false;
      setTimeout(() => {
        _this.cdr.detectChanges();
      }, 1000);
    })();
  }
  /**
   * XXXXX not currently used; if implemented in future switch open parameter to boolean XXXXX
   * @param open 0 or 1
   */
  accordianToggle(open) {
    if (open) {
      $(".m-content").css("overflow-y", "auto");
    } else {
      $(".m-content").css("overflow-y", "hidden");
    }
  }
  /**
   * When a new file/files are add, each one if processed by processFile
   * @param files
   */
  processFiles(files) {
    this.isLoadingFiles = true;
    if (Array.from(files).length > 0) {
      Array.from(files).map(file => {
        this.processFile(file);
      });
    }
    this.isLoadingFiles = false;
  }
  /**
   * Gets file extension and calls appropriate function to load info into MicrobeTrace.
   * For example, for json files commonService.processJSON is used.
   * Adds file to commonService.session.files and adds file to table with this.addToTable
   *
   * XXXXX Currrently unable to load zip files XXXXX
   * @returns
   */
  processFile(rawfile) {
    if (!rawfile) {
      rawfile = this.commonService.session.files[0];
    }
    if (this.commonService.debugMode) {
      console.log('raw file: ', rawfile);
    }
    // Loading informaiton null
    // $('#loading-information').html('');
    const extension = rawfile.name.split('.').pop().toLowerCase();
    console.log('process file end');
    if (extension === 'zip') {
      //debugger;
      // let new_zip = new JSZip();
      // new_zip
      //     .loadAsync(rawfile)
      //     .then(zip => {
      //         zip.forEach((relativePath, zipEntry) => {
      //             zipEntry.async("text").then(c => {
      //                 this.commonService.processJSON(c, zipEntry.name.split('.').pop())
      //             });
      //         });
      //     });
      return;
    }
    if (extension === 'microbetrace' || extension === 'hivtrace') {
      //debugger;
      let reader = new FileReader();
      reader.onloadend = out => {
        this.commonService.processJSON(out.target, extension).then(() => this.populateTable());
      };
      reader.readAsText(rawfile, 'UTF-8');
      return;
    }
    if (extension === 'svg') {
      //debugger;
      let reader = new FileReader();
      reader.onloadend = out => this.commonService.processSVG(out.target);
      reader.readAsText(rawfile, 'UTF-8');
      return;
    }
    if (extension === 'json') {
      const fileName = this.commonService.filterXSS(rawfile.name);
      let reader = new FileReader();
      reader.onloadend = out => {
        const output = JSON.parse(out.target['result']);
        console.log(output);
        if (output.meta && output.tree) {
          const auspiceFile = {
            contents: output,
            name: fileName,
            extension: extension
          };
          this.commonService.session.files.push(auspiceFile);
          this.addToTable(auspiceFile);
          // this.commonService.temp.auspiceOutput = output;
        } else {
          this.commonService.processJSON(out.target, extension);
        }
      };
      reader.readAsText(rawfile, 'UTF-8');
      return;
    }
    fileto__WEBPACK_IMPORTED_MODULE_6__.promise(rawfile, extension === 'xlsx' || extension === 'xls' ? 'ArrayBuffer' : 'Text').then(file => {
      //debugger;
      file.name = this.commonService.filterXSS(file.name);
      file.extension = file.name.split('.').pop().toLowerCase();
      this.commonService.session.files.push(file);
      this.addToTable(file);
    });
  }
  /**
   * Removes all files from commonService.session.files, sets this.nodeIds and this.edgeIds to empty arrays [].
   * Calls nodeEdgeCheck
   */
  removeAllFiles() {
    const fileTableRows = $(".file-table-row");
    fileTableRows.slideUp(() => fileTableRows.remove());
    this.commonService.session.files = [];
    this.nodeIds = [];
    this.edgeIds = [];
    this.nodeEdgeCheck();
  }
  /**
   * Gets information from file about extension, file type, and header and uses that information to addTableTile for file-table
   */
  addToTable(file) {
    if (this.commonService.debugMode) {
      console.log('addToTable: ', file);
    }
    //debugger;
    const extension = file.extension ? file.extension : this.commonService.filterXSS(file.name).split('.').pop().toLowerCase();
    const isFasta = extension.indexOf('fas') > -1;
    const isNewick = extension.indexOf('nwk') > -1 || extension.indexOf('newick') > -1;
    const isXL = extension === 'xlsx' || extension === 'xls';
    const isJSON = extension === 'json';
    const isAuspice = extension === 'json' && file.contents.meta && file.contents.tree;
    const isNode = this.commonService.includes(file.name.toLowerCase(), 'node') || file.format && file.format.toLowerCase() === 'node';
    if (isXL) {
      try {
        const workbook = xlsx__WEBPACK_IMPORTED_MODULE_16__.read(file.contents, {
          type: 'array'
        });
        const data = xlsx__WEBPACK_IMPORTED_MODULE_16__.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
        const headers = [];
        data.forEach(row => {
          Object.keys(row).forEach(key => {
            const safeKey = this.commonService.filterXSS(key);
            if (!this.commonService.includes(headers, safeKey)) headers.push(safeKey);
          });
        });
        addTableTile(headers, this);
      } catch {
        console.log('Unable to read excel file: ', file.name);
        addTableTile([file.field1, file.field2, file.field3], this);
        return;
      }
    } else if (isJSON) {
      let data = [];
      console.log('This is a JSON file');
      if (typeof file.contents === 'string') {
        data = JSON.parse(file.contents);
      } else {
        console.log(file);
        data = [file.contents];
      }
      addTableTile(Object.keys(data[0]).map(this.commonService.filterXSS), this);
      if (!isFasta && !isNewick && isNode) {
        this.loadNodes(file.name, data, true);
      }
      if (!isFasta && !isNewick && !isNode) {
        this.loadEdges(file.name, data, true);
      }
      this.nodeEdgeCheck();
    } else if (isFasta) {
      //let that = this;
      this.commonService.parseFASTA(file.contents).then(output => {
        addTableTile(["id", "seq"], this);
        this.nodeEdgeCheck();
      });
    } else {
      papaparse__WEBPACK_IMPORTED_MODULE_4__.parse(file.contents, {
        header: true,
        skipEmptyLines: true,
        complete: output => {
          addTableTile(output.meta.fields.map(this.commonService.filterXSS), this);
          if (!isFasta && !isNewick && isNode) {
            this.loadNodes(file.name, output, false);
          }
          if (!isFasta && !isNewick && !isNode) {
            this.loadEdges(file.name, output, false);
          }
          this.nodeEdgeCheck();
          if (this.commonService.debugMode) {
            console.log('addToTable parse end: ', file);
          }
        }
      });
      if (this.commonService.debugMode) {
        console.log('addToTabl End: ', file);
      }
    }
    //For the love of all that's good...
    //TODO: Rewrite this as a [Web Component](https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements) or [something](https://reactjs.org/docs/react-component.html) or something.
    /**
     * Adds a file-table-row for the file.
     */
    function addTableTile(headers, context) {
      console.log('addTableTile: ', headers);
      const parentContext = context;
      const root = $('<div class="file-table-row" style="position: relative; z-index: 1;margin-bottom: 24px;"></div>').data('filename', file.name);
      const fnamerow = $('<div class="row w-100"></div>');
      $('<div class="file-name col"></div>').append($('<a href="javascript:void(0);" class="far flaticon-delete-1 align-middle p-1" title="Remove this file"></a>').on('click', () => {
        parentContext.commonService.session.files.splice(parentContext.commonService.session.files.findIndex(f => f.name === file.name), 1);
        parentContext.removeFile(file.name);
        $('#launch').prop('disabled', false).focus();
        $('#launch').text('Update');
        root.slideUp(() => root.remove());
      })).append($(`<a href="javascript:void(0);" class="far flaticon-download-1 align-middle p-1" ${parentContext.isFileContentsEmpty(file) ? 'style="color: gray" title="Unable to resave this file"' : 'title="Resave this file"'} ></a>`).on('click', () => {
        if (parentContext.isFileContentsEmpty(file)) {
          alert('Unable to resave this file.');
        } else {
          file_saver__WEBPACK_IMPORTED_MODULE_5__(new Blob([file.contents], {
            type: file.type || 'text'
          }), file.name);
        }
      })).append('<span class="p-1">' + file.name + '</span>').append(`
                    <div class="btn-group btn-group-toggle btn-group-sm float-right" data-toggle="buttons">
                      <label class="btn btn-light${!isFasta && !isNewick && !isNode && !isAuspice ? ' active' : ''}">
                        <input type="radio" name="options-${file.name}" data-type="link" autocomplete="off"${!isFasta && !isNewick && !isNode ? ' checked' : ''}>Link
                      </label>
                      <label class="btn btn-light${!isFasta && !isNewick && isNode ? ' active' : ''}">
                        <input type="radio" name="options-${file.name}" data-type="node" autocomplete="off"${!isFasta && !isNewick && isNode ? ' checked' : ''}>Node
                      </label>
                      <label class="btn btn-light">
                        <input type="radio" name="options-${file.name}" data-type="matrix" autocomplete="off">Matrix
                      </label>
                      <label class="btn btn-light${isFasta ? ' active' : ''}">
                        <input type="radio" name="options-${file.name}" data-type="fasta" autocomplete="off"${isFasta ? ' checked' : ''}>FASTA
                      </label>
                      <label class="btn btn-light${isNewick ? ' active' : ''}">
                        <input type="radio" name="options-${file.name}" data-type="newick" autocomplete="off"${isNewick ? ' checked' : ''}>Newick
                      </label>
                      <label class="btn btn-light${isAuspice ? ' active' : ''}">
                        <input type="radio" name="options-${file.name}" data-type="auspice" autocomplete="off"${isAuspice ? ' checked' : ''}>Auspice
                      </label>
                    </div>`).appendTo(fnamerow);
      fnamerow.appendTo(root);
      const optionsrow = $('<div class="row w-100"></div>');
      const options = '<option>None</option>' + headers.map(h => `<option value="${h}">${parentContext.commonService.titleize(h)}</option>`).join('\n');
      optionsrow.append(`
                  <div class='col-4 '${isFasta || isNewick ? ' style="display: none;"' : ''} data-file='${file.name}'>
                    <label for="file-${file.name}-field-1">${isNode ? 'ID' : 'Source'}</label>
                    <select id="file-${file.name}-field-1" class="form-control form-control-sm">${options}</select>
                  </div>
                  <div class='col-4 '${isFasta || isNewick ? ' style="display: none;"' : ''} data-file='${file.name}'>
                    <label for="file-${file.name}-field-2">${isNode ? 'Sequence' : 'Target'}</label>
                    <select id="file-${file.name}-field-2" class="form-control form-control-sm">${options}</select>
                  </div>
                  <div class='col-4 '${isFasta || isNewick ? ' style="display: none;"' : ''} data-file='${file.name}'>
                    <label for="file-${file.name}-field-3">Distance</label>
                    <select id="file-${file.name}-field-3" class="form-control form-control-sm">${options}</select>
                  </div>`);
      optionsrow.appendTo(root);
      function matchHeaders(type) {
        const these = $(`[data-file='${file.name}'] select`);
        const a = type === 'node' ? ['ID', 'Id', 'id'] : ['SOURCE', 'Source', 'source'],
          b = type === 'node' ? ['SEQUENCE', 'SEQ', 'Sequence', 'sequence', 'seq'] : ['TARGET', 'Target', 'target'],
          c = ['length', 'Length', 'distance', 'Distance', 'snps', 'SNPs', 'tn93', 'TN93'];
        [a, b, c].forEach((list, i) => {
          $(these.get(i)).val("None");
          list.forEach(title => {
            if (parentContext.commonService.includes(headers, title)) $(these.get(i)).val(title);
          });
          if ($(these.get(i)).val() === 'None' && !(i === 1 && type === 'node') &&
          //If Node Sequence...
          !(i === 2 && type === 'link')) {
            //...or Link distance...
            //...don't match to a variable in the dataset, leave them as "None".
            $(these.get(i)).val(headers[i]);
            //Everything else, just guess the next ordinal column.
          }
        });
      }
      root.appendTo('#file-table');
      matchHeaders($(`[name="options-${file.name}"]:checked`).data('type'));
      function refit(e = null) {
        const type = $(e ? e.target : `[name="options-${file.name}"]:checked`).data('type'),
          these = $(`[data-file='${file.name}']`),
          first = $(these.get(0)),
          second = $(these.get(1)),
          third = $(these.get(2));
        if (type === 'node') {
          first.slideDown().find('label').text('ID');
          second.slideDown().find('label').text('Sequence');
          third.slideUp();
          matchHeaders(type);
        } else if (type === 'link') {
          first.slideDown().find('label').text('Source');
          second.slideDown().find('label').text('Target');
          third.slideDown();
          matchHeaders(type);
        } else {
          these.slideUp();
        }
        parentContext.updateMetadata(file);
        $('#launch').prop('disabled', false).focus();
      }
      ;
      const fileTable = document.getElementById('file-table');
      const selectElements = fileTable.querySelectorAll('select');
      for (let i = 0; i < selectElements.length; i++) {
        selectElements[i].addEventListener('change', event => {
          // Handle change event here
          parentContext.updateMetadata(file);
        });
      }
      console.log('addTableTile end: ', headers);
      $(`[name="options-${file.name}"]`).on("change", refit);
      refit();
    }
  }
  isFileContentsEmpty(file) {
    try {
      // large link list csv (230K rows) throws error, with try-catch, able to load file
      if (file.contents === null || file.contents === undefined) {
        return true;
      } else if (file.contents instanceof ArrayBuffer && file.contents.byteLength > 0) {
        return false;
      } else if (Object.keys(file.contents).length === 0 || file.contents == '') {
        return true;
      } else {
        return false;
      }
    } catch {
      return false;
    }
  }
  /**
   * Updates commonService.session.files info, such as field1, field2 ...etc, based on value user selects
   */
  updateMetadata(file) {
    $('#file-panel .file-table-row').each((i, el) => {
      const $el = $(el);
      const fname = $el.data('filename');
      const selects = $el.find('select');
      const f = this.commonService.session.files.find(file => file.name === fname);
      console.log(f);
      if (f) {
        f.format = $el.find('input[type="radio"]:checked').data('type');
        f.field1 = selects.get(0).value;
        f.field2 = selects.get(1).value;
        f.field3 = selects.get(2).value;
      }
    });
  }
  /**
   * Populates this.nodeIds
   */
  loadNodes(fileName, output, isJson) {
    if (isJson) {
      const data = output;
      const firstField = Object.keys(data[0])[0];
      if (this.nodeIds.find(x => x.fileName === fileName)) {
        const currentNodeId = this.nodeIds.find(x => x.fileName === fileName);
        currentNodeId.ids = output.map(x => x[firstField]);
      } else {
        this.nodeIds.push({
          fileName: fileName,
          ids: output.map(x => '' + x[firstField])
        });
      }
    } else {
      if (this.nodeIds.find(x => x.fileName === fileName)) {
        const currentNodeId = this.nodeIds.find(x => x.fileName === fileName);
        currentNodeId.ids = output.data.map(x => x[output.meta.fields[0]]);
      } else {
        this.nodeIds.push({
          fileName: fileName,
          ids: output.data.map(x => '' + x[output.meta.fields[0]])
        });
      }
    }
  }
  /**
   * Populated this.edgeIds
   */
  loadEdges(fileName, output, isJson) {
    if (isJson) {
      const data = output;
      const fields = Object.keys(data[0]);
      if (this.edgeIds.find(x => x.fileName === fileName)) {
        const currentEdgeId = this.edgeIds.find(x => x.fileName === fileName);
        currentEdgeId.ids = output.map(x => ({
          source: '' + x[fields[0]],
          target: '' + x[fields[1]]
        }));
      } else {
        console.log(`Adding edges ${output}`);
        this.edgeIds.push({
          fileName: fileName,
          ids: output.map(x => ({
            source: '' + x[fields[0]],
            target: '' + x[fields[1]]
          }))
        });
      }
    } else {
      if (this.edgeIds.find(x => x.fileName === fileName)) {
        const currentEdgeId = this.edgeIds.find(x => x.fileName === fileName);
        currentEdgeId.ids = output.data.map(x => ({
          source: '' + x[output.meta.fields[0]],
          target: '' + x[output.meta.fields[1]]
        }));
      } else {
        this.edgeIds.push({
          fileName: fileName,
          ids: output.data.map(x => ({
            source: '' + x[output.meta.fields[0]],
            target: '' + x[output.meta.fields[1]]
          }))
        });
      }
    }
  }
  /**
   * Updates this.uniqueEdgeNodes and this.uniqueNodes
   */
  nodeEdgeCheck() {
    // populated with a string[] of unique node ids
    let allNodesListNodes = [];
    this.nodeIds.forEach(x => {
      x.ids.forEach(y => allNodesListNodes.push(y));
    });
    allNodesListNodes = lodash__WEBPACK_IMPORTED_MODULE_10__.uniq(allNodesListNodes);
    // populated with a string[] of unique node ids that have a link/edge
    let allEdgeListNodes = [];
    this.edgeIds.forEach(x => x.ids.forEach(y => {
      allEdgeListNodes.push(y.source);
      allEdgeListNodes.push(y.target);
    }));
    allEdgeListNodes = lodash__WEBPACK_IMPORTED_MODULE_10__.uniq(allEdgeListNodes);
    this.uniqueEdgeNodes = allEdgeListNodes.filter(x => x && !allNodesListNodes.some(y => y == x));
    this.uniqueNodes = allNodesListNodes.filter(x => x && !this.uniqueEdgeNodes.some(y => y == x));
  }
  /**
   * Removes elements of this.nodeIds and this.edgeIds where the fileName == fileName and then calls nodeEdgeCheck to update uniqueEdgeNodes and uniqueNodes
   * @param fileName
   */
  removeFile(fileName, runNodeEdgeCheck = true) {
    this.nodeIds = this.nodeIds.filter(x => x.fileName != fileName);
    this.edgeIds = this.edgeIds.filter(x => x.fileName != fileName);
    if (runNodeEdgeCheck) this.nodeEdgeCheck();
  }
  /**
   * Async function that reads sequencing data from fasta files or from csv/excel files with sequence data
   *
   * @returns An array of sequencing objects [{id, seq},]
   */
  readFastas() {
    var _this2 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      const fastas = _this2.commonService.session.files.filter(f => _this2.commonService.includes(f.extension, 'fas'));
      const nodeFilesWithSeqs = _this2.commonService.session.files.filter(f => f.format === "node" && f.field2 != "None" && f.field2 != "");
      if (fastas.length === 0 && nodeFilesWithSeqs.length === 0) return [];
      let data = [];
      for (let i = 0; i < fastas.length; i++) {
        let fasta = fastas[i];
        let nodes = yield _this2.commonService.parseFASTA(fasta.contents);
        data = data.concat(nodes);
      }
      for (let j = 0; j < nodeFilesWithSeqs.length; j++) {
        if (nodeFilesWithSeqs[j].extension == "csv") {
          const csv = nodeFilesWithSeqs[j];
          const seqLabel = csv['field2'];
          yield papaparse__WEBPACK_IMPORTED_MODULE_4__.parse(csv.contents, {
            header: true,
            skipEmptyLines: true,
            complete: output => {
              output.data.forEach(node => {
                if (node[seqLabel] != '' || node[seqLabel] != undefined || node[seqLabel] != null) {
                  data = data.concat({
                    'id': node.id,
                    'seq': node[seqLabel]
                  });
                }
              });
            }
          });
          // TODO: Cannot presently preview sequences in Node XLSX tables.
        } else {
          const file = nodeFilesWithSeqs[j];
          const seqLabel = file['field2'];
          const workbook = xlsx__WEBPACK_IMPORTED_MODULE_16__.read(file.contents, {
            type: 'array'
          });
          const dataJSON = xlsx__WEBPACK_IMPORTED_MODULE_16__.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
          const headers = [];
          dataJSON.forEach(row => {
            Object.keys(row).forEach(key => {
              const safeKey = _this2.commonService.filterXSS(key);
              if (!_this2.commonService.includes(headers, safeKey)) headers.push(safeKey);
            });
            if (row[seqLabel] != '' || row[seqLabel] != undefined || row[seqLabel] != null) {
              data = data.concat({
                'id': row['id'],
                'seq': row[seqLabel]
              });
            }
          });
          //addTableTile(headers, this);
        }
      }
      return data;
    })();
  }
  updatePreview(data) {
    var _this3 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      if (!data) {
        data = yield _this3.readFastas();
      }
      $('#alignment-preview').empty().append('<div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div>');
      if ($('#align-sw').is(':checked')) {
        data = yield _this3.commonService.align({
          nodes: data,
          reference: _this3.commonService.session.data.reference,
          match: [parseFloat($('#alignerMatch').val().toString()), -parseFloat($('#alignerMismatch').val().toString())],
          gap: [-parseFloat($('#alignerGapO').val().toString()), -parseFloat($('#alignerGapE').val().toString())]
        });
      }
      (0,_visualizationComponents_AlignmentViewComponent_generateAlignmentViewCanvas__WEBPACK_IMPORTED_MODULE_7__.generateCanvas)(data.map(obj => obj.seq.toUpperCase()), {}).then(function (canvas) {
        $('#alignment-preview').empty().append(canvas);
      });
    })();
  }
  onAmbiguityStrategyChanged() {
    this.commonService.session.style.widgets['ambiguity-resolution-strategy'] = this.SelectedAmbiguityResolutionStrategyVariable;
  }
  onAmbiguityThresholdChanged() {
    this.commonService.session.style.widgets['ambiguity-threshold'] = this.SelectedAmbiguityThresholdVariable;
  }
  generateSequences() {
    $('#file-prompt').remove();
    $('#launch').prop('disabled', false).focus();
    this.processFile(new File([papaparse__WEBPACK_IMPORTED_MODULE_4__.unparse(this.commonService.generateSeqs('gen-' + this.commonService.session.meta.readyTime + '-', this.SelectedGenerateNumberVariable, 20))], 'generatedNodes.csv'));
  }
  applyStyleFileSettings() {
    if (this.SelectedDefaultDistanceMetricVariable != this.commonService.session.style.widgets['default-distance-metric']) {
      this.SelectedDefaultDistanceMetricVariable = this.commonService.session.style.widgets['default-distance-metric'].toLowerCase();
    }
    if (this.SelectedAmbiguityResolutionStrategyVariable != this.commonService.session.style.widgets['ambiguity-resolution-strategy']) {
      this.SelectedAmbiguityResolutionStrategyVariable = this.commonService.session.style.widgets['ambiguity-resolution-strategy'];
    }
    if (this.SelectedAmbiguityThresholdVariable != this.commonService.session.style.widgets['ambiguity-threshold']) {
      this.SelectedAmbiguityThresholdVariable = this.commonService.session.style.widgets['ambiguity-threshold'];
    }
    if (this.SelectedDefaultDistanceThresholdVariable != this.commonService.session.style.widgets['link-threshold']) {
      this.SelectedDefaultDistanceThresholdVariable = this.commonService.session.style.widgets['link-threshold'];
    }
    if (this.SelectedDefaultViewVariable != this.commonService.session.style.widgets['default-view']) {
      this.SelectedDefaultViewVariable = this.commonService.session.style.widgets['default-view'];
    }
  }
  static {
    this.ctorParameters = () => [{
      type: golden_layout__WEBPACK_IMPORTED_MODULE_17__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_14__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_12__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_14__.ElementRef
    }, {
      type: _shared_utils_event_emitter_service__WEBPACK_IMPORTED_MODULE_11__.EventEmitterService
    }, {
      type: _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_14__.ChangeDetectorRef
    }, {
      type: _app_contactTraceCommonServices_common_store_services__WEBPACK_IMPORTED_MODULE_13__.CommonStoreService
    }];
  }
  static {
    this.propDecorators = {
      LoadDefaultVisualizationEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_14__.Output
      }]
    };
  }
};
FilesComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_18__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_14__.Component)({
  selector: 'FilesComponent',
  template: _files_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__,
  changeDetection: _angular_core__WEBPACK_IMPORTED_MODULE_14__.ChangeDetectionStrategy.OnPush,
  styles: [(_files_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_2___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_18__.__metadata)("design:paramtypes", [golden_layout__WEBPACK_IMPORTED_MODULE_17__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_14__.ElementRef, _shared_utils_event_emitter_service__WEBPACK_IMPORTED_MODULE_11__.EventEmitterService, _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService, _angular_core__WEBPACK_IMPORTED_MODULE_14__.ChangeDetectorRef, _app_contactTraceCommonServices_common_store_services__WEBPACK_IMPORTED_MODULE_13__.CommonStoreService])], FilesComponent);

(function (FilesComponent) {
  FilesComponent.componentTypeName = 'Files';
})(FilesComponent || (FilesComponent = {}));

/***/ }),

/***/ 39107:
/*!****************************************************!*\
  !*** ./src/app/golden-layout-component.service.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GoldenLayoutComponentService: () => (/* binding */ GoldenLayoutComponentService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _base_component_directive__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./base-component.directive */ 18784);



let GoldenLayoutComponentService = class GoldenLayoutComponentService {
  constructor(componentFactoryResolver) {
    this.componentFactoryResolver = componentFactoryResolver;
    this._componentTypeMap = new Map();
  }
  /**
   * Adds a new element with a specified key and value to the Map (_componentTypeMap). If an element with the same key already exists, the element will be updated.
   * It doesn't make new view, just registers the view/component with goldenLayout map (_componentTypeMap).
   */
  registerComponentType(name, componentType) {
    this._componentTypeMap.set(name, componentType);
  }
  /**
   * XXXXX Never called in codebase XXXXX
   * @returns an array of registered components
   */
  getRegisteredComponentTypeNames() {
    const count = this._componentTypeMap.size;
    const result = new Array(count);
    let idx = 0;
    for (let [key, value] of this._componentTypeMap) {
      result[idx++] = key;
    }
    return result;
  }
  createComponent(componentTypeJsonValue, container) {
    const componentType = this._componentTypeMap.get(componentTypeJsonValue);
    if (componentType === undefined) {
      throw new Error('Unknown component type');
    } else {
      const provider = {
        provide: _base_component_directive__WEBPACK_IMPORTED_MODULE_0__.BaseComponentDirective.GoldenLayoutContainerInjectionToken,
        useValue: container
      };
      const injector = _angular_core__WEBPACK_IMPORTED_MODULE_1__.Injector.create({
        providers: [provider]
      });
      const componentFactoryRef = this.componentFactoryResolver.resolveComponentFactory(componentType);
      return componentFactoryRef.create(injector);
    }
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_1__.ComponentFactoryResolver
    }];
  }
};
GoldenLayoutComponentService = (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_1__.Injectable)({
  providedIn: 'root'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_1__.ComponentFactoryResolver])], GoldenLayoutComponentService);


/***/ }),

/***/ 64862:
/*!*************************************************!*\
  !*** ./src/app/golden-layout-host.component.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GoldenLayoutHostComponent: () => (/* binding */ GoldenLayoutHostComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_src_app_golden_layout_host_component_ts_css_ngResource_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_ngtools_webpack_src_loaders_inline_resource_js_data_CiAgICA6aG9zdCB7CiAgICAgIGhlaWdodDogMTAwJTsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB9CiAgICA_3D_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_src_app_golden_layout_host_component_ts__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./src/app/golden-layout-host.component.ts.css?ngResource!=!./node_modules/@ngtools/webpack/src/loaders/inline-resource.js?data=CiAgICA6aG9zdCB7CiAgICAgIGhlaWdodDogMTAwJTsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB9CiAgICA%3D!./src/app/golden-layout-host.component.ts */ 34213);
/* harmony import */ var _Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_src_app_golden_layout_host_component_ts_css_ngResource_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_ngtools_webpack_src_loaders_inline_resource_js_data_CiAgICA6aG9zdCB7CiAgICAgIGhlaWdodDogMTAwJTsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB9CiAgICA_3D_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_src_app_golden_layout_host_component_ts__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_src_app_golden_layout_host_component_ts_css_ngResource_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_ngtools_webpack_src_loaders_inline_resource_js_data_CiAgICA6aG9zdCB7CiAgICAgIGhlaWdodDogMTAwJTsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB9CiAgICA_3D_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_src_app_golden_layout_host_component_ts__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! golden-layout */ 81156);
/* harmony import */ var _golden_layout_component_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./golden-layout-component.service */ 39107);
/* harmony import */ var _filesComponent_files_plugin_component__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./filesComponent/files-plugin.component */ 16025);
/* harmony import */ var _visualizationComponents_MapComponent_map_plugin_component__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./visualizationComponents/MapComponent/map-plugin.component */ 15936);
/* harmony import */ var _visualizationComponents_PhylogeneticComponent_phylogenetic_plugin_component__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./visualizationComponents/PhylogeneticComponent/phylogenetic-plugin.component */ 52516);
/* harmony import */ var _visualizationComponents_TimelineComponent_timeline_component_component__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./visualizationComponents/TimelineComponent/timeline-component.component */ 38510);
/* harmony import */ var _visualizationComponents_TableComponent_table_plugin_component__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./visualizationComponents/TableComponent/table-plugin-component */ 6811);
/* harmony import */ var _visualizationComponents_TwoDComponent_twoD_plugin_component__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./visualizationComponents/TwoDComponent/twoD-plugin.component */ 27316);
/* harmony import */ var _visualizationComponents_AlignmentViewComponent_alignment_view_plugin_component__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./visualizationComponents/AlignmentViewComponent/alignment-view-plugin-component */ 20944);
/* harmony import */ var _visualizationComponents_CrosstabComponent_crosstab_plugin_component__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./visualizationComponents/CrosstabComponent/crosstab-plugin.component */ 59972);
/* harmony import */ var _visualizationComponents_AggregateComponent_aggregate_component__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./visualizationComponents/AggregateComponent/aggregate.component */ 97214);
/* harmony import */ var _visualizationComponents_GanttComponent_gantt_plugin_component__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./visualizationComponents/GanttComponent/gantt-plugin.component */ 10688);
/* harmony import */ var _visualizationComponents_HeatmapComponent_heatmap_component__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./visualizationComponents/HeatmapComponent/heatmap.component */ 28775);
/* harmony import */ var _visualizationComponents_BubbleComponent_bubble_component__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./visualizationComponents/BubbleComponent/bubble.component */ 31884);
/* harmony import */ var _visualizationComponents_WaterfallComponent_waterfall_component__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./visualizationComponents/WaterfallComponent/waterfall.component */ 75312);


















let GoldenLayoutHostComponent = class GoldenLayoutHostComponent {
  get goldenLayout() {
    return this._goldenLayout;
  }
  get virtualActive() {
    return this._virtualActive;
  }
  get viewContainerRefActive() {
    return this._viewContainerRefActive;
  }
  get isGoldenLayoutSubWindow() {
    return this._goldenLayout.isSubWindow;
  }
  constructor(_appRef, _elRef, goldenLayoutComponentService) {
    this._appRef = _appRef;
    this._elRef = _elRef;
    this.goldenLayoutComponentService = goldenLayoutComponentService;
    this._virtualActive = true;
    this._viewContainerRefActive = true;
    this._componentRefMap = new Map();
    this._goldenLayoutBoundingClientRect = new DOMRect();
    this._goldenLayoutBindComponentEventListener = (container, itemConfig) => this.handleBindComponentEvent(container, itemConfig);
    this._goldenLayoutUnbindComponentEventListener = container => this.handleUnbindComponentEvent(container);
    this.TabRemovedEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_15__.EventEmitter();
    this.TabChangedEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_15__.EventEmitter();
    this._goldenLayoutElement = this._elRef.nativeElement;
    this.goldenLayoutComponentService.registerComponentType(_filesComponent_files_plugin_component__WEBPACK_IMPORTED_MODULE_2__.FilesComponent.componentTypeName, _filesComponent_files_plugin_component__WEBPACK_IMPORTED_MODULE_2__.FilesComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_TwoDComponent_twoD_plugin_component__WEBPACK_IMPORTED_MODULE_7__.TwoDComponent.componentTypeName, _visualizationComponents_TwoDComponent_twoD_plugin_component__WEBPACK_IMPORTED_MODULE_7__.TwoDComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_TableComponent_table_plugin_component__WEBPACK_IMPORTED_MODULE_6__.TableComponent.componentTypeName, _visualizationComponents_TableComponent_table_plugin_component__WEBPACK_IMPORTED_MODULE_6__.TableComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_MapComponent_map_plugin_component__WEBPACK_IMPORTED_MODULE_3__.MapComponent.componentTypeName, _visualizationComponents_MapComponent_map_plugin_component__WEBPACK_IMPORTED_MODULE_3__.MapComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_PhylogeneticComponent_phylogenetic_plugin_component__WEBPACK_IMPORTED_MODULE_4__.PhylogeneticComponent.componentTypeName, _visualizationComponents_PhylogeneticComponent_phylogenetic_plugin_component__WEBPACK_IMPORTED_MODULE_4__.PhylogeneticComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_TimelineComponent_timeline_component_component__WEBPACK_IMPORTED_MODULE_5__.TimelineComponent.componentTypeName, _visualizationComponents_TimelineComponent_timeline_component_component__WEBPACK_IMPORTED_MODULE_5__.TimelineComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_AlignmentViewComponent_alignment_view_plugin_component__WEBPACK_IMPORTED_MODULE_8__.AlignmentViewComponent.componentTypeName, _visualizationComponents_AlignmentViewComponent_alignment_view_plugin_component__WEBPACK_IMPORTED_MODULE_8__.AlignmentViewComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_CrosstabComponent_crosstab_plugin_component__WEBPACK_IMPORTED_MODULE_9__.CrosstabComponent.componentTypeName, _visualizationComponents_CrosstabComponent_crosstab_plugin_component__WEBPACK_IMPORTED_MODULE_9__.CrosstabComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_AggregateComponent_aggregate_component__WEBPACK_IMPORTED_MODULE_10__.AggregateComponent.componentTypeName, _visualizationComponents_AggregateComponent_aggregate_component__WEBPACK_IMPORTED_MODULE_10__.AggregateComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_GanttComponent_gantt_plugin_component__WEBPACK_IMPORTED_MODULE_11__.GanttComponent.componentTypeName, _visualizationComponents_GanttComponent_gantt_plugin_component__WEBPACK_IMPORTED_MODULE_11__.GanttComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_HeatmapComponent_heatmap_component__WEBPACK_IMPORTED_MODULE_12__.HeatmapComponent.componentTypeName, _visualizationComponents_HeatmapComponent_heatmap_component__WEBPACK_IMPORTED_MODULE_12__.HeatmapComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_BubbleComponent_bubble_component__WEBPACK_IMPORTED_MODULE_13__.BubbleComponent.componentTypeName, _visualizationComponents_BubbleComponent_bubble_component__WEBPACK_IMPORTED_MODULE_13__.BubbleComponent);
    this.goldenLayoutComponentService.registerComponentType(_visualizationComponents_WaterfallComponent_waterfall_component__WEBPACK_IMPORTED_MODULE_14__.WaterfallComponent.componentTypeName, _visualizationComponents_WaterfallComponent_waterfall_component__WEBPACK_IMPORTED_MODULE_14__.WaterfallComponent);
  }
  ngOnDestroy() {
    this._goldenLayout.destroy();
  }
  initialise() {
    this._goldenLayout = new golden_layout__WEBPACK_IMPORTED_MODULE_16__.GoldenLayout(this._goldenLayoutElement, this._goldenLayoutBindComponentEventListener, this._goldenLayoutUnbindComponentEventListener);
    this._goldenLayout.resizeWithContainerAutomatically = true;
    this._goldenLayout.beforeVirtualRectingEvent = count => this.handleBeforeVirtualRectingEvent(count);
    if (this._goldenLayout.isSubWindow) {
      this._goldenLayout.checkAddDefaultPopinButton();
    }
    // Add the activeContentItemChanged event listener
    this._goldenLayout.on('activeContentItemChanged', contentItem => {
      this.handleActiveTabChange(contentItem);
    });
    this.setViewContainerRefActive(true);
  }
  setVirtualActive(value) {
    this._goldenLayout.clear();
    this._virtualActive = value;
    if (!this._virtualActive) {
      this._viewContainerRefActive = false;
    }
  }
  setViewContainerRefActive(value) {
    this._goldenLayout.clear();
    if (value && !this.virtualActive) {
      throw new Error('ViewContainerRef active only possible if VirtualActive');
    }
    this._viewContainerRefActive = value;
  }
  setSize(width, height) {
    this._goldenLayout.setSize(width, height);
  }
  getComponentRef(container) {
    return this._componentRefMap.get(container);
  }
  focusComponent(componentId) {
    const container = Array.from(this._componentRefMap.keys()).find(container => container.componentType?.toString() === componentId);
    if (container) {
      const componentItem = container.parent;
      this._goldenLayout.focusComponent(componentItem);
    }
    return container;
  }
  handleBindComponentEvent(container, itemConfig) {
    const componentType = itemConfig.componentType;
    const componentRef = this.goldenLayoutComponentService.createComponent(componentType, container);
    const component = componentRef.instance;
    this._componentRefMap.set(container, componentRef);
    if (this._virtualActive) {
      container.virtualRectingRequiredEvent = (container, width, height) => this.handleContainerVirtualRectingRequiredEvent(container, width, height);
      container.virtualVisibilityChangeRequiredEvent = (container, visible) => this.handleContainerVisibilityChangeRequiredEvent(container, visible);
      container.virtualZIndexChangeRequiredEvent = (container, logicalZIndex, defaultZIndex) => this.handleContainerVirtualZIndexChangeRequiredEvent(container, logicalZIndex, defaultZIndex);
      if (this._viewContainerRefActive) {
        this._componentViewContainerRef.insert(componentRef.hostView);
      } else {
        this._appRef.attachView(componentRef.hostView);
        const componentRootElement = component.rootHtmlElement;
        this._goldenLayoutElement.appendChild(componentRootElement);
      }
    } else {
      this._appRef.attachView(componentRef.hostView);
      const domElem = componentRef.hostView.rootNodes[0];
      container.element.appendChild(domElem);
    }
    return {
      component,
      virtual: this._virtualActive
    };
  }
  handleUnbindComponentEvent(container) {
    const componentRef = this._componentRefMap.get(container);
    if (componentRef === undefined) {
      throw new Error('Could not unbind component. Container not found');
    }
    this._componentRefMap.delete(container);
    const hostView = componentRef.hostView;
    if (container.virtual) {
      if (this._viewContainerRefActive) {
        const viewRefIndex = this._componentViewContainerRef.indexOf(hostView);
        if (viewRefIndex < 0) {
          throw new Error('Could not unbind component. ViewRef not found');
        }
        this._componentViewContainerRef.remove(viewRefIndex);
      } else {
        const component = componentRef.instance;
        const componentRootElement = component.rootHtmlElement;
        this._goldenLayoutElement.removeChild(componentRootElement);
        this._appRef.detachView(hostView);
      }
    } else {
      const component = componentRef.instance;
      const componentRootElement = component.rootHtmlElement;
      container.element.removeChild(componentRootElement);
      this._appRef.detachView(hostView);
    }
    if (container.componentType !== undefined) {
      this.TabRemovedEvent.emit(container.componentType.toString());
    }
    componentRef.destroy();
  }
  handleBeforeVirtualRectingEvent(count) {
    this._goldenLayoutBoundingClientRect = this._goldenLayoutElement.getBoundingClientRect();
  }
  handleContainerVirtualRectingRequiredEvent(container, width, height) {
    const containerBoundingClientRect = container.element.getBoundingClientRect();
    const left = containerBoundingClientRect.left - this._goldenLayoutBoundingClientRect.left;
    const top = containerBoundingClientRect.top - this._goldenLayoutBoundingClientRect.top;
    const componentRef = this._componentRefMap.get(container);
    if (componentRef === undefined) {
      throw new Error('handleContainerVirtualRectingRequiredEvent: ComponentRef not found');
    }
    const component = componentRef.instance;
    component.setPositionAndSize(left, top, width, height);
  }
  removeComponent(componentId) {
    const container = Array.from(this._componentRefMap.keys()).find(container => container.componentType?.toString() === componentId);
    if (container) {
      const componentItem = container.parent;
      if (componentItem && componentItem.parent) {
        componentItem.parent.removeChild(componentItem);
      }
    } else {
      throw new Error('Component not found for the provided id');
    }
  }
  /**
   * Sets up listeners to monitor active view changes in Golden Layout.
   */
  // private setupActiveViewListener(): void {
  //   // Listen to 'activeContentItemChanged' event
  //   this.layout.on('activeContentItemChanged', (currentItem, previousItem) => {
  //     if (currentItem && currentItem.config && currentItem.config.componentName) {
  //       const activeView = currentItem.config.componentName;
  //       this.viewStateService.setActiveView(activeView);
  //       console.log(`Active view changed to: ${activeView}`);
  //     } else {
  //       this.viewStateService.clearActiveView();
  //       console.log('No active view.');
  //     }
  //   });
  //   // Optionally, set initial active view
  //   const activeItem = this.layout.root.contentItems[0].contentItems[0];
  //   if (activeItem && activeItem.config && activeItem.config.componentName) {
  //     this.viewStateService.setActiveView(activeItem.config.componentName);
  //   }
  // }
  handleContainerVisibilityChangeRequiredEvent(container, visible) {
    const componentRef = this._componentRefMap.get(container);
    if (componentRef === undefined) {
      throw new Error('handleContainerVisibilityChangeRequiredEvent: ComponentRef not found');
    }
    const component = componentRef.instance;
    component.setVisibility(visible);
  }
  handleContainerVirtualZIndexChangeRequiredEvent(container, logicalZIndex, defaultZIndex) {
    const componentRef = this._componentRefMap.get(container);
    if (componentRef === undefined) {
      throw new Error('handleContainerVirtualZIndexChangeRequiredEvent: ComponentRef not found');
    }
    const component = componentRef.instance;
    component.setZIndex(defaultZIndex);
  }
  handleActiveTabChange(contentItem) {
    console.log('handleActiveTabChange: ', contentItem);
    this.TabChangedEvent.emit(contentItem._title);
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_15__.ApplicationRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_15__.ElementRef
    }, {
      type: _golden_layout_component_service__WEBPACK_IMPORTED_MODULE_1__.GoldenLayoutComponentService
    }];
  }
  static {
    this.propDecorators = {
      _componentViewContainerRef: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_15__.ViewChild,
        args: ['componentViewContainer', {
          read: _angular_core__WEBPACK_IMPORTED_MODULE_15__.ViewContainerRef,
          static: true
        }]
      }],
      TabRemovedEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_15__.Output
      }],
      TabChangedEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_15__.Output
      }]
    };
  }
};
GoldenLayoutHostComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_17__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_15__.Component)({
  selector: 'app-golden-layout-host',
  template: '<ng-template #componentViewContainer></ng-template>',
  styles: [(_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_src_app_golden_layout_host_component_ts_css_ngResource_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_ngtools_webpack_src_loaders_inline_resource_js_data_CiAgICA6aG9zdCB7CiAgICAgIGhlaWdodDogMTAwJTsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB9CiAgICA_3D_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_src_app_golden_layout_host_component_ts__WEBPACK_IMPORTED_MODULE_0___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_17__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_15__.ApplicationRef, _angular_core__WEBPACK_IMPORTED_MODULE_15__.ElementRef, _golden_layout_component_service__WEBPACK_IMPORTED_MODULE_1__.GoldenLayoutComponentService])], GoldenLayoutHostComponent);


/***/ }),

/***/ 1481:
/*!*************************************************!*\
  !*** ./src/app/helperClasses/auspiceHandler.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ AuspiceHandler)
/* harmony export */ });
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! patristic */ 50826);
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(patristic__WEBPACK_IMPORTED_MODULE_0__);

class AuspiceHandler {
  constructor(commonService) {
    this.commonService = commonService;
    this.strainSymbol = Symbol('strain');
    this.NODE_VISIBLE = 2; // included on tree and map
    this.invalidStrings = ['unknown', '?', 'nan', 'na', 'n/a', '', 'unassigned'];
    this.nodeList = [];
    this.linkList = [];
    this.recurseChildren = tree => {
      if (!tree.children) {
        const node = this.makeNode(tree);
        this.nodeList.push(node);
        const branch = new patristic__WEBPACK_IMPORTED_MODULE_0__.Branch(node);
        return branch;
      } else {
        const rootNode = this.makeNode(tree);
        this.nodeList.push(rootNode);
        const newTree = new patristic__WEBPACK_IMPORTED_MODULE_0__.Branch(rootNode);
        for (const child of tree.children) {
          const node = this.recurseChildren(child);
          newTree.addChild(node);
        }
        return newTree;
      }
    };
    this.makeNode = tree => {
      const node = {};
      node.id = tree.name;
      node._id = tree.name;
      if (tree.hasOwnProperty('branch_attrs') && tree.branch_attrs.hasOwnProperty('mutations') && tree.branch_attrs.mutations.hasOwnProperty('nuc')) {
        node.mutations = tree.branch_attrs.mutations.nuc;
      }
      for (const attribute of Object.keys(tree.node_attrs)) {
        if (attribute !== 'div') {
          node[attribute] = tree.node_attrs[attribute].value;
        } else {
          node[attribute] = tree.node_attrs[attribute];
        }
      }
      return node;
    };
    this.combineMutations = tree => {
      const leaves = tree.getLeaves();
      for (const leaf of leaves) {
        let mutHolder = [];
        for (const ancestor of leaf.getAncestors(true)) {
          const nodeIndex = this.nodeList.findIndex(x => x.id === ancestor.id);
          const nodeHolder = this.nodeList[nodeIndex];
          if (nodeHolder.hasOwnProperty('mutations')) {
            mutHolder = mutHolder.concat(nodeHolder.mutations);
          }
        }
        leaf.data.mutations = mutHolder;
      }
      return tree;
    };
    this.parseAuspice = auspiceTree => {
      console.log(auspiceTree);
      return this.recurseChildren(auspiceTree.tree);
    };
    this.treeToNewick = (tree, temporal, internalNodeNames = false, nodeAnnotation = node => '') => {
      const getXVal = temporal ? n => this.getTraitFromNode(n, 'num_date') : this.getDivFromNode;
      function recurse(node, parentX) {
        if (node.hasOwnProperty('children')) {
          const childSubtrees = node.children.map(child => {
            const subtree = recurse(child, getXVal(node));
            return subtree;
          });
          return `(${childSubtrees.filter(t => !!t).join(',')})` + `${internalNodeNames ? node.name : ''}${nodeAnnotation(node)}:${getXVal(node) - parentX}`;
        }
        /* terminal node */
        const leaf = `${node.name}${nodeAnnotation(node)}:${getXVal(node) - parentX}`;
        return leaf;
      }
      const rootNode = tree;
      const rootXVal = getXVal(rootNode);
      return recurse(rootNode, rootXVal) + ';';
    };
    this.getTraitFromNode = (node, trait, {
      entropy = false,
      confidence = false
    } = {}) => {
      if (!node.node_attrs) return undefined;
      if (!entropy && !confidence) {
        if (!node.node_attrs[trait]) {
          if (trait === this.strainSymbol) return node.name;
          return undefined;
        }
        const value = node.node_attrs[trait].value;
        if (!this.isValueValid(value)) return undefined;
        return value;
      } else if (entropy) {
        if (node.node_attrs[trait]) return node.node_attrs[trait].entropy;
        return undefined;
      } else if (confidence) {
        if (node.node_attrs[trait]) return node.node_attrs[trait].confidence;
        return undefined;
      }
      return undefined;
    };
    this.getDivFromNode = node => {
      /* see comment at top of this file */
      if (node.node_attrs && node.node_attrs.div !== undefined) {
        return node.node_attrs.div;
      }
      return undefined;
    };
    this.isValueValid = value => {
      if (!['number', 'boolean', 'string'].includes(typeof value)) {
        return false;
      }
      if (typeof value === 'string' && this.invalidStrings.includes(value.toLowerCase())) {
        return false; // checks against list of invalid strings
      }
      // booleans, valid strings & numbers are valid.
      return true;
    };
    this.makeLinksFromMatrix = matrix => {
      const linkList = [];
      for (let i = 0; i < matrix.ids.length - 1; i++) {
        for (let j = i + 1; j < matrix.ids.length; j++) {
          const link = {
            source: matrix.ids[i],
            target: matrix.ids[j],
            distance: matrix.matrix[i][j],
            hasDistance: true,
            distanceOrigin: 'Auspice'
          };
          linkList.push(link);
        }
      }
      this.linkList = linkList;
    };
    this.addLatLong = (nodes, metadata) => {
      const newNodes = [];
      for (const node of nodes) {
        if (metadata.hasOwnProperty('geo_resolutions')) {
          for (let i = 0; i < metadata.geo_resolutions.length; i++) {
            const deme = node[metadata.geo_resolutions[i].key];
            if (deme) {
              node.latitude = metadata.geo_resolutions[i].demes[deme].latitude;
              node.longtude = metadata.geo_resolutions[i].demes[deme].longitude;
            }
          }
        }
        newNodes.push(node);
      }
      return newNodes;
    };
    this.run = jsonObj => {
      const newickString = this.treeToNewick(jsonObj.tree, false, true);
      const fullTree = this.parseAuspice(jsonObj);
      const distanceMatrix = patristic__WEBPACK_IMPORTED_MODULE_0__.parseNewick(newickString).toMatrix();
      const updatedTree = this.combineMutations(fullTree);
      this.makeLinksFromMatrix(distanceMatrix);
      const bareNewickString = this.treeToNewick(jsonObj.tree, false, false);
      this.nodeList = this.addLatLong(this.nodeList, jsonObj.meta);
      return {
        nodes: this.nodeList,
        links: this.linkList,
        tree: updatedTree,
        newick: bareNewickString
      };
    };
    this.commonService = commonService;
  }
}

/***/ }),

/***/ 2311:
/*!************************************************!*\
  !*** ./src/app/helperClasses/colorIterator.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ColorIterator: () => (/* binding */ ColorIterator)
/* harmony export */ });
class ColorIterator {
  constructor() {
    this.colors = ["#000000", "#1CE6FF", "#FF34FF", "#FF4A46", "#008941", "#006FA6", "#A30059", "#FFDBE5", "#7A4900", "#0000A6", "#63FFAC", "#B79762", "#004D43", "#8FB0FF", "#997D87", "#5A0007", "#809693", "#FEFFE6", "#1B4400", "#4FC601", "#3B5DFF", "#4A3B53", "#FF2F80", "#61615A", "#BA0900", "#6B7900", "#00C2A0", "#FFAA92", "#FF90C9", "#B903AA", "#D16100", "#DDEFFF", "#000035", "#7B4F4B", "#A1C299", "#300018", "#0AA6D8", "#013349", "#00846F", "#372101", "#FFB500", "#C2FFED", "#A079BF", "#CC0744", "#C0B9B2", "#C2FF99", "#001E09", "#00489C", "#6F0062", "#0CBD66", "#EEC3FF", "#456D75", "#B77B68", "#7A87A1", "#788D66", "#885578", "#FAD09F", "#FF8A9A", "#D157A0", "#BEC459", "#456648", "#0086ED", "#886F4C", "#34362D", "#B4A8BD", "#00A6AA", "#452C2C", "#636375", "#A3C8C9", "#FF913F", "#938A81", "#575329", "#00FECF", "#B05B6F", "#8CD0FF", "#3B9700", "#04F757", "#C8A1A1", "#1E6E00", "#7900D7", "#A77500", "#6367A9", "#A05837", "#6B002C", "#772600", "#D790FF", "#9B9700", "#549E79", "#FFF69F", "#201625", "#72418F", "#BC23FF", "#99ADC0", "#3A2465", "#922329", "#5B4534", "#FDE8DC", "#404E55", "#0089A3", "#CB7E98", "#A4E804", "#324E72", "#6A3A4C", "#83AB58", "#001C1E", "#D1F7CE", "#004B28", "#C8D0F6", "#A3A489", "#806C66", "#222800", "#BF5650", "#E83000", "#66796D", "#DA007C", "#FF1A59", "#8ADBB4", "#1E0200", "#5B4E51", "#C895C5", "#320033", "#FF6832", "#66E1D3", "#CFCDAC", "#D0AC94", "#7ED379", "#012C58", "#7A7BFF", "#D68E01", "#353339", "#78AFA1", "#FEB2C6", "#75797C", "#837393", "#943A4D", "#B5F4FF", "#D2DCD5", "#9556BD", "#6A714A", "#001325", "#02525F", "#0AA3F7", "#E98176", "#DBD5DD", "#5EBCD1", "#3D4F44", "#7E6405", "#02684E", "#962B75", "#8D8546", "#9695C5", "#E773CE", "#D86A78", "#3E89BE", "#CA834E", "#518A87", "#5B113C", "#55813B", "#E704C4", "#00005F", "#A97399", "#4B8160", "#59738A", "#FF5DA7", "#F7C9BF", "#643127", "#513A01", "#6B94AA", "#51A058", "#A45B02", "#1D1702", "#E20027", "#E7AB63", "#4C6001", "#9C6966", "#64547B", "#97979E", "#006A66", "#391406", "#F4D749", "#0045D2", "#006C31", "#DDB6D0", "#7C6571", "#9FB2A4", "#00D891", "#15A08A", "#BC65E9", "#FFFFFE", "#C6DC99", "#203B3C", "#671190", "#6B3A64", "#F5E1FF", "#FFA0F2", "#CCAA35", "#374527", "#8BB400", "#797868", "#C6005A", "#3B000A", "#C86240", "#29607C", "#402334", "#7D5A44", "#CCB87C", "#B88183", "#AA5199", "#B5D6C3", "#A38469", "#9F94F0", "#A74571", "#B894A6", "#71BB8C", "#00B433", "#789EC9", "#6D80BA", "#953F00", "#5EFF03", "#E4FFFC", "#1BE177", "#BCB1E5", "#76912F", "#003109", "#0060CD", "#D20096", "#895563", "#29201D", "#5B3213", "#A76F42", "#89412E", "#1A3A2A", "#494B5A", "#A88C85", "#F4ABAA", "#A3F3AB", "#00C6C8", "#EA8B66", "#958A9F", "#BDC9D2", "#9FA064", "#BE4700", "#658188", "#83A485", "#453C23", "#47675D", "#3A3F00", "#061203", "#DFFB71", "#868E7E", "#98D058", "#6C8F7D", "#D7BFC2", "#3C3E6E", "#D83D66", "#2F5D9B", "#6C5E46", "#D25B88", "#5B656C", "#00B57F", "#545C46", "#866097", "#365D25", "#252F99", "#00CCFF", "#674E60", "#FC009C", "#92896B"];
    /**
     * Stores the current traversal position. An iterator may have a lot of
     * other fields for storing iteration state, especially when it is supposed
     * to work with a particular kind of collection.
     */
    this.position = 0;
  }
  current() {
    return this.colors[this.position];
  }
  key() {
    return this.position;
  }
  next() {
    const item = this.colors[this.position];
    this.position += 1;
    if (this.position === this.colors.length) this.position = 0;
    return item;
  }
  valid() {
    return this.position < this.colors.length;
  }
  reset() {
    this.position = 0;
  }
}

/***/ }),

/***/ 13564:
/*!***********************************************!*\
  !*** ./src/app/helperClasses/customShapes.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CustomShapes: () => (/* binding */ CustomShapes)
/* harmony export */ });
class CustomShapes {
  constructor() {
    this.diamondAlt = {
      draw: function (context, size) {
        var tan30 = Math.sqrt(1 / 3);
        var tan30_2 = tan30 * 2;
        var x = Math.sqrt(size / tan30_2);
        var y = x * tan30;
        context.moveTo(0, -y);
        context.lineTo(x, 0);
        context.lineTo(0, y);
        context.lineTo(-x, 0);
        context.closePath();
      }
    };
    this.diamondSquare = {
      draw: function (context, size) {
        var w = Math.sqrt(size);
        var d = w / 2 * Math.sqrt(2);
        context.moveTo(0, -d);
        context.lineTo(d, 0);
        context.lineTo(0, d);
        context.lineTo(-d, 0);
        context.closePath();
      }
    };
    this.hexagon = {
      draw: function (context, size) {
        function sideLength(area) {
          var num = 2 * area;
          var denom = 3 * Math.sqrt(3);
          return Math.sqrt(num / denom);
        }
        function rotatePoint(x, y, theta) {
          return [Math.cos(theta) * x + -Math.sin(theta) * y,
          // x
          Math.sin(theta) * x + Math.cos(theta) * y // y
          ];
        }
        var tau = 2 * Math.PI;
        var s = sideLength(size);
        var R = s;
        context.moveTo.apply(context, rotatePoint(R, 0, tau / 12));
        for (var i = 0; i < 6; ++i) {
          var a = tau * i / 6;
          var x = Math.cos(a) * R;
          var y = Math.sin(a) * R;
          context.lineTo.apply(context, rotatePoint(x, y, tau / 12));
        }
        context.closePath();
      }
    };
    this.hexagonAlt = {
      draw: function (context, size) {
        function sideLength(area) {
          var num = 2 * area;
          var denom = 3 * Math.sqrt(3);
          return Math.sqrt(num / denom);
        }
        function rotatePoint(x, y, theta) {
          return [Math.cos(theta) * x + -Math.sin(theta) * y,
          // x
          Math.sin(theta) * x + Math.cos(theta) * y // y
          ];
        }
        var tau = 2 * Math.PI;
        var s = sideLength(size);
        var R = s;
        context.moveTo.apply(context, rotatePoint(R, 0, tau));
        for (var i = 0; i < 6; ++i) {
          var a = tau * i / 6;
          var x = Math.cos(a) * R;
          var y = Math.sin(a) * R;
          context.lineTo.apply(context, rotatePoint(x, y, tau));
        }
        context.closePath();
      }
    };
    this.octogon = {
      draw(context, size) {
        var circumradiusCoeff = 1 / 2 * Math.sqrt(4 + 2 * Math.sqrt(2)); // ~ 1.3065629648763766
        function circumradius(side) {
          return side * circumradiusCoeff;
        }
        function sideLength(area) {
          var num = area * (1 - Math.sqrt(2));
          var denom = 2;
          return Math.sqrt(-1 * num / denom);
        }
        function rotatePoint(x, y, theta) {
          return [Math.cos(theta) * x + -Math.sin(theta) * y,
          // x
          Math.sin(theta) * x + Math.cos(theta) * y // y
          ];
        }
        var tau = 2 * Math.PI;
        var s = sideLength(size);
        var R = circumradius(s);
        context.moveTo.apply(context, rotatePoint(R, 0, 0));
        for (var i = 0; i < 8; ++i) {
          var a = tau * i / 8;
          var x = Math.cos(a) * R;
          var y = Math.sin(a) * R;
          context.lineTo.apply(context, rotatePoint(x, y, 0));
        }
        context.closePath();
      }
    };
    this.octagonAlt = {
      draw(context, size) {
        var circumradiusCoeff = 1 / 2 * Math.sqrt(4 + 2 * Math.sqrt(2)); // ~ 1.3065629648763766
        function circumradius(side) {
          return side * circumradiusCoeff;
        }
        function sideLength(area) {
          var num = area * (1 - Math.sqrt(2));
          var denom = 2;
          return Math.sqrt(-1 * num / denom);
        }
        function rotatePoint(x, y, theta) {
          return [Math.cos(theta) * x + -Math.sin(theta) * y,
          // x
          Math.sin(theta) * x + Math.cos(theta) * y // y
          ];
        }
        var tau = 2 * Math.PI;
        var s = sideLength(size);
        var R = circumradius(s);
        context.moveTo.apply(context, rotatePoint(R, 0, tau / 16));
        for (var i = 0; i < 8; ++i) {
          var a = tau * i / 8;
          var x = Math.cos(a) * R;
          var y = Math.sin(a) * R;
          context.lineTo.apply(context, rotatePoint(x, y, tau / 16));
        }
        context.closePath();
      }
    };
    this.pentagon = {
      draw: function (context, size) {
        var circumradiusCoeff = 1 / 10 * Math.sqrt(50 + 10 * Math.sqrt(5)); // ~ 0.85065080835204
        function circumradius(side) {
          return side * circumradiusCoeff;
        }
        function sideLength(area) {
          var num = 4 * area;
          var denom = Math.sqrt(5 * (5 + 2 * Math.sqrt(5))); // ~ 6.881909602355868
          return Math.sqrt(num / denom);
        }
        function rotatePoint(x, y, theta) {
          return [Math.cos(theta) * x + -Math.sin(theta) * y,
          // x
          Math.sin(theta) * x + Math.cos(theta) * y // y
          ];
        }
        var tau = 2 * Math.PI;
        var s = sideLength(size);
        var R = circumradius(s);
        var theta = -tau / 4; // Rotate 1/4 turn back so the shape is oriented with a point upward.
        context.moveTo.apply(context, rotatePoint(R, 0, theta));
        for (var i = 0; i < 5; ++i) {
          var a = tau * i / 5;
          var x = Math.cos(a) * R;
          var y = Math.sin(a) * R;
          context.lineTo.apply(context, rotatePoint(x, y, theta));
        }
        context.closePath();
      }
    };
    this.triangleDown = {
      draw: function (context, size) {
        var y = -Math.sqrt(size / (Math.sqrt(3) * 3));
        context.moveTo(0, -y * 2);
        context.lineTo(-Math.sqrt(3) * y, y);
        context.lineTo(Math.sqrt(3) * y, y);
        context.closePath();
      }
    };
    this.triangleLeft = {
      draw: function (context, size) {
        var x = -Math.sqrt(size / (Math.sqrt(3) * 3));
        context.moveTo(x * 2, 0);
        context.lineTo(-x, -Math.sqrt(3) * x);
        context.lineTo(-x, Math.sqrt(3) * x);
        context.closePath();
      }
    };
    this.triangleRight = {
      draw: function (context, size) {
        var x = -Math.sqrt(size / (Math.sqrt(3) * 3));
        context.moveTo(-x * 2, 0);
        context.lineTo(x, -Math.sqrt(3) * x);
        context.lineTo(x, Math.sqrt(3) * x);
        context.closePath();
      }
    };
    this.x = {
      draw: function (context, size) {
        function rotatePoint(x, y, theta) {
          return [Math.cos(theta) * x + -Math.sin(theta) * y,
          // x
          Math.sin(theta) * x + Math.cos(theta) * y // y
          ];
        }
        var tau = 2 * Math.PI;
        var r = Math.sqrt(size / 5) / 2;
        var theta = tau / 8;
        // Use the same construction points as `symbolCross` and rotate 1/8 turn.
        var points = [rotatePoint(-3 * r, -r, theta), rotatePoint(-r, -r, theta), rotatePoint(-r, -3 * r, theta), rotatePoint(r, -3 * r, theta), rotatePoint(r, -r, theta), rotatePoint(3 * r, -r, theta), rotatePoint(3 * r, r, theta), rotatePoint(r, r, theta), rotatePoint(r, 3 * r, theta), rotatePoint(-r, 3 * r, theta), rotatePoint(-r, r, theta), rotatePoint(-3 * r, r, theta)];
        context.moveTo.apply(context, points.pop());
        for (var i = 0; i < points.length; i++) {
          context.lineTo.apply(context, points[i]);
        }
        context.closePath();
      }
    };
    this.shapes = {
      "symbolDiamondAlt": this.diamondAlt,
      "symbolDiamondSquare": this.diamondSquare,
      "symbolHexagon": this.hexagon,
      "symbolHexagonAlt": this.hexagonAlt,
      "symbolOctagon": this.octogon,
      "symbolOctagonAlt": this.octagonAlt,
      "symbolPentagon": this.pentagon,
      "symbolTriangleLeft": this.triangleLeft,
      "symbolTriangleRight": this.triangleRight,
      "symbolTriangleDown": this.triangleDown,
      "symbolX": this.x
    };
  }
}

/***/ }),

/***/ 63412:
/*!*************************************************!*\
  !*** ./src/app/helperClasses/dialogSettings.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   DialogSettings: () => (/* binding */ DialogSettings)
/* harmony export */ });
class DialogSettings {
  constructor(dialogControlId, isVisible) {
    this.isVisible = false;
    this.top = 200;
    this.left = 450;
    // Link Color
    this.linkTop = 200;
    this.linkLeft = "bottom-left";
    // Map settings
    this.mapRight = "bottom-right";
    // Node Color
    this.nodeTop = 400;
    this.nodeLeft = "left";
    // Node Shape
    this.shapeTop = 700;
    this.shapeRight = "bottom-right";
    // Polygon Color
    this.polygonRight = "right";
    this.polygonTop = 200;
    this.polygonLeft = 950;
    this.dialogControlId = dialogControlId;
    this.isVisible = isVisible;
  }
  getDialogControl() {
    return document.querySelector(this.dialogControlId);
  }
  getDomRect() {
    const dialogControl = this.getDialogControl();
    return dialogControl.children[0].getBoundingClientRect();
  }
  onShow() {
    this.isVisible = true;
  }
  onHide() {
    this.isVisible = false;
  }
  setStateBeforeExport() {
    this.stateBeforeExport = {
      isVisible: this.isVisible,
      top: undefined,
      left: undefined
    };
    if (this.isVisible) {
      // sometimes getDomRect throws an error, need to revisit when we decide to revisit saving the locations of tables on show/hide
      try {
        const domRect = this.getDomRect();
        this.stateBeforeExport.top = domRect.top;
        this.stateBeforeExport.left = domRect.left;
      } catch {
        this.stateBeforeExport.top = 100;
        this.stateBeforeExport.left = 100;
      }
    }
    this.isVisible = false;
  }
  restoreStateAfterExport() {
    this.isVisible = this.stateBeforeExport.isVisible;
    this.top = this.stateBeforeExport.top;
    this.left = this.stateBeforeExport.left;
  }
  setVisibility(isVisible) {
    if (isVisible && this.top === 0 && this.left === 0) {
      this.top = window.innerHeight / 2 - 300;
      this.left = window.innerWidth / 2;
    } else if (isVisible && this.stateBeforeExport) {
      this.restoreStateAfterExport();
    } else if (!isVisible) {
      this.setStateBeforeExport();
    }
    this.isVisible = isVisible;
    // this section causes the network settings dialog box (at least on 2D network) to minimize so that only top headings to be displayed. Removed (12/5/23) because it causes unwanted behavior
    /*
    if(isVisible){
        const dialog = document.querySelector('#network-settings-pane');
        const tabset = dialog.querySelector('.tab-container');
             if(tabset){
            const tabs: Array<Element> = Array.from(tabset.querySelectorAll('.m-tabs__item'));
            
            for(let tab of tabs){
                tab.classList.remove('active');
            }
            
        }
    }
    */
  }
}

/***/ }),

/***/ 58406:
/*!***********************************************!*\
  !*** ./src/app/helperClasses/inlineWorker.ts ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   InlineWorker: () => (/* binding */ InlineWorker)
/* harmony export */ });
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! rxjs */ 10819);

class InlineWorker {
  constructor(func) {
    this.onMessage = new rxjs__WEBPACK_IMPORTED_MODULE_0__.Subject();
    this.onError = new rxjs__WEBPACK_IMPORTED_MODULE_0__.Subject();
    const WORKER_ENABLED = !!Worker;
    if (WORKER_ENABLED) {
      let urls = ["https://raw.githubusercontent.com/CDCgov/patristic/master/dist/patristic.js", "https://raw.githubusercontent.com/CDCgov/tn93.js/master/dist/tn93.js", "https://raw.githubusercontent.com/CDCgov/bioseq-js/master/dist/bioseq.js"];
      let functionBody = "";
      for (let i = 0; i < urls.length; i++) {
        let request = new XMLHttpRequest();
        request.open("GET", urls[i], false);
        request.send(null);
        let returnValue = request.responseText;
        if (i === 0) {
          let start = returnValue.indexOf("const version = \"0.5.7\";");
          let finish = returnValue.indexOf("exports.Branch = Branch;");
          functionBody += returnValue.substring(start, finish);
        } else if (i === 1) {
          let start = returnValue.indexOf("\n");
          let finish = returnValue.indexOf("if(typeof exports !== 'undefined'){");
          functionBody += returnValue.substring(start + 1, finish);
        } else if (i === 2) {
          let start = returnValue.indexOf("var bioseq");
          let finish = returnValue.indexOf("return bioseq");
          functionBody += returnValue.substring(start, finish);
        } else {
          functionBody += returnValue;
        }
        // functionBody += returnValue;
        functionBody += "\n";
      }
      functionBody += func.toString().replace(/^[^{]*{\s*/, '').replace(/\s*}[^}]*$/, '');
      this.worker = new Worker(URL.createObjectURL(new Blob([functionBody], {
        type: 'text/javascript'
      })));
      this.worker.onmessage = data => {
        this.onMessage.next(data);
      };
      this.worker.onerror = data => {
        this.onError.next(data);
      };
    } else {
      throw new Error('WebWorker is not enabled');
    }
  }
  postMessage(data) {
    this.worker.postMessage(data);
  }
  onmessage() {
    return this.onMessage.asObservable();
  }
  onerror() {
    return this.onError.asObservable();
  }
  terminate() {
    if (this.worker) {
      this.worker.terminate();
    }
  }
}

/***/ }),

/***/ 53193:
/*!******************************************************!*\
  !*** ./src/app/microbe-trace-next-plugin-visuals.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MicrobeTraceNextVisuals: () => (/* binding */ MicrobeTraceNextVisuals)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/core */ 37580);


let MicrobeTraceNextVisuals = class MicrobeTraceNextVisuals {};
MicrobeTraceNextVisuals = (0,tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_1__.Injectable)({
  providedIn: 'root'
})], MicrobeTraceNextVisuals);


/***/ }),

/***/ 24384:
/*!********************************************************!*\
  !*** ./src/app/microbe-trace-next-plugin.component.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MicrobeTraceNextHomeComponent: () => (/* binding */ MicrobeTraceNextHomeComponent)
/* harmony export */ });
/* harmony import */ var _Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 89204);
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _microbe_trace_next_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./microbe-trace-next-plugin.component.html?ngResource */ 99768);
/* harmony import */ var _microbe_trace_next_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./microbe-trace-next-plugin.component.less?ngResource */ 57087);
/* harmony import */ var _microbe_trace_next_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_microbe_trace_next_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! d3 */ 86164);
/* harmony import */ var _shared_common_app_component_base__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @shared/common/app-component-base */ 2449);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var _shared_common_session_app_session_service__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @shared/common/session/app-session.service */ 50686);
/* harmony import */ var _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./helperClasses/dialogSettings */ 63412);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! rxjs */ 10819);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! rxjs */ 52575);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! rxjs */ 91817);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! rxjs */ 33900);
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! moment */ 39545);
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var tabulator_tables__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! tabulator-tables */ 12754);
/* harmony import */ var _golden_layout_host_component__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./golden-layout-host.component */ 64862);
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! papaparse */ 92853);
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(papaparse__WEBPACK_IMPORTED_MODULE_11__);
/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! jszip */ 45834);
/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(jszip__WEBPACK_IMPORTED_MODULE_12__);
/* harmony import */ var html2canvas__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! html2canvas */ 60822);
/* harmony import */ var html2canvas__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(html2canvas__WEBPACK_IMPORTED_MODULE_13__);
/* harmony import */ var _contactTraceCommonServices_common_store_services__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./contactTraceCommonServices/common-store.services */ 16546);
/* harmony import */ var _contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./contactTraceCommonServices/export.service */ 70616);
/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! xlsx */ 13857);






















let MicrobeTraceNextHomeComponent = class MicrobeTraceNextHomeComponent extends _shared_common_app_component_base__WEBPACK_IMPORTED_MODULE_5__.AppComponentBase {
  constructor(injector, commonService, domSanitizer, cdref, el, store, exportService) {
    super(injector);
    this.commonService = commonService;
    this.domSanitizer = domSanitizer;
    this.cdref = cdref;
    this.el = el;
    this.store = store;
    this.exportService = exportService;
    this.metric = "tn93";
    this.ambiguity = "Average";
    this.launchView = "2D Network";
    this.threshold = "0.015";
    this.showSettings = false;
    this.showExport = false;
    this.showCenter = false;
    this.showPinAllNodes = false;
    this.showRefresh = false;
    this.showButtonGroup = false;
    this.showSorting = false;
    this.display_eula_modal = false;
    this.showExportDashboardMenu = false;
    this.ExportDashboardFilename = '';
    this.ExportDashboardScale = 1;
    this.ExportDashboardResolution = {
      width: 0,
      height: 0,
      summary: ''
    };
    this.thresholdDebouncer = new rxjs__WEBPACK_IMPORTED_MODULE_16__.Subject();
    this.showExportTablesMenu = false;
    this.ExportTablesFilename = '';
    this.ExportTablesFileType = 'png';
    this.ExportTablesScale = 1;
    this.exportTables = {
      'node-color': false,
      'link-color': false,
      'node-symbol': false,
      'polygon-color': false
    };
    this.displayHelp = false;
    this.displayAbout = false;
    this.displayStashDialog = false;
    this.displayUrlDialog = false;
    this.displayMTDialog = false;
    this.displayRecallStashDialog = false;
    this.displayLedgerLoaderDialog = false;
    this.displayloadingInformationModal = false;
    // messages to display in loading modal
    this.messages = [];
    this.version = '2.0';
    this.auspiceUrlVal = '';
    this.saveFileName = '';
    this.saveByCluster = false;
    this.saveFileTypeOptions = [{
      label: 'session',
      value: 'session'
    }, {
      label: 'style',
      value: 'style'
    }];
    this.selectedSaveFileType = 'session';
    this.searchField = '';
    this.searchText = '';
    this.destroy$ = new rxjs__WEBPACK_IMPORTED_MODULE_16__.Subject();
    //BlockChainLedgerNodeList: any[] = [];
    //BlockChainLedgerEdgeList: any[] = [];
    this.FieldList = [];
    this.ToolTipFieldList = [];
    this.PruneWityTypes = [{
      label: 'None',
      value: 'None'
    }, {
      label: 'Nearest Neighbor',
      value: 'Nearest Neighbor'
    }];
    this.SelectedPruneWityTypesVariable = 'None';
    this.SelectedClusterMinimumSizeVariable = 0;
    this.SelectedLinkSortVariable = 'Distance';
    this.SelectedLinkThresholdVariable = parseFloat(this.threshold);
    this.SelectedDistanceMetricVariable = this.metric;
    this.RevealTypes = [{
      label: 'Everything',
      value: 'Everything'
    }];
    this.SelectedRevealTypesVariable = 'Everything';
    this.StatisticsTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedStatisticsTypesVariable = 'Show';
    this.SelectedColorNodesByVariable = 'None';
    this.SelectedNodeColorVariable = '#1f77b4';
    this.SelectedLinkColorVariable = '#1f77b4';
    this.SelectedColorLinksByVariable = 'origin';
    this.SelectedTimelineVariable = 'None';
    this.timelineSpeed = 200;
    this.LinkColorTableTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedLinkColorTableTypesVariable = 'Hide';
    this.NodeColorTableTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedNodeColorTableTypesVariable = 'Hide';
    this.SelectedColorVariable = '#ff8300';
    this.SelectedBackgroundColorVariable = '#ffffff';
    this.SelectedApplyStyleVariable = '';
    this.activeTabNdx = null;
    this.ShowGlobalSettingsLinkColorTable = false;
    this.ShowGlobalSettingsNodeColorTable = false;
    this.roles = new Array();
    this.ShowGlobalSettingsSettingsPane = false;
    this.cachedGlobalSettingsVisibility = false;
    this.cachedGlobalSettingsLinkColorVisibility = false;
    this.cachedGlobalSettingsNodeColorVisibility = false;
    this.playBtnText = "Play";
    this.previousTab = '';
    this.bpaaSPayloadWrappers = [];
    this.networkRendered = false;
    this.DisplayGlobalSettingsDialogEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_17__.EventEmitter();
    this.HideThisForNow = false;
    this.files = [];
    this.homepageTabs = [];
    this._lastLinkThreshold = this.commonService.session.style.widgets["link-threshold"];
    this._lastClusterMinimum = this.commonService.session.style.widgets["cluster-minimum-size"];
    this._lastLinkSortValue = this.commonService.session.style.widgets["link-sort-variable"];
    /**
     * Updates default-distance-metric widget and this.SelectedLinkThresholdVariable (7 for snps, 0.015 for TN93).
     * Calls onLinkThresholdChanged to updated links
     */
    this.onDistanceMetricChanged = () => {
      if (!this.SelectedDistanceMetricVariable) this.SelectedDistanceMetricVariable = this.commonService.session.style.widgets['default-distance-metric'];
      this.store.updatecurrentThresholdStepSize(this.SelectedDistanceMetricVariable);
      if (this.SelectedDistanceMetricVariable.toLowerCase() === 'snps') {
        $('#default-distance-threshold').attr('step', 1).val(7).trigger('change');
        this.commonService.session.style.widgets['default-distance-metric'] = 'snps';
        this.SelectedLinkThresholdVariable = '7';
        this.onLinkThresholdChanged();
      } else {
        $('#default-distance-threshold').attr('step', 0.001).val(0.015).trigger('change');
        this.commonService.session.style.widgets['default-distance-metric'] = 'tn93';
        this.SelectedLinkThresholdVariable = '0.015';
        this.onLinkThresholdChanged();
      }
    };
    this.widgets = this.commonService.session.style.widgets;
    this.appSession = injector.get(_shared_common_session_app_session_service__WEBPACK_IMPORTED_MODULE_6__.AppSessionService);
    this.activeTabIndex = 0;
    this.dataSetView = [];
    this.dataSetView.push({
      label: 'Nodes',
      value: 'Node'
    });
    this.dataSetView.push({
      label: 'Links',
      value: 'Link'
    });
    this.dataSetView.push({
      label: 'Clusters',
      value: 'Cluster'
    });
    this.dataSetViewSelected = "Node";
    this.currentUrl = window.location.href;
  }
  getElementById(id) {
    const element = this.el.nativeElement.querySelector(`#${id}`);
    return element;
  }
  ngOnInit() {
    // Check if user has accepted the license:
    this.check_eula_acceptance();
    this.auspiceUrlVal = this.commonService.getURL();
    if (this.commonService.debugMode) {
      console.log(this.auspiceUrlVal);
    }
    this.getGlobalSettingsData();
    // Subscribe to export requests
    this.exportService.exportRequested$.subscribe(info => {
      this.performExport(info.element, info.exportNodeTable, info.exportLinkTable);
    });
    this.exportService.exportSVG$.subscribe(info => {
      this.performExportSVG(info.element, info.mainSVGString, info.exportNodeTable, info.exportLinkTable);
    });
    // Add debounce subscription
    this.thresholdDebouncer.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_18__.debounceTime)(1000),
    // Wait 300ms after last change
    (0,rxjs__WEBPACK_IMPORTED_MODULE_19__.distinctUntilChanged)()).subscribe(threshold => {
      this.executeThresholdChange(threshold);
    });
    this.store.networkUpdated$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_20__.takeUntil)(this.destroy$)) // Add takeUntil for proper cleanup
    .subscribe(isUpdated => {
      console.log('--- networkUpdated$ subscription triggered:', isUpdated);
      if (isUpdated) {
        // Case 1: Initial UI settings load after first network update
        if (!this.store.settingsLoadedValue) {
          console.log('--- Loading UI settings as settingsLoadedValue is false ---');
          this.loadUISettings();
          // After loading UI settings, check if table needs immediate regeneration
          if (this.GlobalSettingsLinkColorDialogSettings.isVisible && this.SelectedColorLinksByVariable !== 'None') {
            console.log('--- Regenerating Link Color Table after initial UI load ---');
            this.generateNodeLinkTable('#link-color-table');
          }
        }
        // Case 2: Subsequent network updates (e.g., from threshold change)
        // Regenerate table only if UI settings are already loaded AND table should be visible/relevant
        else if (this.store.settingsLoadedValue && this.GlobalSettingsLinkColorDialogSettings.isVisible && this.SelectedColorLinksByVariable !== 'None') {
          console.log('--- Regenerating Link Color Table due to network update (settings already loaded) ---');
          this.generateNodeLinkTable('#link-color-table');
        }
      }
    });
    // Subscribe to network rendered
    this.networkRenderedSubscription = this.store.networkRendered$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_20__.takeUntil)(this.destroy$)).subscribe(rendered => {
      console.log('DEBUG: networkRenderedSubscription fired. rendered =', rendered);
      console.log('DEBUG: session.network.isFullyLoaded?', this.commonService.session.network.isFullyLoaded);
      if (rendered) {
        this.displayloadingInformationModal = false;
        this.messages = [];
        console.log('DEBUG: Calling onLinkColorTableChanged from networkRenderedSubscription...');
        console.log('DEBUG: #link-color-table rowcount BEFORE = ', $('#link-color-table').find('tr').length);
        // Optionally call or not call your method:
        // this.onLinkColorTableChanged();
        this.networkRendered = true;
        // Also see if forcing a detect changes right here changes the outcome:
        console.log('DEBUG: inrender sub => about to detect changes manually...');
        this.cdref.detectChanges();
        console.log('DEBUG: #link-color-table rowcount AFTER  = ', $('#link-color-table').find('tr').length);
      } else if (!rendered && this.commonService.demoNetworkRendered && this.commonService.session.network.isFullyLoaded) {
        this.displayloadingInformationModal = true;
        this.showMessage('Rendering Network...');
        this.networkRendered = false;
      }
    });
    // Subscribe to network rendered
    this.loadingMessageUpdatedSubscription = this.store.loadingMessageUpdated$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_20__.takeUntil)(this.destroy$)).subscribe(message => {
      console.log('--- message updated: ', message);
      if (message) {
        this.displayloadingInformationModal = true;
        this.showMessage(message);
      }
    });
    // Subscribe to threshold changes from the service
    this.thresholdSubscription = this.store.linkThreshold$.subscribe(newThreshold => {
      // Only update local state if changed
      if (this.SelectedLinkThresholdVariable !== newThreshold) {
        this.onLinkThresholdChanged(newThreshold);
      }
    });
    this.elem = document.documentElement;
    if (!this.GlobalSettingsDialogSettings) {
      this.GlobalSettingsDialogSettings = new _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_7__.DialogSettings('#global-settings-modal', false);
    }
    if (!this.GlobalSettingsLinkColorDialogSettings) {
      this.GlobalSettingsLinkColorDialogSettings = new _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_7__.DialogSettings('#global-settings-link-color-table', false);
    }
    if (!this.GlobalSettingsNodeColorDialogSettings) {
      this.GlobalSettingsNodeColorDialogSettings = new _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_7__.DialogSettings('#global-settings-node-color-table', false);
    }
    // Subscribe to metric changes
    this.store.metricChanged$.subscribe(metric => {
      this.metric = metric;
      this.SelectedDistanceMetricVariable = metric;
      this.onDistanceMetricChanged();
    });
    // Subscribe to table cleared event
    this.store.tableCleared$.subscribe(tableId => {
      this.clearTable(tableId); // Existing method to handle updates
    });
    // Subscribe to statistics changed event
    this.store.statisticsChanged$.subscribe(statisticsType => {
      this.SelectedStatisticsTypesVariable = statisticsType;
      this.onShowStatisticsChanged();
    });
    this.SelectedPruneWityTypesVariable = this.commonService.GlobalSettingsModel.SelectedPruneWityTypesVariable;
    //debugger;
    this.SelectedClusterMinimumSizeVariable = this.commonService.GlobalSettingsModel.SelectedClusterMinimumSizeVariable;
    this.SelectedLinkSortVariable = this.commonService.GlobalSettingsModel.SelectedLinkSortVariable;
    this.SelectedLinkThresholdVariable = this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable;
    this.threshold = this.SelectedLinkThresholdVariable;
    this.commonService.session.style.widgets['link-threshold'] = this.SelectedLinkThresholdVariable;
    this.SelectedRevealTypesVariable = this.commonService.GlobalSettingsModel.SelectedRevealTypesVariable;
    this.SelectedStatisticsTypesVariable = this.commonService.GlobalSettingsModel.SelectedStatisticsTypesVariable;
    this.SelectedColorNodesByVariable = this.commonService.GlobalSettingsModel.SelectedColorNodesByVariable;
    this.SelectedNodeColorVariable = this.commonService.session.style.widgets['node-color'];
    this.SelectedColorLinksByVariable = this.commonService.GlobalSettingsModel.SelectedColorLinksByVariable;
    this.SelectedTimelineVariable = this.commonService.session.style.widgets['node-timeline-variable'];
    this.SelectedColorVariable = this.commonService.session.style.widgets['selected-color'];
    this.SelectedLinkColorTableTypesVariable = this.commonService.GlobalSettingsModel.SelectedLinkColorTableTypesVariable;
    this.SelectedApplyStyleVariable = this.commonService.GlobalSettingsModel.SelectedApplyStyleVariable;
    //this.commonService.updateThresholdHistogram();
    if (this.commonService.debugMode) {
      console.log("global settings: ", this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable);
      console.log("SelectedLinkThresholdVariable: ", this.SelectedLinkThresholdVariable);
    }
    // Update distance metric in cashe
    let cachedLSV = "";
    let cachedView = "";
    this.commonService.localStorageService.getItem('default-distance-metric', (err, result) => {
      // Run this code once the value has been
      // loaded from the offline store.
      cachedLSV = result;
    });
    // Subscribe to threshold changes
    this.commonService.localStorageService.getItem('default-view', (err, result) => {
      cachedView = result;
    });
    const that = this;
    // $( document ).on( "link-visibility", function( ) {
    //     that.generateNodeLinkTable("#link-color-table");
    // });
    // $( document ).on('node-visibility', function () {
    //     that.generateNodeColorTable('#node-color-table'); 
    // })
    setTimeout(() => {
      $('#top-toolbar').fadeTo("slow", 1);
      // TODO:: uncommentback when done Subscribe for files subscription
      // this.homepageTabs[0].componentRef = this.goldenLayout.componentInstances[0];
    }, 1000);
    setTimeout(() => {
      if (cachedLSV) {
        if (cachedLSV === 'snps') {
          this.metric = 'snps';
          this.threshold = '7';
          $('#ambiguities-menu').hide();
        } else {
          this.metric = 'tn93';
          this.threshold = '0.015';
        }
        this.SelectedLinkThresholdVariable = parseFloat(this.threshold);
        this.SelectedDistanceMetricVariable = this.metric;
        this.commonService.session.style.widgets['default-distance-metric'] = this.metric;
        this.commonService.session.style.widgets['link-threshold'] = parseFloat(this.threshold);
        console.log('--- distance metric: ', this.SelectedDistanceMetricVariable);
        this.onLinkThresholdChanged();
      }
      if (cachedView) {
        // this.updateLaunchView(cachedView);
      }
      $("#welcome-title").animate({
        marginTop: '-30px',
        opacity: '1'
      }, 1000);
    }, 2000);
    setTimeout(() => {
      $("#welcome-description").animate({
        marginTop: '0px',
        opacity: '1'
      }, 1000);
    }, 3000);
    setTimeout(() => {
      $('#visualwrapper').fadeTo("slow", 1);
      $('#add-data-container').fadeTo("slow", 1);
      $('#onload-container').fadeTo("slow", 1);
      $('#tool-btn-container').fadeTo("slow", 1);
    }, 5000);
  }
  /**
  * Check local storage for EULA acceptance.
  * If no acceptance found, display the license modal.
  */
  check_eula_acceptance() {
    // Example of using the localStorageService if needed:
    this.commonService.localStorageService.getItem('microbetrace_eula_accepted', (err, result) => {
      if (!result) {
        this.display_eula_modal = true;
      }
    });
  }
  /**
   * User accepted the EULA, store acceptance and close the modal.
   */
  on_eula_accept() {
    this.commonService.localStorageService.setItem('microbetrace_eula_accepted', 'true');
    this.display_eula_modal = false;
  }
  /**
   * User rejected the EULA, immediately route to https://www.cdc.gov/
   */
  on_eula_reject() {
    window.location.href = 'https://www.cdc.gov/';
  }
  showMessage(msg) {
    this.messages = [...this.messages, msg];
    setTimeout(() => {
      console.log('DEBUG: inshowmessage => about to detect changes manually...');
      this.cdref.detectChanges();
    }, 0);
  }
  // New method to handle the actual threshold change logic
  executeThresholdChange(newThreshold) {
    if (this.commonService.debugMode) {
      console.log('loading settingss1: ', this.commonService.session.style.widgets["link-threshold"]);
    }
    // Execute the actual threshold change
    this.onLinkThresholdChanged(newThreshold);
  }
  addComponent(component) {
    console.log('--- addComponent called');
    this.commonService.session.tabLoaded = false;
    // const componentType = this._selectedRegisteredComponentTypeName;
    const goldenLayoutComponent = this._goldenLayoutHostComponent.goldenLayout.newComponent(component);
    const componentRef = this._goldenLayoutHostComponent.getComponentRef(goldenLayoutComponent.container);
    this.addTab(component, component + this.activeTabIndex, this.activeTabIndex, componentRef);
    console.log('--- addComponent Tab added');
    // TODO:: GOLDEN LAYOUT USES ASYNCHONOUS Loading of Components, settimout waits for it
    setTimeout(() => {
      console.log('--- GOLDEN LAYOUT COMPONENT LOADED');
      this.commonService.session.tabLoaded = true;
      this.commonService.session.network.isFullyLoaded = true;
      this.setActiveTabProperties();
      // logpolygon color sh
      if (!this.store.settingsLoadedValue) {
        console.log('--- GOLDEN LAYOUT COMPONENT filter settings');
        this.loadFilterSettings();
        console.log('--- polygon color show33: ', this.commonService.session.style.widgets['polygons-color-show']);
      }
    });
  }
  /**
   * Performs the export of the visualization, including tables.
   */
  performExport(elementsForExport = [this.visualWrapperRef.nativeElement], exportNodeTable = false, exportLinkTable = false) {
    var _this = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      if (!elementsForExport[0] && !exportNodeTable && !exportLinkTable) {
        console.error('Visual wrapper container not found');
        return;
      }
      try {
        // Retrieve export options from the service
        const options = _this.exportService.getExportOptions();
        let canvas;
        let settings = {
          scale: options.scale || 1,
          useCORS: true,
          // Enable CORS if images are loaded from external sources,
          allowTaint: true,
          onclone: clonedDoc => {
            // Replace color input elements with colored spans
            const clonedInputs = clonedDoc.querySelectorAll('input[type="color"]');
            clonedInputs.forEach(input => {
              const color = input.getAttribute('value') || '#ffffff';
              const span = clonedDoc.createElement('span');
              span.style.display = 'inline-block';
              span.style.width = '20px';
              span.style.height = '20px';
              span.style.backgroundColor = color;
              span.style.border = '1px solid #000'; // Optional: Add border for visibility
              input.parentNode?.replaceChild(span, input);
            });
            // Optionally, handle other elements that display hex codes
            // For example, if you have spans or divs showing hex values:
            /*
            const colorTextElements = clonedDoc.querySelectorAll('.color-text');
            colorTextElements.forEach(elem => {
                const color = elem.textContent;
                elem.style.backgroundColor = color;
                elem.textContent = '';
            });
            */
          }
        };
        // if pos == 0, exporting just tables and not a view
        let pos = elementsForExport[0] instanceof HTMLDivElement ? 1 : 0;
        if (exportLinkTable && _this.commonService.session.style.widgets['link-color-variable'] !== 'None') {
          elementsForExport.splice(pos, 0, _this.linkColorTable.nativeElement);
        }
        if (exportNodeTable && _this.commonService.session.style.widgets['node-color-variable'] !== 'None') {
          elementsForExport.splice(pos, 0, _this.nodeColorTable.nativeElement);
        }
        Promise.all(elementsForExport.map(input => {
          return html2canvas__WEBPACK_IMPORTED_MODULE_13___default()(input, settings);
        })).then(canvasArray => {
          canvas = document.createElement('canvas');
          const context = canvas.getContext('2d');
          // Set the width and height of the combined canvas
          let width = canvasArray[0].width;
          let height = canvasArray[0].height;
          let offsets = pos == 0 ? [[5, 5]] : [[0, 0]];
          let previousColWidth,
            currentColWidth = 0;
          for (let i = 1; i < canvasArray.length; i++) {
            if (i == 1) {
              width += canvasArray[i].width + 5;
              height = Math.max(height, canvasArray[i].height + 5);
              offsets.push([canvasArray[0].width + offsets[0][0], 5]);
              previousColWidth = canvasArray[0].width + offsets[0][0];
              currentColWidth = canvasArray[1].width;
            } else {
              //if need to add a new column
              if (canvasArray[i].height + 5 > height) {
                width += canvasArray[i].width + 5;
                height = canvasArray[i].height + 5;
                offsets.push([offsets[i - 1][0] + currentColWidth, 5]);
                previousColWidth = currentColWidth;
                currentColWidth = canvasArray[i].width + 5;
              }
              // need to add a new column
              else if (offsets[i - 1][1] + canvasArray[i - 1].height + canvasArray[i].height + 5 > height) {
                width += canvasArray[i].width + 5;
                offsets.push([offsets[i - 1][0] + canvasArray[i - 1].width, 5]);
                previousColWidth = currentColWidth;
                currentColWidth = canvasArray[i].width + 5;
              } else {
                // don't need to add a new column
                offsets.push([offsets[i - 1][0], offsets[i - 1][1] + canvasArray[i - 1].height + 5]);
                if (canvasArray[i].width + 5 > currentColWidth) {
                  width += canvasArray[i].width - currentColWidth + 5;
                  currentColWidth = canvasArray[i].width + 5;
                }
              }
            }
          }
          canvas.width = width + 10;
          canvas.height = height + 10;
          context.fillStyle = '#ffffff';
          context.fillRect(0, 0, canvas.width, canvas.height);
          context.strokeStyle = '#000000';
          // Draw the canvases onto the combined canvas
          for (let i = 0; i < canvasArray.length; i++) {
            context.drawImage(canvasArray[i], offsets[i][0], offsets[i][1]);
            if (i > 0 || pos == 0) {
              // draw a rect around each additional drawImage element
              context.strokeRect(offsets[i][0], offsets[i][1], canvasArray[i].width, canvasArray[i].height);
            }
          }
          // Convert canvas to desired image format
          let imgData;
          const filetype = options.filetype.toLowerCase();
          const filename = options.filename || 'network_export';
          if (filetype === 'png') {
            imgData = canvas.toDataURL('image/png');
          } else if (filetype === 'jpeg' || filetype === 'jpg') {
            imgData = canvas.toDataURL('image/jpeg', options.quality || 0.92);
          } else if (filetype === 'webp') {
            imgData = canvas.toDataURL('image/webp', options.quality || 0.92);
          } else {
            console.error('Unsupported file type:', filetype);
            return;
          }
          // Trigger the download
          const link = document.createElement('a');
          link.href = imgData;
          link.download = `${filename}.${filetype}`;
          document.body.appendChild(link); // Append to body to make it clickable in Firefox
          link.click();
          document.body.removeChild(link); // Remove from body after clicking
          console.log('Export completed successfully.');
        });
      } catch (error) {
        console.error('Error during export:', error);
      }
    })();
  }
  performExportSVG(elementsForExport, mainSVGString, exportNodeTable = false, exportLinkTable = false) {
    var _this2 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      console.log('Exporting SVG');
      if (mainSVGString == '') {
        mainSVGString = '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="fill: transparent;"></svg>';
      }
      if (exportLinkTable) {
        elementsForExport.unshift(_this2.linkColorTable.nativeElement);
      }
      if (exportNodeTable) {
        elementsForExport.unshift(_this2.nodeColorTable.nativeElement);
      }
      const options = _this2.exportService.getExportOptions();
      const parser = new DOMParser();
      const doc = parser.parseFromString(mainSVGString, 'image/svg+xml');
      const svg1 = doc.documentElement;
      // i'll need some way to check when to add new col to export; but for now do this;            
      let width = parseFloat(svg1.getAttribute('width')) + 5 || 5;
      let height = parseFloat(svg1.getAttribute('height')) + 5 || 5;
      let tableSVGStrings = '';
      let currentOffsetX = width;
      let currentOffsetY = 5;
      let currentColWidth = 0;
      elementsForExport.forEach((element, index) => {
        let output = _this2.exportService.exportTableAsSVG(element, true);
        // exact logic from exporting a png
        if (index == 0) {
          width += output.width;
          height = Math.max(height, output.height);
          currentColWidth = output.width;
        } else {
          // if need to add a new column
          if (output.height > height) {
            width += output.width + 5;
            height = output.height + 5;
            currentOffsetX += currentColWidth;
            currentOffsetY = 5;
            currentColWidth = output.width;
          } else if (currentOffsetY + output.height + 5 > height) {
            // need to add a new column
            width += output.width + 5;
            currentOffsetX += currentColWidth;
            currentOffsetY = 5;
            currentColWidth = output.width;
          } else {
            // don't need to add a new column
            if (output.width + 5 > currentColWidth) {
              width += output.width - currentColWidth + 5;
              currentColWidth = output.width + 5;
            }
          }
        }
        let updatedSVGString = output.svg.replace('<g>', `<g transform="translate(${currentOffsetX}, ${currentOffsetY})" fill="none">`);
        tableSVGStrings += updatedSVGString;
        currentOffsetY += output.height + 5;
      });
      svg1.style.width = `${width + 5}px`;
      svg1.style.height = `${height + 5}px`;
      let mainSVG = String(svg1.outerHTML);
      let combinedSvgString;
      if (mainSVG.endsWith('/>')) {
        combinedSvgString = mainSVG.replace('/>', '>' + tableSVGStrings + '</svg>');
      } else {
        combinedSvgString = mainSVG.replace('</svg>', tableSVGStrings + '</svg>');
      }
      let blob = new Blob([combinedSvgString], {
        type: 'image/svg+xml;charset=utf-8'
      });
      file_saver__WEBPACK_IMPORTED_MODULE_8__(blob, `${options.filename}.svg`);
    })();
  }
  /**
   * Removes a component from this.homepageTabs
   * @param component name of the component to be removed
   */
  removeComponent(component) {
    this.homepageTabs = this.homepageTabs.filter(tab => {
      return tab.label !== component;
    });
  }
  /**
   * Delete file from files list
   * @param index (File index)
   */
  deleteFile(index) {
    this.files.splice(index, 1);
  }
  /**
   * Uses search-field, search-whole-word, search-case-sensitive widgets, and searchText variable to search each node and select all nodes that meet current criteria.
   * Also populates search-results list, and sets function that selects the node for when an option in the list is selected.
   */
  onSearch() {
    const nodes = this.commonService.session.data.nodes;
    const n = nodes.length;
    let v = this.searchText;
    const val = v;
    if (v == "") {
      $('#search-results').html("").hide();
      for (let i = 0; i < n; i++) {
        nodes[i].selected = false;
      }
    } else {
      $('#search-results').html("").hide();
      const field = this.commonService.session.style.widgets["search-field"];
      const dataSet = new Set();
      for (let i = 0; i < n; i++) {
        const node = nodes[i];
        if (node[field]) {
          const fieldData = node[field].toString(); // Convert the data to string
          // matches anything that is not a digit, letter, whitespace or one of following char < > & and replaces with corresponding HTML entity number
          const encodedField = fieldData.replace(/[\u00A0-\u9999<>&]/g, function (i) {
            return '&#' + i.charCodeAt(0) + ';';
          });
          dataSet.add(`${encodedField}`);
        }
      }
      const dataArray = Array.from(dataSet).sort();
      //#298
      if (this.commonService.session.style.widgets["search-whole-word"]) v = '\\b' + v + '\\b';
      let vre;
      if (this.commonService.session.style.widgets["search-case-sensitive"]) vre = new RegExp(v);else vre = new RegExp(v, 'i');
      dataArray.forEach(element => {
        if (element.match(vre)) {
          const $li = $('<li/>').html(element).attr('data-value', element);
          $('#search-results').append($li).show();
        }
      });
      const that = this;
      // on click of an option from the search list, the node is selected
      $('.autocomplete-wrapper li').on('click', function () {
        let ac_v = $(this).attr('data-value');
        const ac_val = ac_v;
        let ac_vre;
        $('#search').val(ac_v);
        $('#search-results').html("").hide();
        if (that.commonService.session.style.widgets["search-whole-word"]) ac_v = '\\b' + ac_v + '\\b';
        if (that.commonService.session.style.widgets["search-case-sensitive"]) ac_vre = new RegExp(ac_v);else ac_vre = new RegExp(ac_v, 'i');
        for (let i = 0; i < n; i++) {
          const node = nodes[i];
          if (!node[field]) {
            node.selected = false;
          }
          if (typeof node[field] == "string") {
            node.selected = ac_vre.test(node[field]);
          }
          if (typeof node[field] == "number") {
            node.selected = node[field] + "" == ac_val;
          }
        }
        $(document).trigger("node-selected");
      });
      let firstSelected = false;
      // selects that meets current search criteria
      for (let i = 0; i < n; i++) {
        if (!firstSelected) {
          const node = nodes[i];
          if (!node[field]) {
            node.selected = false;
          }
          if (typeof node[field] == "string") {
            node.selected = vre.test(node[field]);
            firstSelected = node.selected;
          }
          if (typeof node[field] == "number") {
            node.selected = node[field] + "" == val;
            firstSelected = node.selected;
          }
        } else {
          break;
        }
      }
      if (!nodes.some(node => node.selected)) console.log('no matches');
    }
    $(document).trigger("node-selected");
  }
  /**
   * Updates search-field widget (with variable to search in) can updates search
   */
  onSearchFieldChange(ev) {
    this.commonService.session.style.widgets["search-field"] = ev;
    this.onSearch();
  }
  /**
   * Updates search-whole-word widget can updates search
   */
  onWholeWordChange() {
    this.commonService.session.style.widgets["search-whole-word"] = !this.commonService.session.style.widgets["search-whole-word"];
    this.onSearch();
  }
  /**
   * Updates search-case-sensitive widget can updates search
   */
  onCaseSensitiveChange() {
    this.commonService.session.style.widgets["search-case-sensitive"] = !this.commonService.session.style.widgets["search-case-sensitive"];
    this.onSearch();
  }
  /**
   * Convert Files list to normal array list
   * @param files (Files List)
   */
  prepareFilesLists($event) {
    if (this.commonService.debugMode) {
      console.log("Trying to prepare files");
    }
    // this.commonService.resetData();
    this.store.setFP_removeFiles(true);
    this.commonService.session.files = [];
    if (!this.commonService.session.style.widgets) {
      this.commonService.session.style.widgets = this.commonService.defaultWidgets();
    }
    if (this.commonService.debugMode) {
      console.log('threshold: ', this.commonService.session.style.widgets['link-threshold']);
    }
    // this.loadSettings();
    // this.homepageTabs[1].isActive = false;
    this.homepageTabs[0].isActive = true;
    $('#overlay').fadeOut();
    $('.ui-tabview-nav').fadeTo("slow", 1);
    $('.m-portlet').fadeTo("slow", 1);
    this.showExport = false;
    this.showCenter = false;
    this.showPinAllNodes = false;
    this.showRefresh = false;
    this.showButtonGroup = false;
    this.showSorting = false;
    // Remove the default tab
    this._removeGlView('2D Network');
    if (this.commonService.debugMode) {
      console.log('homepage tabs1: ', this.homepageTabs);
    }
    this.getfileContent($event);
  }
  /**
   * Updates metric based on selection
   * @param value - metric selected
   */
  updateMetric(value) {
    this.metric = value;
    if (this.commonService.debugMode) {
      console.log('updating metric: ', this.metric);
    }
    if (this.metric.toLowerCase() === "snps") {
      //Hide Ambiguities
      $('#ambiguities-menu').hide();
      this.threshold = "7";
      this.commonService.session.style.widgets["link-threshold"] = 7;
    } else {
      $('#ambiguities-menu').show();
      this.threshold = "0.015";
      this.commonService.session.style.widgets["link-threshold"] = 0.015;
    }
    // Update distance metric in style
    this.commonService.session.style.widgets['default-distance-metric'] = this.metric.toLocaleLowerCase();
    this.commonService.localStorageService.setItem('default-distance-metric', this.metric.toLocaleLowerCase());
  }
  /**
   * Updates ambiguity based on selection and store in style widgets
   * @param value - ambiguity selected
   */
  updateAmbiguity(value) {
    this.ambiguity = value;
    this.commonService.session.style.widgets['ambiguity-resolution-strategy'] = this.ambiguity.toLocaleUpperCase();
  }
  /**
   * Updates launch view based on selection
   * @param value - view selected
   */
  updateLaunchView(value) {
    this.launchView = value;
    this.commonService.localStorageService.setItem('default-view', this.launchView);
    this.commonService.session.style.widgets['default-view'] = this.launchView;
    this.commonService.session.layout.content[0].type = this.launchView;
  }
  /**
   * Updates threshold based on selection and stores in style widget
   */
  updateThreshold(ev) {
    const newThreshold = ev.target?.value ?? ev;
    this.threshold = newThreshold;
    if (this.commonService.debugMode) {
      console.log('threshold: ', this.threshold);
    }
    // Update UI immediately
    this.SelectedLinkThresholdVariable = newThreshold;
    this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable = this.SelectedLinkThresholdVariable;
    // Emit the new threshold value to the debouncer for actual threshold change
    this.thresholdDebouncer.next(Number(newThreshold));
  }
  /**
   * Handler for recall btn
   * Opens recall window
   * @param {void}
   */
  recallClicked() {}
  /**
   * Handler for continue btn
   * Opens recall window
   * @param {void}
   */
  continueClicked() {
    // this._removeGlView('Files');
    $('#overlay').fadeOut("slow");
    $('.ui-tabview-nav').fadeTo("slow", 1);
    $('.m-portlet').fadeTo("slow", 1);
  }
  /**
   * Updates background-color widget and then updates background color on twoD network (or any element with #network)
   */
  onBackgroundChanged() {
    this.commonService.session.style.widgets['background-color'] = this.SelectedBackgroundColorVariable;
    if ($('#cy') != undefined) {
      $('#cy').css('background-color', this.SelectedBackgroundColorVariable);
    }
  }
  /**
   * Updates GlobalSetingModel variable and cluster-minimum-size widget. Removes and adds clusters when needed
   */
  onMinimumClusterSizeChanged(silent = false) {
    console.log('--- onMinimumClusterSizeChanged called: silent: ', silent);
    this.commonService.GlobalSettingsModel.SelectedClusterMinimumSizeVariable = this.SelectedClusterMinimumSizeVariable;
    let val = parseInt(this.SelectedClusterMinimumSizeVariable);
    this.commonService.session.style.widgets["cluster-minimum-size"] = val;
    if (this.commonService.session.data.nodes.length === 0) {
      return;
    }
    // Check if the cluster minimum value really changed
    if (val === this._lastClusterMinimum && this.store.settingsLoadedValue) {
      console.log("Cluster minimum unchanged; no update needed.");
      return;
    }
    if (!silent) {
      let previousNumberOfVisibleClusters = this.commonService.session.data.clusters.filter(cluster => cluster.visible).length;
      this.commonService.setClusterVisibility(true);
      // if number of visible clusters changed, then update network
      if (previousNumberOfVisibleClusters != this.commonService.session.data.clusters.filter(cluster => cluster.visible).length) {
        this.commonService.setNodeVisibility(true);
        this.commonService.setLinkVisibility(true);
        this.commonService.updateStatistics();
        this.store.setNetworkUpdated(true);
      }
    }
    this._lastClusterMinimum = val;
  }
  /**
   * Updates GlobalSettingsModel variable and link-sort-variable widget. Updates link threshold histogram and then updates network
   */
  onLinkSortChanged(silent = false) {
    if (this.commonService.session.data.nodes.length === 0) {
      return;
    }
    // Only update if the sort variable is different
    if (this.SelectedLinkSortVariable === this._lastLinkSortValue && this.store.settingsLoadedValue) {
      console.log("Link sort variable unchanged; skipping update.");
      return;
    }
    // Otherwise, update the stored value and proceed
    this._lastLinkSortValue = this.SelectedLinkSortVariable;
    console.log('onLinkSortChanged called');
    this.commonService.GlobalSettingsModel.SelectedLinkSortVariable = this.SelectedLinkSortVariable;
    this.commonService.session.style.widgets["link-sort-variable"] = this.SelectedLinkSortVariable;
    // this.commonService.updateThresholdHistogram();
    // 1) Parse the threshold value to a number
    const linkThresholdValue = parseFloat(String(this.commonService.session.style.widgets["link-threshold"]));
    // 2) Now you can safely call toFixed on a numeric value
    const decimals = this.commonService.session.style.widgets['default-distance-metric'].toLowerCase() === "tn93" ? 3 : 0;
    const fixedThresholdValue = linkThresholdValue.toFixed(decimals);
    // 3) If you want to store it back as a number (not a string), parseFloat again:
    this.SelectedLinkThresholdVariable = parseFloat(fixedThresholdValue);
    // If not loading all settings at once, update link threshold
    if (!silent) {
      this.onLinkThresholdChanged();
    }
    // this.commonService._debouncedUpdateNetworkVisuals();
  }
  /**
   * Reads the file and applies the style to MicrobeTrace session.style
   *
   */
  onApplyStyle(file) {
    $('.custom-file-label').text(this.SelectedApplyStyleVariable.substring(12));
    const reader = new FileReader();
    reader.onload = e => {
      this.commonService.applyStyle(JSON.parse(e.target.result));
      this.applyStyleFileSettings();
    };
    reader.readAsText(file.target.files[0]);
  }
  applyStyleFileSettings() {
    this.widgets = this.commonService.session.style.widgets;
    if (this.SelectedClusterMinimumSizeVariable != this.widgets['cluster-minimum-size']) {
      this.SelectedClusterMinimumSizeVariable = this.widgets['cluster-minimum-size'];
      this.onMinimumClusterSizeChanged();
      // not triggering render clus-vis correctly, may be relate to bug with onMinimumClusterSizeChanged()
    }
    if (this.SelectedColorNodesByVariable != this.widgets['node-color-variable']) {
      this.SelectedColorNodesByVariable = this.widgets['node-color-variable'];
      this.getGlobalSettingsData();
      this.onColorNodesByChanged();
    }
    if (this.SelectedColorLinksByVariable != this.widgets['link-color-variable']) {
      this.SelectedColorLinksByVariable = this.widgets['link-color-variable'];
      console.log('link colorTable - applystylefile: ', $('#link-color-table'));
      this.onColorLinksByChanged();
    }
    if (this.SelectedBackgroundColorVariable != this.widgets['background-color']) {
      this.SelectedBackgroundColorVariable = this.widgets['background-color'];
      this.onBackgroundChanged();
    }
    if (this.widgets['node-color-variable'] && this.widgets['node-color-variable'] !== 'None') {
      // Show table dialog
      this.SelectedNodeColorTableTypesVariable = 'Show';
      this.GlobalSettingsNodeColorDialogSettings.setVisibility(true);
    }
    // Show Link Color Table if link-color-variable != 'None'
    if (this.widgets['link-color-variable'] && this.widgets['link-color-variable'] !== 'None') {
      this.SelectedLinkColorTableTypesVariable = 'Show';
      this.GlobalSettingsLinkColorDialogSettings.setVisibility(true);
    }
  }
  onEpsilonValueChange() {
    this.commonService.session.style.widgets["mst-computed"] = false;
    this.onPruneWithTypesChanged(this.SelectedPruneWityTypesVariable);
  }
  onPruneWithTypesChanged(newValue) {
    console.log('onPruneWithTypesChanged: ', newValue);
    this.SelectedPruneWityTypesVariable = newValue;
    this.commonService.GlobalSettingsModel.SelectedPruneWityTypesVariable = this.SelectedPruneWityTypesVariable;
    if (this.SelectedPruneWityTypesVariable == "None") {
      $('#filtering-epsilon-row').slideUp();
      this.commonService.session.style.widgets["link-show-nn"] = false;
      this.commonService.setLinkVisibility(true);
      this.commonService.updateNetworkVisuals(true);
      this.store.setLinkThreshold(this.SelectedLinkThresholdVariable - 0.000001);
      this.commonService.onStatisticsChanged("Show");
    } else {
      this.SelectedEpsilonValue = Math.pow(10, this.widgets['filtering-epsilon']).toPrecision(3);
      this.commonService.session.style.widgets["filtering-epsilon"] = this.widgets['filtering-epsilon'];
      this.commonService.session.style.widgets["link-show-nn"] = true;
      $('#filtering-epsilon-row').slideDown();
      this.commonService.computeMST().then(() => {
        console.log('computeMST for nearest neighbor');
        console.log('Link (MZ745515-MZ712879) after MST:', this.commonService.session.data.links.filter(link => link.source === "MZ745515" && link.target === "MZ712879" || link.source === "MZ712879" && link.target === "MZ745515"));
        //console log link that source is MZ798055 and target is MZ375596
        console.log('link after computeMST: ', this.commonService.session.data.links.filter(link => link.source === "MZ798055" && link.target === "MZ375596"));
        this.commonService.setLinkVisibility(true);
        this.commonService.updateNetworkVisuals(true);
        this.store.setLinkThreshold(this.SelectedLinkThresholdVariable + 0.000001);
        console.log('onlink compute mst');
        this.onLinkColorTableChanged();
        // TODO:: David is this needed?
        if ('tableComp' in this.commonService.visuals) {
          if (this.commonService.visuals.tableComp.dataSetViewSelected == 'Link') {
            this.commonService.visuals.tableComp.openSelectDataSetScreen({
              value: 'Link'
            });
          }
        }
        this.commonService.onStatisticsChanged("Show");
      });
      return;
      // TODO:: David Removed to fix NN issue
      // if(!this.commonService.session.style.widgets["mst-computed"]) {
      //     this.commonService.computeMST().then(() => {
      //         this.commonService.updateNetwork();
      //         this.updatedVisualization();
      //         if ('tableComp' in this.commonService.visuals) {
      //             if (this.commonService.visuals.tableComp.dataSetViewSelected == 'Link') {
      //                 this.commonService.visuals.tableComp.openSelectDataSetScreen({value: 'Link'});
      //             }
      //         }
      //     });
      //      this.commonService.session.style.widgets["mst-computed"] = true;
      //      console.log('updated compute:' , this.commonService.session.style.widgets["mst-computed"]);
      //      return;
      //    } else {
    }
  }
  // This is the method that actually toggles the link-color dialog & table
  onLinkColorTableChanged(silent = false) {
    console.log('DEBUG: onLinkColorTableChanged fired. value=', this.SelectedLinkColorTableTypesVariable, 'silent=', silent);
    // Keep your GlobalSettingsModel in sync
    this.commonService.GlobalSettingsModel.SelectedLinkColorTableTypesVariable = this.SelectedLinkColorTableTypesVariable;
    if (this.SelectedLinkColorTableTypesVariable === 'Hide') {
      console.log('DEBUG: Hiding link color dialog and clearing table');
      this.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
      $('#link-color-table').empty();
    } else {
      console.log('DEBUG: Showing link color dialog & building table');
      this.GlobalSettingsLinkColorDialogSettings.setVisibility(true);
      if (this.SelectedColorLinksByVariable === 'None') {
        console.log('DEBUG: Link color variable=NONE => empty table');
        $('#link-color-table').empty();
      } else {
        console.log('DEBUG: Generating link table. Table element =', this.linkColorTable?.nativeElement);
        this.generateNodeLinkTable('#link-color-table');
      }
      $('#link-color-table-row').slideDown();
    }
    // If OnPush, sometimes you might also need:
    if (!silent) {
      console.log('DEBUG: onLinkColorTableChanged => Marking for check');
      this.cdref.markForCheck();
      // or .detectChanges() if you want an immediate synchronous check
      // this.cdref.detectChanges();
    }
  }
  /**
   * Updates this.commonService.GlobalSettingsModel.SelectedNodeColorTableTypesVariable and
   * then hides the node color table or calls onColorNodesByChanged
   */
  onNodeColorTableChanged(silent = false) {
    if (this.commonService.debugMode) {
      console.log('node color changed: ', this.SelectedNodeColorTableTypesVariable);
    }
    this.commonService.GlobalSettingsModel.SelectedNodeColorTableTypesVariable = this.SelectedNodeColorTableTypesVariable;
    if (this.SelectedNodeColorTableTypesVariable == "Hide") {
      this.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
    } else {
      this.onColorNodesByChanged(silent);
    }
  }
  onShowStatisticsChanged() {
    if (this.SelectedStatisticsTypesVariable === "Show") {
      this.commonService.updateStatistics();
      $("#network-statistics-wrapper").fadeIn();
    } else {
      this.commonService.updateStatistics();
      $("#network-statistics-wrapper").fadeOut();
    }
    this.commonService.GlobalSettingsModel.SelectedStatisticsTypesVariable = this.SelectedStatisticsTypesVariable;
    // if (this.homepageTabs[this.activeTabNdx].label == "2D Network") {
    //     this.homepageTabs[this.activeTabNdx].componentRef.enableSettings();
    // }
  }
  /**
   * Updates node-color widget and published node color to each view to update them. Only relevant when color nodes by = None
   */
  onNodeColorChanged(silent = false) {
    const variable = this.SelectedNodeColorVariable;
    this.commonService.session.style.widgets["node-color"] = variable;
    if (!silent) this.publishUpdateNodeColors();
  }
  /**
   * calls updateNodeColors() for each view
   */
  publishUpdateNodeColors() {
    this.homepageTabs.forEach(tab => {
      if (tab.componentRef && tab.componentRef.instance.updateNodeColors) {
        console.log('publishUpdateNodeColors - updateNodeColors called');
        tab.componentRef.instance.updateNodeColors();
      }
    });
  }
  /**
   * Updates visualization for each view that is available
   */
  publishUpdateVisualization() {
    this.homepageTabs.forEach(tab => {
      if (tab.componentRef && tab.componentRef.instance.updateVisualization) {
        tab.componentRef.instance.updateVisualization();
      }
    });
  }
  publishUpdateLinkColor() {
    this.homepageTabs.forEach(tab => {
      if (tab.componentRef && tab.componentRef.instance.updateLinkColor) {
        tab.componentRef.instance.updateLinkColor();
      }
    });
  }
  onLinkColorChanged(silent = false) {
    this.commonService.session.style.widgets["link-color"] = this.SelectedLinkColorVariable;
    if (!silent) this.publishUpdateLinkColor();
  }
  onColorLinksByChanged(silent = false) {
    console.log('DEBUG: onColorLinksByChanged fired. variable =', this.SelectedColorLinksByVariable, 'silent=', silent);
    this.commonService.GlobalSettingsModel.SelectedColorLinksByVariable = this.SelectedColorLinksByVariable;
    this.commonService.session.style.widgets['link-color-variable'] = this.SelectedColorLinksByVariable;
    if (this.SelectedColorLinksByVariable !== 'None') {
      console.log('DEBUG: onColorLinksByChanged => user picked something, setting table to Show');
      this.SelectedLinkColorTableTypesVariable = 'Show';
    } else {
      console.log('DEBUG: onColorLinksByChanged => user picked None, setting table to Hide');
      this.SelectedLinkColorTableTypesVariable = 'Hide';
    }
    if (!silent) {
      console.log('DEBUG: onColorLinksByChanged => publishing link-color updates to views');
      this.publishUpdateLinkColor();
    }
    this.onLinkColorTableChanged(silent);
  }
  // The actual function that builds your color table
  generateNodeLinkTable(tableId, isEditable = true) {
    console.log('DEBUG: generateNodeLinkTable called. tableId=', tableId);
    console.log('DEBUG: table before .empty(): child rowcount=', $(tableId).find('tr').length);
    const linkColorTable = $(tableId).empty().append('<tr>' + "<th class='p-1 table-header-row'><div class='header-content'><span>Link " + this.commonService.titleize(this.SelectedColorLinksByVariable) + "</span><a class='sort-button' style='cursor: pointer'></a></div></th>" + `<th class='table-header-row tableCount' ${this.widgets['link-color-table-counts'] ? '' : 'style="display: none"'}><div class='header-content'><span>Count</span><a class='sort-button' style='cursor: pointer'></a></div></th>` + `<th class='table-header-row tableFrequency' ${this.widgets['link-color-table-frequencies'] ? '' : 'style="display: none"'}><div class='header-content'><span>Frequency</span><a class='sort-button' style='cursor: pointer'></a></div></th>` + '<th>Color</th>' + '</tr>');
    // Debug checks
    console.log('DEBUG: after appending header, table rowcount=', $(tableId).find('tr').length);
    // If you suspect linkColorMap may be empty or never updated, log it:
    const aggregates = this.commonService.createLinkColorMap();
    console.log('DEBUG: createLinkColorMap =>', aggregates);
    const vlinks = this.commonService.getVisibleLinks();
    console.log('DEBUG: getVisibleLinks =>', vlinks?.length);
    const aggregateValues = Object.keys(aggregates);
    console.log('DEBUG: aggregateValues =>', aggregateValues);
    const disabled = isEditable ? '' : 'disabled';
    aggregateValues.forEach((value, i) => {
      if (aggregates[value] == 0) {
        return;
      }
      // console.log('link color aggregates value: ', aggregates[value]);
      // console.log('link color value: ', value);
      // console.log('link color map: ', this.commonService.temp.style.linkColorMap);
      // console.log('link color map value: ', this.commonService.temp.style.linkColorMap(value));
      // Grab color of link from session
      const color = this.commonService.temp.style.linkColorMap(value);
      // Create color input element with color value and assign id to retrieve new value on change
      const colorinput = $(`<input type="color" value="${color}" ${disabled}>`).on("change", e => {
        // need to update the value in the dom which is used when exportings
        e.currentTarget.attributes[1].value = e.target['value'];
        // Need to get value from id since "this" keyword is used by angular
        // Update that value at the index in the color table
        this.commonService.session.style.linkColors.splice(i, 1, e.target['value']);
        // Generate new color map with updated table
        this.commonService.temp.style.linkColorMap = d3__WEBPACK_IMPORTED_MODULE_4__.scaleOrdinal(this.commonService.session.style.linkColors).domain(aggregateValues);
        // Call the updateLinkColor method in the active tab
        this.homepageTabs[this.activeTabIndex].componentRef.instance.updateLinkColor();
      });
      const alphainput = $(`<a class="transparency-symbol"></a>`).on("click", e => {
        $("#color-transparency-wrapper").css({
          top: e.clientY + 129,
          left: e.clientX,
          display: "block"
        });
        $("#color-transparency").val(this.commonService.session.style.linkAlphas[i]).one("change", f => {
          // Update table with new alpha value
          // Need to get value from id since "this" keyword is used by angular
          this.commonService.session.style.linkAlphas.splice(i, 1, parseFloat(f.target['value']));
          this.commonService.temp.style.linkAlphaMap = d3__WEBPACK_IMPORTED_MODULE_4__.scaleOrdinal(this.commonService.session.style.linkAlphas).domain(aggregateValues);
          $("#color-transparency-wrapper").fadeOut();
          this.homepageTabs[this.activeTabIndex].componentRef.instance.updateLinkColor();
          // this.goldenLayout.componentInstances[1].updateLinkColor();
        });
      });
      const row = $("<tr>" + "<td data-value='" + value + "'>" + (this.commonService.session.style.linkValueNames[value] ? this.commonService.session.style.linkValueNames[value] : this.commonService.titleize("" + value)) + "</td>" + `<td class='tableCount' ${this.widgets['link-color-table-counts'] ? "" : "style='display: none'"}>` + aggregates[value] + "</td>" + `<td class='tableFrequency' ${this.widgets['link-color-table-frequencies'] ? "" : "style='display: none'"}>` + (aggregates[value] / vlinks.length).toLocaleString() + "</td>" + "</tr>");
      const nonEditCell = `<td style="background-color:${color}"></td>`;
      if (isEditable) {
        row.append($("<td></td>").append(colorinput).append(alphainput));
      } else {
        row.append(nonEditCell);
      }
      console.log('---- link colorTable: ', i, linkColorTable);
      linkColorTable.append(row);
    });
    console.log('DEBUG: after building rows, rowcount=', $(tableId).find('tr').length);
    // At the end, we do a final check of the DOM:
    const finalCount = $(tableId).find('tr').length;
    console.log('DEBUG: final rowcount in table:', finalCount);
    if (isEditable) {
      linkColorTable.find("td").on("dblclick", function () {
        $(this).attr("contenteditable", "true").focus();
      }).on("focusout", () => {
        const $this = $(this);
        $this.attr("contenteditable", "false");
        this.commonService.session.style.linkValueNames[$this.data("value")] = $this.text();
      });
    }
    let isAscending = true; // add this line before the click event handler
    this.updateCountFreqTable('link-color');
    $('#linkColorTableSettings').on('mouseleave', () => $('#linkColorTableSettings').delay(500).css('display', 'none'));
    // console lof the rows in the table
    $(tableId).on('click', '.sort-button', function () {
      const table = $(this).parents('table').eq(0);
      let rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).parent().parent().index()));
      isAscending = !isAscending; // replace 'this.asc' with 'isAscending'
      if (!isAscending) {
        rows = rows.reverse();
      }
      for (let i = 0; i < rows.length; i++) {
        table.append(rows[i]);
      }
    });
    function comparer(index) {
      return function (a, b) {
        const valA = getCellValue(a, index),
          valB = getCellValue(b, index);
        return !isNaN(Number(valA)) && !isNaN(Number(valB)) ? Number(valA) - Number(valB) : valA.toString().localeCompare(valB);
      };
    }
    function getCellValue(row, index) {
      const value = $(row).children('td').eq(index).text();
      return value;
    }
  }
  onTimelineChanged(e) {
    this.SelectedTimelineVariable = e;
    if (this.commonService.debugMode) {
      console.log('timeline changed: ', e);
    }
    d3__WEBPACK_IMPORTED_MODULE_4__.select('#global-timeline svg').remove();
    clearInterval(this.commonService.session.timeline);
    let variable = e;
    let loadingJsonFile = this.commonService.session.style.widgets["node-timeline-variable"] == variable;
    if (this.commonService.session.style.widgets["node-timeline-variable"] != 'None' && !loadingJsonFile) {
      // change timeline variable when end time not reaching target time - redraw netwrok to start fresh
      if (moment__WEBPACK_IMPORTED_MODULE_9___default()(this.commonService.session.state.timeEnd).toDate() < moment__WEBPACK_IMPORTED_MODULE_9___default()(this.commonService.session.state.timeTarget).toDate()) {
        this.commonService.session.state.timeEnd = this.commonService.session.state.timeTarget;
        this.commonService.setNodeVisibility(false);
        this.commonService.setLinkVisibility(false);
        this.commonService.updateStatistics();
      }
    }
    this.commonService.session.style.widgets["node-timeline-variable"] = variable;
    if (variable == "None") {
      $("#global-timeline-field").empty();
      this.commonService.session.style.widgets["timeline-date-field"] = 'None';
      $("#global-timeline-wrapper").fadeOut();
      // $('#pinbutton').prop("disabled", false);
      // if(!this.commonService.session.network.timelinePinned) {
      // $('#pinbutton').trigger('click');
      // this.commonService.updatePinNodes(false);
      // }
      this.commonService.session.network.timelineNodes = [];
      this.commonService.setNodeVisibility(false);
      this.commonService.setLinkVisibility(false);
      this.commonService.updateStatistics();
      return;
    }
    // need to check and ensure bubble nodes are sorted by this variable, then rerender/recalculate bubbles position
    if ('bubble' in this.commonService.visuals) {
      this.commonService.visuals.bubble.sortData(variable);
    }
    console.log('timeline variable: ', variable);
    if (!this.commonService.temp.style.nodeColor) $("#node-color-variable").trigger("change");
    // let el: HTMLElement = this.pinBtn.nativeElement;
    // console.log('pin : ', el);
    // if (!$('#pinbutton').prop('disabled')){
    //     if (!loadingJsonFile) {
    //         this.commonService.session.network.timelinePinned = this.commonService.session.network.allPinned;
    //     if(!this.commonService.session.network.allPinned) {
    //         this.commonService.updatePinNodes(true);
    //         this.openPinAllNodes(1);
    //     }
    //     this.commonService.session.network.timelineNodes = this.commonService.getNetworkNodes();
    //     }
    //     $('#pinbutton').prop("disabled", true);
    // }
    if (!loadingJsonFile) {
      this.commonService.session.network.timelinePinned = this.commonService.session.network.allPinned;
      // if(!this.commonService.session.network.allPinned) {
      //     this.commonService.updatePinNodes(true);
      // }
    }
    let globalTimelineField = this.commonService.session.style.overwrite && variable == this.commonService.session.style.overwrite['globalTimelineFieldVariable'] ? this.commonService.session.style.overwrite['globalTimelineField'] : this.commonService.titleize(variable);
    const encodedGlobalTimelineField = globalTimelineField.replace(/[\u00A0-\u9999<>\&]/g, function (i) {
      return '&#' + i.charCodeAt(0) + ';';
    });
    $("#global-timeline-field").html(encodedGlobalTimelineField);
    const formatDateIntoYear = d3__WEBPACK_IMPORTED_MODULE_4__.timeFormat("%Y");
    const formatDateIntoMonthYear = d3__WEBPACK_IMPORTED_MODULE_4__.timeFormat("%b %y");
    const formatDateIntoMonth = d3__WEBPACK_IMPORTED_MODULE_4__.timeFormat("%b");
    const formatDateMonthYear = d3__WEBPACK_IMPORTED_MODULE_4__.timeFormat("%b %Y");
    const formatDateDateMonth = d3__WEBPACK_IMPORTED_MODULE_4__.timeFormat("%b %_d");
    // let timeDomainStart, timeDomainEnd;
    let field = variable;
    let times = [],
      vnodes = JSON.parse(JSON.stringify(this.commonService.session.data.nodes));
    vnodes.forEach(d => {
      let time = moment__WEBPACK_IMPORTED_MODULE_9___default()(d[field]);
      if (time.isValid()) {
        console.log('time moment value: ', d[field]);
        d[field] = time.toDate();
        times.push(d[field]);
      } else {
        console.log('time moment not value: ', d[field]);
        d[field] = null;
      }
    });
    if (times.length < 2) {
      times = [new Date(2000, 1, 1), new Date()];
    }
    const timeDomainStart = Math.min(...times);
    const timeDomainEnd = Math.max(...times);
    const days = moment__WEBPACK_IMPORTED_MODULE_9___default()(timeDomainEnd).diff(moment__WEBPACK_IMPORTED_MODULE_9___default()(timeDomainStart), 'days');
    const tickDateFormat = d => {
      if (days < 184) return formatDateDateMonth(d);else if (days < 367) return formatDateIntoMonth(d);else if (days < 367 * 5) return formatDateIntoMonthYear(d);else return formatDateIntoYear(d);
    };
    this.handleDateFormat = d => {
      if (days < 367) return formatDateDateMonth(d);else return formatDateMonthYear(d);
    };
    const startDate = timeDomainStart;
    const endDate = timeDomainEnd;
    const margin = {
        top: 50,
        right: 50,
        bottom: 0,
        left: 50
      },
      width = $('#visualwrapper').width() * 4 / 5 - margin.left - margin.right,
      height = 200 - margin.top - margin.bottom;
    var svgTimeline = d3__WEBPACK_IMPORTED_MODULE_4__.select("#global-timeline").append("svg").attr("width", width + margin.left + margin.right).attr("height", 120);
    ////////// slider //////////
    this.currentTimelineValue = 0;
    this.currentTimelineTargetValue = width;
    this.commonService.session.state.timeStart = startDate;
    const that = this;
    const playButton = d3__WEBPACK_IMPORTED_MODULE_4__.select("#timeline-play-button");
    if (playButton.text() == "Pause") playButton.text("Play");
    this.xAttribute = d3__WEBPACK_IMPORTED_MODULE_4__.scaleTime().domain([startDate, endDate]).range([0, this.currentTimelineTargetValue]).clamp(true).nice();
    const slider = svgTimeline.append("g").attr("class", "slider").attr("transform", "translate(30," + height / 2 + ")");
    slider.append("line").attr("class", "track").attr("x1", this.xAttribute.range()[0]).attr("x2", this.xAttribute.range()[1]).attr("stroke", "#ddd") // Ensure this is a visible color
    .attr("stroke-width", "10px"); // Ensure this is a sufficient width
    // Pre D3
    // .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
    //.each(function() { this.parentNode.appendChild(this.cloneNode(true)); })
    slider.append('line').attr("class", "track-inset").attr("x1", this.xAttribute.range()[0]).attr("x2", this.xAttribute.range()[1]).attr("stroke", "#ddd") // Ensure this is a visible color
    .attr("stroke-width", "10px"); // Ensure this is a sufficient width
    //.each(function() { this.parentNode.appendChild(this.cloneNode(true)); })
    slider.append('line')
    // Pre D3
    // .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
    .attr("class", "track-overlay").attr("x1", this.xAttribute.range()[0]).attr("x2", this.xAttribute.range()[1]).attr("stroke", "#ddd") // Ensure this is a visible color
    .attr("stroke-width", "10px") // Ensure this is a sufficient width
    .call(d3__WEBPACK_IMPORTED_MODULE_4__.drag().on("start.interrupt", function () {
      slider.interrupt();
    }).on("start drag", function () {
      that.currentTimelineValue = d3__WEBPACK_IMPORTED_MODULE_4__.event.x;
      that.update(that.xAttribute.invert(that.currentTimelineValue));
      if (that.playBtnText == "Pause") {
        that.playBtnText = "Play";
        clearInterval(that.commonService.session.timeline);
      }
    }));
    slider.insert("g", ".track-overlay").attr("class", "ticks").attr("transform", "translate(0," + 18 + ")").selectAll("text").data(this.xAttribute.ticks(12)).enter().append("text").attr("x", this.xAttribute).attr("y", 10).attr("text-anchor", "middle").text(function (d) {
      return tickDateFormat(d);
    });
    this.label = slider.append("text").attr("class", "label").attr("text-anchor", "middle").text(this.handleDateFormat(startDate)).attr("transform", "translate(25," + -20 + ")");
    this.handle = slider.insert("circle", ".track-overlay").attr("class", "handle").attr("r", 9);
    this.commonService.session.style.widgets["timeline-date-field"] = field;
    this.commonService.session.state.timeStart = startDate;
    this.commonService.session.state.timeTarget = this.xAttribute.invert(this.currentTimelineTargetValue);
    if (loadingJsonFile && moment__WEBPACK_IMPORTED_MODULE_9___default()(this.commonService.session.state.timeEnd).toDate() < moment__WEBPACK_IMPORTED_MODULE_9___default()(this.commonService.session.state.timeTarget).toDate()) {
      let t = moment__WEBPACK_IMPORTED_MODULE_9___default()(this.commonService.session.state.timeEnd).toDate();
      this.currentTimelineTargetValue = this.xAttribute(t);
      this.handle.attr("cx", this.xAttribute(t));
      this.label.attr("x", this.xAttribute(t)).text(this.handleDateFormat(t));
    }
    $("#global-timeline-wrapper").fadeIn();
  }
  playTimeline() {
    if (this.playBtnText == "Pause") {
      this.playBtnText = "Play";
      clearInterval(this.commonService.session.timeline);
    } else {
      this.playBtnText = "Pause";
      this.commonService.session.timeline = setInterval(this.step, this.timelineSpeed, this);
    }
  }
  update(h) {
    this.handle.attr("cx", this.xAttribute(h));
    this.label.attr("x", this.xAttribute(h)).text(this.handleDateFormat(h));
    this.commonService.session.state.timeEnd = h;
    this.commonService.setNodeVisibility(false);
    this.commonService.setLinkVisibility(false);
    this.commonService.updateStatistics();
  }
  step(that) {
    that.update(that.xAttribute.invert(that.currentTimelineValue));
    if (that.currentTimelineValue > that.currentTimelineTargetValue) {
      that.currentTimelineValue = 0;
      clearInterval(that.commonService.session.timeline);
      that.playBtnText = "Play";
      return;
    }
    that.currentTimelineValue = that.currentTimelineValue + that.currentTimelineTargetValue / 151;
  }
  showNodeColorTable() {
    if (this.SelectedNodeColorTableTypesVariable != ' Show') {
      this.SelectedNodeColorTableTypesVariable = 'Show';
      this.onNodeColorTableChanged();
    }
    ;
  }
  hideNodeColorTable() {
    if (this.SelectedNodeColorTableTypesVariable != 'Hide') {
      this.SelectedNodeColorTableTypesVariable = 'Hide';
      this.onNodeColorTableChanged();
    }
  }
  showLinkColorTable() {
    console.log('onLinkColorTableChanged - show');
    if (this.SelectedLinkColorTableTypesVariable != ' Show') {
      this.SelectedLinkColorTableTypesVariable = 'Show';
      this.onLinkColorTableChanged();
    }
  }
  hideLinkColorTable() {
    if (this.ShowGlobalSettingsLinkColorTable) {
      // This was just the initial load (or a code-based hide).
      return;
    }
    if (this.SelectedLinkColorTableTypesVariable != 'Hide') {
      this.SelectedLinkColorTableTypesVariable = 'Hide';
      this.onLinkColorTableChanged();
    }
  }
  /**
   * Called when SelectedColorNodesByVariable (keeps track of what variable to use to color nodes by) is changed.
   */
  onColorNodesByChanged(silent = false) {
    console.log('on color nodes by changed - visible: ', this.GlobalSettingsNodeColorDialogSettings.isVisible);
    this.commonService.GlobalSettingsModel.SelectedColorNodesByVariable = this.SelectedColorNodesByVariable;
    if (!this.GlobalSettingsNodeColorDialogSettings.isVisible) {
      console.log('on color nodes by changed - visible: ', this.SelectedColorNodesByVariable);
      // TODO::David you added  "&& this.checkActiveView('node')" below which makes it not dispaly in twoD network
      if (this.SelectedColorNodesByVariable != "None") {
        this.SelectedNodeColorTableTypesVariable = 'Show';
        this.GlobalSettingsNodeColorDialogSettings.setVisibility(true);
        this.cachedGlobalSettingsNodeColorVisibility = this.GlobalSettingsNodeColorDialogSettings.isVisible;
        const prevColorNodesByVariable = this.SelectedColorNodesByVariable;
        // this reset to false to trigger showing the node color table
        this.ShowGlobalSettingsNodeColorTable = false;
        // this detect changes leads to SelectedColorNodesByVariable being set to default value when loading MT files that have both 2D and map view
        this.cdref.detectChanges();
        if (prevColorNodesByVariable != this.SelectedColorNodesByVariable) this.SelectedColorNodesByVariable = prevColorNodesByVariable;
      }
    }
    this.commonService.session.style.widgets["node-color-variable"] = this.SelectedColorNodesByVariable;
    console.log('on color nodes by changed5 - visible: ', this.SelectedColorNodesByVariable);
    if (this.commonService.session.data.nodes.length === 0) {
      return;
    }
    console.log('on color nodes by changed6 - visible: ', this.ShowGlobalSettingsNodeColorTable);
    if (this.SelectedColorNodesByVariable !== "None") {
      this.ShowGlobalSettingsNodeColorTable = true;
      this.generateNodeColorTable("#node-color-table");
      $('#node-color-value-row').slideUp();
      //If hidden by default, unhide to perform slide up and down
      if (!this.ShowGlobalSettingsNodeColorTable) {
        const element = this.el.nativeElement.querySelector('#node-color-table');
        this.commonService.setNodeTableElement(element);
        this.ShowGlobalSettingsNodeColorTable = true;
      } else {
        $('#node-color-table-row').slideDown();
      }
      console.log('--- onColorNodesByChanged called');
      // if not loading all settings at once, update node colors
      if (!silent) {
        this.publishUpdateNodeColors();
      }
      // if color nodes by equals None, then hide node color table
    } else {
      $('#node-color-table').empty();
      $('#node-color-value-row').slideDown();
      $('#node-color-table-row').slideUp();
      this.SelectedNodeColorTableTypesVariable = 'Hide';
      this.onNodeColorTableChanged(silent);
      if (!silent) {
        this.publishUpdateNodeColors();
      }
      this.exportTables['node-color'] = false;
    }
  }
  generateNodeColorTable(tableId, isEditable = true) {
    const nodeColorTable = $(tableId).empty().append("<tr>" + "<th class='p-1 table-header-row'><div class='header-content'><span contenteditable>Node " + this.commonService.titleize(this.SelectedColorNodesByVariable) + "</span><a class='sort-button' style='cursor: pointer'></a></div></th>" + `<th class='table-header-row tableCount' ${this.widgets['node-color-table-counts'] ? "" : "style='display: none'"}><div class='header-content'><span contenteditable>Count</span><a class='sort-button' style='cursor: pointer'></a></div></th>` + `<th class='table-header-row tableFrequency' ${this.widgets['node-color-table-frequencies'] ? "" : "style='display: none'"}><div class='header-content'><span contenteditable>Frequency</span><a class='sort-button' style='cursor: pointer'></a></div></th>` + "<th>Color</th>" + "</tr>");
    if (!this.commonService.session.style.nodeValueNames) this.commonService.session.style.nodeValueNames = {};
    const aggregates = this.commonService.createNodeColorMap();
    const vnodes = this.commonService.getVisibleNodes();
    const aggregateValues = Object.keys(aggregates);
    const disabled = isEditable ? '' : 'disabled';
    aggregateValues.forEach((value, i) => {
      if (aggregates[value] < 1) return;
      const color = this.commonService.temp.style.nodeColorMap(value);
      const colorinput = $(`<input type="color" value="${color}" ${disabled}>`).on("change", e => {
        // need to update the value in the dom which is used when exportings
        e.currentTarget.attributes[1].value = e.target['value'];
        if (this.commonService.debugMode) {
          console.log('color: ', this.SelectedColorNodesByVariable);
          console.log('color2: ', this.commonService.session.style.nodeColorsTableKeys);
        }
        let key = this.commonService.session.style.nodeColorsTableKeys[this.SelectedColorNodesByVariable].findIndex(k => k === value);
        this.commonService.session.style.nodeColorsTable[this.SelectedColorNodesByVariable].splice(key, 1, e);
        // Update history with new color
        this.commonService.session.style.nodeColorsTableHistory[this.commonService.session.style.nodeColorsTableKeys[this.SelectedColorNodesByVariable][key]] = e;
        //if (this.commonService.session.style.widgets["node-timeline-variable"] == 'None') {
        // Update table with new alpha value
        // Need to get value from id since "this" keyword is used by angular
        this.commonService.session.style.nodeColors.splice(i, 1, e.target['value']);
        this.commonService.temp.style.nodeColorMap = d3__WEBPACK_IMPORTED_MODULE_4__.scaleOrdinal(this.commonService.session.style.nodeColors).domain(aggregateValues);
        // temp.style.nodeColorMap = d3
        // .scaleOrdinal(session.style.nodeColorsTable[variable])
        // .domain(session.style.nodeColorsTableKeys[variable]);
        // } else {
        //     let temKey = this.commonService.temp.style.nodeColorKeys.findIndex( k => k === value);
        //     this.commonService.temp.style.nodeColor.splice(temKey, 1, e);
        //     this.commonService.temp.style.nodeColorMap = d3
        //         .scaleOrdinal(this.commonService.temp.style.nodeColor)
        //         .domain(this.commonService.temp.style.nodeColorKeys);
        // }
        this.publishUpdateNodeColors();
      });
      const alphainput = $(`<a class="transparency-symbol"></a>`).on("click", e => {
        $("#color-transparency-wrapper").css({
          top: e.clientY + 129,
          left: e.clientX,
          display: "block"
        });
        $("#color-transparency").val(this.commonService.session.style.nodeAlphas[i]).one("change", f => {
          // Update table with new alpha value
          // Need to get value from id since "this" keyword is used by angular
          this.commonService.session.style.nodeAlphas.splice(i, 1, parseFloat(f.target['value']));
          this.commonService.temp.style.nodeAlphaMap = d3__WEBPACK_IMPORTED_MODULE_4__.scaleOrdinal(this.commonService.session.style.nodeAlphas).domain(aggregateValues);
          this.publishUpdateNodeColors();
          $("#color-transparency-wrapper").fadeOut();
        });
      });
      const nonEditCell = `<td style="background-color:${color}"></td>`;
      const cell = $("<td></td>").append(colorinput).append(alphainput);
      const row = $("<tr>" + "<td data-value='" + value + "'>" + (this.commonService.session.style.nodeValueNames[value] ? this.commonService.session.style.nodeValueNames[value] : this.commonService.titleize("" + value)) + "</td>" + `<td class='tableCount' ${this.widgets['node-color-table-counts'] ? "" : "style='display: none'"}>` + aggregates[value] + "</td>" + `<td class='tableFrequency' ${this.widgets['node-color-table-frequencies'] ? "" : "style='display: none'"}>` + (aggregates[value] / vnodes.length).toLocaleString() + "</td>" + "</tr>").append(isEditable ? cell : nonEditCell);
      nodeColorTable.append(row);
    });
    if (isEditable) {
      nodeColorTable.find("td.rowName").on("dblclick", function () {
        $(this).attr("contenteditable", "true").focus();
      }).on("focusout", () => {
        const $this = $(this);
        $this.attr("contenteditable", "false");
        //this.commonService.session.style.nodeValueNames[$this.data("value")] = $this.find("input").value;
      });
    }
    this.updateCountFreqTable('node-color');
    $('#nodeColorTableSettings').on('mouseleave', () => $('#nodeColorTableSettings').delay(500).css('display', 'none'));
    $(tableId).on('click', '.sort-button', function () {
      const table = $(this).parents('table').eq(0);
      let rows = table.find('tr:gt(0)').toArray().sort(comparer($(this).parent().parent().index()));
      this.asc = !this.asc; // using property 'asc' on DOM object instead of jQuery data function
      if (!this.asc) {
        rows = rows.reverse();
      }
      for (let i = 0; i < rows.length; i++) {
        table.append(rows[i]);
      }
    });
    function comparer(index) {
      return function (a, b) {
        const valA = getCellValue(a, index),
          valB = getCellValue(b, index);
        return !isNaN(Number(valA)) && !isNaN(Number(valB)) ? Number(valA) - Number(valB) : valA.toString().localeCompare(valB);
      };
    }
    function getCellValue(row, index) {
      return $(row).children('td').eq(index).text();
    }
  }
  /**
   * Toggles the setting menu for node-color or link-color table. This menu allow users to show/hide counts and/or frequencies
   * @param tableName 'node-color' or 'link-color'
   */
  toggleColorTableSettings(tableName) {
    let settingsPane;
    if (tableName == 'node-color') {
      settingsPane = $('#nodeColorTableSettings');
    } else if (tableName == 'link-color') {
      settingsPane = $('#linkColorTableSettings');
    } else {
      return;
    }
    if (settingsPane.css('display') == 'none') {
      settingsPane.css('display', 'block');
    } else {
      settingsPane.css('display', 'none');
    }
  }
  /**
   * Updates the appropriate widget value and then updates the node-color or link-color table
   * @param table 'node-color' or 'link-color'
   * @param column 'tableCouts' or 'tableFreq'
   */
  toggleColorTableColumns(table, column) {
    if (table == 'node-color' && column == 'tableCounts') {
      this.widgets['node-color-table-counts'] = !this.widgets['node-color-table-counts'];
    } else if (table == 'node-color' && column == 'tableFreq') {
      this.widgets['node-color-table-frequencies'] = !this.widgets['node-color-table-frequencies'];
    } else if (table == 'link-color' && column == 'tableCounts') {
      this.widgets['link-color-table-counts'] = !this.widgets['link-color-table-counts'];
    } else if (table == 'link-color' && column == 'tableFreq') {
      this.widgets['link-color-table-frequencies'] = !this.widgets['link-color-table-frequencies'];
    } else {
      return;
    }
    this.updateCountFreqTable(table);
  }
  /**
   * Updates the node-color-table or link-color-table based on value of widgets; it doesn't recalculate anything; just shows/hide columns
   * @param tableName 'node-color' or 'link-color'
   */
  updateCountFreqTable(tableName) {
    let tableReferenceName, showCount, showFreq;
    if (tableName == 'node-color') {
      tableReferenceName = '#global-settings-node-color-table';
      showCount = this.widgets['node-color-table-counts'];
      showFreq = this.widgets['node-color-table-frequencies'];
    } else if (tableName == 'link-color') {
      tableReferenceName = '#global-settings-link-color-table';
      showCount = this.widgets['link-color-table-counts'];
      showFreq = this.widgets['link-color-table-frequencies'];
    }
    const countColumn = $(tableReferenceName + ' .tableCount');
    const freqColumn = $(tableReferenceName + ' .tableFrequency');
    showCount ? countColumn.slideDown() : countColumn.slideUp();
    showFreq ? freqColumn.slideDown() : freqColumn.slideUp();
  }
  /**
   * Updated link-threshold widget and this.threshold variable. Sets mst-computed widget to false.
   * Updates clusters and cluster visibility, link visibility, and node visibility. Finallys updates
   * visualizations and stastistics
   */
  onLinkThresholdChanged(newThreshold, silent = false) {
    if (this.commonService.session.data.nodes.length === 0) {
      return;
    }
    if (newThreshold !== undefined) {
      // Update the style widget
      this.commonService.session.style.widgets["link-threshold"] = newThreshold;
    }
    // Determine the new threshold
    const parsedThreshold = newThreshold !== undefined ? parseFloat(newThreshold.toString()) : parseFloat(this.SelectedLinkThresholdVariable);
    // Only update if the threshold is different
    // if (parsedThreshold === this._lastLinkThreshold && this.commonService.session.network.isFullyLoaded) {
    // console.log("Threshold unchanged; skipping full network update.");
    // return;
    // }
    //debugger;
    // If a new threshold is provided, update the SelectedLinkThresholdVariable
    if (newThreshold) {
      this.SelectedLinkThresholdVariable = newThreshold;
    }
    this._lastLinkThreshold = this.SelectedLinkThresholdVariable;
    this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable = this.SelectedLinkThresholdVariable;
    this.commonService.session.style.widgets["link-threshold"] = parseFloat(this.SelectedLinkThresholdVariable);
    this.threshold = this.SelectedLinkThresholdVariable;
    // const minClust = $("#cluster-minimum-size").val();
    // Unset MST construction since links might have been changed
    this.commonService.session.style.widgets["mst-computed"] = false;
    console.log('min clust is: ', this.commonService.session.style.widgets["cluster-minimum-size"]);
    if (this.commonService.session.style.widgets["cluster-minimum-size"] !== 1) {
      if (this.commonService.debugMode) {
        console.log('reseting min clust');
      }
      $("#cluster-minimum-size").val("1");
      $("#cluster-minimum-size").trigger("change");
      $("#cluster-minimum-size").val(this.commonService.session.style.widgets["cluster-minimum-size"]);
      $("#cluster-minimum-size").trigger("change");
    }
    console.log('onLinkThresholdChanged called 2');
    if (!silent) {
      // Immediately hide links
      this.commonService.setLinkVisibility(false, false);
      console.log('tagClusters called link threshold change');
      // Now schedule the heavy update (tag clusters, update visibilities, stats) using debouncing
      this.commonService.updateNetworkVisuals();
    }
  }
  revealClicked() {
    $("#cluster-minimum-size").val(1);
    this.commonService.session.style.widgets["cluster-minimum-size"] = 1;
    $("#filtering-wrapper").slideDown();
    this.commonService.setClusterVisibility(true);
    this.commonService.setNodeVisibility(true);
    //To catch links that should be filtered out based on cluster size:
    this.commonService.setLinkVisibility(true);
    //Because the network isn't robust to the order in which these operations
    //take place, we just do them all silently and then react as though we did
    //them each after all of them are already done.
    this.GlobalSettingsLinkColorDialogSettings.isVisible = true;
    this.GlobalSettingsNodeColorDialogSettings.isVisible = true;
    this.store.setNetworkUpdated(true);
    // this.updatedVisualization();
    this.commonService.updateStatistics();
  }
  updateGlobalSettingsModel() {
    this.commonService.GlobalSettingsModel.SelectedRevealTypesVariable = this.SelectedRevealTypesVariable;
    // TODO: See if we need to flip these now since the service should override these local settings
    this.SelectedDistanceMetricVariable = this.commonService.session.style.widgets['default-distance-metric'];
    this.SelectedLinkThresholdVariable = this.commonService.session.style.widgets['link-threshold'];
    this.commonService.GlobalSettingsModel.SelectedNodeColorVariable = this.SelectedNodeColorVariable;
    this.commonService.session.style.widgets['node-color'] = this.SelectedNodeColorVariable;
    this.commonService.session.style.widgets['link-color'] = this.SelectedLinkColorVariable;
    this.commonService.session.style.widgets['node-color-variable'] = this.SelectedColorNodesByVariable;
    this.commonService.session.style.widgets['link-threshold-variable'] = this.SelectedDistanceMetricVariable;
    //this.commonService.session.style.widgets['node-color-variable'] = this.SelectedNodeColorVariable;
    // TODO: Removed, see if this is still necessary
    // this.commonService.session.style.widgets['link-tooltip-variable'] = this.SelectedColorLinksByVariable;
    this.commonService.GlobalSettingsModel.SelectedColorVariable = this.SelectedColorVariable;
    this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable = this.SelectedLinkThresholdVariable;
    this.commonService.GlobalSettingsModel.SelectedDistanceMetricVariable = this.SelectedDistanceMetricVariable;
    this.commonService.session.style.widgets['selected-color'] = this.SelectedColorVariable;
    this.commonService.session.style.widgets['selected-node-stroke-color'] = this.SelectedColorVariable;
    // TODO: 
    // if (this.commonService.visuals.phylogenetic) {
    //   this.commonService.visuals.phylogenetic.updateNodeColors();
    // }
    this.commonService.GlobalSettingsModel.SelectedBackgroundColorVariable = this.SelectedBackgroundColorVariable;
    this.commonService.session.style.widgets['background-color'] = this.SelectedBackgroundColorVariable;
    this.commonService.GlobalSettingsModel.SelectedApplyStyleVariable = this.SelectedApplyStyleVariable;
    this.ShowGlobalSettingsLinkColorTable = this.GlobalSettingsLinkColorDialogSettings.isVisible;
    console.log('3 this.ShowGlobalSettingsLinkColorTable: ', this.ShowGlobalSettingsLinkColorTable);
    console.log('4 this.ShowGlobalSettingsLinkColorTable: ', this.GlobalSettingsLinkColorDialogSettings.isVisible);
    // print out #global-settings-link-color-table element
    console.log('xy link color table 3: ', $('#link-color-table'));
  }
  /**
   * this.publishUpdateVisualization()
   *
   * XXXXX may need to be updated or trimmed (switch statement has no functionality) XXXXX
   */
  updatedVisualization() {
    console.log('updatedVisualization called');
    this.publishUpdateVisualization();
  }
  getGlobalSettingsData() {
    console.log('--- getGlobalSettingsData called');
    this.FieldList = [];
    this.FieldList.push({
      label: "None",
      value: "None"
    });
    this.commonService.session.data['nodeFields'].map((d, i) => {
      this.FieldList.push({
        label: this.commonService.capitalize(d.replace("_", "")),
        value: d
      });
    });
    this.ToolTipFieldList = [];
    this.ToolTipFieldList.push({
      label: "None",
      value: "None"
    });
    this.commonService.session.data['linkFields'].map((d, i) => {
      this.ToolTipFieldList.push({
        label: this.commonService.capitalize(d.replace("_", "")),
        value: d
      });
    });
    this.SelectedLinkSortVariable = this.commonService.GlobalSettingsModel.SelectedLinkSortVariable;
    //this.commonService.updateThresholdHistogram();
    console.log('--- getGlobalSettingsData end - last of loadDefaultVisualization in MT');
  }
  /**
   * XXXXX move XXXXX
   */
  ngAfterViewInit() {
    // let factory = this.cfr.resolveComponentFactory(FilesComponent);
    // this.cmpRef = this.targets.first.createComponent(factory);
    // setTimeout(() => {
    this._goldenLayoutHostComponent.initialise();
    // headerHeight (tab) is updated so that goldenLayout knows what the css is set to. 
    this._goldenLayoutHostComponent['_goldenLayout.layoutConfig.dimensions.headerHeight'] = 36;
    this.addComponent('Files');
    if (this.auspiceUrlVal) {
      if (this.commonService.debugMode) {
        console.log("Trying to open URL");
      }
      this.DisplayUrlDialog("Open");
      this.continueClicked();
      this.displayUrlDialog = false;
      //this.displayMTDialog = true;
      // this.DisplayMTDialog("Open");
      /**
      this.commonService.openAuspiceUrl(this.auspiceUrlVal)
      .then( (out) => {
      if (out['meta'] && out['tree']) {
        const auspiceFile = { contents: out, name: this.getAuspiceName(this.auspiceUrlVal), extension: 'json'};
        this.commonService.session.files.push(auspiceFile);
        this.prepareFilesLists(auspiceFile);
        console.log(out);
      //   console.log(this.homepageTabs[0].componentRef);
          // this.goldenLayout.componentInstances[0].addToTable(auspiceFile);
        this.homepageTabs[0].componentRef.addToTable(auspiceFile);
        this.homepageTabs[0].isActive = true;
      } else {
        console.log("This isn't a valid Auspice JSON file");
      }
      });
      */
    }
    // Subscribe to the files view to see when its time to load the visualization
    this.subscription = this.homepageTabs[0].componentRef.instance.LoadDefaultVisualizationEvent.subscribe(v => {
      // if(this.commonService.debugMode) {
      //     console.log('--- INIT Homepage [0] LoadDefaultloading default: ', this.homepageTabs[0].componentRef.instance, v);
      // }
      if (this.commonService.debugMode) {
        console.log('init Files Load Default subscription-: ', this.homepageTabs[0].componentRef.instance);
      }
      this.loadDefaultVisualization(v);
      this.publishLoadNewData();
      this.getGlobalSettingsData();
    });
    this._goldenLayoutHostComponent.TabRemovedEvent.subscribe(v => {
      // this.loadSettings();
      this.removeComponent(v);
    });
    this._goldenLayoutHostComponent.TabChangedEvent.subscribe(v => {
      this.commonService.activeTab = v;
      console.log('tab changed settigns viz: ', v);
      // If network is not even renered yet, no need ot update these values
      if (!this.networkRendered) {
        return;
      }
      if (v === "Files" || v === "Epi Curve" || v === "Alignment View" || v === "Table" || v === "Crosstab" || v === "Aggregate" || v === "Heatmap" || v === "Gantt Chart" || v === "Waterfall") {
        this.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
        this.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
      } else {
        if (this.SelectedColorNodesByVariable == 'None') {
          this.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
        } else {
          this.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
          this.GlobalSettingsNodeColorDialogSettings.setVisibility(true);
        }
        if (this.SelectedColorLinksByVariable == 'None' || v === "Phylogenetic Tree" || v == 'Bubble') {
          this.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
        } else {
          this.GlobalSettingsLinkColorDialogSettings.setVisibility(true);
        }
      }
      if (this.GlobalSettingsNodeColorDialogSettings.isVisible && this.SelectedNodeColorTableTypesVariable == 'Hide') {
        this.SelectedNodeColorTableTypesVariable = 'Show';
      } else if (!this.GlobalSettingsNodeColorDialogSettings.isVisible && this.SelectedNodeColorTableTypesVariable == 'Show') {
        this.SelectedNodeColorTableTypesVariable = 'Hide';
      }
      if (this.GlobalSettingsLinkColorDialogSettings.isVisible && this.SelectedLinkColorTableTypesVariable == 'Hide') {
        this.SelectedLinkColorTableTypesVariable = 'Show';
      } else if (!this.GlobalSettingsLinkColorDialogSettings.isVisible && this.SelectedLinkColorTableTypesVariable == 'Show') {
        this.SelectedLinkColorTableTypesVariable = 'Hide';
      }
      console.log('linktable vis - false tab changed: ', this.GlobalSettingsLinkColorDialogSettings.isVisible);
    });
    this.store.updatecurrentThresholdStepSize(this.SelectedDistanceMetricVariable);
    console.log('tab changed end: ');
  }
  _removeGlView(view) {
    console.log(`Removing ${view}`);
    this._goldenLayoutHostComponent.removeComponent(view);
    this.removeComponent(view);
  }
  convertToCSV(objArray) {
    const tmpArray = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
    let str = '';
    let headerLoaded = false;
    let line = '';
    for (let i = 0; i < tmpArray.length; i++) {
      line = '';
      if (headerLoaded == false) {
        for (const index1 in tmpArray[i]) {
          if (line != '') line = line.toString() + ',';
          line = line.toString() + index1.toString().replace(/\r/g, '').replace(/\n/g, '').trim();
        }
        str = str.toString() + line.toString() + '\r\n';
        headerLoaded = true;
      }
      line = '';
      for (const index2 in tmpArray[i]) {
        if (line != '') line = line.toString() + ',';
        line = line.toString() + tmpArray[i][index2].toString();
      }
      if (line != "") {
        str = str.toString() + line.toString().replace(/\r/g, '').replace(/\r/g, '').trim() + (i == tmpArray.length - 1 ? '' : '\r\n');
      }
    }
    return str;
  }
  officialInstance() {
    const prodVal = RegExp(/https:\/\/microbetrace.cdc.gov\/MicrobeTrace/);
    const devVal = RegExp(/https:\/\/cdcgov.github.io\/MicrobeTrace/);
    const localVal = RegExp(/localhost/);
    if (prodVal.test(this.currentUrl) || devVal.test(this.currentUrl) || localVal.test(this.currentUrl)) {
      return true;
    }
  }
  getHeight() {
    const timelineHeight = this.commonService.session.style.widgets["timeline-date-field"] == 'None' ? 0 : 150;
    if (this.officialInstance()) {
      return window.innerHeight - 80 - timelineHeight;
    } else {
      const warningHeight = $('#url-warning-div').height();
      return window.innerHeight - 80 - warningHeight - timelineHeight;
    }
  }
  showSpinner() {
    this.spinnerDivElement.nativeElement.style.display = "block";
    this.spinnerElement.nativeElement.style.display = "block";
  }
  hideSpinner() {
    this.spinnerDivElement.nativeElement.style.display = "none";
    this.spinnerElement.nativeElement.style.display = "none";
  }
  loadDefaultVisualization(e) {
    console.log('--- Load Default Visualization called - reset layout ', e);
    e = e.replace("_", " ");
    if (e === "2d network") {
      e = "2D Network";
    }
    this.resetLayout();
    // TODO:: see if timeout needed
    // setTimeout(() => {
    if (this.homepageTabs.findIndex(x => x.label == e) === -1) {
      console.log('--- Load Default Visualization end - view click');
      this.Viewclick(e);
    }
    // }, 500);
  }
  resetLayout() {
    this.homepageTabs.forEach(tab => {
      if (tab.label !== "Files") {
        console.group('removing: ', tab.label);
        this._removeGlView(tab.label);
      }
    });
    this.activeTabIndex = 0;
  }
  getfileContent(fileList) {
    // Loading new data so setting network rendered to false
    this.networkRendered = false;
    this.GlobalSettingsDialogSettings.setVisibility(false);
    this.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
    console.log('link table vis - false get file content');
    this.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
    if (this.commonService.debugMode) {
      console.log('GetFile Ontent Called');
    }
    // TODO: unccomment back when updated
    // this.srv.removeTab(0,1);
    //remove last homepage tab
    // this.homepageTabs.splice(this.homepageTabs.length - 1, 1);
    // console.log('homepagetabs: ', this.homepageTabs);
    // this.goldenLayout.componentInstances[0].processFiles(fileList)
    this.homepageTabs.map(x => {
      if (x.label === "Files") {
        if (x.componentRef != null) {
          // Unsubscribe from previous files view subscription in get file contents
          this.subscription.unsubscribe();
          this.subscription = this.homepageTabs[0].componentRef.instance.LoadDefaultVisualizationEvent.subscribe(v => {
            console.log('--- Files loading default from subscription: ');
            // this.loadSettings();
            this.loadDefaultVisualization(v);
            this.publishLoadNewData();
          });
          // Process files in the files view
          x.componentRef.instance.processFiles(fileList);
          // Populate table
          x.componentRef.instance.populateTable();
        }
      }
    });
  }
  getSinglefileContent(file) {
    // this.goldenLayout.componentInstances[0].processFile(file);
    this.homepageTabs.map(x => {
      if (x.label === "Files") {
        if (x.componentRef != null) {
          x.componentRef.processFile(file);
          //TODO does this need instance?
        }
      }
    });
  }
  DisplayHelp() {
    window.open("https://github.com/CDCgov/MicrobeTrace/wiki");
  }
  DisplayAbout() {
    this.displayAbout = !this.displayAbout;
  }
  OpenExportDashboard() {
    this.showExportDashboardMenu = true;
    this.updateExportResolution();
  }
  OpenExportTables() {
    this.showExportTablesMenu = true;
  }
  ExportDashboard() {
    // Prepare export options
    const exportOptions = {
      filename: this.ExportDashboardFilename,
      filetype: 'png',
      scale: this.ExportDashboardScale,
      quality: 1
    };
    // Set export options in the service
    this.exportService.setExportOptions(exportOptions);
    // Request export
    this.performExport();
    this.showExportDashboardMenu = false;
  }
  ExportTables() {
    const exportOptions = {
      filename: this.ExportTablesFilename,
      filetype: this.ExportTablesFileType,
      scale: this.ExportTablesScale,
      quality: 1
    };
    this.exportService.setExportOptions(exportOptions);
    let elementsToExport = [];
    if (this.exportTables['node-symbol']) {
      let nodeSymbolTable = $('#nodeSymbolTable')[0];
      elementsToExport.push(nodeSymbolTable);
      console.log(nodeSymbolTable, elementsToExport);
    }
    if (this.exportTables['polygon-color']) {
      let polygonTable = $('#polygon-color-table')[0];
      elementsToExport.push(polygonTable);
    }
    if (elementsToExport.length == 0 && this.exportTables['node-color'] == false && this.exportTables['link-color'] == false) {
      console.log('nothing to export');
      return;
    }
    if (this.ExportTablesFileType == 'svg') {
      this.performExportSVG(elementsToExport, '', this.exportTables['node-color'], this.exportTables['link-color']);
    } else {
      this.performExport(elementsToExport, this.exportTables['node-color'], this.exportTables['link-color']);
    }
  }
  updateExportResolution() {
    const visualWrapper = this.visualWrapperRef.nativeElement;
    console.log(visualWrapper);
    let height = visualWrapper.offsetHeight;
    let width = visualWrapper.offsetWidth;
    this.ExportDashboardResolution.width = Math.floor(width * this.ExportDashboardScale);
    this.ExportDashboardResolution.height = Math.floor(height * this.ExportDashboardScale);
    this.ExportDashboardResolution.summary = `${this.ExportDashboardResolution.width} x ${this.ExportDashboardResolution.height}`;
  }
  clusterSaveClick() {}
  DisplayStashDialog(saveStash) {
    switch (saveStash) {
      case "Save":
        {
          if (this.selectedSaveFileType == 'style') {
            const data = JSON.stringify(this.commonService.session.style);
            const blob = new Blob([data], {
              type: "application/json;charset=utf-8"
            });
            file_saver__WEBPACK_IMPORTED_MODULE_8__(blob, this.saveFileName + '.style');
            return;
          }
          const zip = new (jszip__WEBPACK_IMPORTED_MODULE_12___default())();
          const lightTabs = this.homepageTabs.map(x => {
            return {
              label: x.label,
              tabTitle: x.tabTitle,
              isActive: x.isActive,
              componentRef: undefined,
              templateRef: undefined
            };
          });
          if (this.saveByCluster) {
            const clusterNodeList = [];
            const clusterLinkList = [];
            const singletonNodeList = [];
            const dyadNodeList = [];
            const dyadEdgeList = [];
            const nodes = this.commonService.session.data.nodes;
            const links = this.commonService.session.data.links;
            this.commonService.session.data.clusters.forEach(cluster => {
              const clusterNodes = nodes.filter(node => node.cluster === cluster.id);
              const clusterLinks = links.filter(link => link.cluster === cluster.id);
              // We have a singleton - all singletons go into one file
              if (clusterNodes.length == 1) {
                singletonNodeList.push(clusterNodes[0]);
                // We have a dyad - all dyads go into one file
              } else if (clusterNodes.length == 2) {
                // Add both nodes
                dyadNodeList.push(clusterNodes[0]);
                dyadNodeList.push(clusterNodes[1]);
                // Add the single link
                dyadEdgeList.push(clusterLinks[0]);
                // We have a cluster
              } else {
                // Add array object of nodes with matching cluster
                clusterNodeList.push(clusterNodes);
                // Add array object of links with matching cluster
                clusterLinkList.push(clusterLinks);
              }
            });
            let singletonFolder = null;
            let dyadFolder = null;
            for (let i = 0; i < this.commonService.session.data.clusters.length; i++) {
              const currentCluster = this.commonService.session.data.clusters[i];
              const cluster = clusterNodeList.filter(nodeList => nodeList[0].cluster == currentCluster.id);
              // Check if cluster is in clusterNodesList
              if (cluster.length > 0) {
                // Create cluster folder
                const clusterFolder = zip.folder("cluster-" + cluster[0][0].cluster);
                // If node and edge lists exists, add them to the current folder
                const clusterNode = clusterNodeList.filter(NodeList => NodeList[0].cluster == currentCluster.id);
                if (clusterNode) {
                  const blob = new Blob([papaparse__WEBPACK_IMPORTED_MODULE_11__.unparse(cluster[0])], {
                    type: 'text/csv;charset=utf-8'
                  });
                  clusterFolder.file("nodeList_cluster_" + cluster[0][0].cluster + ".csv", blob);
                  // Now get link list of cluster
                  const clusterLink = clusterLinkList.filter(LinkList => LinkList[0].cluster == currentCluster.id);
                  if (clusterLink) {
                    const blob = new Blob([papaparse__WEBPACK_IMPORTED_MODULE_11__.unparse(clusterLink[0])], {
                      type: 'text/csv;charset=utf-8'
                    });
                    clusterFolder.file("edgeList_cluster_" + cluster[0][0].cluster + ".csv", blob);
                  }
                }
              }
            }
            if (dyadNodeList.length > 0) {
              dyadFolder = zip.folder("dyads");
              // Add all dyads in one shot
              const nodesBlob = new Blob([papaparse__WEBPACK_IMPORTED_MODULE_11__.unparse(dyadNodeList)], {
                type: 'text/csv;charset=utf-8'
              });
              dyadFolder.file("nodeList_cluster.csv", nodesBlob);
              const edgesBlob = new Blob([papaparse__WEBPACK_IMPORTED_MODULE_11__.unparse(dyadEdgeList)], {
                type: 'text/csv;charset=utf-8'
              });
              dyadFolder.file("edgeList_cluster.csv", edgesBlob);
            }
            if (singletonNodeList.length > 0) {
              singletonFolder = zip.folder("singletons");
              // Add all singletons in one shot
              const blob = new Blob([papaparse__WEBPACK_IMPORTED_MODULE_11__.unparse(singletonNodeList)], {
                type: 'text/csv;charset=utf-8'
              });
              singletonFolder.file("nodeList_cluster.csv", blob);
            }
            const that = this;
            // generate zip repsetnation in memory
            zip.generateAsync({
              type: "blob"
            }).then(function (content) {
              // see FileSaver.js
              file_saver__WEBPACK_IMPORTED_MODULE_8__(content, `${that.saveFileName}.zip`);
            });
          } else {
            this.commonService.session.files.forEach(file => {
              if (file.extension == 'xlsx' || file.extension == 'xls') {
                this.convertFileToCSV(file);
              }
            });
            const stash = {
              session: this.commonService.session,
              tabs: lightTabs
            };
            const that = this;
            if ($("#save-file-compress").is(":checked")) {
              const zip = new (jszip__WEBPACK_IMPORTED_MODULE_12___default())();
              zip.file(`${that.saveFileName}.microbetrace`, new Blob([JSON.stringify(stash)], {
                type: "application/json;charset=utf-8"
              }));
              zip.generateAsync({
                type: "blob",
                compression: "DEFLATE",
                compressionOptions: {
                  level: 9
                }
              }).then(content => file_saver__WEBPACK_IMPORTED_MODULE_8__(content, `${that.saveFileName}.zip`));
            } else {
              const blob = new Blob([JSON.stringify(stash)], {
                type: "application/json;charset=utf-8"
              });
              file_saver__WEBPACK_IMPORTED_MODULE_8__(blob, `${this.saveFileName}.microbetrace`);
            }
          }
          break;
        }
      case "Cancel":
        {
          break;
        }
    }
    this.displayStashDialog = !this.displayStashDialog;
  }
  /**
   * Converts an excel file array buffer to a CSV string use when exporting
   * @param file excel file in commonService.session.files
   */
  convertFileToCSV(file) {
    if (file.extension == 'xlsx' || file.extension == 'xls') {
      let x = new Uint8Array(file.contents);
      let workbook = xlsx__WEBPACK_IMPORTED_MODULE_21__.read(x, {
        type: 'array'
      });
      let csvString = xlsx__WEBPACK_IMPORTED_MODULE_21__.utils.sheet_to_csv(workbook.Sheets[workbook.SheetNames[0]]);
      file.extension = 'csv';
      file.name = file.name.replace('.xlsx', '.csv').replace('.xls', '.csv');
      file.contents = csvString;
      file.type = "text/csv";
    }
  }
  getAuspiceName(url) {
    const split = url.split('=');
    console.log(split);
    const nameParts = split.length > 1 ? split[1].split('/') : split[0].split('/');
    return nameParts.join('_');
    return 'auspice_import_via_url';
  }
  DisplayUrlDialog(saveUrl) {
    switch (saveUrl) {
      case 'Open':
        {
          const auspiceUrl = this.auspiceUrlVal;
          this.commonService.openAuspiceUrl(auspiceUrl).then(out => {
            if (out['meta'] && out['tree']) {
              console.log(this);
              this.homepageTabs[0].componentRef.instance.removeAllFiles();
              this.commonService.clearData();
              const auspiceFile = {
                contents: out,
                name: this.getAuspiceName(auspiceUrl),
                extension: 'json'
              };
              this.commonService.session.files.push(auspiceFile);
              this.homepageTabs[0].componentRef.instance.addToTable(auspiceFile);
              //   console.log(this.homepageTabs[0].componentRef);
              // this.goldenLayout.componentInstances[0].addToTable(auspiceFile);
              //this.homepageTabs[0].componentRef.addToTable(auspiceFile);
              this.homepageTabs[0].isActive = true;
              console.log("Trying to launch");
              this.homepageTabs[0].componentRef.instance.launchClick();
              $('#overlay').fadeOut();
              $('.ui-tabview-nav').fadeTo("slow", 1);
              $('.m-portlet').fadeTo("slow", 1);
            }
          });
          break;
        }
      case 'Cancel':
        {
          break;
        }
    }
    this.displayUrlDialog = !this.displayUrlDialog;
    if (this.displayUrlDialog) {
      console.log(this.displayUrlDialog);
      this.continueClicked();
    }
  }
  DisplayMTDialog(saveUrl) {
    switch (saveUrl) {
      case 'Open':
        {
          //const auspiceUrl = this.auspiceUrlVal;
          break;
        }
      case 'Cancel':
        {
          break;
        }
    }
    this.displayMTDialog = !this.displayMTDialog;
  }
  ResetTabs() {
    const home = this.homepageTabs.find(x => x.label === "Files");
    home.isActive = true;
    this.homepageTabs = this.homepageTabs.filter(x => home === x);
    this.homepageTabs = [home];
    this.commonService.activeTab = 'Files';
    this.activeTabIndex = 0;
  }
  // Commonet back when implementing stash
  NewSession() {
    // Emit new session event for other components to reset/destroy
    this.commonService.onNewSession();
    this.ResetTabs();
    this.onReloadScreen();
  }
  FileClick(actionName) {
    switch (actionName) {
      case "New Session":
        {
          this.NewSession();
          break;
        }
      case "Stash Session":
        {
          this.stashSession();
          break;
        }
      case "Recall Session":
        {
          // this.DisplayRecallStashDialog("Cancel");
          this.displayRecallStashDialog = true;
          this.updateTable();
          break;
        }
      case "Save Session":
        {
          this.DisplayStashDialog("Cancel");
          break;
        }
      case "Open URL":
        {
          this.DisplayUrlDialog("Cancel");
          break;
        }
      case "Add Data":
        {
          // If files tab exists, go to it
          if (this.homepageTabs.length > 1 && this.homepageTabs.findIndex(x => x.label === "Files") !== -1) {
            this._goldenLayoutHostComponent.focusComponent("Files");
          } else {
            this.addComponent('Files');
          }
          break;
        }
    }
  }
  SettingsClick(actionName) {
    switch (actionName) {
      case "Global Settings":
        {
          console.log('snps settings: ', this.SelectedDistanceMetricVariable);
          this.DisplayGlobalSettingsDialog();
          break;
        }
    }
  }
  stashSession() {
    console.log('sesssion: ', this.commonService.session);
    this.commonService.localStorageService.setItem("stash-" + Date.now() + "-" + $("#stash-name").val(), JSON.stringify(this.commonService.session));
  }
  updateTable() {
    this.table = new tabulator_tables__WEBPACK_IMPORTED_MODULE_22__.Tabulator(this.stashes.nativeElement, {
      height: "100%",
      layout: "fitData",
      selectable: 1,
      columns: [{
        title: "Name",
        field: "name"
      }, {
        title: "Date",
        field: "date",
        align: "right",
        sorter: "date"
      }]
    });
    const rows = [];
    this.commonService.localStorageService.keys().then(keys => {
      keys.forEach(k => {
        if (k.substring(0, 5) !== "stash") return;
        rows.push({
          fullname: k,
          name: k.substring(20),
          date: new Date(parseFloat(k.substring(6, 19))).toISOString()
        });
      });
      this.table.setData(rows);
    });
  }
  // $("#recall-load-stash").on("click", () => {
  //     let key = table.getSelectedData()[0].fullname;
  //     localforage.getItem(key).then(json => {
  //       MT.applySession(JSON.parse(json));
  //       $("#session-recall-modal").modal("hide");
  //     });
  //   });
  Viewclick(viewName) {
    if (this.commonService.debugMode) {
      console.log('--- viewClick: ', viewName);
      console.log(this.commonService.session.style.widgets['link-threshold']);
      console.log('homepage tabs: ', this.homepageTabs);
      console.log('--- polygon color show11: ', this.commonService.session.style.widgets['polygons-color-show']);
    }
    if (viewName == "2d network") {
      viewName = "2D Network";
    }
    const tabNdx = this.homepageTabs.findIndex(x => x.label == viewName);
    /*/
     * Don't allow duplicate tabs to get added.
    /*/
    if (tabNdx == -1) {
      console.log('--- viewClick new view - add component');
      this.activeTabIndex = this.activeTabIndex + 1;
      this.addComponent(viewName);
    } else {
      const container = this._goldenLayoutHostComponent.focusComponent(viewName);
      const instance = this._goldenLayoutHostComponent.getComponentRef(container).instance;
      console.log('--- viewClick exisitng view - load settings');
      //Load global settings changes if changed in another view
      if (instance.loadSettings) {
        instance.loadSettings();
        if (this.metric === 'snps') {
          this.commonService.session.style.widgets['default-distance-metric'] = 'snps';
          this.commonService.session.style.widgets['link-threshold'] = parseInt(this.threshold);
          this.onLinkThresholdChanged();
        }
      }
    }
  }
  DisplayGlobalSettingsDialog(activeTab = "Styling") {
    this.getGlobalSettingsData();
    // TODO: May need to refacor this
    this.updateGlobalSettingsModel();
    this.GlobalSettingsDialogSettings.setVisibility(true);
    this.cachedGlobalSettingsVisibility = this.GlobalSettingsDialogSettings.isVisible;
    this.commonService.updateThresholdHistogram(this.linkThresholdSparkline.nativeElement);
    this.globalSettingsTab.tabs[activeTab === "Styling" ? 1 : 0].active = true;
  }
  WindowClick(actionName) {
    switch (actionName) {
      case "Fullscreen":
        if (this.elem.requestFullscreen) {
          this.elem.requestFullscreen();
        } else if (this.elem.mozRequestFullScreen) {
          /* Firefox */
          this.elem.mozRequestFullScreen();
        } else if (this.elem.webkitRequestFullscreen) {
          /* Chrome, Safari and Opera */
          this.elem.webkitRequestFullscreen();
        } else if (this.elem.msRequestFullscreen) {
          /* IE/Edge */
          this.elem.msRequestFullscreen();
        }
        break;
      case "Reload Screen":
        {
          this.onReloadScreen();
          window.location.reload();
          // this.homepageTabs.forEach(tab => {
          //     if (tab.componentRef &&
          //         tab.componentRef.instance.openRefreshScreen) {
          //         tab.componentRef.instance.openRefreshScreen();
          //     }
          // })
          break;
        }
      case "Settings":
        {
          this.DisplayGlobalSettingsDialog("Filtering");
        }
    }
  }
  HelpClick(actionName) {
    switch (actionName) {
      case "Help":
        {
          this.DisplayHelp();
          break;
        }
      case "Report":
        {
          this.DisplayHelp();
          break;
        }
      case "About":
        {
          this.DisplayAbout();
          break;
        }
    }
  }
  setActiveTabProperties(tabNdx = -1) {
    if (tabNdx === -1) tabNdx = this.homepageTabs.findIndex(x => x.isActive == true);
    const activeComponentName = this.homepageTabs[tabNdx].label;
    this.homepageTabs.forEach(item => {
      item.isActive = item.label === activeComponentName;
    });
    // this.activeTabIndex = tabNdx;
    if (this.commonService.debugMode) {
      console.log('-- set active tab tab switched is: ', tabNdx);
      console.log('global l: ', this.GlobalSettingsLinkColorDialogSettings);
      console.log('global n: ', this.GlobalSettingsNodeColorDialogSettings);
    }
    switch (activeComponentName) {
      case "Files":
        {
          this.showSettings = true;
          this.showExport = false;
          this.showCenter = false;
          this.showPinAllNodes = false;
          this.showRefresh = false;
          this.showButtonGroup = false;
          this.showSorting = false;
          this.cachedGlobalSettingsVisibility = this.GlobalSettingsDialogSettings.isVisible;
          this.cachedGlobalSettingsLinkColorVisibility = this.GlobalSettingsLinkColorDialogSettings.isVisible;
          this.cachedGlobalSettingsNodeColorVisibility = this.GlobalSettingsNodeColorDialogSettings.isVisible;
          // this.GlobalSettingsDialogSettings.setVisibility(false);
          // this.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
          // this.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
          break;
        }
      case "2D Network":
        {
          this.showSettings = true;
          this.showExport = true;
          this.showCenter = true;
          this.showPinAllNodes = true;
          this.showRefresh = false;
          this.showButtonGroup = false;
          this.showSorting = false;
          break;
        }
      case "Table":
        {
          this.showSettings = false;
          this.showExport = true;
          this.showCenter = false;
          this.showPinAllNodes = false;
          this.showRefresh = false;
          this.showButtonGroup = true;
          this.showSorting = true;
          // this.GlobalSettingsDialogSettings.setVisibility(false);
          this.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
          this.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
          break;
        }
      case "Map":
        {
          this.showSettings = true;
          this.showExport = true;
          this.showCenter = true;
          this.showPinAllNodes = false;
          this.showRefresh = false;
          this.showButtonGroup = false;
          this.showSorting = false;
          // this.GlobalSettingsDialogSettings.setVisibility(false);
          //this.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
          this.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
          break;
        }
      case "Phylogenetic Tree":
        {
          this.showSettings = true;
          this.showExport = true;
          this.showCenter = true;
          this.showPinAllNodes = false;
          this.showRefresh = false;
          this.showButtonGroup = false;
          this.showSorting = false;
          // this.GlobalSettingsDialogSettings.setVisibility(false);
          this.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
          this.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
          break;
        }
    }
    if (!this.homepageTabs[tabNdx].componentRef) {
      setTimeout(() => {
        tabNdx = this.homepageTabs.findIndex(x => x.label == activeComponentName);
        if (this.homepageTabs[tabNdx].componentRef.instance.DisplayGlobalSettingsDialogEvent) {
          this.homepageTabs[tabNdx].componentRef.instance.DisplayGlobalSettingsDialogEvent.subscribe(v => {
            this.DisplayGlobalSettingsDialog(v);
          });
        }
      });
    } else {
      if (this.homepageTabs[tabNdx].componentRef.instance.DisplayGlobalSettingsDialogEvent) {
        this.homepageTabs[tabNdx].componentRef.instance.DisplayGlobalSettingsDialogEvent.subscribe(v => {
          this.DisplayGlobalSettingsDialog(v);
        });
      }
    }
    this.previousTab = activeComponentName;
  }
  addTab(tabLabel, tabTitle, tabPosition, componentRef, activate = true) {
    console.log('--- addTab called');
    /*/
     * Ensure that all tabs are not selected before we set the next new tab.
     * This will ensure that the newly created component appears on the currently selected tab,
     * which will be the newly added tab array element.
    /*/
    this.homepageTabs.map(x => {
      x.isActive = false;
    });
    // this.tabView.tabs.map(x => {
    //     x.selected = false;
    // });
    this.activeTabIndex = tabPosition;
    this.homepageTabs.splice(tabPosition, 0, {
      label: tabLabel,
      templateRef: null,
      tabTitle: tabTitle,
      isActive: activate,
      componentRef: componentRef
      // componentRef: this.goldenLayout.componentInstances[this.goldenLayout.componentInstances.length - 1]
    });
    console.log('--- addTab end: ', this.homepageTabs, componentRef);
  }
  clearTable(tableId) {
    const linkColorTable = $(tableId).empty();
  }
  onReloadScreen() {
    this.commonService.session.style.widgets = this.commonService.defaultWidgets();
    this.loadFilterSettings();
  }
  loadFilterSettings() {
    this.store.setSettingsLoaded(false);
    this.commonService.session.network.settingsLoaded = false;
    this.getGlobalSettingsData();
    //Filtering|Prune With
    this.SelectedPruneWityTypesVariable = this.commonService.session.style.widgets["link-show-nn"] ? "Nearest Neighbor" : "None";
    // this.onPruneWithTypesChanged();
    //Filtering|Minimum Cluster Size
    this.SelectedClusterMinimumSizeVariable = this.commonService.session.style.widgets["cluster-minimum-size"];
    this.onMinimumClusterSizeChanged(true);
    //Filtering|Filter Links on
    this.SelectedLinkSortVariable = this.commonService.session.style.widgets["link-sort-variable"];
    this.onLinkSortChanged(true);
    //Filtering|Filtering Threshold
    console.log('--- loadSettings link-threshold changed: ', this.commonService.session.style.widgets["link-threshold"]);
    this.SelectedLinkThresholdVariable = this.commonService.session.style.widgets["link-threshold"];
    this.onLinkThresholdChanged();
  }
  loadUISettings() {
    this.ShowGlobalSettingsLinkColorTable = false;
    this.ShowGlobalSettingsNodeColorTable = false;
    // console.log('xy link color table: ', linkColorTable);
    console.log('xy link color table 1.5: ', $('#link-color-table'));
    //Styling|Color Nodes By
    this.SelectedColorNodesByVariable = this.commonService.session.style.widgets["node-color-variable"];
    this.onColorNodesByChanged(false);
    console.log('oncolorNodesByChanged 2 - selected color nodes by variable: ', this.SelectedColorNodesByVariable);
    //Styling|Nodes
    this.SelectedNodeColorVariable = this.commonService.session.style.widgets["node-color"];
    this.onNodeColorChanged(true);
    console.log('xy link color table 2: ', $('#link-color-table'));
    //Styling|Color Links By
    if (this.commonService.session.style.widgets['link-color-variable'] === "None") {
      this.commonService.session.style.widgets['link-color-variable'] = "origin";
    }
    //  console.log('1this.ShowGlobalSettingsLinkColorTable: ', this.ShowGlobalSettingsLinkColorTable); 
    this.SelectedColorLinksByVariable = this.commonService.session.style.widgets['link-color-variable'];
    console.log('oncolorLinksByChanged - loadUISettings - selected color links by variable: ', this.SelectedColorLinksByVariable);
    console.log('link colorTable - loadui1: ', $('#link-color-table'));
    this.onColorLinksByChanged(true);
    console.log('xy link colorTable 3 - loadui2: ', $('#link-color-table'));
    //Styling|Links
    this.SelectedLinkColorVariable = this.commonService.session.style.widgets["link-color"];
    this.onLinkColorChanged(true);
    //Styling|Selected
    this.SelectedColorVariable = this.commonService.session.style.widgets['selected-color'];
    //Styling|Background
    this.SelectedBackgroundColorVariable = this.commonService.session.style.widgets['background-color'];
    this.onBackgroundChanged();
    //  console.log('xy link color table 3: ', linkColorTable);
    //  console.log('this.ShowGlobalSettingsLinkColorTable: ', this.ShowGlobalSettingsLinkColorTable); 
    //  console.log('2 this.ShowGlobalSettingsLinkColorTable: ', this.GlobalSettingsLinkColorDialogSettings.isVisible); 
    this.store.setSettingsLoaded(true);
    console.log('link colorTable - loadui3: ', $('#link-color-table'));
    this.updateGlobalSettingsModel();
  }
  publishLoadNewData() {
    console.log('--- publishLoadNewData called');
    // this.goldenLayout.componentInstances[1].onLoadNewData();
    this.homepageTabs.forEach(tab => {
      // componentRef.instance.onLoadNewData ?
      if (tab.componentRef && tab.componentRef.onLoadNewData) {
        tab.componentRef.onLoadNewData();
      }
    });
  }
  publishFilterDataChange() {
    // this.goldenLayout.componentInstances[1].onFilterDataChange();
    this.homepageTabs.forEach(tab => {
      if (tab.componentRef && tab.componentRef.instance.onFilterDataChange) {
        tab.componentRef.instance.onFilterDataChange();
      }
    });
  }
  ngOnDestroy() {
    this.NewSession();
  }
  getCurrentThresholdStepSize() {
    return this.store.currentThresholdStepSizeValue;
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.Injector
    }, {
      type: _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService
    }, {
      type: _angular_platform_browser__WEBPACK_IMPORTED_MODULE_23__.DomSanitizer
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ChangeDetectorRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ElementRef
    }, {
      type: _contactTraceCommonServices_common_store_services__WEBPACK_IMPORTED_MODULE_14__.CommonStoreService
    }, {
      type: _contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_15__.ExportService
    }];
  }
  static {
    this.propDecorators = {
      stashes: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['stashes']
      }],
      _goldenLayoutHostComponent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['goldenLayoutHost']
      }],
      linkThresholdSparkline: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['linkThresholdSparkline']
      }],
      visualWrapperRef: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['visualwrapper', {
          static: false
        }]
      }],
      nodeColorTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['nodeColorTable']
      }],
      linkColorTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['linkColorTable']
      }],
      DisplayGlobalSettingsDialogEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.Output
      }],
      dataSet: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['dataSet']
      }],
      targets: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChildren,
        args: ['placeholder', {
          read: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewContainerRef
        }]
      }],
      spinnerElement: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['ledgerloader']
      }],
      spinnerDivElement: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['ledgerloadDiv']
      }],
      globalSettingsTab: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['globalSettingsTab']
      }],
      pinBtn: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewChild,
        args: ['pinbutton']
      }]
    };
  }
};
MicrobeTraceNextHomeComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_24__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_17__.Component)({
  changeDetection: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ChangeDetectionStrategy.OnPush,
  selector: 'contact-trace',
  encapsulation: _angular_core__WEBPACK_IMPORTED_MODULE_17__.ViewEncapsulation.None,
  template: _microbe_trace_next_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__,
  styles: [(_microbe_trace_next_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_2___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_24__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_17__.Injector, _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService, _angular_platform_browser__WEBPACK_IMPORTED_MODULE_23__.DomSanitizer, _angular_core__WEBPACK_IMPORTED_MODULE_17__.ChangeDetectorRef, _angular_core__WEBPACK_IMPORTED_MODULE_17__.ElementRef, _contactTraceCommonServices_common_store_services__WEBPACK_IMPORTED_MODULE_14__.CommonStoreService, _contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_15__.ExportService])], MicrobeTraceNextHomeComponent);

class BpaaSPayloadWrapper {
  constructor() {
    this.BlockHashCode = undefined;
    this.BlockName = undefined;
    this.BpaaSPayload = undefined;
    this.FuzzyMatchRatios = undefined;
  }
}
class BpaaSPayloadWrapperData {
  constructor() {
    this.Type = undefined;
    this.SubType = undefined;
    this.JurisdictionKey = undefined;
    this.JurisdictionName = undefined;
    this.Jurisdiction = undefined;
    this.FileName = undefined;
    this.Data = [];
  }
}

/***/ }),

/***/ 97214:
/*!***********************************************************************************!*\
  !*** ./src/app/visualizationComponents/AggregateComponent/aggregate.component.ts ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AggregateComponent: () => (/* binding */ AggregateComponent)
/* harmony export */ });
/* harmony import */ var _Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 89204);
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _aggregate_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./aggregate.component.html?ngResource */ 23870);
/* harmony import */ var _aggregate_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./aggregate.component.scss?ngResource */ 11954);
/* harmony import */ var _aggregate_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_aggregate_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @app/contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! papaparse */ 92853);
/* harmony import */ var papaparse__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(papaparse__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! jszip */ 45834);
/* harmony import */ var jszip__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(jszip__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! xlsx */ 13857);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);














//import pdfMake from 'pdfmake/build/pdfmake.js';
//import pdfFonts from 'pdfmake/build/vfs_fonts.js';

let AggregateComponent = class AggregateComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__.BaseComponentDirective {
  constructor(injector, renderer, elem, eventManager, commonService, container, elRef, cdref, gtmService) {
    super(elRef.nativeElement);
    this.renderer = renderer;
    this.elem = elem;
    this.eventManager = eventManager;
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.gtmService = gtmService;
    this.SelectedDataTables = [];
    this.fieldOptions = [{
      label: 'Node',
      value: 'nodes',
      items: []
    }, {
      label: 'Link',
      value: 'links',
      items: []
    }, {
      label: 'Cluster',
      value: 'clusters',
      items: []
    }];
    this.SelectedDataFields = ['Node-cluster'];
    this.viewActive = true;
    this.settingsOpen = true;
    this.exportOpen = false;
    this.SelectedAggregateExportFilename = '';
    this.AggregateExportFileTypeList = [{
      label: 'xlsx',
      value: 'xlsx'
    }, {
      label: 'csv.zip',
      value: 'csv.zip'
    }, {
      label: 'json',
      value: 'json'
    }, {
      label: 'pdf',
      value: 'pdf'
    }];
    this.SelectedAggregateExportFileType = 'pdf';
    this.visuals = commonService.visuals;
    this.visuals.aggregate = this;
    this.widgets = this.commonService.session.style.widgets;
    this.updateFieldOptions();
  }
  ngOnInit() {
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/aggregate",
      page_title: "Aggregate View"
    });
    this.SelectedDataFields.forEach((field, index) => {
      this.SelectedDataTables.push({
        label: '',
        data: [],
        tableColumns: []
      });
      this.updateTable(index);
    });
    this.updateViewHeight();
    this.updateTableColWidth();
    this.container.on('resize', () => {
      this.updateViewHeight();
      this.updateTableColWidth();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.cdref.detectChanges();
    });
  }
  ngAfterViewInit() {
    this.updateTableColWidth();
  }
  updateTable(i) {
    let fullField = this.SelectedDataFields[i].split('-');
    let dataset = fullField[0];
    let field = fullField.slice(1).join('-');
    let tableColumns;
    let total = 0;
    let rawdata;
    if (dataset == 'Node') {
      rawdata = this.commonService.getVisibleNodes();
      tableColumns = [{
        field: 'groupName',
        header: this.commonService.capitalize(field)
      }, {
        field: 'count',
        header: 'Number of Nodes'
      }, {
        field: 'percent',
        header: 'Percent of Total Nodes'
      }];
    } else if (dataset == 'Link') {
      rawdata = this.commonService.getVisibleLinks();
      tableColumns = [{
        field: 'groupName',
        header: this.commonService.capitalize(field)
      }, {
        field: 'count',
        header: 'Number of Links'
      }, {
        field: 'percent',
        header: 'Percent of Total Links'
      }];
    } else {
      rawdata = this.commonService.getVisibleClusters();
      tableColumns = [{
        field: 'groupName',
        header: this.commonService.capitalize(field)
      }, {
        field: 'count',
        header: 'Number of Clusters'
      }, {
        field: 'percent',
        header: 'Percent of Total Clusters'
      }];
    }
    // populate count array [{}, {}, ...] where each item/object is a row
    var data = [];
    rawdata.forEach(row => {
      var match = data.find(arow => arow.groupName == row[field]);
      if (match) {
        match['count']++;
      } else {
        data.push({
          groupName: row[field],
          count: 1
        });
      }
      total++;
    });
    data.forEach(row => {
      row['percent'] = row['count'] * 100 / total;
      if (row.groupName == null) {
        row.groupName = 'null';
      }
    });
    this.SelectedDataTables[i] = {
      label: dataset + '-' + field,
      data: data,
      tableColumns: tableColumns
    };
  }
  updateViewHeight() {
    this.viewHeight = $(".aggregate-wrapper").parent().height() - 70;
  }
  updateTableColWidth() {
    let width = $('#tablesContainer').width() - 40;
    width = width > 700 ? width * .7 : width;
    this.tableStyle = {
      'width': width + 'px',
      'display': 'block'
    };
    $('#tablesContainer th').width(width / 3);
  }
  addTable() {
    this.SelectedDataFields.push('Node-selected');
    this.SelectedDataTables.push({
      label: 'Node-selected',
      data: [],
      tableColumns: []
    });
    this.updateTable(this.SelectedDataTables.length - 1);
    setTimeout(() => this.updateTableColWidth(), 0);
    this.orderList.cd.detectChanges();
  }
  deleteTable(i) {
    console.log(`deleting table ${i}`);
    this.SelectedDataFields = this.SelectedDataFields.filter((_, loc) => loc != i);
    this.SelectedDataTables = this.SelectedDataTables.filter((_, loc) => loc != i);
  }
  updateFieldOptions() {
    this.commonService.session.data['nodeFields'].map(d => {
      if (['seq', 'origin', '_diff', '_ambiguity', 'index', '_id'].includes(d)) return;
      this.fieldOptions[0]['items'].push({
        short_label: this.commonService.capitalize(d.replace("_", "")),
        label: `Node-${this.commonService.capitalize(d.replace("_", ""))}`,
        value: `Node-${d}`
      });
    });
    this.commonService.session.data['linkFields'].map(d => {
      if (['index', 'origin', 'nearest neighbor', 'nn'].includes(d)) return;
      this.fieldOptions[1]['items'].push({
        short_label: this.commonService.capitalize(d.replace("_", "")),
        label: `Link-${this.commonService.capitalize(d.replace("_", ""))}`,
        value: `Link-${d}`
      });
    });
    this.commonService.session.data['clusterFields'].map(d => {
      this.fieldOptions[2]['items'].push({
        short_label: this.commonService.capitalize(d.replace("_", "")),
        label: `Cluster-${this.commonService.capitalize(d.replace("_", ""))}`,
        value: `Cluster-${d}`
      });
    });
  }
  formatTableTitle(inputString) {
    let fullField = inputString.split('-');
    //let datasetName = this.commonService.capitalize(fullField[0]);
    let colGroupName = this.commonService.capitalize(fullField.slice(1).join('-'));
    return colGroupName;
  }
  updateNodeColors() {}
  updateLinkColor() {}
  updateVisualization() {}
  applyStyleFileSettings() {}
  openRefreshScreen() {}
  onRecallSession() {}
  onLoadNewData() {}
  onFilterDataChange() {}
  openSettings() {
    console.log("open settings pushed");
    this.settingsOpen = true;
  }
  openExport() {
    console.log("open export pushed");
    this.exportOpen = true;
  }
  exportVisualization() {
    var _this = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      console.log(_this.SelectedAggregateExportFilename + '.' + _this.SelectedAggregateExportFileType);
      if (_this.SelectedAggregateExportFileType == 'csv.zip') {
        let zip = new (jszip__WEBPACK_IMPORTED_MODULE_6___default())();
        _this.SelectedDataTables.forEach(table => {
          let tmpData = table.data.map(item => {
            let colGroupName = table.label.split('-').slice(1).join('-');
            return {
              [colGroupName]: item.groupName,
              'count': item.count,
              'percent': item.percent + '%'
            };
          });
          zip.file(table.label + '.csv', papaparse__WEBPACK_IMPORTED_MODULE_5__.unparse(tmpData));
          console.log(papaparse__WEBPACK_IMPORTED_MODULE_5__.unparse(tmpData));
        });
        zip.generateAsync({
          type: 'blob'
        }).then(content => file_saver__WEBPACK_IMPORTED_MODULE_7__(content, _this.SelectedAggregateExportFilename + '.zip'));
      } else if (_this.SelectedAggregateExportFileType == 'xlsx') {
        let wb = xlsx__WEBPACK_IMPORTED_MODULE_8__.utils.book_new();
        _this.SelectedDataTables.forEach(table => {
          let tmpData = table.data.map(item => {
            let colGroupName = table.label.split('-').slice(1).join('-');
            return {
              [colGroupName]: item.groupName,
              'count': item.count,
              'percent': item.percent + '%'
            };
          });
          let ws = xlsx__WEBPACK_IMPORTED_MODULE_8__.utils.json_to_sheet(tmpData);
          xlsx__WEBPACK_IMPORTED_MODULE_8__.utils.book_append_sheet(wb, ws, table.label);
        });
        xlsx__WEBPACK_IMPORTED_MODULE_8__.writeFile(wb, _this.SelectedAggregateExportFilename + '.xlsx');
      } else if (_this.SelectedAggregateExportFileType == 'json') {
        let outputData = [];
        _this.SelectedDataTables.forEach(table => {
          let fullField = table.label.split('-');
          let datasetName = fullField[0];
          let colGroupName = fullField.slice(1).join('-');
          let tmpData = table.data.map(item => {
            return {
              [colGroupName]: item.groupName,
              'n': item.count,
              'percent': item.percent + '%'
            };
          });
          outputData.push({
            "dataset": datasetName.toLowerCase(),
            "column": colGroupName,
            data: tmpData
          });
        });
        let blob = new Blob([JSON.stringify(outputData)], {
          type: "application/json;charset=utf-8"
        });
        file_saver__WEBPACK_IMPORTED_MODULE_7__(blob, _this.SelectedAggregateExportFilename + '.json');
      } else if (_this.SelectedAggregateExportFileType == 'pdf') {
        try {
          const {
            default: pdfMake
          } = yield __webpack_require__.e(/*! import() */ 888).then(__webpack_require__.t.bind(__webpack_require__, /*! pdfmake/build/pdfmake.js */ 27888, 23));
          const {
            default: pdfFonts
          } = yield __webpack_require__.e(/*! import() */ 360).then(__webpack_require__.t.bind(__webpack_require__, /*! pdfmake/build/vfs_fonts.js */ 55360, 23));
          pdfMake.vfs = pdfFonts;
          const documentDefinition = {
            content: [{
              image: _this.commonService.watermark
            }, {
              text: "Cluster Aggregation Snapshot",
              style: "header",
              alignment: "center"
            }, ..._this.SelectedDataTables.map(table => {
              let fullField = table.label.split('-');
              let datasetName = fullField[0];
              let colGroupName = fullField.slice(1).join('-');
              let tmpData = table.data.map(item => {
                let colGroupName = table.label.split('-').slice(1).join('-');
                return [item.groupName, item.count, `${item.percent.toFixed(2)}%`];
              });
              return {
                style: "paddedTable",
                table: {
                  headerRow: 1,
                  widths: ["*", "*", "*"],
                  body: [[`${_this.commonService.capitalize(colGroupName)}`, `Number of ${datasetName}s`, `Percent of Total ${datasetName}s`], ...tmpData]
                }
              };
            })],
            footer: function (currentPage, pageCount) {
              return [{
                text: `Page ${currentPage.toString()} of ${pageCount}`,
                alignment: "center"
              }];
            },
            styles: {
              header: {
                fontSize: 22,
                bold: true
              },
              paddedTable: {
                margin: [10, 10, 10, 10]
              }
            }
          };
          pdfMake.createPdf(documentDefinition).download(`${_this.SelectedAggregateExportFilename}.pdf`);
        } catch (error) {
          console.error("Failed to load pdfmake modules", error);
          // Optionally, notify the user about the failure using a toast or alert
        }
      }
    })();
  }
  reordered(e) {
    console.log('reordered ', this.SelectedDataFields, e);
    let updatedTableOrder = [];
    this.SelectedDataFields.forEach(field => {
      updatedTableOrder.push(this.SelectedDataTables.find(table => {
        if (table.label == field) {
          return true;
        }
      }));
    });
    this.SelectedDataTables = updatedTableOrder;
  }
  updateDataField(i, e) {
    console.log(`data field ${i} changed\nBefore: ${this.SelectedDataFields[0]}, ${this.SelectedDataFields[1]}, ${this.SelectedDataFields[2]}`);
    console.log(e);
    this.SelectedDataFields[i] = e.value;
    console.log(`After: ${this.SelectedDataFields[0]}, ${this.SelectedDataFields[1]}, ${this.SelectedDataFields[2]}`);
    this.updateTable(i);
    setTimeout(() => this.updateTableColWidth(), 0);
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Injector
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Renderer2
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef
    }, {
      type: _angular_platform_browser__WEBPACK_IMPORTED_MODULE_10__.EventManager
    }, {
      type: _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_4__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_11__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ChangeDetectorRef
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_12__.GoogleTagManagerService
    }];
  }
  static {
    this.propDecorators = {
      orderList: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ViewChild,
        args: ['orderList']
      }]
    };
  }
};
AggregateComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_13__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_9__.Component)({
  selector: 'AggregateComponent',
  template: _aggregate_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__,
  styles: [(_aggregate_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_13__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_9__.Injector, _angular_core__WEBPACK_IMPORTED_MODULE_9__.Renderer2, _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef, _angular_platform_browser__WEBPACK_IMPORTED_MODULE_10__.EventManager, _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_4__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_11__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_9__.ChangeDetectorRef, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_12__.GoogleTagManagerService])], AggregateComponent);

(function (AggregateComponent) {
  AggregateComponent.componentTypeName = 'Aggregate';
})(AggregateComponent || (AggregateComponent = {}));

/***/ }),

/***/ 20944:
/*!***************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/AlignmentViewComponent/alignment-view-plugin-component.ts ***!
  \***************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AlignmentViewComponent: () => (/* binding */ AlignmentViewComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _alignment_view_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./alignment-view-plugin-component.html?ngResource */ 36460);
/* harmony import */ var _alignment_view_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./alignment-view-plugin-component.scss?ngResource */ 67368);
/* harmony import */ var _alignment_view_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_alignment_view_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @app/contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../helperClasses/dialogSettings */ 63412);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var _generateAlignmentViewCanvas__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./generateAlignmentViewCanvas */ 81200);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var save_svg_as_png__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! save-svg-as-png */ 494);
/* harmony import */ var save_svg_as_png__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(save_svg_as_png__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);
/* harmony import */ var _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @app/contactTraceCommonServices/export.service */ 70616);













let AlignmentViewComponent = class AlignmentViewComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_2__.BaseComponentDirective {
  constructor(injector, commonService, container, elRef, cdref, gtmService, exportService) {
    super(elRef.nativeElement);
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.gtmService = gtmService;
    this.exportService = exportService;
    // General Settings
    this.alignmentDialogSettings = new _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_4__.DialogSettings('#alignment-settings-pane', false);
    this.ShowAlignExportPane = false;
    this.viewActive = true;
    this.showHideOptions = [{
      label: 'Show',
      value: true
    }, {
      label: 'Hide',
      value: false
    }];
    this.labelFieldList = [];
    this.showPopupMessage = false;
    this.longestSeqLength = 0;
    // Layout
    //showMiniMap: boolean; // replaced with this.widgets['alignView-showMiniMap']
    //alignmentTopDisplay: string; // replaced with this.widgets['alignView-topDisplay']
    this.alignmentTopDisplayOptions = [{
      label: 'Logo',
      value: 'logo'
    }, {
      label: 'Bar Plot',
      value: 'barplot'
    }];
    //charSetting: string; // 'show', 'min', 'hide' // replaced with this.widgets['alignView-charSetting']
    this.charSettingOptions = [{
      label: 'Show',
      value: 'show'
    }, {
      label: 'Minimum',
      value: 'min'
    }, {
      label: 'Hide',
      value: 'hide'
    }];
    this.seqTypeOptions = [{
      label: 'Nucleotides',
      value: 'nt'
    }, {
      label: 'Codons',
      value: 'codon'
    }, {
      label: 'Amino Acids',
      value: 'aa'
    }];
    this.selectedSeqType = 'nt';
    this.startPos = 1;
    //rulerMinorInterval: number = 20; replaced with this.widgets['alignView-rulerMinorInterval']
    this.rulerIntervalOptions = [0, 10, 20, 25, 50];
    this.translationSetting = 'Maintain Codons';
    this.sizes = [{
      label: 'Small',
      value: 's'
    }, {
      label: 'Medium',
      value: 'm'
    }, {
      label: 'Large',
      value: 'l'
    }, {
      label: 'Custom',
      value: 'c'
    }];
    this.colorSchemeOptions = [{
      label: 'Normal',
      value: 'n'
    }, {
      label: 'Alternative',
      value: 'a'
    }, {
      label: 'Custom',
      value: 'c'
    }];
    // Export
    this.AlignmentExportFileName = "";
    this.AlignmentExportFileTypeVis = "svg";
    this.AlignmentExportFileTypeData = "fasta";
    this.visuals = commonService.visuals;
    this.commonService.visuals.alignment = this;
    this.widgets = this.commonService.session.style.widgets;
  }
  ngOnInit() {
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/alignment",
      page_title: "Alignment View"
    });
    // set events such as node-selected
    this.setEvents();
    this.setDefaultWidgets();
    this.labelFieldList = [];
    this.commonService.session.data['nodeFields'].map((d, i) => {
      if (d != 'seq' && d != 'sequence') {
        this.labelFieldList.push({
          label: this.commonService.capitalize(d.replace("_", "")),
          value: d
        });
      }
    });
    // sets nodesWithSeq, seqArr, and longestSeqLength
    this.nodesWithSeq = [];
    this.nodesWithoutSeq = [];
    this.seqArray = [];
    this.commonService.session.data.nodes.forEach((node, index) => {
      if (this.isSeq(node.seq)) {
        this.nodesWithSeq.push(index);
        this.seqArray.push(node.seq.toUpperCase());
        if (node.seq.length > this.longestSeqLength) {
          this.longestSeqLength = node.seq.length;
        }
      } else {
        this.nodesWithoutSeq.push({
          index: node.index,
          ID: node.id
        });
      }
    });
    this.labelArray = this.getData(this.nodesWithSeq, ['index', this.widgets['alignView-labelField']]);
    // calculations countMatrix, proportionMatrix, and positionMatrix
    this.calculateProportionAtEachLocation();
    // sets different variables relating to size and display
    this.onAlignmentTopChange();
    if (this.widgets['alignView-colorSchemeName'] == 'n' || this.widgets['alignView-colorSchemeName'] == 'a') {
      this.useCustomColorScheme = false;
    } else {
      this.useCustomColorScheme = true;
    }
    this.onSelectedColorChanged(true);
    // updates spanWidth, spanHeight, rightWidth, leftWidth, fontSize, and then updates alignment
    this.onSelectedSizeChanged();
    // updates the valus of nodeWidthSeqShortened based on size of rigthWitdth, longestSeqLength, and nodesWithSeq
    this.shortenNodesWithSeq();
    // updates shows or hides minimap and then updates view heights
    this.updateMiniMapVisibility();
    this.container.on('resize', () => {
      this.goldenLayoutComponentResize();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.cdref.detectChanges();
    });
  }
  ngAfterViewInit() {
    this.highlightRows();
    if (this.nodesWithoutSeq.length > 0) {
      this.showPopupMessage = true;
    }
  }
  // General
  isSeq(seq) {
    if (seq === null || seq === "" || seq === "null") {
      return false;
    } else if (/[^-\s]/.test(seq)) {
      // test if seq contains chars other than dash (-) or space
      return true;
    } else {
      return false;
    }
  }
  /**
   * Defines new widgets and set default values
   */
  setDefaultWidgets() {
    //size
    if (this.widgets['alignView-selectedSize'] == undefined) {
      this.widgets['alignView-selectedSize'] = 's';
    }
    // height and width are declare/checked in this.onSelectedSizeChanged()
    // color
    if (this.widgets['alignView-colorSchemeName'] == undefined) {
      this.widgets['alignView-colorSchemeName'] = 'n';
    }
    if (this.widgets['alignView-customColorScheme'] == undefined) {
      this.widgets['alignView-customColorScheme'] = {
        'A': '#ccff00',
        'C': '#f0e442',
        'G': '#ff9900',
        'T': '#ff6600',
        'ambig': '#ffffff'
      };
    }
    // labels/sorting
    if (this.widgets['alignView-labelField'] == undefined) {
      this.widgets['alignView-labelField'] = '_id';
    }
    if (this.widgets['alignView-sortField'] == undefined) {
      this.widgets['alignView-sortField'] = 'index';
    }
    // top settings
    if (this.widgets['alignView-showMiniMap'] == undefined) {
      this.widgets['alignView-showMiniMap'] = true;
    }
    if (this.widgets['alignView-topDisplay'] == undefined) {
      this.widgets['alignView-topDisplay'] = 'barplot';
    }
    if (this.widgets['alignView-rulerMinorInterval'] == undefined) {
      this.widgets['alignView-rulerMinorInterval'] = 50;
    }
    // main canvas
    if (this.widgets['alignView-charSetting'] == undefined) {
      this.widgets['alignView-charSetting'] = 'show';
    }
    this.widgets['alignView-charSetting'] = 'show';
  }
  /**
   *
   * @param indexList an array of indexes for the nodes to get data from
   * @param field string | array of which field to get data from
   * @returns an array of objects
   */
  getData(indexList, field) {
    if (Array.isArray(field)) {
      return indexList.map(index => {
        let currentObj = {};
        field.forEach(f => currentObj[f] = f == "seq" ? this.commonService.session.data.nodes[index][f].toUpperCase() : this.commonService.session.data.nodes[index][f]);
        return currentObj;
      });
    } else if (field == "seq") {
      return indexList.map(index => this.commonService.session.data.nodes[index]["seq"].toUpperCase());
    } else {
      return indexList.map(index => this.commonService.session.data.nodes[index][field]);
    }
  }
  /**
   * Updates the value of this.longestSeqLength
   */
  updateLongestSeqLength() {
    let longestSeq = 0;
    this.seqArray.forEach(seq => {
      if (seq.length > longestSeq) {
        longestSeq = seq.length;
      }
    });
    this.longestSeqLength = longestSeq;
  }
  /**
  * Updates the alignment by generating a new canvas, and recalcuating various heights
  */
  updateAlignment() {
    (0,_generateAlignmentViewCanvas__WEBPACK_IMPORTED_MODULE_5__.generateCanvas)(this.seqArray, {
      width: this.spanWidth,
      height: this.spanHeight,
      charSetting: this.widgets['alignView-charSetting'],
      fontSize: this.fontSize,
      colors: this.colorScheme
    }).then(function (canvas) {
      $('#msa-viewer .canvasHolder').empty().append(canvas);
    });
    this.updateViewHeights();
  }
  // Mini Map
  /**
  * Creates a minimap.
  * The sequences (seqArrayShortened) are previously downsample by picking 1 nt / every n nucleotides;
  */
  updateMiniMap() {
    $('#miniMap canvas').remove();
    (0,_generateAlignmentViewCanvas__WEBPACK_IMPORTED_MODULE_5__.generateCanvas)(this.seqArrayShortened, {
      width: 1,
      height: 1,
      charSetting: 'hide',
      fontSize: 1,
      colors: this.colorScheme
    }).then(function (canvas) {
      $('#miniMap').append(canvas);
    });
  }
  /**
   * Adds/Removed miniMap and miniMap title
   */
  updateMiniMapVisibility() {
    if (this.widgets['alignView-showMiniMap']) {
      this.updateMiniMap();
      $('#miniMapHolder').css({
        'display': 'block'
      });
      $('#miniMapTitle').css({
        'display': 'block'
      });
    } else {
      $('#miniMapHolder').css({
        'display': 'none'
      });
      $('#miniMapTitle').css({
        'display': 'none'
      });
    }
    this.updateViewHeights();
  }
  /**
   * Add miniMapHighlight to correct position
   * @param e mouse event
   * @param miniMap HTMLElement
   */
  showMiniMapHighlight(e, miniMap) {
    let mmDimensions = miniMap.getBoundingClientRect();
    // need to reduce number of sequences on minimap if there are too many
    let scaleFactorNumber = this.nodesWithSeq.length <= 100 ? 1 : Math.ceil(this.nodesWithSeq.length / 100);
    let viewHeight = $('.canvasLabels').height();
    let highlightHeight = viewHeight / (this.spanHeight * scaleFactorNumber);
    // want the minimap to be around this.rightWidth pixels wide; caculate how much to downscale by and then downscale
    let scaleFactorLength = this.longestSeqLength < this.rightWidth ? 1 : Math.ceil(this.longestSeqLength / this.rightWidth);
    let highlightWidth = $('.canvasHolder').width() / (this.spanWidth * scaleFactorLength);
    let canvasWidth = $('#miniMap canvas').width();
    let left = e.clientX - mmDimensions.left - highlightWidth / 2;
    if (left < 0) {
      left = 0;
    } else if (left > canvasWidth - highlightWidth) {
      left = canvasWidth - highlightWidth;
    }
    $('#miniMapHighlight').css({
      'display': 'block',
      'top': top + 'px',
      'left': left + 'px',
      'height': highlightHeight + 'px',
      'width': highlightWidth + 'px'
    });
  }
  /**
   * Moves the position of miniMapHighlight
   * @param e mouse event
   * @param miniMap HTMLElement
   */
  updateMiniMapHighlight(e, miniMap) {
    let mmDimensions = miniMap.getBoundingClientRect();
    let highlightHeight = $('#miniMapHighlight').height();
    let top = e.clientY - mmDimensions.top - highlightHeight / 2;
    if (top < 0) {
      top = 0;
    } else if (top > mmDimensions.height - highlightHeight) {
      top = mmDimensions.height - highlightHeight;
    }
    let canvasWidth = $('#miniMap canvas').width();
    let highlightWidth = $('#miniMapHighlight').width();
    let left = e.clientX - mmDimensions.left - highlightWidth / 2;
    if (left < 0) {
      left = 0;
    } else if (left > canvasWidth - highlightWidth) {
      left = canvasWidth - highlightWidth;
    }
    $('#miniMapHighlight').css({
      'top': top + 'px',
      'left': left + 'px'
    });
  }
  /**
   * Removes highling from minimap
   */
  hideMiniMapHighlight() {
    $('#miniMapHighlight').css({
      'display': 'none'
    });
  }
  /**
   * Moves scroll position of main canvas, canvasLabels, and alignmentTop(Bar Plot, Rule) based on position of miniMapHighlight
   */
  miniMapClick(e, miniMap, canvasHolder, canvasLabels, alignmentTop) {
    let mmDimensions = miniMap.getBoundingClientRect();
    let highlightDimensions = document.getElementById('miniMapHighlight').getBoundingClientRect();
    // want the minimap to be around this.rightWidth pixels wide; caculate how much to downscale by and then downscale
    let scaleFactorLength = this.longestSeqLength < this.rightWidth ? 1 : Math.ceil(this.longestSeqLength / this.rightWidth);
    // need to reduce number of sequences on minimap if there are too many
    let scaleFactorNumber = this.nodesWithSeq.length <= 100 ? 1 : Math.ceil(this.nodesWithSeq.length / 100);
    //let scaleFactor = Math.ceil(this.longestSeqLength/this.rightWidth)
    let horizontalScroll = (highlightDimensions.left - mmDimensions.left) * this.spanWidth * scaleFactorLength;
    alignmentTop.scrollLeft = horizontalScroll < 10 ? horizontalScroll : horizontalScroll + 7;
    canvasHolder.scrollLeft = horizontalScroll < 10 ? horizontalScroll : horizontalScroll + 7;
    let verticalScroll = (highlightDimensions.top - mmDimensions.top) * this.spanHeight * scaleFactorNumber;
    canvasLabels.scrollTop = verticalScroll < 4 ? verticalScroll : verticalScroll + 4;
    canvasHolder.scrollTop = verticalScroll < 4 ? verticalScroll : verticalScroll + 4;
  }
  // Tooltip
  /**
   *
   * @param e $event
   * @param index index of the nt for the tooltip
   */
  showTooltip(e, index) {
    // offsetX = mouse X position + adjustment to center of the bar -50 to center toolbar
    let [x] = this.getRelativeMousePosition(e);
    let adjX = this.spanWidth / 2 - e.offsetX % this.spanWidth;
    let offsetX = x + adjX - 50;
    // offsetY = 151 (51 offset + 100 height) + height of minimap (number of seq/scaleFactor + 26 for padding, border, margin)
    let offsetY;
    if (this.widgets['alignView-showMiniMap']) {
      let scaleFactorNumber = this.nodesWithSeq.length <= 100 ? 1 : Math.ceil(this.nodesWithSeq.length / 100);
      offsetY = 151 + Math.ceil(this.nodesWithSeq.length / scaleFactorNumber + 26);
    } else {
      offsetY = 151;
    }
    let htmlString = this.tabulate(index);
    $('#tooltipAlign').html(htmlString);
    $('#tooltipHolder').css({
      'display': 'block',
      'position': 'absolute',
      'left': offsetX + 'px',
      'top': offsetY + 'px'
    });
  }
  /**
   * Hides the tooltip
   */
  hideTooltip() {
    //$('#tooltipAlign').html("")
    $('#tooltipHolder').css({
      'display': 'none'
    });
  }
  // Data
  /**
   * Updates seqArrayShortened by downsampling (selecting 1 out of every n NTs and selected 1 out of every m sequences, as needed) nodesWithSeq
   *
   */
  shortenNodesWithSeq() {
    if (this.longestSeqLength < this.rightWidth && this.nodesWithSeq.length <= 100) {
      this.seqArrayShortened = this.seqArray;
      $('#miniMap').css({
        'width': this.longestSeqLength + 'px',
        'height': this.nodesWithSeq.length + 'px'
      });
      $('#miniMapTitle').css({
        'height': this.nodesWithSeq.length + 16 + 'px',
        'line-height': this.nodesWithSeq.length + 16 + 'px'
      });
      return;
    }
    // want the minimap to be around this.rightWidth pixels wide; caculate how much to downscale by and then downscale
    let scaleFactorLength = this.longestSeqLength < this.rightWidth ? 1 : Math.ceil(this.longestSeqLength / this.rightWidth);
    // need to reduce number of sequences on minimap if there are too many
    let scaleFactorNumber = this.nodesWithSeq.length <= 100 ? 1 : Math.ceil(this.nodesWithSeq.length / 100);
    this.seqArrayShortened = [];
    this.seqArray.forEach((seq, index) => {
      if (index % scaleFactorNumber != 0) return;
      let downSizedSeq = "";
      for (let i = 0; i < this.longestSeqLength; i += scaleFactorLength) {
        downSizedSeq += seq.charAt(i);
      }
      this.seqArrayShortened.push(downSizedSeq);
    });
    $('#miniMap').css({
      'width': Math.ceil(this.longestSeqLength / scaleFactorLength) + 'px',
      'height': Math.ceil(this.nodesWithSeq.length / scaleFactorNumber) + 'px'
    });
    $('#miniMapTitle').css({
      'height': Math.ceil(this.nodesWithSeq.length / scaleFactorNumber + 16) + 'px',
      'line-height': Math.ceil(this.nodesWithSeq.length / scaleFactorNumber + 16) + 'px'
    });
  }
  /**
   * Calculates the count, proportion, and y position (for logo/bar plot) of each base at each position
   */
  calculateProportionAtEachLocation() {
    // count matrix: [ [#A, #C, #G, #T, #other/ambiguos]-for each location, ... ]
    this.countMatrix = [];
    this.proportionMatrix = [];
    this.positionMatrix = [];
    for (let i = 0; i < this.longestSeqLength; i++) {
      this.countMatrix.push([0, 0, 0, 0, 0]);
    }
    for (let seq of this.seqArray) {
      for (let i = 0; i < seq.length; i++) {
        let nt = seq[i];
        switch (nt) {
          case 'A':
            this.countMatrix[i][0] += 1;
            break;
          case 'C':
            this.countMatrix[i][1] += 1;
            break;
          case 'G':
            this.countMatrix[i][2] += 1;
            break;
          case 'T':
            this.countMatrix[i][3] += 1;
            break;
          default:
            this.countMatrix[i][4] += 1;
        }
      }
    }
    function calcProportion(value) {
      let sum = value[0] + value[1] + value[2] + value[3] + value[4];
      return [value[0] / sum, value[1] / sum, value[2] / sum, value[3] / sum, value[4] / sum];
    }
    function calculatePosition(value) {
      // custom merge sort; i want  first four items in value sorted but i want array of indexes returned not array of values
      let mergeA = value[0] > value[1] ? [0, 1] : [1, 0];
      let mergeB = value[2] > value[3] ? [2, 3] : [3, 2];
      let sortedIndexes = [];
      let locA = 0,
        locB = 0;
      for (let i = 0; i < 4; i++) {
        if (locA == 2) {
          sortedIndexes.push(mergeB[locB]);
          locB += 1;
        } else if (locB == 2) {
          sortedIndexes.push(mergeA[locA]);
          locA += 1;
        } else if (value[mergeA[locA]] > value[mergeB[locB]]) {
          sortedIndexes.push(mergeA[locA]);
          locA += 1;
        } else {
          sortedIndexes.push(mergeB[locB]);
          locB += 1;
        }
      }
      // use sorted index to create temp/row of positionMatrix such at the ambig (value[4]) is at the very top and then largest to smallest
      let temp = [0, 0, 0, 0, 0];
      let y = value[4] * 100;
      for (let index of sortedIndexes) {
        temp[index] = y;
        y += value[index] * 100;
      }
      return temp;
    }
    this.proportionMatrix = this.countMatrix.map(calcProportion);
    this.positionMatrix = this.proportionMatrix.map(calculatePosition);
  }
  /**
   * Generates and returns the proportion matrix from Amino Acid sequence
   */
  calculateProportionAminoAcids() {
    // count matrix: [ [#A, #R, #N, #D, #C, #E, #Q, #G, #H, #I, #L, #K, #M, #F, #P, #S, #T, #W, #Y, #V, #*, #-, #X]-for each location, ... ]
    let countMatrix = [];
    for (let i = 0; i < this.longestSeqLength; i++) {
      countMatrix.push(Array(23).fill(0));
    }
    for (let seq of this.seqArray) {
      for (let i = 0; i < seq.length; i++) {
        let nt = seq[i];
        switch (nt) {
          case 'A':
            countMatrix[i][0] += 1;
            break;
          case 'R':
            countMatrix[i][1] += 1;
            break;
          case 'N':
            countMatrix[i][2] += 1;
            break;
          case 'D':
            countMatrix[i][3] += 1;
            break;
          case 'C':
            countMatrix[i][4] += 1;
            break;
          case 'E':
            countMatrix[i][5] += 1;
            break;
          case 'Q':
            countMatrix[i][6] += 1;
            break;
          case 'G':
            countMatrix[i][7] += 1;
            break;
          case 'H':
            countMatrix[i][8] += 1;
            break;
          case 'I':
            countMatrix[i][9] += 1;
            break;
          case 'L':
            countMatrix[i][10] += 1;
            break;
          case 'K':
            countMatrix[i][11] += 1;
            break;
          case 'M':
            countMatrix[i][12] += 1;
            break;
          case 'F':
            countMatrix[i][13] += 1;
            break;
          case 'P':
            countMatrix[i][14] += 1;
            break;
          case 'S':
            countMatrix[i][15] += 1;
            break;
          case 'T':
            countMatrix[i][16] += 1;
            break;
          case 'W':
            countMatrix[i][17] += 1;
            break;
          case 'Y':
            countMatrix[i][18] += 1;
            break;
          case 'V':
            countMatrix[i][19] += 1;
            break;
          case '*':
            countMatrix[i][20] += 1;
            break;
          case '-':
            countMatrix[i][21] += 1;
            break;
          case 'X':
            countMatrix[i][22] += 1;
            break;
          default:
            countMatrix[i][22] += 1;
        }
      }
    }
    function calcProportion(value) {
      let sum = value.reduce((acc, cur) => acc + cur, 0);
      return value.map(current => current / sum);
    }
    return countMatrix.map(calcProportion);
  }
  /**
   * Generates and returns the position Matrix from Amino Acid proportion matrix
   */
  calculatePositionMatrixAminoAcids() {
    let count = 0;
    let output = [];
    //let index2NT = ['A', 'R', 'N', 'D', 'C', 'E', 'Q', 'G', 'H', 'I', 'L', 'K', 'M', 'F', 'P', 'S', 'T', 'W', 'Y', 'V', '*', '-', 'X'];
    this.proportionMatrixAA.forEach(row => {
      let nonZeroIndexes = [];
      row.forEach((value, index) => {
        if (value > 0 && index < 20) nonZeroIndexes.push(index);
      });
      nonZeroIndexes.sort(compareIndices);
      function compareIndices(a, b) {
        return row[b] - row[a];
      }
      count += 1;
      let temp = new Array(23).fill(0);
      let y = (row[22] + row[21] + row[20]) * 100;
      for (let index of nonZeroIndexes) {
        temp[index] = y;
        y += row[index] * 100;
      }
      output.push(temp);
    });
    return output;
  }
  /**
   * Similar to caclulating the proportion, but gaps and ambiguous nucleotides are separated
   */
  calculateAdvancedProportion() {
    // count matrix: [ [#A, #C, #G, #T, gaps, #N, #R, #Y, #K, #M, #S, #W, #B, #D, #H, #V #other]-for each location, ... ]
    let countMatrix = [];
    for (let i = 0; i < this.longestSeqLength; i++) {
      countMatrix.push(Array(17).fill(0)); // update this
    }
    for (let seq of this.seqArray) {
      for (let i = 0; i < seq.length; i++) {
        let nt = seq[i];
        switch (nt) {
          case 'A':
            countMatrix[i][0] += 1;
            break;
          case 'C':
            countMatrix[i][1] += 1;
            break;
          case 'G':
            countMatrix[i][2] += 1;
            break;
          case 'T':
            countMatrix[i][3] += 1;
            break;
          case '-':
            countMatrix[i][4] += 1;
            break;
          case 'N':
            countMatrix[i][5] += 1;
            break;
          case 'R':
            countMatrix[i][6] += 1;
            break;
          case 'Y':
            countMatrix[i][7] += 1;
            break;
          case 'K':
            countMatrix[i][8] += 1;
            break;
          case 'M':
            countMatrix[i][9] += 1;
            break;
          case 'S':
            countMatrix[i][10] += 1;
            break;
          case 'W':
            countMatrix[i][11] += 1;
            break;
          case 'B':
            countMatrix[i][12] += 1;
            break;
          case 'D':
            countMatrix[i][13] += 1;
            break;
          case 'H':
            countMatrix[i][14] += 1;
            break;
          case 'V':
            countMatrix[i][15] += 1;
            break;
          default:
            countMatrix[i][16] += 1;
        }
      }
    }
    function calcProportion(value) {
      let sum = value.reduce((acc, cur) => acc + cur, 0);
      return value.map(current => current / sum);
    }
    return countMatrix.map(calcProportion);
  }
  /** returns Math.floor(i); allows for it to be called from within the template */
  floor(i) {
    return Math.floor(i);
  }
  /**
   * @param i position
   * @returns the x pos for the elements in the barplot/logo/ruler based on the startPos and selectedSeqType
   */
  xPos(i) {
    if (this.selectedSeqType == 'codon' && i < this.startPos) {
      return 0;
    } else if (this.selectedSeqType == 'codon') {
      return this.spanWidth * (i - this.startPos + 1 + Math.floor((i - this.startPos + 1) / 3));
    } else {
      return this.spanWidth * i;
    }
  }
  /** Calculates the need with of SVG image based on selectedSeqType and the length of the sequences */
  getSVGWidth() {
    if (this.selectedSeqType == 'nt') {
      return this.spanWidth * this.proportionMatrix.length + 17;
    } else if (this.selectedSeqType == 'codon') {
      let length = this.proportionMatrix.length;
      return this.spanWidth * (length + Math.floor(length / 3)) + 17;
    } else {
      return this.spanWidth * this.proportionMatrixAA.length + 17;
    }
  }
  /** Updates Alignment View when type of sequence is changed */
  onSeqTypeChange() {
    if (this.selectedSeqType == 'nt') {
      this.startPos = 1;
      this.revert2NT();
    } else if (this.selectedSeqType == 'codon') {
      this.NT2Codon(this.startPos - 1);
    } else {
      this.convertToAASequence(this.startPos - 1);
    }
  }
  /** Returns a lookup table for converting NTs to Amino Acids. Doesn't account for ambiguity. USe checkAmbiguousCodons() to convert a codon
   * with ambiguous nucleotides into an Amino Acid
   */
  getNT2AATable() {
    return {
      'TTT': 'F',
      'TTC': 'F',
      'TTA': 'L',
      'TTG': 'L',
      'TCT': 'S',
      'TCC': 'S',
      'TCA': 'S',
      'TCG': 'S',
      'TAT': 'Y',
      'TAC': 'Y',
      'TAA': '*',
      'TAG': '*',
      'TGT': 'C',
      'TGC': 'C',
      'TGA': '*',
      'TGG': 'W',
      'CTT': 'L',
      'CTC': 'L',
      'CTA': 'L',
      'CTG': 'L',
      'CCT': 'P',
      'CCC': 'P',
      'CCA': 'P',
      'CCG': 'P',
      'CAT': 'H',
      'CAC': 'H',
      'CAA': 'Q',
      'CAG': 'Q',
      'CGT': 'R',
      'CGC': 'R',
      'CGA': 'R',
      'CGG': 'R',
      'ATT': 'I',
      'ATC': 'I',
      'ATA': 'I',
      'ATG': 'M',
      'ACT': 'T',
      'ACC': 'T',
      'ACA': 'T',
      'ACG': 'T',
      'AAT': 'N',
      'AAC': 'N',
      'AAA': 'K',
      'AAG': 'K',
      'AGT': 'S',
      'AGC': 'S',
      'AGA': 'R',
      'AGG': 'R',
      'GTT': 'V',
      'GTC': 'V',
      'GTA': 'V',
      'GTG': 'V',
      'GCT': 'A',
      'GCC': 'A',
      'GCA': 'A',
      'GCG': 'A',
      'GAT': 'D',
      'GAC': 'D',
      'GAA': 'E',
      'GAG': 'E',
      'GGT': 'G',
      'GGC': 'G',
      'GGA': 'G',
      'GGG': 'G'
    };
  }
  /** Converts the nucleotide sequence for each node into an amino acid sequence, based on startPos and , then updates the view */
  convertToAASequence(startPos = 0) {
    let NT2AA_table = this.getNT2AATable();
    this.seqArray = this.getData(this.nodesWithSeq, 'seq');
    this.updateLongestSeqLength();
    let AAarray = [];
    let NT_check = /^[ACGT]+$/;
    this.seqArray.forEach(seq => {
      if (this.translationSetting == 'Maintain Codons') {
        let aaString = '';
        for (let i = startPos; i < seq.length; i += 3) {
          let codon = seq.substring(i, i + 3);
          if (NT_check.test(codon)) {
            aaString += NT2AA_table[codon];
          } else if (codon == '---') {
            aaString += '-';
          } else {
            aaString += this.checkAmbiguousCodons(codon, NT2AA_table);
          }
        }
        AAarray.push(aaString);
      } else {
        let aaString = '';
        let gapCount = 0;
        let codon = '';
        for (let i = startPos; i < seq.length; i++) {
          let nt = seq.charAt(i);
          if (nt == '-') {
            gapCount += 1;
          } else {
            codon += nt;
          }
          if (gapCount == 3) {
            aaString += '-';
            gapCount = 0;
          } else if (codon.length == 3) {
            if (NT_check.test(codon)) {
              aaString += NT2AA_table[codon];
            } else {
              let aa = this.checkAmbiguousCodons(codon, NT2AA_table);
              aaString += aa;
            }
            codon = '';
          }
        }
        AAarray.push(aaString);
      }
    });
    this.seqArray = AAarray;
    this.colorScheme = {
      A: '#33cc00',
      R: '#cc0000',
      N: '#6600cc',
      D: '#0033ff',
      C: '#ffff00',
      Q: '#6600cc',
      E: '#0033ff',
      G: '#33cc00',
      H: '#009900',
      I: '#33cc00',
      L: '#33cc00',
      K: '#cc0000',
      M: '#33cc00',
      F: '#009900',
      P: '#33cc00',
      S: '#0099ff',
      T: '#0099ff',
      W: '#009900',
      Y: '#009900',
      V: '#33cc00',
      X: '#ffffff'
    };
    this.updateAlignment();
    this.updateLongestSeqLength();
    this.shortenNodesWithSeq();
    this.proportionMatrixAA = this.calculateProportionAminoAcids();
    this.positionMatrixAA = this.calculatePositionMatrixAminoAcids();
    this.updateMiniMap();
  }
  /** Converts a codon into an amino acid, tries to resolve ambiguous nucleotides; Return amino acid, X for ambiguous amino acid, or - if codon.length != 3 */
  checkAmbiguousCodons(codon, NT2AA_table = this.getNT2AATable()) {
    let ambiguousCheck = /^[ACGTNRYKMSWBDHV]+$/;
    if (codon.length != 3) {
      return '-';
    } else if (!ambiguousCheck.test(codon)) {
      return 'X';
    }
    let positionPossibilities = [];
    for (let i = 0; i < 3; i++) {
      let currentNT = codon.charAt(i);
      if (currentNT == 'A' || currentNT == 'C' || currentNT == 'G' || currentNT == 'T') {
        positionPossibilities.push([currentNT]);
      } else if (currentNT == 'W') {
        positionPossibilities.push(['A', 'T']);
      } else if (currentNT == 'S') {
        positionPossibilities.push(['C', 'G']);
      } else if (currentNT == 'M') {
        positionPossibilities.push(['A', 'C']);
      } else if (currentNT == 'K') {
        positionPossibilities.push(['G', 'T']);
      } else if (currentNT == 'R') {
        positionPossibilities.push(['A', 'G']);
      } else if (currentNT == 'Y') {
        positionPossibilities.push(['C', 'T']);
      } else if (currentNT == 'B') {
        positionPossibilities.push(['C', 'G', 'T']);
      } else if (currentNT == 'D') {
        positionPossibilities.push(['A', 'G', 'T']);
      } else if (currentNT == 'H') {
        positionPossibilities.push(['A', 'C', 'T']);
      } else if (currentNT == 'V') {
        positionPossibilities.push(['A', 'C', 'G']);
      } else if (currentNT == 'N') {
        positionPossibilities.push(['A', 'C', 'G', 'T']);
      }
    }
    let possibleCodons = [];
    positionPossibilities[0].forEach(nt0 => {
      positionPossibilities[1].forEach(nt1 => {
        positionPossibilities[2].forEach(nt2 => {
          possibleCodons.push(nt0 + nt1 + nt2);
        });
      });
    });
    let possibleAA = NT2AA_table[possibleCodons[0]];
    for (let i = 1; i < possibleCodons.length; i++) {
      let AA = NT2AA_table[possibleCodons[i]];
      if (possibleAA != AA) {
        return 'X';
      }
    }
    return possibleAA;
  }
  /** Reverts the view back to the original sequence view */
  revert2NT() {
    this.seqArray = this.getData(this.nodesWithSeq, 'seq');
    this.updateLongestSeqLength();
    this.shortenNodesWithSeq();
    this.onSelectedColorChanged();
  }
  /** Converts the sequence into a codons by introducing spaces every 3NTs and then updates the view */
  NT2Codon(start) {
    let newSeqs = [];
    this.seqArray = this.getData(this.nodesWithSeq, 'seq');
    this.seqArray.forEach(seq => {
      let codons = [];
      for (let i = start; i < seq.length; i += 3) {
        codons.push(seq.slice(i, i + 3));
      }
      newSeqs.push(codons.join(' '));
    });
    this.seqArray = newSeqs;
    this.updateLongestSeqLength();
    this.shortenNodesWithSeq();
    this.onSelectedColorChanged();
  }
  // Layout Positioning
  /**
  * Set rightViewHeigh, alignmentViewHeight, and canvasViewHeigh
  */
  updateViewHeights() {
    // order is important as subsequent calculations rely on previous updated values; These values are used to ensure the view heights are correct and scrolling occurs as expectd
    this.rightViewHeight = this.calculateRightHeight();
    this.alignmentViewHeight = this.calculateViewHeight();
    this.canvasViewHeight = this.calculateCanvasViewHeight();
  }
  /**
   * @returns the height needed to for all the elements on the right half of msa-viewer. If this height > available space, then scrolling will be used
   */
  calculateRightHeight() {
    let miniMapHeight = this.widgets['alignView-showMiniMap'] ? $('#miniMapHolder').height() + 16 : 0;
    // 170 alignmentTop, 17 bottomScrollBar, height of canvas
    return 170 + 25 + this.nodesWithSeq.length * this.spanHeight + miniMapHeight;
  }
  /**
   * @returns the height for msa-viewer element based on the minimum of the available space for the view and the height needed for the elements
   */
  calculateViewHeight() {
    return Math.min($(".msa-viewer-container").parent().height() - 50, this.rightViewHeight);
  }
  /**
   * @returns the height for the canvasHolder element and then subsequently the canvasLabels element. Not the height of the canvas itself
   */
  calculateCanvasViewHeight() {
    let miniMapHeight = this.widgets['alignView-showMiniMap'] ? $('#miniMapHolder').outerHeight() : 0;
    return Math.min(this.alignmentViewHeight - 170 - miniMapHeight, this.nodesWithSeq.length * this.spanHeight + 25);
  }
  /**
   * @returns the width for the right half of the viewer
   */
  calculateRightWidth() {
    // 7: gap between left and right (5) + 2
    return $("#msa-viewer").width() - this.leftWidth - 7;
  }
  // Sizing
  /**
  * Updates font size as needed and then updates the alignment view based on new height
  */
  onSpanHeightChange(e) {
    if (e >= 16) {
      this.fontSize = 16;
      this.leftWidth = 250;
    } else if (e >= 12) {
      this.fontSize = 12;
      this.leftWidth = 200;
    } else if (e >= 10) {
      this.fontSize = 10;
      this.leftWidth = 150;
    }
    this.rightWidth = this.calculateRightWidth();
    this.widgets['alignView-selectedSize'] = 'c';
    this.widgets['alignView-spanHeight'] = e;
    this.updateAlignment();
  }
  /**
   * Updates the alignment view with the new width
   */
  onSpanWidthChange(e) {
    this.widgets['alignView-selectedSize'] = 'c';
    this.widgets['alignView-spanWidth'] = e;
    this.updateAlignment();
  }
  /**
   * Updates spanHeight, spanWidth, fontSize, and sometimes charSetting and then updates alignment view with new settings
   */
  onSelectedSizeChanged() {
    if (this.widgets['alignView-selectedSize'] == 's') {
      this.spanHeight = 10;
      this.spanWidth = 2;
      this.widgets['alignView-charSetting'] = 'hide';
    } else if (this.widgets['alignView-selectedSize'] == 'm') {
      this.spanHeight = 12;
      this.spanWidth = 6;
      //this.charSetting = 'hide';
    } else if (this.widgets['alignView-selectedSize'] == 'l') {
      this.spanHeight = 16;
      this.spanWidth = 10;
      //this.charSetting = 'show';
    } else if (this.widgets['alignView-selectedSize'] == 'c') {
      if (!this.widgets['alignView-spanWidth']) {
        this.spanWidth = 10;
      } else {
        this.spanWidth = this.widgets['alignView-spanWidth'];
      }
      if (!this.widgets['alignView-spanHeight']) {
        this.spanHeight = 16;
      } else {
        this.spanHeight = this.widgets['alignView-spanHeight'];
      }
    }
    if (this.spanHeight >= 16) {
      this.fontSize = 16;
      this.leftWidth = 250;
    } else if (this.spanHeight >= 12) {
      this.fontSize = 12;
      this.leftWidth = 200;
    } else if (this.spanHeight >= 10) {
      this.fontSize = 10;
      this.leftWidth = 150;
    }
    this.widgets['alignView-spanWidth'] = this.spanWidth;
    this.widgets['alignView-spanHeight'] = this.spanHeight;
    this.rightWidth = this.calculateRightWidth();
    this.updateAlignment();
  }
  // Colors
  /**
   * Updates the color scheme for the view based on what is selected
   * @param skipUpdateAlignment set to true during ngOnInit to skip this.updateAlignment() and if statement for this.updateMiniMap()
   */
  onSelectedColorChanged(skipUpdateAlignment = false) {
    if (this.selectedSeqType != 'aa') {
      if (this.widgets['alignView-colorSchemeName'] == 'n') {
        this.colorScheme = {
          'A': '#ccff00',
          'C': '#f0e442',
          'G': '#ff9900',
          'T': '#ff6600',
          'ambig': '#ffffff'
        };
        this.useCustomColorScheme = false;
      } else if (this.widgets['alignView-colorSchemeName'] == 'a') {
        this.colorScheme = {
          'A': '#009E73',
          'C': '#F0E442',
          'G': '#E69F00',
          'T': '#D55E00',
          'ambig': '#ffffff'
        };
        this.useCustomColorScheme = false;
      } else {
        this.colorScheme = {
          'A': this.widgets['alignView-customColorScheme']['A'],
          'C': this.widgets['alignView-customColorScheme']['C'],
          'G': this.widgets['alignView-customColorScheme']['G'],
          'T': this.widgets['alignView-customColorScheme']['T'],
          'ambig': this.widgets['alignView-customColorScheme']['ambig']
        };
        this.useCustomColorScheme = true;
      }
    } else {
      this.useCustomColorScheme = false;
      this.colorScheme = {
        A: '#33cc00',
        R: '#cc0000',
        N: '#6600cc',
        D: '#0033ff',
        C: '#ffff00',
        Q: '#6600cc',
        E: '#0033ff',
        G: '#33cc00',
        H: '#009900',
        I: '#33cc00',
        L: '#33cc00',
        K: '#cc0000',
        M: '#33cc00',
        F: '#009900',
        P: '#33cc00',
        S: '#0099ff',
        T: '#0099ff',
        W: '#009900',
        Y: '#009900',
        V: '#33cc00',
        X: '#ffffff'
      };
    }
    if (skipUpdateAlignment == false) {
      this.updateAlignment();
      if (this.widgets['alignView-showMiniMap']) {
        this.updateMiniMap();
      }
    }
  }
  /**
   * Updates the colorScheme for nt given with the e.target.value color
   * @param nt 'A' | 'C' | 'G' | 'T' | 'ambig'
   */
  updateColorScheme(nt, e) {
    this.colorScheme[nt] = e.target.value;
    this.widgets['alignView-customColorScheme'][nt] = e.target.value;
    this.updateAlignment();
    if (this.widgets['alignView-showMiniMap']) {
      this.updateMiniMap();
    }
  }
  /**
   * @param index 0=A, 1=C, 2=G, 3=T, anythingElse=ambig
   * @returns the value (hexvalue) from colorScheme based on the index given
   */
  fillColor(index) {
    if (this.selectedSeqType == 'aa') {
      switch (index) {
        //['A', 'R', 'N', 'D', 'C', 'E', 'Q', 'G', 'H', 'I', 'L', 'K', 'M', 'F', 'P', 'S', 'T', 'W', 'Y', 'V', '*', '-', 'X']
        case 0:
          return this.colorScheme['A'];
        case 1:
          return this.colorScheme['R'];
        case 2:
          return this.colorScheme['N'];
        case 3:
          return this.colorScheme['D'];
        case 4:
          return this.colorScheme['C'];
        case 5:
          return this.colorScheme['E'];
        case 6:
          return this.colorScheme['Q'];
        case 7:
          return this.colorScheme['G'];
        case 8:
          return this.colorScheme['H'];
        case 9:
          return this.colorScheme['I'];
        case 10:
          return this.colorScheme['L'];
        case 11:
          return this.colorScheme['K'];
        case 12:
          return this.colorScheme['M'];
        case 13:
          return this.colorScheme['F'];
        case 14:
          return this.colorScheme['P'];
        case 15:
          return this.colorScheme['S'];
        case 16:
          return this.colorScheme['T'];
        case 17:
          return this.colorScheme['W'];
        case 18:
          return this.colorScheme['Y'];
        case 19:
          return this.colorScheme['V'];
        case 22:
          return this.colorScheme['X'];
        default:
          return this.colorScheme['X'];
      }
    }
    if (index == 0) {
      return this.colorScheme['A'];
    } else if (index == 1) {
      return this.colorScheme['C'];
    } else if (index == 2) {
      return this.colorScheme['G'];
    } else if (index == 3) {
      return this.colorScheme['T'];
    } else {
      return this.colorScheme['ambig'];
    }
  }
  // Helper
  /**
   * Searches nodesWithSequences for name given; changes background color for all nodes that are found
   * @param name name/id of node to search for
   * @param field which field from node to search in
   */
  search(name, field) {
    $('.canvasLabels div').removeClass('searchHighlight2');
    if (name == "") {
      return;
    }
    let isFieldNumerical = typeof this.getData([this.nodesWithSeq[0]], field)[0] === 'number';
    let data = this.getData(this.nodesWithSeq, field == 'index' ? ['index'] : ['index', field]);
    let indexes;
    if (isFieldNumerical) {
      indexes = data.filter(obj => obj[field] == parseFloat(name)).map(obj => obj['index']);
    } else {
      indexes = data.filter(obj => obj[field].includes(name)).map(obj => obj['index']);
    }
    //let indexes = this.nodesWithSeq.filter((obj) => obj.name.includes(name)).map((obj) => this.nodesWithSeq.indexOf(obj));
    if (indexes.length == 0) {
      console.log('not found');
      return;
    }
    for (let index of indexes) {
      //let element = $('.canvasLabels div').get(index);
      let element = $(`.canvasLabels div[data-index="${index}"]`);
      $(element).addClass('searchHighlight2');
    }
    // need to scroll if necessary
    let scroll = $('.canvasLabels').scrollTop();
    let topIndex = scroll / this.spanHeight;
    topIndex = topIndex % 1 > .2 ? Math.ceil(topIndex) : Math.floor(topIndex);
    let bottomIndex = Math.floor((this.canvasViewHeight - 20) / this.spanHeight + topIndex - 1);
    if (indexes[0] < topIndex || indexes[0] > bottomIndex) {
      let scrollPos = indexes[0] * this.spanHeight - 5;
      $('.canvasLabels').scrollTop(scrollPos);
    }
  }
  /**
   * Replaces search function and better incorporates with all node-selected events and not node-selected from search
   */
  highlightRows() {
    $('.canvasLabels div').removeClass('searchHighlight2');
    let nodes = this.getData(this.nodesWithSeq, ['index', 'selected']);
    let selectedNodes = nodes.filter(node => node.selected);
    if (selectedNodes.length == 0) {
      return;
    }
    for (let node of selectedNodes) {
      //let element = $('.canvasLabels div').get(index);
      let element = $(`.canvasLabels div[data-index="${node.index}"]`);
      $(element).addClass('searchHighlight2');
    }
    let firstPositionSelected = nodes.indexOf(selectedNodes[0]);
    // need to scroll if necessary
    let scroll = $('.canvasLabels').scrollTop();
    let topIndex = scroll / this.spanHeight;
    topIndex = topIndex % 1 > .2 ? Math.ceil(topIndex) : Math.floor(topIndex);
    let bottomIndex = Math.floor((this.canvasViewHeight - 20) / this.spanHeight + topIndex - 1);
    if (firstPositionSelected < topIndex || firstPositionSelected > bottomIndex) {
      let scrollPos = firstPositionSelected * this.spanHeight - 5;
      $('.canvasLabels').scrollTop(scrollPos);
    }
  }
  /**
   * Opens settings pane
   */
  openSettings() {
    //this.alignmentDialogSettings.isVisible ? this.alignmentDialogSettings.setVisibility(false) : this.alignmentDialogSettings.setVisibility(true);
    this.alignmentDialogSettings.isVisible = !this.alignmentDialogSettings.isVisible;
  }
  /**
   * Updates text in Alignment Top
   */
  onAlignmentTopChange() {
    if (this.widgets['alignView-topDisplay'] == 'barplot') {
      $('#alignmnetTopTitle').text('Bar Plot').prop('title', 'Barplot representation of the sequences that shows the proportion of each nucleotide at each position.');
    } else {
      $('#alignmnetTopTitle').text('Logo').prop('title', 'Logo representation of the sequences that shows the proportion of each nucleotide at each position.');
    }
  }
  /** XXXX May need to remove; currently use position matrix instead of calculating each XXXX
   * @param i current index of the base/nt in proportion matrix
   * @param j A=0, C=1, G=2, T=3, other/ambiguos=4
   * @returns location for the y value of rectangle in the logo
   */
  calculateY(i, j) {
    if (j == 4) {
      return 0;
    }
    let nt = this.proportionMatrix[i];
    let y = nt[4] * 100;
    if (j == 0) {
      return y;
    }
    for (let k = 0; k < j; k++) {
      y += nt[k] * 100;
    }
    return y;
  }
  /**
   * Sychronises horizonal scrolls on canvasHolder with alignmentTop and vertical scrolls on canvasHolder with canvasLabels
   * @param canvasHolder div class="canvasHolder"
   * @param canvasLabels div class="canvasLabels"
   * @param alignmentTop div class="alignmentTop"
   */
  canvasScroll(canvasHolder, canvasLabels, alignmentTop) {
    if (canvasHolder.scrollLeft != alignmentTop.scrollLeft) {
      alignmentTop.scrollLeft = canvasHolder.scrollLeft;
    }
    if (canvasHolder.scrollTop != canvasLabels.scrollTop) {
      canvasLabels.scrollTop = canvasHolder.scrollTop;
    }
  }
  /**
  * Generate a tabular HTML string from the index of proportionMatrix
  * @param data index of the position to use to make the HTML string of the table
  * @returns an HTML string with a table representation of the data
  */
  tabulate(index) {
    let dataType = this.selectedSeqType == 'aa' ? 'AA' : 'NT';
    let tableHtml = `
        <style>
        #tooltip-table {
            border-spacing: 0;
            width: 100%;
            border: 1px solid #ddd;
            z-index: 1000;
        }
        
        #tooltip-table td, #tooltip-table th {
            text-align: left;
            padding: 2px;
            border: 1px solid #ddd;
        }
        
        #tooltip-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        #tooltip-table tr:nth-child(odd) {
            background-color: #fff;
        }
        </style>
        <div>Position: ${index + 1}</div>
        <table id="tooltip-table"><thead><th>${dataType}</th><th> % </th></thead><tbody>`;
    if (this.selectedSeqType == 'aa') {
      let data = this.proportionMatrixAA[index];
      let nonZeroIndexes = [];
      let index2NT = ['A', 'R', 'N', 'D', 'C', 'E', 'Q', 'G', 'H', 'I', 'L', 'K', 'M', 'F', 'P', 'S', 'T', 'W', 'Y', 'V', 'STOP', 'GAP', 'UNK'];
      data.forEach((value, index) => {
        if (value > 0) nonZeroIndexes.push(index);
      });
      nonZeroIndexes.sort(compareIndices);
      function compareIndices(a, b) {
        return data[b] - data[a];
      }
      let numberOfRows = Math.min(4, nonZeroIndexes.length);
      let sum = 0;
      for (let i = 0; i < numberOfRows; i++) {
        let AAindex = nonZeroIndexes[i];
        tableHtml += `<tr><td>${index2NT[AAindex]}</td><td>` + (data[AAindex] * 100).toFixed(1) + '%</td>';
        sum += data[AAindex];
      }
      if (sum <= 0.99) {
        tableHtml += `<tr><td>Other</td><td>` + ((1 - sum) * 100).toFixed(1) + '%</td>';
      }
    } else {
      for (let i = 0; i < 5; i++) {
        let data = this.proportionMatrix[index];
        tableHtml += '<tr>';
        if (i == 0) {
          tableHtml += '<td>A</td><td>' + (data[i] * 100).toFixed(1) + '%</td>';
        } else if (i == 1) {
          tableHtml += '<td>C</td><td>' + (data[i] * 100).toFixed(1) + '%</td>';
        } else if (i == 2) {
          tableHtml += '<td>G</td><td>' + (data[i] * 100).toFixed(1) + '%</td>';
        } else if (i == 3) {
          tableHtml += '<td>T</td><td>' + (data[i] * 100).toFixed(1) + '%</td>';
        } else {
          tableHtml += '<td>other</td><td>' + (data[i] * 100).toFixed(1) + '%</td>';
        }
        tableHtml += '</tr>';
      }
    }
    tableHtml += '</tbody></table>';
    return tableHtml;
  }
  /**
  * @returns an array [X, Y] of the position of mouse relative to alignment view. Global position (i.e. d3.event.pageX) doesn't work for a dashboard
  */
  getRelativeMousePosition(e) {
    let rect = document.querySelector('alignmentviewcomponent').getBoundingClientRect();
    let X = e.pageX - rect.left;
    let Y = e.pageY - rect.top;
    return [X, Y];
  }
  /**
   * Set events such as node-selected so that they can be triggered; such as with search
   */
  setEvents() {
    let that = this;
    $(document).on("node-selected", function () {
      //that.search($('#search').val() as string, $('#search-field').val() as string)
      that.highlightRows();
    });
  }
  /**
   * updates labelArray and then searches again if needed
   */
  onLabelFieldChange() {
    this.labelArray = this.getData(this.nodesWithSeq, ['index', this.widgets['alignView-labelField']]);
    setTimeout(() => this.highlightRows(), 1);
  }
  /**
   * Sorts the indexes in nodesWithSeq based on the field selected.
   * After updating nodesWithSeq, it updates labelArray, seqArray, seqArrayShortened, main canvas, and minimap
   */
  onSortFieldChange() {
    let newSort;
    let sortField = this.widgets['alignView-sortField'];
    if (sortField == "None") {
      return;
    } else if (sortField == "index") {
      //return
      newSort = this.getData(this.nodesWithSeq, [sortField]).sort((a, b) => a[sortField] - b[sortField]);
      //this.nodesWithSeq.sort((a,b) => )
    } else if (typeof this.getData([this.nodesWithSeq[0]], sortField)[0] == 'number') {
      newSort = this.getData(this.nodesWithSeq, ['index', sortField]).sort((a, b) => a[sortField] - b[sortField]);
    } else {
      newSort = this.getData(this.nodesWithSeq, ['index', sortField]).sort((a, b) => a[sortField].localeCompare(b[sortField]));
    }
    // updates nodesWithSeq
    this.nodesWithSeq = newSort.map(obj => obj['index']);
    // updates labelArray with new sort
    this.onLabelFieldChange();
    // updates seqArray with new order
    this.seqArray = this.getData(this.nodesWithSeq, 'seq');
    // updates seqArrayShortened with new order
    this.shortenNodesWithSeq();
    // updates main canvas and minimap canvas
    this.updateAlignment();
  }
  updateNodeColors() {}
  updateLinkColor() {}
  updateVisualization() {}
  // function is called when style file is applied
  applyStyleFileSettings() {
    this.widgets = window.context.commonService.session.style.widgets;
    this.labelArray = this.getData(this.nodesWithSeq, ['index', this.widgets['alignView-labelField']]);
    // sets different variables relating to size and display
    this.onAlignmentTopChange();
    if (this.widgets['alignView-colorSchemeName'] == 'n' || this.widgets['alignView-colorSchemeName'] == 'a') {
      this.useCustomColorScheme = false;
    } else {
      this.useCustomColorScheme = true;
    }
    this.onSelectedColorChanged(true);
    // updates spanWidth, spanHeight, rightWidth, leftWidth, fontSize, and then updates alignment
    this.onSelectedSizeChanged();
    // updates shows or hides minimap and then updates view heights
    this.updateMiniMapVisibility();
  }
  goldenLayoutComponentResize() {
    this.updateViewHeights();
    this.rightWidth = this.calculateRightWidth();
  }
  openRefreshScreen() {}
  onRecallSession() {}
  onLoadNewData() {}
  onFilterDataChange() {}
  /**
   * Opens the Alignment View Export Pain
  */
  openExport() {
    this.ShowAlignExportPane = true;
  }
  /**
   * Exports the alignmentTop and main canvas as png image
   */
  exportPNG() {
    let that = this;
    let alignmentTop = document.querySelector('#alignmentTop svg');
    let mainCanvas = $('.canvasHolder canvas').get(0);
    let exportWidth = mainCanvas.width;
    let exportHeight = mainCanvas.height + 140;
    (0,save_svg_as_png__WEBPACK_IMPORTED_MODULE_7__.svgAsPngUri)(alignmentTop, {
      scale: 1,
      backgroundColor: '#ffffff',
      encoderType: 'image/png',
      encoderOptions: 0.8
    }).then(topB64string => {
      let imageDataUrl;
      let exportCanvas = document.createElement("canvas");
      exportCanvas.height = exportHeight;
      exportCanvas.width = exportWidth;
      let ctx = exportCanvas.getContext("2d");
      let iTop = new Image();
      let iMain = new Image();
      iTop.src = topB64string;
      iTop.onload = function () {
        iMain.src = mainCanvas.toDataURL();
        iMain.onload = function () {
          ctx.drawImage(iTop, 0, 0);
          ctx.drawImage(iMain, 0, 140);
          imageDataUrl = exportCanvas.toDataURL("image/png");
          (0,file_saver__WEBPACK_IMPORTED_MODULE_6__.saveAs)(imageDataUrl, that.AlignmentExportFileName + '.png');
        };
      };
    });
  }
  /**
   * Exports the alignment top and main canvas as svg or png image
   */
  exportVisualization() {
    $("body").css("cursor", "progress");
    if (this.AlignmentExportFileTypeVis == 'png') {
      this.exportPNG();
    } else {
      let canvas = $('.canvasHolder canvas').get(0);
      let canvasDataURL = canvas.toDataURL();
      let foreignObj = document.createElementNS('http://www.w3.org/2000/svg', 'image');
      foreignObj.setAttribute('x', '0'); // Set the x-coordinate
      foreignObj.setAttribute('y', '140'); // Set the y-coordinate
      foreignObj.setAttribute('width', canvas.width.toString()); // Set the width
      foreignObj.setAttribute('height', canvas.height.toString()); // Set the height
      foreignObj.setAttribute('xlink:href', canvasDataURL);
      let top = $('#alignmentTop svg').get(0);
      top.style.height = 150 + canvas.height + 'px';
      top.appendChild(foreignObj);
      let content = this.exportService.unparseSVG(top);
      let blob = new Blob([content], {
        type: 'image/svg+xml;charset=utf-8'
      });
      (0,file_saver__WEBPACK_IMPORTED_MODULE_6__.saveAs)(blob, this.AlignmentExportFileName + '.svg');
      top.style.height = 150 + canvas.height + 'px';
      top.removeChild(foreignObj);
    }
    $("body").css("cursor", "default");
  }
  /**
   * Exports sequencing data (id + seq string) as fasta or mega file
   */
  exportData(includeConsensus = false) {
    let data, consensus, megaFormat;
    if (this.selectedSeqType == 'aa') {
      let labels = this.getData(this.nodesWithSeq, '_id');
      data = labels.map((id, index) => ({
        '_id': id,
        seq: this.seqArray[index]
      }));
      consensus = includeConsensus ? this.getConsensus(this.proportionMatrixAA, 'plurality', 'aa') : '';
      megaFormat = 'DataType=Protein Missing=X Indel=-;\r\n\r\n';
    } else {
      data = this.getData(this.nodesWithSeq, ['_id', 'seq']);
      consensus = includeConsensus ? this.getConsensus(this.proportionMatrix) : '';
      megaFormat = 'DataType=DNA CodeTable=Standard\r\n\tIdentical=. Missing=? Indel=-;\r\n\r\n';
    }
    if (this.AlignmentExportFileTypeData == 'fasta') {
      let consensusString = includeConsensus ? '>consensus\r\n' + consensus + "\r\n" : '';
      let blob = new Blob([consensusString, data.map(node => ">" + node._id + "\r\n" + node.seq).join("\r\n")]);
      (0,file_saver__WEBPACK_IMPORTED_MODULE_6__.saveAs)(blob, this.AlignmentExportFileName + '.fasta');
    } else if (this.AlignmentExportFileTypeData == 'mega') {
      let headers = "#mega\r\n!Title " + this.AlignmentExportFileName + ";\r\n!Format\r\n\t" + megaFormat;
      let consensusString = includeConsensus ? '#consensus\r\n' + consensus + "\r\n" : '';
      let blob = new Blob([headers, consensusString, data.map(node => "#" + node._id + "\r\n" + node.seq).join("\r\n")]);
      (0,file_saver__WEBPACK_IMPORTED_MODULE_6__.saveAs)(blob, this.AlignmentExportFileName + '.meg');
    }
  }
  exportDataTable(option = 'basic', includeConsensus) {
    // basic 5 number for each position     // may not use basic option but keeping it for now
    // advances includes proportion for gaps and each ambiguous nucleotide option
    // [A, C, G, T, #other/ambig]
    let csvString;
    if (option == 'basic') {
      let csvHeader = 'A,C,G,T,other (including gap and abiguous)\n';
      csvString = csvHeader + this.proportionMatrix.map(innerArray => innerArray.join(',')).join('\n');
    } else if (includeConsensus) {
      let csvHeader;
      let proportionMatrix;
      let consensus;
      if (this.selectedSeqType == 'aa') {
        csvHeader = 'position,consensus,"consensus ambiguities (most prevalent AA outside of brackets, other AAs found at this position inside brackets)",A,R,N,D,C,E,Q,G,H,I,L,K,M,F,P,S,T,W,Y,V,stop,gap,ambiguous\n';
        proportionMatrix = this.proportionMatrixAA;
        consensus = this.getConsensus(proportionMatrix, 'meme', 'aa');
      } else {
        csvHeader = 'position,consensus,"consensus ambiguities (most prevalent NT outside of brackets, other NTs found at this position inside brackets)",A,C,G,T,gap,N,R,Y,K,M,S,W,B,D,H,V,other\n';
        proportionMatrix = this.calculateAdvancedProportion();
        consensus = this.getConsensus(proportionMatrix, 'meme');
      }
      let consensusInterator = getNextPosition(consensus);
      csvString = csvHeader + proportionMatrix.map((innerArray, pos) => {
        let chars = consensusInterator.next().value;
        return pos + 1 + ',' + chars.charAt(0) + ',' + chars + ',' + innerArray.join(',');
      }).join('\n');
    } else {
      let proportionMatrix;
      let csvHeader;
      if (this.selectedSeqType == 'aa') {
        csvHeader = 'position,A,R,N,D,C,E,Q,G,H,I,L,K,M,F,P,S,T,W,Y,V,stop,gap,ambiguous\n';
        proportionMatrix = this.proportionMatrixAA;
      } else {
        csvHeader = 'position,A,C,G,T,gap,N,R,Y,K,M,S,W,B,D,H,V,other\n';
        proportionMatrix = this.calculateAdvancedProportion();
      }
      csvString = csvHeader + proportionMatrix.map((innerArray, pos) => pos + 1 + ',' + innerArray.join(',')).join('\n');
    }
    function* getNextPosition(input) {
      for (let i = 0; i < input.length; i++) {
        const char = input[i];
        if (input[i + 1] === '[') {
          // Yield the character and everything in the brackets
          let bracketContent = '';
          while (input[i] !== ']') {
            bracketContent += input[i];
            i++;
          }
          bracketContent += ']';
          yield bracketContent;
        } else {
          // Yield individual characters
          yield char;
        }
      }
    }
    let blob = new Blob([csvString], {
      type: 'text/csv'
    });
    (0,file_saver__WEBPACK_IMPORTED_MODULE_6__.saveAs)(blob, this.AlignmentExportFileName + '.csv');
  }
  /** Gets the consensus sequence of a NT or AA sequence, defined by most common char at a position (not based on meeting a threshold);
   *
   * Option:
   ** 'pluratily' returns just the sequence of most common bases
   ** 'meme' return the most common base, then adds other bases found at that position in brackets.
   *
   * Given all A at first 1, and 70% C and 30% A at 2nd pos, plurality returns 'AC', 'meme' returns 'AC[A]'
   */
  getConsensus(proportionMatrix, option = 'plurality', seq = 'nt') {
    let consensusSeq = '';
    if (option == 'plurality') {
      let index2NT = seq == 'nt' ? ['A', 'C', 'G', 'T', '-'] : ['A', 'R', 'N', 'D', 'C', 'E', 'Q', 'G', 'H', 'I', 'L', 'K', 'M', 'F', 'P', 'S', 'T', 'W', 'Y', 'V', '*', '-', 'X'];
      proportionMatrix.forEach(row => {
        let maxPos = row.indexOf(Math.max(...row));
        if (maxPos > 4 && seq == 'nt') {
          consensusSeq += 'N';
        } else {
          consensusSeq += index2NT[maxPos];
        }
      });
      return consensusSeq;
    } else if (option == 'meme') {
      let index2NT = seq == 'nt' ? ['A', 'C', 'G', 'T', '-', 'N', 'R', 'Y', 'K', 'M', 'S', 'W', 'B', 'D', 'H', 'V', 'invalid'] : ['A', 'R', 'N', 'D', 'C', 'E', 'Q', 'G', 'H', 'I', 'L', 'K', 'M', 'F', 'P', 'S', 'T', 'W', 'Y', 'V', '*', '-', 'X'];
      proportionMatrix.forEach(row => {
        let nonZeroIndexes = [];
        row.forEach((value, index) => {
          if (value > 0) nonZeroIndexes.push(index);
        });
        nonZeroIndexes.sort(compareIndices);
        function compareIndices(a, b) {
          return row[b] - row[a];
        }
        nonZeroIndexes.forEach((index, pos) => {
          if (pos == 1) {
            consensusSeq += '[';
          }
          consensusSeq += index2NT[index];
        });
        if (nonZeroIndexes.length > 1) consensusSeq += ']';
      });
      return consensusSeq;
    }
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Injector
    }, {
      type: _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_10__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_2__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ChangeDetectorRef
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_11__.GoogleTagManagerService
    }, {
      type: _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_8__.ExportService
    }];
  }
};
AlignmentViewComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_12__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_9__.Component)({
  selector: 'AlignmentViewComponent',
  template: _alignment_view_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  styles: [(_alignment_view_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_12__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_9__.Injector, _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_10__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_9__.ChangeDetectorRef, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_11__.GoogleTagManagerService, _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_8__.ExportService])], AlignmentViewComponent);

(function (AlignmentViewComponent) {
  AlignmentViewComponent.componentTypeName = 'Alignment View';
})(AlignmentViewComponent || (AlignmentViewComponent = {}));

/***/ }),

/***/ 81200:
/*!***********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/AlignmentViewComponent/generateAlignmentViewCanvas.ts ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   generateCanvas: () => (/* binding */ generateCanvas)
/* harmony export */ });
// Moved out of alignment-view-plugin-component, so that it can be accessed from files view without having to initialize the whole view
/**
   * Adapted from  https://github.com/CDCgov/AlignmentViewer to also allow minimum charSetting, accepts array of seq (not array of seq objects)
   * @param seqs array of sequences objects ['ATGA...', 'TATA...', ...]
   * @param config  object: { width: number, height: number, charSetting:['hide'|'show'|'min'], fontSize: number, colors: {'A':'#000000', 'C': , 'G':, 'T':, 'ambig':}}
   * @returns promise of a HTMLCanvasElement showing the alignment
   */
function generateCanvas(seqs, config) {
  config = Object.assign({
    width: 1,
    height: 1,
    'charSetting': 'hide'
  }, config, {
    colors: Object.assign({
      'A': '#ccff00',
      'C': '#ffff00',
      'G': '#ff9900',
      'T': '#ff6600',
      'ambig': '#ffffff'
    }, 'colors' in config ? config.colors : {})
  });
  return new Promise(resolve => {
    let longest = 0;
    let n = seqs.length;
    for (let i = 0; i < n; i++) {
      let seq = seqs[i].toUpperCase();
      if (seq.length > longest) longest = seq.length;
    }
    let ch = Math.ceil(config.height);
    let cw = Math.ceil(config.width);
    let width = longest * config.width;
    let height = seqs.length * config.height;
    let canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;
    let context = canvas.getContext('2d', {
      alpha: false
    });
    context.fillStyle = config.colors['ambig'];
    context.fillRect(0, 0, width, height);
    Object.keys(config.colors).forEach(nucleotide => {
      if (nucleotide == 'ambig') return;
      context.fillStyle = config.colors[nucleotide];
      for (let row = 0; row < n; row++) {
        let seq = seqs[row];
        let y = Math.floor(row * ch);
        for (let col = 0; col < longest; col++) {
          let c = seq[col];
          if (!c) break;
          if (c != nucleotide) continue;
          let x = Math.floor(col * cw);
          context.fillRect(x, y, cw, ch);
        }
      }
    });
    context.font = config.fontSize + 'px mono';
    context.textAlign = 'center';
    context.textBaseline = 'bottom';
    context.fillStyle = 'black';
    if (config.charSetting == 'show') {
      for (let row = 0; row < n; row++) {
        let seq = seqs[row];
        let y = row * ch + ch;
        for (let col = 0; col < longest; col++) {
          let c = seq[col];
          if (!c) break;
          let x = col * cw + cw / 2;
          context.fillText(c, x, y, cw);
        }
      }
    } else if (config.charSetting == 'min') {
      let refSeq = seqs[0];
      for (let col = 0; col < longest; col++) {
        let c = refSeq[col];
        if (!c) break;
        let x = col * cw + cw / 2;
        context.fillText(c, x, ch, cw);
      }
      for (let row = 1; row < n; row++) {
        let seq = seqs[row];
        let y = row * ch + ch;
        for (let col = 0; col < longest; col++) {
          let c = refSeq[col] != seq[col] || seq[col] == '-' || refSeq[col] == ' ' ? seq[col] : '.';
          if (!c) break;
          let x = col * cw + cw / 2;
          context.fillText(c, x, y, cw);
        }
      }
    }
    resolve(canvas);
  });
}

/***/ }),

/***/ 31884:
/*!*****************************************************************************!*\
  !*** ./src/app/visualizationComponents/BubbleComponent/bubble.component.ts ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   BubbleComponent: () => (/* binding */ BubbleComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _bubble_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./bubble.component.html?ngResource */ 34220);
/* harmony import */ var _bubble_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./bubble.component.scss?ngResource */ 5820);
/* harmony import */ var _bubble_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_bubble_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @app/contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var cytoscape__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! cytoscape */ 15363);
/* harmony import */ var cytoscape_svg__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! cytoscape-svg */ 27515);
/* harmony import */ var cytoscape_svg__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(cytoscape_svg__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @app/contactTraceCommonServices/export.service */ 70616);











let BubbleComponent = class BubbleComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_2__.BaseComponentDirective {
  constructor(commonService, container, elRef, cdref, gtmService, exportService) {
    super(elRef.nativeElement);
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.gtmService = gtmService;
    this.exportService = exportService;
    this.DisplayGlobalSettingsDialogEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_7__.EventEmitter();
    this.viewActive = true;
    this.settingsOpen = false;
    this.exportOpen = false;
    this.BubbleExportFileType = 'png';
    this.BubbleExportFileName = '';
    this.SelectedBubbleExportScaleVariable = 1;
    this.selectedFieldList = [];
    this.nodeSpacing = 0.05;
    this.allData = [];
    this.visibleData = [];
    this.X_categories = [];
    this.X_tickValues = [];
    this.Y_categories = [];
    this.Y_tickValues = [];
    this.scaleFactor = 200;
    this.svgDefs = {};
    this.NodeCollapsingTypes = [{
      label: 'On',
      value: true
    }, {
      label: 'Off',
      value: false
    }];
    this.visuals = commonService.visuals;
    this.visuals.bubble = this;
    this.widgets = this.commonService.session.style.widgets;
    cytoscape__WEBPACK_IMPORTED_MODULE_4__["default"].use((cytoscape_svg__WEBPACK_IMPORTED_MODULE_5___default()));
  }
  ngOnInit() {
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/bubble",
      page_title: "Bubble View"
    });
    try {
      this.viewHeight = this.container.height - 73;
      this.viewWidth = this.container.width - 42;
    } catch (error) {
      console.log('unable to set proper view sizes for bubble view, setting to default values');
      this.viewWidth = 800;
      this.viewHeight = 600;
    }
    this.selectedFieldList.push({
      label: "None",
      value: "None"
    });
    this.commonService.session.data['nodeFields'].map(d => {
      if (['seq', 'origin', '_diff', '_ambiguity', 'index', '_id'].includes(d)) return;
      this.selectedFieldList.push({
        label: this.commonService.capitalize(d.replace("_", "")),
        value: d
      });
    });
    this.setWidgets();
    this.updateAxisValues('X');
    this.updateAxisValues('Y');
    this.getData();
    this.onNodeSizeChange();
    this.container.on('resize', () => {
      this.goldenLayoutComponentResize();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.setSelectedNodes(this);
      setTimeout(() => {
        this.goldenLayoutComponentResize();
        this.cdref.detectChanges();
      }, 5);
    });
    let that = this;
    $(document).on("node-selected", function () {
      if (that.viewActive) {
        that.visuals.bubble.setSelectedNodes(that);
      }
    });
    $(document).on("node-visibility", function () {
      //console.log('node visi event')
      that.updateVisibleNodes();
      that.updateNodes();
    });
  }
  ngAfterViewInit() {
    this.generateCytoscape();
  }
  setWidgets() {
    if (this.widgets['bubble-x'] == undefined || !this.selectedFieldList.map(x => x.value).includes(this.widgets['bubble-x'])) {
      this.xVariable = 'cluster';
      this.widgets['bubble-x'] = this.xVariable;
    } else {
      this.xVariable = this.widgets['bubble-x'];
    }
    if (this.widgets['bubble-y'] == undefined || !this.selectedFieldList.map(x => x.value).includes(this.widgets['bubble-y'])) {
      this.xVariable = 'None';
      this.widgets['bubble-y'] = this.xVariable;
    } else {
      this.yVariable = this.widgets['bubble-y'];
    }
    if (this.widgets['bubble-x'] == 'None' && this.widgets['bubble-y'] == 'None') {
      this.openSettings();
    }
    if (this.widgets['bubble-size'] < 10 || this.widgets['bubble-size'] > 40 || this.widgets['bubble-size'] == undefined || this.widgets['bubble-size'] == null || typeof this.widgets['bubble-size'] != 'number') {
      this.widgets['bubble-size'] = 15;
    }
    this.nodeSize = this.widgets['bubble-size'];
    if (this.widgets['bubble-charge'] < .01 || this.widgets['bubble-charge'] > .15 || this.widgets['bubble-charge'] == undefined || this.widgets['bubble-charge'] == null || typeof this.widgets['bubble-charge'] != 'number') {
      this.widgets['bubble-charge'] = 0.05;
    }
    this.nodeSpacing = this.widgets['bubble-charge'];
    if (this.widgets['bubble-collapsed'] == undefined || this.widgets['bubble-collapsed'] == null) {
      this.widgets['bubble-collapsed'] = false;
    }
    this.SelectedNodeCollapsingTypeVariable = this.widgets['bubble-collapsed'];
  }
  mapDataToCytoscapElements(data) {
    const nodes = data.map(node => {
      let size = this.SelectedNodeCollapsingTypeVariable ? this.nodeSize * Math.sqrt(node.totalCount) : this.nodeSize;
      // probably do something here for node size
      return {
        data: {
          id: node.id,
          nodeSize: size,
          nodeColor: node.color,
          label: node.id,
          counts: node.counts,
          totalCount: node.totalCount
        },
        position: {
          x: node.x * this.scaleFactor,
          y: node.y * this.scaleFactor
        }
      };
    });
    return {
      nodes: nodes,
      edges: null
    };
  }
  AddAxes() {
    let Axes = [];
    if (this.xVariable != 'None') {
      this.X_categories.forEach((value, i) => {
        let label = value == null || value == undefined ? 'Unknown' : value;
        Axes.push({
          group: 'nodes',
          data: {
            id: `x_axis${i}`,
            label: label
          },
          position: {
            x: i * this.scaleFactor,
            y: this.Y_categories.length * this.scaleFactor - 50
          },
          classes: ['X_axis']
        });
      });
      Axes.push({
        group: 'nodes',
        data: {
          id: 'x_axis_Label',
          label: this.commonService.capitalize(this.xVariable)
        },
        position: {
          x: (this.X_categories.length - 1) * this.scaleFactor / 2,
          y: this.Y_categories.length * this.scaleFactor
        },
        classes: ['X_axis', 'axisLabel']
      });
    }
    if (this.yVariable != 'None') {
      this.Y_categories.forEach((value, i) => {
        let label = value == null || value == undefined ? 'Unknown' : value;
        Axes.push({
          group: 'nodes',
          data: {
            id: `y_axis${i}`,
            label: label
          },
          position: {
            x: -100,
            y: i * this.scaleFactor
          },
          classes: ['Y_axis']
        });
      });
      Axes.push({
        group: 'nodes',
        data: {
          id: 'y_axis_Label',
          label: this.commonService.capitalize(this.yVariable)
        },
        position: {
          x: -150,
          y: (this.Y_categories.length - 1) * this.scaleFactor / 2
        },
        classes: ['Y_axis', 'axisLabel']
      });
    }
    this.cy.add(Axes);
    this.cy.fit(this.cy.nodes(), 30);
    this.cy.nodes().lock();
  }
  getCytoscapeStyle() {
    return [{
      selector: 'node',
      css: {
        //'background-color': 'data(nodeColor)', // Use dynamic node color
        //'label': 'data(label)',
        'width': 'data(nodeSize)',
        'height': 'data(nodeSize)',
        'border-width': 3,
        // Use dynamic border width
        'border-color': '#000000'
      }
    },
    // Apply styles only to nodes with nodeColor defined
    {
      selector: 'node[nodeColor]',
      css: {
        'background-color': 'data(nodeColor)'
      }
    }, {
      selector: '.X_axis',
      css: {
        'label': 'data(label)',
        'shape': 'rectangle',
        'border-width': 0,
        'background-color': 'white',
        'width': 1,
        'height': 1
      }
    }, {
      selector: '.Y_axis',
      css: {
        'label': 'data(label)',
        'shape': 'rectangle',
        //'border-color': 'none',
        'border-width': 0,
        'background-color': 'white',
        'width': 1,
        'height': 1,
        'text-valign': 'center'
      }
    }, {
      selector: '#y_axis_Label',
      css: {
        'text-rotation': 4.71239
      }
    }, {
      selector: '.axisLabel',
      css: {
        'font-size': 24
      }
    }, {
      selector: 'node:selected',
      css: {
        'border-color': '#ff8300'
      }
    }];
  }
  generateCytoscape() {
    this.cy = (0,cytoscape__WEBPACK_IMPORTED_MODULE_4__["default"])({
      container: this.cyContainer.nativeElement,
      elements: this.mapDataToCytoscapElements(this.visibleData),
      style: this.getCytoscapeStyle(),
      layout: {
        name: 'preset',
        fit: true,
        padding: 30
      },
      zoomingEnabled: true,
      userZoomingEnabled: false,
      panningEnabled: true,
      userPanningEnabled: false
    });
    this.AddAxes();
    this.cy.nodes().lock();
    // Example: Hover events
    this.cy.on('mouseover', 'node', evt => {
      const node = evt.target;
      if (node.classes().length > 0) return;
      this.showTooltip(node.data(), evt.originalEvent);
    });
    this.cy.on('mouseout', 'node', () => {
      this.hideTooltip();
    });
  }
  showTooltip(d, e) {
    let tooltipHTML = '';
    if (this.SelectedNodeCollapsingTypeVariable) {
      tooltipHTML = `
      <style>
        #bubbleToolTip {
          border-spacing: 0;
          width: 100%;
          //border: 1px solid #ddd;
          z-index: 1000;
        }

        #bubbleToolTip td, #bubbleToolTip th {
          text-align: center;
          padding: 2px;
          font-weight: 400;
          border: 1px solid #ddd;
        }

        #bubbleToolTip tr:nth-child(even) {
          background-color: #f2f2f2;
        }

        #bubbleToolTip tr:nth-child(odd) {
          background-color: #fff;
        } 
      </style>
      <table id="bubbleToolTip"><thead><th>${this.commonService.capitalize(this.commonService.session.style.widgets['node-color-variable'])}</th><th> Count </th><th> % </th></thead><tbody>`;
      d.counts.forEach(x => tooltipHTML += `<tr><td>${x.label}</td><td> ${x.count}</td><td>${(x.count / d.totalCount * 100).toFixed(1)}%</td></tr>`);
      tooltipHTML += '</tbody></table>';
    } else {
      tooltipHTML = `${d.id}`;
    }
    let [X, Y] = this.getRelativeMousePosition(event);
    this.toolTip.nativeElement.innerHTML = tooltipHTML;
    Object.assign(this.toolTip.nativeElement.style, {
      position: 'absolute',
      left: X + 20 + 'px',
      top: Y + 10 + 'px',
      zIndex: '1000',
      transition: 'opacity 100ms',
      opacity: '1'
    });
    this.toolTip.nativeElement.addEventListener('transitionend', () => {
      this.toolTip.nativeElement.style.zIndex = '1000';
    }, {
      once: true
    });
  }
  getRelativeMousePosition(event) {
    let rect = this.cyContainer.nativeElement.getBoundingClientRect();
    const X = event['clientX'] - rect.left;
    const Y = event['clientY'] - rect.top;
    return [X, Y];
  }
  hideTooltip() {
    Object.assign(this.toolTip.nativeElement.style, {
      transition: 'opacity 100ms',
      opacity: 0
    });
    this.toolTip.nativeElement.addEventListener('transitionend', () => {
      this.toolTip.nativeElement.style.zIndex = '-1';
    }, {
      once: true
    });
  }
  /**
   * Gets the data from commonService.getVisibleNodes and then creates node with this. Creates the axis labels and
   * (updates axes and places nodes with this.updateAxes and updates color of nodes with this.updateColors)
   */
  getData() {
    this.allData = [];
    let nodes = this.commonService.session.data.nodeFilteredValues;
    nodes.forEach(node => {
      let nodeDR = {
        index: node.index,
        id: node._id,
        x: 0,
        y: 0,
        color: '#ff00ff',
        Xgroup: 0,
        Ygroup: 0,
        strokeColor: node.selected ? this.commonService.session.style.widgets['selected-color'] : '#000000',
        totalCount: 1
      };
      if (this.xVariable != undefined || this.xVariable != 'None') {
        let nodeX = node[this.xVariable];
        let locX = this.X_categories.indexOf(nodeX);
        nodeDR.Xgroup = locX;
      }
      if (this.yVariable != undefined || this.yVariable != 'None') {
        let nodeY = node[this.yVariable];
        let locY = this.Y_categories.indexOf(nodeY);
        nodeDR.Ygroup = locY;
      }
      this.allData.push(nodeDR);
    });
    this.updateAxes();
    this.updateColors();
    if (this.widgets["node-timeline-variable"] != 'None') {
      this.sortData(this.widgets["node-timeline-variable"]);
      let currentLength = this.allData.length;
      this.visibleData = this.allData.slice(0, currentLength);
    }
    this.updateVisibleNodes();
  }
  /**
   * updates values of visibleNodes based on SelectedNodeCollapsingTypeVariable and if timeline mode is active
   */
  updateVisibleNodes() {
    // if no timeline and not collapsed
    if (this.widgets["node-timeline-variable"] == 'None' && this.SelectedNodeCollapsingTypeVariable == false) {
      this.visibleData = this.allData;
      // if timeline and not collapse
    } else if (this.widgets["node-timeline-variable"] != 'None' && this.SelectedNodeCollapsingTypeVariable == false) {
      let visibleNodes = this.commonService.getVisibleNodes();
      if (visibleNodes.length == this.visibleData.length) {
        return;
      }
      this.visibleData = [];
      this.allData.forEach(node => {
        if (visibleNodes.find(vNode => vNode._id == node.id)) {
          this.visibleData.push(node);
        }
      });
      // if no timeline and collapse
    } else if (this.widgets["node-timeline-variable"] == 'None') {
      // console.log(this.commonService.getVisibleNodes().length, this.visibleData.reduce((sum, obj) => sum + obj.totalCount, 0))
      this.getCollapsedData(false, false);
      // if timeline and collapse
    } else {
      if (this.commonService.getVisibleNodes().length == this.visibleData.reduce((sum, obj) => sum + obj.totalCount, 0)) {
        return;
      }
      this.getCollapsedData(false, false);
    }
  }
  /**
  * Updates the value of X_categories X_tickValues based on xVariables (or those variables for Y axis)
  * @param axis 'X' or anything else defaults to 'Y' axis
  */
  updateAxisValues(axis) {
    let nodes = this.commonService.session.data.nodeFilteredValues;
    if (axis == 'X') {
      this.widgets['bubble-x'] = this.xVariable;
      if (this.xVariable == 'None' || this.xVariable == undefined) {
        this.X_categories = [undefined];
        this.X_tickValues = [0];
      }
      this.X_categories = [];
      this.X_tickValues = [];
      nodes.forEach(node => {
        let nodeX = node[this.xVariable];
        if (this.X_categories.indexOf(nodeX) == -1) {
          this.X_tickValues.push(this.X_categories.length);
          this.X_categories.push(nodeX);
        }
      });
    } else {
      this.widgets['bubble-y'] = this.yVariable;
      if (this.yVariable == 'None' || this.yVariable == undefined) {
        this.Y_categories = [undefined];
        this.Y_tickValues = [0];
      }
      this.Y_categories = [];
      this.Y_tickValues = [];
      nodes.forEach(node => {
        let nodeY = node[this.yVariable];
        if (this.Y_categories.indexOf(nodeY) == -1) {
          this.Y_tickValues.push(this.Y_categories.length);
          this.Y_categories.push(nodeY);
        }
      });
    }
  }
  /**
   * Updates axis tickValues (X_tickValues & Y_tickValues) and positions for each node
   */
  updateAxes() {
    this.X_tickValues.forEach(xLoc => {
      this.Y_tickValues.forEach(yLoc => {
        let filteredNodes = this.allData.filter(node => node.Xgroup == xLoc && node.Ygroup == yLoc);
        if (filteredNodes.length == 0) {
          return;
        } else if (filteredNodes.length == 1) {
          filteredNodes[0].x = xLoc;
          filteredNodes[0].y = yLoc;
        } else {
          this.calculateHexagonalGridPositions(filteredNodes);
        }
      });
    });
  }
  /**
   * Updates this.visibleData so that each node represents a multiple datapoints instead of a single data point;
   * Also updates color/pattern of nodes so that they are pie charts based on proportion of each datapoint's color
   */
  getCollapsedData(sortData = false, initial = true) {
    if (this.widgets["node-timeline-variable"] != 'None' && sortData) {
      this.sortData(this.widgets["node-timeline-variable"]);
    }
    if (initial) {
      this.visibleData = [];
      let fullNodes = this.commonService.session.data.nodeFilteredValues;
      this.allData.forEach(node => {
        let X_group = 0,
          Y_group = 0;
        let currentFullNode = fullNodes.find(fNode => fNode.index == node.index);
        if (this.xVariable != undefined || this.xVariable != 'None') {
          let nodeX = currentFullNode[this.xVariable];
          X_group = this.X_categories.indexOf(nodeX);
        }
        if (this.yVariable != undefined || this.yVariable != 'None') {
          let nodeY = currentFullNode[this.yVariable];
          Y_group = this.Y_categories.indexOf(nodeY);
        }
        let index = this.visibleData.findIndex(node => node.Xgroup == X_group && node.Ygroup == Y_group);
        if (index == -1) {
          //console.log(X_group, Y_group)
          let length = this.visibleData.length;
          this.visibleData.push({
            index: length,
            id: `cNode${length}`,
            x: X_group,
            y: Y_group,
            color: node.color,
            Xgroup: X_group,
            Ygroup: Y_group,
            strokeColor: '#000000',
            totalCount: 0,
            counts: []
          });
        }
      });
    }
    let changedVisibleNodes = this.generateCollapsedCounts();
    this.generatePieChartsSVGDefs(changedVisibleNodes);
    this.cy.remove('node');
    this.updateNodes();
    this.cy.style().resetToDefault();
    this.cy.style(this.getCytoscapeStyle());
    this.visibleData.forEach((node, i) => {
      if (node.totalCount == 1 || node.counts.length == 1) {
        return;
      } else {
        let size = this.nodeSize * Math.sqrt(node.totalCount);
        let svgPattern = `<svg width='${size}' height='${size}' xmlns='http://www.w3.org/2000/svg'><defs>${this.svgDefs[`node${i}`]}</defs><circle fill="url(#node${i})" cx='${size / 2}' cy='${size / 2}' r='${size / 2}'/></svg>`;
        let b64 = 'data:image/svg+xml;base64,' + btoa(svgPattern);
        this.cy.style().selector(`#cNode${i}`).style({
          'background-color': 'transparent',
          'background-fit': 'cover',
          'background-image': b64
        });
      }
    });
    this.cy.style().update();
    this.updateAxes();
  }
  /**
   * Update the values for counts for each node in this.visibleData (relevant when nodes are collapsed). These values are used when creating a pie
   * chart of each collapsed node.
   * @returns an array of indexes of visibleData that was changed
   */
  generateCollapsedCounts() {
    let fullNodes = this.commonService.getVisibleNodes();
    let colorCategory = this.commonService.session.style.widgets['node-color-variable'];
    let changedVisibleNodes = [];
    this.visibleData.forEach(node => {
      if (node.id == '' && node.index == 1000) {
        node.counts = {
          label: '',
          count: 0
        };
        return;
      }
      let X = this.X_categories[node.Xgroup];
      let Y = this.Y_categories[node.Ygroup];
      let currentNodes = fullNodes.filter(fNode => fNode[this.xVariable] == X && fNode[this.yVariable] == Y);
      node.counts = [];
      let previousTotal = node.totalCount;
      node.totalCount = 0;
      currentNodes.forEach(cNode => {
        let currentCategory = cNode[colorCategory];
        let index = node.counts.findIndex(countItem => countItem.label == currentCategory);
        if (index == -1) {
          node.counts.push({
            label: currentCategory,
            count: 1
          });
        } else {
          node.counts[index].count += 1;
        }
        node.totalCount += 1;
      });
      if (previousTotal != node.totalCount) {
        //console.log('node updated: ', node.totalCount, node.index)
        changedVisibleNodes.push(node.index);
      }
    });
    return changedVisibleNodes;
  }
  /**
   * @returns a string representing the SVG def of the patterns needed to generate the pie chart
   */
  generatePieChartsSVGDefs(changedVisibleNodes) {
    changedVisibleNodes.forEach(indexNumber => {
      let patternString = '';
      let node = this.visibleData.find(vNode => vNode.index == indexNumber);
      if (node.totalCount < 2 || node.counts.length == 1 || node == undefined) {
        return;
      }
      let proportions = [];
      let coordinates = [];
      let colors = [];
      node.counts.forEach(x => {
        let proportion = proportions.reduce((acc, cv) => acc + cv, 0) + x.count / node.totalCount;
        let xPos = Math.cos(2 * Math.PI * proportion);
        let yPos = Math.sin(2 * Math.PI * proportion);
        proportions.push(x.count / node.totalCount);
        coordinates.push([xPos, yPos]);
        colors.push(this.commonService.temp.style.nodeColorMap(x.label));
      });
      patternString += `<pattern id='node${indexNumber}' viewBox='-1 -1 2 2' style='transform: rotate(-.25turn)' width='100%' height='100%'>`;
      for (let i = 0; i < coordinates.length; i++) {
        let arcStart = i == 0 ? '1 0' : coordinates[i - 1][0] + ' ' + coordinates[i - 1][1];
        let largeArcFlag = proportions[i] > .5 ? 1 : 0;
        let arcEnd = i == coordinates.length - 1 ? '1 0' : coordinates[i][0] + ' ' + coordinates[i][1];
        patternString += `<path d='M 0 0 L ${arcStart} A 1 1 0 ${largeArcFlag} 1 ${arcEnd} L 0 0' fill='${colors[i]}' />`;
      }
      patternString += '</pattern>';
      this.svgDefs[`node${indexNumber}`] = patternString;
    });
  }
  /**
   * Updates the color of the nodes in allData
   */
  updateColors() {
    let fillcolor = this.commonService.session.style.widgets['node-color'];
    let colorVariable = this.commonService.session.style.widgets['node-color-variable'];
    let fullNodes = this.commonService.session.data.nodeFilteredValues;
    this.allData.forEach(node => {
      let currentFullNode = fullNodes.find(Fnode => node.index == Fnode.index);
      node.color = colorVariable == 'None' ? fillcolor : this.commonService.temp.style.nodeColorMap(currentFullNode[colorVariable]);
    });
    if (this.cy && this.cy.nodes().length > 0) {
      this.cy.nodes().forEach(node => {
        if (node.classes().length > 0) return;
        let currentNode = this.allData.find(dataNode => dataNode.id == node.id());
        node.data('nodeColor', currentNode.color);
      });
      this.cy.style().update(); // Refresh Cytoscape styles to apply changes
    }
  }
  /**
   * Calculates the position (x, y) for the array of nodes; nodes are positioned in a layers spiral/hexagonal pattern
   */
  calculateHexagonalGridPositions(nodes) {
    // alternative method could use d3 forces and/or phyllotaxis arrangement
    // https://2019.wattenberger.com/blog/spirals
    const layerDistance = this.nodeSpacing + .02;
    let layer = 0;
    let nodesInLayer = 1;
    let count = 0;
    nodes.forEach(node => {
      const angle = 2 * Math.PI / nodesInLayer * count;
      node.x = node.Xgroup + layer * layerDistance * Math.cos(angle);
      node.y = node.Ygroup + layer * layerDistance * Math.sin(angle);
      count++;
      if (count >= nodesInLayer) {
        count = 0;
        layer++;
        nodesInLayer = 6 * layer;
      }
    });
  }
  onNodeCollapsingChange() {
    this.widgets['bubble-collapsed'] = this.SelectedNodeCollapsingTypeVariable;
    if (this.SelectedNodeCollapsingTypeVariable) {
      this.getCollapsedData(true);
    } else {
      this.cy.remove('node');
      this.getData();
      this.updateNodes();
    }
  }
  goldenLayoutComponentResize() {
    this.viewHeight = this.container.height - 73;
    this.viewWidth = this.container.width - 42;
    setTimeout(() => this.cy.fit(this.cy.nodes(), 30), 300);
  }
  setSelectedNodes(that) {
    if (that.commonService.visuals.bubble.SelectedNodeCollapsingTypeVariable) {
      return;
    }
    let nodes = that.commonService.getVisibleNodes();
    nodes.forEach(node => {
      let datum = that.visibleData.find(datum => datum.index == node.index);
      let datum_all = that.allData.find(datum => datum.index == node.index);
      if (node.selected) console.log('found: ', datum);
      datum.strokeColor = node.selected ? this.commonService.session.style.widgets['selected-color'] : '#000000';
      datum_all.strokeColor = node.selected ? this.commonService.session.style.widgets['selected-color'] : '#000000';
    });
    that.strokeColor = d => d.strokeColor;
  }
  updateNodes() {
    if (this.cy) {
      this.cy.remove('node');
      this.cy.add(this.mapDataToCytoscapElements(this.visibleData));
      this.AddAxes();
    }
  }
  onDataChange(axis) {
    this.updateAxisValues(axis);
    this.svgDefs = {};
    if (this.SelectedNodeCollapsingTypeVariable) {
      this.getCollapsedData(true);
    } else {
      this.getData();
    }
    this.updateNodes();
  }
  /**
   * Sorts this.allData chronologically based on the given sortVariable
   * @param sortVariable name of a property of commonService.session.data.nodeFilteredValues
   */
  sortData(sortVariable) {
    let allNodes = JSON.parse(JSON.stringify(this.commonService.session.data.nodeFilteredValues));
    allNodes.sort((a, b) => new Date(a[sortVariable]).getTime() - new Date(b[sortVariable]).getTime());
    let allData = [];
    allNodes.forEach(node => {
      allData.push(this.allData.find(dataNode => node._id == dataNode.id));
    });
    this.allData = allData;
    this.recalculatePositions();
    this.updateVisibleNodes();
    this.updateNodes();
  }
  /**
   * Recalculates the position of the nodes in allData
   */
  recalculatePositions() {
    this.X_tickValues.forEach(xLoc => {
      this.Y_tickValues.forEach(yLoc => {
        let filteredNodes = this.allData.filter(node => node.Xgroup == xLoc && node.Ygroup == yLoc);
        if (filteredNodes.length == 0) {
          return;
        } else if (filteredNodes.length == 1) {
          filteredNodes[0].x = xLoc;
          filteredNodes[0].y = yLoc;
        } else {
          this.calculateHexagonalGridPositions(filteredNodes);
        }
      });
    });
  }
  onNodeSpacingChange() {
    this.widgets['bubble-charge'] = this.nodeSpacing;
    this.recalculatePositions();
    if (this.cy) {
      this.cy.nodes().unlock();
      this.cy.nodes().positions((node, i) => {
        if (node.classes().length > 0) return;
        let current = this.visibleData[i];
        return {
          x: current.x * this.scaleFactor,
          y: current.y * this.scaleFactor
        };
      });
      this.cy.fit(this.cy.nodes(), 30);
      this.cy.nodes().lock();
    }
  }
  onNodeSizeChange() {
    this.widgets['bubble-size'] = this.nodeSize;
    if (this.SelectedNodeCollapsingTypeVariable) {
      if (this.cy) {
        this.cy.nodes().forEach(node => {
          node.data('nodeSize', this.nodeSize * Math.sqrt(node.data().totalCount));
        });
        this.cy.style().update();
        this.cy.fit(this.cy.nodes(), 30);
      }
    } else {
      this.recalculatePositions();
      if (this.cy) {
        this.cy.nodes().forEach(node => {
          node.data('nodeSize', this.nodeSize);
        });
        this.cy.style().update();
        this.cy.fit(this.cy.nodes(), 30);
      }
    }
  }
  /**
  * Opens Global Setting Dialog
  */
  showGlobalSettings() {
    this.DisplayGlobalSettingsDialogEvent.emit("Styling");
  }
  updateNodeColors() {
    if (this.SelectedNodeCollapsingTypeVariable) {
      let _ = this.generateCollapsedCounts();
      this.generatePieChartsSVGDefs(this.visibleData.map(obj => obj.index));
      this.cy.remove('node');
      this.getData();
      this.updateNodes();
      this.visibleData.forEach((node, i) => {
        if (node.totalCount == 1 || node.counts.length == 1) {
          let currrentVar = node.counts[0].label;
          //console.log(node, currrentVar)
          this.cy.style().selector(`#${node.id}`).style({
            'background-color': this.commonService.temp.style.nodeColorMap(currrentVar)
          });
          return;
        } else {
          let size = this.nodeSize * Math.sqrt(node.totalCount);
          let svgPattern = `<svg width='${size}' height='${size}' xmlns='http://www.w3.org/2000/svg'><defs>${this.svgDefs[`node${i}`]}</defs><circle fill="url(#node${i})" cx='${size / 2}' cy='${size / 2}' r='${size / 2}'/></svg>`;
          let b64 = 'data:image/svg+xml;base64,' + btoa(svgPattern);
          this.cy.style().selector(`#cNode${i}`).style({
            'background-color': 'transparent',
            'background-fit': 'cover',
            'background-image': b64
          });
        }
      });
      this.cy.style().update();
      let fillcolor = this.commonService.session.style.widgets['node-color'];
      let colorVariable = this.commonService.session.style.widgets['node-color-variable'];
      let fullNodes = this.commonService.session.data.nodeFilteredValues;
      this.allData.forEach(node => {
        let currentFullNode = fullNodes.find(Fnode => node.index == Fnode.index);
        node.color = colorVariable == 'None' ? fillcolor : this.commonService.temp.style.nodeColorMap(currentFullNode[colorVariable]);
      });
    } else {
      this.updateColors();
    }
  }
  getAxisLabel(axis) {
    if (axis == 'X') {
      if (this.xVariable == 'None') return;
      return this.commonService.capitalize(this.xVariable);
    } else {
      if (this.yVariable == 'None') return;
      return this.commonService.capitalize(this.yVariable);
    }
  }
  updateLinkColor() {}
  updateVisualization() {}
  applyStyleFileSettings() {
    this.widgets = window.context.commonService.session.style.widgets;
    if (this.widgets['bubble-x'] != undefined && this.selectedFieldList.map(x => x.value).includes(this.widgets['bubble-x'])) {
      this.xVariable = this.widgets['bubble-x'];
      this.onDataChange('X');
    } else {
      this.widgets['bubble-x'] = this.xVariable;
    }
    if (this.widgets['bubble-y'] != undefined && this.selectedFieldList.map(x => x.value).includes(this.widgets['bubble-y'])) {
      this.yVariable = this.widgets['bubble-y'];
      this.onDataChange('Y');
    } else {
      this.widgets['bubble-y'] = this.yVariable;
    }
    if (this.widgets['bubble-size'] >= 10 && this.widgets['bubble-size'] <= 40) {
      this.nodeSize = this.widgets['bubble-size'];
      this.onNodeSizeChange();
    } else {
      this.widgets['bubble-size'] = this.nodeSize;
    }
    if (this.widgets['bubble-charge'] >= .01 && this.widgets['bubble-charge'] <= .15) {
      this.nodeSpacing = this.widgets['bubble-charge'];
      this.onNodeSpacingChange();
    } else {
      this.widgets['bubble-charge'] = this.nodeSpacing;
    }
    if (this.widgets['bubble-collapsed'] == undefined || this.widgets['bubble-collapsed'] == null) {
      this.widgets['bubble-collapsed'] = this.SelectedNodeCollapsingTypeVariable;
    } else if (this.widgets['bubble-collapsed'] != this.SelectedNodeCollapsingTypeVariable) {
      this.SelectedNodeCollapsingTypeVariable = this.widgets['bubble-collapsed'];
      this.onNodeCollapsingChange();
    }
  }
  openRefreshScreen() {}
  onRecallSession() {}
  onLoadNewData() {}
  onFilterDataChange() {}
  openExport() {
    this.setCalculatedResolution();
    this.exportOpen = true;
  }
  /**
  * Sets CalculatedResolution variable to string such as '1250 x 855px'. Only called when export is first opened
  */
  setCalculatedResolution() {
    this.CalculatedResolution = Math.round((this.viewWidth - 42) * this.SelectedBubbleExportScaleVariable) + " x " + Math.round((this.viewHeight - 73) * this.SelectedBubbleExportScaleVariable) + "px";
  }
  /**
   * Updates CalculatedResolution variable to string such as '1250 x 855px' based on ImageDimensions and SelectedNetworkExportScaleVariable.
   * This is called anytime SelectedNetworkExportScaleVariable is updated.
   */
  updateCalculatedResolution() {
    this.CalculatedResolution = Math.round((this.viewWidth - 42) * this.SelectedBubbleExportScaleVariable) + " x " + Math.round((this.viewHeight - 73) * this.SelectedBubbleExportScaleVariable) + "px";
    this.cdref.detectChanges();
  }
  exportVisualization() {
    const exportOptions = {
      filename: this.BubbleExportFileName,
      filetype: this.BubbleExportFileType,
      scale: this.SelectedBubbleExportScaleVariable,
      quality: 1
    };
    // Set export options in the service
    this.exportService.setExportOptions(exportOptions);
    if (this.BubbleExportFileType == 'svg') {
      let options = {
        scale: 1,
        full: true,
        bg: '#ffffff'
      };
      let content = this.cy.svg(options);
      this.exportService.requestSVGExport([], content, true, false);
    } else {
      this.exportService.requestExport([this.cyContainer.nativeElement], true, false);
    }
    this.exportOpen = false;
  }
  openSettings() {
    this.settingsOpen = true;
  }
  static {
    this.ctorParameters = () => [{
      type: _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_8__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_7__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_2__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_7__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_7__.ChangeDetectorRef
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_9__.GoogleTagManagerService
    }, {
      type: _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_6__.ExportService
    }];
  }
  static {
    this.propDecorators = {
      DisplayGlobalSettingsDialogEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_7__.Output
      }],
      cyContainer: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_7__.ViewChild,
        args: ['cyBubble', {
          static: false
        }]
      }],
      toolTip: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_7__.ViewChild,
        args: ['bubbleTooltip']
      }]
    };
  }
};
BubbleComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_10__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_7__.Component)({
  selector: 'bubble-component',
  template: _bubble_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  styles: [(_bubble_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_10__.__metadata)("design:paramtypes", [_app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_8__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_7__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_7__.ChangeDetectorRef, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_9__.GoogleTagManagerService, _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_6__.ExportService])], BubbleComponent);

(function (BubbleComponent) {
  BubbleComponent.componentTypeName = 'Bubble';
})(BubbleComponent || (BubbleComponent = {}));

/***/ }),

/***/ 59972:
/*!****************************************************************************************!*\
  !*** ./src/app/visualizationComponents/CrosstabComponent/crosstab-plugin.component.ts ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CrosstabComponent: () => (/* binding */ CrosstabComponent)
/* harmony export */ });
/* harmony import */ var _Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 89204);
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _crosstab_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./crosstab-plugin.component.html?ngResource */ 99800);
/* harmony import */ var _crosstab_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./crosstab-plugin.component.scss?ngResource */ 70926);
/* harmony import */ var _crosstab_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_crosstab_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);









// import pdfMake from 'pdfmake/build/pdfmake.js';
// import pdfFonts from 'pdfmake/build/vfs_fonts.js'



let CrosstabComponent = class CrosstabComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_4__.BaseComponentDirective {
  constructor(injector, renderer, elem, eventManager, commonService, container, elRef, cdref, gtmService) {
    super(elRef.nativeElement);
    this.renderer = renderer;
    this.elem = elem;
    this.eventManager = eventManager;
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.gtmService = gtmService;
    this.viewActive = true;
    this.showOptions = [{
      label: 'Counts',
      value: false
    }, {
      label: 'Proportion',
      value: true
    }];
    this.settingsOpen = true;
    this.exportOpen = false;
    this.SelectedCrossTabExportFilename = "";
    this.SelectedCrossTabExportFileType = 'csv';
    this.CrossTabExportFileTypeList = [{
      label: 'xlsx',
      value: 'xlsx'
    }, {
      label: 'csv',
      value: 'csv'
    }, {
      label: 'json',
      value: 'json'
    }, {
      label: 'pdf',
      value: 'pdf'
    }];
    this.selectedSize = '';
    this.sizes = [{
      name: 'Small',
      class: 'p-datatable-sm'
    }, {
      name: 'Normal',
      class: ''
    }, {
      name: 'Large',
      class: 'p-datatable-lg'
    }];
    this.visuals = commonService.visuals;
    this.visuals.crossTab = this;
    this.widgets = this.commonService.session.style.widgets;
  }
  ngOnInit() {
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/crosstab",
      page_title: "Crosstab View"
    });
    this.updateFieldLists();
    this.setWidgets();
    this.updateTable();
    // offsets: 70 table-wrapper padding-top, 10 table-wrapper padding-bottom
    let pFooterHeight = this.selectedSize == 'p-datatable-sm' ? 41 : this.selectedSize == 'p-datatable-lg' ? 65 : 57;
    this.scrollHeight = $('crosstabcomponent').height() - 70 - 10 - pFooterHeight + 'px';
    let width = $('crosstabcomponent').width() - 23 + 'px';
    this.tableStyleCrosstab = {
      'max-width': width,
      'display': 'block'
    };
    this.container.on('resize', () => {
      this.goldenLayoutComponentResize();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.cdref.detectChanges();
    });
  }
  /**
   * Set Default widgets if not previously defined or when a style file is loaded
   */
  setWidgets() {
    // x and y variable
    if (this.widgets['crosstab-xVariable'] == undefined || !this.fieldList.map(x => x.value).includes(this.widgets['crosstab-xVariable'])) {
      this.xVariable = 'cluster';
      this.widgets['crosstab-xVariable'] = 'cluster';
    } else {
      this.xVariable = this.widgets['crosstab-xVariable'];
    }
    if (this.widgets['crosstab-yVariable'] == undefined || !this.fieldList.map(x => x.value).includes(this.widgets['crosstab-yVariable'])) {
      this.yVariable = 'None';
      this.widgets['crosstab-yVariable'] = 'None';
    } else {
      this.yVariable = this.widgets['crosstab-yVariable'];
    }
    // use proportion
    if (this.widgets['crosstab-useProportion'] == undefined) {
      this.widgets['crosstab-useProportion'] = false;
    }
  }
  /**
   * Generates the table by counting the data. Converts the counts into proportions if needed
   */
  updateTable() {
    var xValues = [],
      yValues = [];
    let rawdata = this.commonService.getVisibleNodes();
    // get values for X and Y axis
    rawdata.forEach(row => {
      var val = row[this.xVariable];
      if (!xValues.includes(val)) xValues.push(val);
      val = row[this.yVariable];
      if (!yValues.includes(val)) yValues.push(val);
    });
    xValues.push('Total');
    yValues.push('Total');
    xValues = xValues.map(String);
    // populate count array [{}, {}, ...] where each item/object is a row
    var data = [];
    this.totalRow = {
      col: 'Total'
    };
    xValues.forEach(col => this.totalRow[col] = 0);
    rawdata.forEach(row => {
      var match = data.find(arow => arow.col == row[this.widgets['crosstab-yVariable']]);
      if (match) {
        match[row[this.xVariable]]++;
        match['Total']++;
      } else {
        var newRow = {
          col: row[this.widgets['crosstab-yVariable']]
        };
        xValues.forEach(col => newRow[col] = 0);
        newRow[row[this.xVariable]]++;
        newRow['Total'] = 1;
        data.push(newRow);
      }
      this.totalRow[row[this.xVariable]]++;
    });
    this.totalRow['Total'] = Object.keys(this.totalRow).filter(key => key != 'col').reduce((acc, key) => acc + this.totalRow[key], 0);
    data.forEach(row => {
      row.col = String(row.col);
    });
    this.SelectedTableData = {
      tableColumns: [{
        field: 'col',
        header: ''
      }],
      data: data
    };
    xValues.forEach(value => {
      this.SelectedTableData.tableColumns.push({
        field: value,
        header: value
      });
    });
    if (this.widgets['crosstab-useProportion']) {
      this.convertToProportion();
    }
  }
  /**
   * Calculate proportion instead of count for each cell based on total.
   */
  convertToProportion() {
    // Future updates may give option for proportion based on col and row as well
    // But it's not clear how to work with pivot function (would proportion by row/X become by col/Y or not)
    let total = this.totalRow['Total'];
    this.SelectedTableData.data.forEach(row => {
      Object.keys(row).forEach(key => {
        if (key == 'col') return;
        row[key] = (row[key] / total).toFixed(3);
      });
    });
    Object.keys(this.totalRow).forEach(key => {
      if (key == 'col') return;
      this.totalRow[key] = (this.totalRow[key] / total).toFixed(3);
    });
    //this.cdref.detectChanges();
  }
  /**
   * Switch the value of widgets['crosstab-xVariable'] and widgets['crosstab-yVariable'], and then updates the values in the table so that it pivots.
   * This function does not recount the value.
   */
  pivotCrosstab() {
    // switch widgets['crosstab-xVariable'] and yVariable
    let tmp = this.xVariable;
    this.xVariable = this.yVariable;
    this.yVariable = tmp;
    // use prevData and prevColumn to generate the newData and newTableColumns
    let prevData = this.SelectedTableData.data;
    let prevColumns = this.SelectedTableData.tableColumns.slice(1).map(obj => obj.header);
    let newData = [];
    let newTotalRow = {
      col: 'Total'
    };
    let newTableColumns = [{
      field: 'col',
      header: ''
    }];
    prevData.forEach(row => {
      newTableColumns.push({
        field: row.col,
        header: row.col
      });
      newTotalRow[row.col] = row['Total'];
    });
    newTableColumns.push({
      field: 'Total',
      header: 'Total'
    });
    prevColumns.forEach(pcol => {
      if (pcol == 'Total') return;
      let newRow = {
        col: pcol
      };
      newTableColumns.forEach(ncol => {
        if (ncol.header == '') return;else if (ncol.header == 'Total') {
          newRow['Total'] = this.totalRow[pcol];
          return;
        }
        newRow[ncol.field] = prevData.find(aRow => aRow.col == ncol.field)[pcol];
      });
      newData.push(newRow);
    });
    newTotalRow['Total'] = this.totalRow['Total'];
    // update the table with new values
    this.SelectedTableData = {
      tableColumns: newTableColumns,
      data: newData
    };
    this.totalRow = newTotalRow;
    this.widgets['crosstab-xVariable'] = this.xVariable;
    this.widgets['crosstab-yVariable'] = this.yVariable;
  }
  /**
   * Converts the data into proportion or recounts the data
   */
  useProportionChanged() {
    if (this.widgets['crosstab-useProportion']) {
      this.convertToProportion();
    } else {
      this.updateTable();
    }
  }
  formatTableTitle() {
    if (this.xVariable != 'None' && this.yVariable != 'None') {
      return `${this.commonService.capitalize(this.xVariable.replace("_", ""))} vs ${this.commonService.capitalize(this.yVariable.replace("_", ""))}`;
    } else if (this.xVariable != 'None') {
      return `${this.commonService.capitalize(this.xVariable.replace("_", ""))}`;
    } else if (this.yVariable != 'None') {
      return `${this.commonService.capitalize(this.yVariable.replace("_", ""))}`;
    } else {
      return '';
    }
  }
  /**
   * Updates the stored values and table when the widgets['crosstab-xVariable'] or widgets['crosstab-yVariable'] is changed
   */
  onDataChange() {
    this.widgets['crosstab-xVariable'] = this.xVariable;
    this.widgets['crosstab-yVariable'] = this.yVariable;
    this.updateTable();
  }
  /**
   * Updates the values for the fieldListDictionary then updates the fieldList
   */
  updateFieldLists() {
    this.fieldList = [];
    this.fieldList.push({
      label: "None",
      value: "None"
    });
    this.commonService.session.data['nodeFields'].map(d => {
      if (['seq', 'origin', '_diff', '_ambiguity', 'index', '_id'].includes(d)) return;
      this.fieldList.push({
        label: this.commonService.capitalize(d.replace("_", "")),
        value: d
      });
    });
  }
  updateNodeColors() {}
  updateVisualization() {}
  applyStyleFileSettings() {
    this.widgets = window.context.commonService.session.style.widgets;
    let tempX, tempY;
    if (this.widgets['crosstab-xVariable'] != undefined) {
      tempX = this.widgets['crosstab-xVariable'];
    }
    if (this.widgets['crosstab-yVariable'] != undefined) {
      tempY = this.widgets['crosstab-yVariable'];
    }
    this.cdref.detectChanges();
    // x and y variable
    if (tempX == undefined || !this.fieldList.map(x => x.value).includes(tempX)) {
      this.xVariable = 'None';
      this.widgets['crosstab-xVariable'] = 'None';
    } else {
      this.xVariable = tempX;
      this.widgets['crosstab-xVariable'] = tempX;
    }
    if (tempY == undefined || !this.fieldList.map(x => x.value).includes(tempY)) {
      this.yVariable = 'None';
      this.widgets['crosstab-yVariable'] = 'None';
    } else {
      this.yVariable = tempY;
      this.widgets['crosstab-yVariable'] = tempY;
    }
    // use proportion
    if (this.widgets['crosstab-useProportion'] == undefined) {
      this.widgets['crosstab-useProportion'] = false;
    }
    this.updateTable();
  }
  updateLinkColor() {}
  openRefreshScreen() {}
  onRecallSession() {}
  onLoadNewData() {
    this.updateTable();
  }
  onFilterDataChange() {
    this.updateTable();
  }
  /**
   * Opens the settings menu
   */
  openSettings() {
    this.settingsOpen = true;
  }
  /**
   * Opens the export menu
   */
  openExport() {
    this.exportOpen = true;
  }
  /**
   * Exports visualization as csv file or calls saveAsExcelFile to save as Excel
   */
  exportVisualization() {
    var _this = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      if (_this.SelectedCrossTabExportFileType == 'xlsx') {
        _this.saveAsExcelFile();
      } else if (_this.SelectedCrossTabExportFileType == 'csv') {
        _this.dataTable.exportFilename = _this.SelectedCrossTabExportFilename;
        _this.dataTable.value.push(_this.totalRow);
        _this.dataTable.exportCSV();
        _this.dataTable.value.pop();
      } else if (_this.SelectedCrossTabExportFileType == 'json') {
        let keys = Object.keys(_this.SelectedTableData.data[0]);
        let data = _this.SelectedTableData.data.map(row => {
          let output = {};
          keys.forEach(key => {
            if (key == 'Total') return;else if (row[key] == 'null') {
              output[key] = null;
            } else {
              output[key] = row[key];
            }
          });
          return output;
        });
        let blob = new Blob([JSON.stringify(data)], {
          type: "application/json;charset=utf-8"
        });
        file_saver__WEBPACK_IMPORTED_MODULE_3__(blob, _this.SelectedCrossTabExportFilename + '.json');
      } else {
        let columns = ['col'];
        _this.SelectedTableData.tableColumns.forEach(col => {
          if (col.header != '') {
            columns.push(col.header);
          }
        });
        let dataBody = [_this.SelectedTableData.tableColumns.map(col => {
          if (col.header == '') return _this.commonService.capitalize(_this.yVariable);
          return _this.commonService.capitalize(col.header);
        })].concat(_this.SelectedTableData.data.map(formatData)).concat([formatData(_this.totalRow)]);
        function formatData(dataRow) {
          return columns.map(header => dataRow[header]);
        }
        try {
          const {
            default: pdfMake
          } = yield __webpack_require__.e(/*! import() */ 888).then(__webpack_require__.t.bind(__webpack_require__, /*! pdfmake/build/pdfmake.js */ 27888, 23));
          const {
            default: pdfFonts
          } = yield __webpack_require__.e(/*! import() */ 360).then(__webpack_require__.t.bind(__webpack_require__, /*! pdfmake/build/vfs_fonts.js */ 55360, 23));
          pdfMake.vfs = pdfFonts;
          pdfMake.createPdf({
            content: [{
              image: _this.commonService.watermark
            }, {
              text: "Cluster Crosstab Snapshot:",
              style: "header",
              alignment: "center"
            }, {
              text: `${_this.commonService.capitalize(_this.xVariable)} vs ${_this.commonService.capitalize(_this.yVariable)}`,
              style: "fontSize: 18",
              alignment: "center"
            }, {
              style: "paddedTable",
              table: {
                headerRows: 1,
                widths: _this.SelectedTableData.tableColumns.map(col => "*"),
                body: dataBody
              }
            }],
            footer: function (currentPage, pageCount) {
              return [{
                text: `Page ${currentPage.toString()} of ${pageCount}`,
                alignment: "center"
              }];
            },
            styles: {
              header: {
                fontSize: 22,
                bold: true
              },
              paddedTable: {
                margin: [10, 10, 10, 10]
              }
            }
          }).download(_this.SelectedCrossTabExportFilename + '.pdf');
        } catch (error) {
          console.error('Unable to export pdf: ', error);
        }
      }
      _this.exportOpen = !_this.exportOpen;
    })();
  }
  /**
   * Exports the data as an excel file
   */
  saveAsExcelFile() {
    Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! xlsx */ 13857)).then(xlsx => {
      this.dataTable.value.push(this.totalRow);
      let headers = [];
      this.SelectedTableData.tableColumns.forEach(item => headers.push(item.field));
      let worksheet = xlsx.utils.json_to_sheet(this.dataTable.value, {
        header: headers
      });
      const workbook = {
        Sheets: {
          'data': worksheet
        },
        SheetNames: ['data']
      };
      const excelBuffer = xlsx.write(workbook, {
        bookType: 'xlsx',
        type: 'array'
      });
      const EXCEL_TYPE = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';
      const data = new Blob([excelBuffer], {
        type: EXCEL_TYPE
      });
      file_saver__WEBPACK_IMPORTED_MODULE_3__(data, this.SelectedCrossTabExportFilename + '.xlsx');
      this.dataTable.value.pop();
    });
  }
  /**
   * Resizes the component as need based on how the goldenlayout dashboard is resized
   */
  goldenLayoutComponentResize() {
    let pFooterHeight = this.selectedSize == 'p-datatable-sm' ? 41 : this.selectedSize == 'p-datatable-lg' ? 65 : 57;
    this.scrollHeight = $('crosstabcomponent').height() - 70 - 10 - pFooterHeight + 'px';
    let width = $('crosstabcomponent').width() - 23 + 'px';
    this.tableStyleCrosstab = {
      'max-width': width,
      'display': 'block'
    };
  }
  onTableSizeChange() {
    let pFooterHeight = this.selectedSize == 'p-datatable-sm' ? 41 : this.selectedSize == 'p-datatable-lg' ? 65 : 57;
    console.log('abc', pFooterHeight);
    this.scrollHeight = $('crosstabcomponent').height() - 70 - 10 - pFooterHeight + 'px';
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_6__.Injector
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_6__.Renderer2
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_6__.ElementRef
    }, {
      type: _angular_platform_browser__WEBPACK_IMPORTED_MODULE_7__.EventManager
    }, {
      type: _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_5__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_8__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_6__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_4__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_6__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_6__.ChangeDetectorRef
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_9__.GoogleTagManagerService
    }];
  }
  static {
    this.propDecorators = {
      dataTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_6__.ViewChild,
        args: ['dt']
      }]
    };
  }
};
CrosstabComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_10__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_6__.Component)({
  selector: 'CrosstabComponent',
  template: _crosstab_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__,
  styles: [(_crosstab_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_10__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_6__.Injector, _angular_core__WEBPACK_IMPORTED_MODULE_6__.Renderer2, _angular_core__WEBPACK_IMPORTED_MODULE_6__.ElementRef, _angular_platform_browser__WEBPACK_IMPORTED_MODULE_7__.EventManager, _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_5__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_8__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_6__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_6__.ChangeDetectorRef, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_9__.GoogleTagManagerService])], CrosstabComponent);

(function (CrosstabComponent) {
  CrosstabComponent.componentTypeName = 'Crosstab';
})(CrosstabComponent || (CrosstabComponent = {}));

/***/ }),

/***/ 2143:
/*!***********************************************************************************!*\
  !*** ./src/app/visualizationComponents/GanttComponent/constants/color-schemes.ts ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   colorSchemes: () => (/* binding */ colorSchemes)
/* harmony export */ });
const colorSchemes = {
  colorful: ['#EAC435', '#345995', '#03CEA4', '#FF6B6B', '#CA1551', '#3A3335', '#FFE19C', '#C1FFF2', '#511730', '#8789C0'],
  cool: ['#5680E9', '#84CEEB', '#5AB9EA', '#C1C8E4', '#8860D0', '#7555E8', '#69C6EA', '#5971EA', '#AAACE2', '#C060D1'],
  warm: ['#BA9434', '#FFE899', '#FFAC47', '#FF813D', '#E55730', '#BA9948', '#A38B3C', '#A36E2E', '#A35327', '#92381F']
};

/***/ }),

/***/ 57473:
/*!*********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/GanttComponent/gantt-chart/gantt-chart.component.ts ***!
  \*********************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GanttChartComponent: () => (/* binding */ GanttChartComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _gantt_chart_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./gantt-chart.component.html?ngResource */ 33215);
/* harmony import */ var _gantt_chart_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./gantt-chart.component.scss?ngResource */ 17339);
/* harmony import */ var _gantt_chart_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_gantt_chart_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _constants_color_schemes__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../constants/color-schemes */ 2143);
/* harmony import */ var _gantt_chart_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./gantt-chart.service */ 15013);






let GanttChartComponent = class GanttChartComponent {
  addDays(date, days) {
    const newdate = new Date(date);
    newdate.setDate(new Date(date).getDate() + days);
    const day = newdate.getDate();
    const monthIndex = newdate.getMonth();
    const year = newdate.getFullYear();
    return this.monthNames[monthIndex] + ' ' + day + ', ' + year;
  }
  shortenDate(date) {
    if (typeof date === "string") {
      date = date.replace('January', 'Jan');
      date = date.replace('February', 'Feb');
      date = date.replace('March', 'Mar');
      date = date.replace('April', 'Apr');
      date = date.replace('May', 'May');
      date = date.replace('June', 'Jun');
      date = date.replace('July', 'Jul');
      date = date.replace('August', 'Aug');
      date = date.replace('September', 'Sep');
      date = date.replace('October', 'Oct');
      date = date.replace('November', 'Nov');
      date = date.replace('December', 'Dec');
    }
    return date;
  }
  computeGrid() {
    this.cdref.detectChanges();
    // compute the min date and max date
    // const oneDay = 24 * 60 * 60 * 1000;
    // const dateRange = Math.round(Math.abs(
    //     (this.ganttChartService.ganttMaxDate.getTime()
    //      - this.ganttChartService.ganttMinDate.getTime()
    //      ) / (oneDay)));
    let flag = 0;
    let qts = 1;
    // 3m --> 1 week  --> 12
    // 6m --> 2 weeks --> 12
    // 9m --> 3 weeks --> 12
    while (flag === 0) {
      if (this.ganttChartService.ganttDateRange <= 90 * qts) {
        this.gridPrecisionX = 7 * qts;
        flag = 1;
      } else qts = qts + 1;
    }
    // console.log(this.gridPrecisionX);
    this.gridWidthX = this.ganttChartService.transformX(this.gridPrecisionX);
    this.gridWidthY = this.ganttChartService.rectHeight / this.ganttChartService.ganttPhases.length;
    this.gridPath = 'M ' + this.gridWidthX + ' 0 L 0 0 0 ' + this.gridWidthY;
    this.xAxis = [];
    this.yAxis = [];
    let date = this.ganttChartService.ganttMinDate;
    // let xPos = this.ganttChartService.transformGanttDate(date) + this.ganttChartService.xPadding + 150;
    const yTrans = this.ganttChartService.rectHeight + this.ganttChartService.yPadding + 10;
    // let transform = 'translate(' + xPos + 'px, ' + yTrans + 'px)';
    // this.xAxis.push({xPos: xPos, value: date, transform: transform});
    while (new Date(date) <= new Date(this.ganttChartService.ganttMaxDate)) {
      // console.log(date);
      const xPos = this.ganttChartService.transformGanttDate(date) + this.ganttChartService.xPadding + 150;
      const transform = 'translate(' + xPos + 'px, ' + yTrans + 'px)';
      this.xAxis.push({
        xPos,
        value: this.shortenDate(date),
        transform
      });
      date = this.addDays(date, this.gridPrecisionX);
    }
    // console.log(this.xAxis);
    let cnt = 0;
    for (const phase of this.ganttChartService.ganttPhases) {
      const yPos = this.gridWidthY * cnt + this.gridWidthY * 0.5 + this.ganttChartService.yPadding;
      this.yAxis.push({
        yPos,
        value: phase
      });
      cnt++;
    }
    // console.log(this.yAxis);
    // console.log(this.xAxis);
  }
  getWidth(gEntry) {
    if (gEntry.to === gEntry.from) {
      return 15;
    } else {
      return this.ganttChartService.transformGanttDate(gEntry.to) - this.ganttChartService.transformGanttDate(gEntry.from);
    }
  }
  setDimensions() {
    if (this.width) this.height = this.width - this.xPadding;else {
      const host = this.currentElement.nativeElement;
      if (host.parentNode != null) {
        const dims = host.parentNode.getBoundingClientRect();
        this.width = dims.width;
        this.height = this.width - this.xPadding;
      }
    }
    /*
    console.log('---set dimensions---');
    console.log('width: ' + this.width);
    console.log('height: ' + this.height);
    console.log('--------------------');
    */
  }
  setColors() {
    let cnt = 0;
    for (const team of this.data) {
      if (!team.color) {
        if (this.customColorScheme.length > 0) {
          team.color = this.customColorScheme[cnt % this.customColorScheme.length];
        } else {
          team.color = _constants_color_schemes__WEBPACK_IMPORTED_MODULE_2__.colorSchemes[this.colorScheme][cnt % 10];
        }
        cnt++;
      }
    }
  }
  definePhaseTimelines() {
    this.phaseTimelines = {};
    for (const phase of this.ganttChartService.ganttPhases) {
      this.phaseTimelines[phase] = [];
    }
    for (const team of this.ganttChartService.data) {
      for (const phase of Object.keys(team.timelines)) {
        for (const timeline of team.timelines[phase]) {
          this.phaseTimelines[phase].push({
            from: timeline.from,
            to: timeline.to,
            color: team.color,
            info: timeline.info,
            toolTip: timeline.info ? 'block' : 'none'
          });
        }
      }
    }
    // console.log('phase timelines: ');
    // console.log(this.phaseTimelines);
  }
  // setColors() {
  //   let cnt = 0;
  //   for (const team of this.ganttChartService.data) {
  //     if (!team.color) team.color = colorSchemes[this.ganttChartService.colorScheme][cnt % 10];
  //     cnt++;
  //   }
  // }
  constructor(ganttChartService, currentElement, cdref) {
    this.ganttChartService = ganttChartService;
    this.currentElement = currentElement;
    this.cdref = cdref;
    this.colorScheme = 'colorful';
    this.customColorScheme = [];
    this.xPadding = 60;
    this.yPadding = this.xPadding / 2;
    this.monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  }
  ngOnInit() {
    this.cdref.detectChanges();
    this.componentID = 1;
    this.setDimensions();
    this.setColors();
    this.ganttChartService.setValues({
      componentID: this.componentID,
      width: this.width,
      xPadding: this.xPadding,
      yPadding: this.yPadding,
      data: this.data
    });
    this.gridID = 'grid' + this.ganttChartService.componentID;
    this.height = this.ganttChartService.height;
    this.definePhaseTimelines();
    this.computeGrid();
  }
  ngOnChanges() {
    this.setDimensions();
    this.setColors();
    this.ganttChartService.setValues({
      componentID: this.componentID,
      width: this.width,
      xPadding: this.xPadding,
      yPadding: this.yPadding,
      data: this.data
    });
    this.height = this.ganttChartService.height;
    this.definePhaseTimelines();
    this.computeGrid();
  }
  static {
    this.ctorParameters = () => [{
      type: _gantt_chart_service__WEBPACK_IMPORTED_MODULE_3__.GanttChartService
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_4__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_4__.ChangeDetectorRef
    }];
  }
  static {
    this.propDecorators = {
      data: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_4__.Input
      }],
      width: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_4__.Input
      }],
      colorScheme: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_4__.Input
      }],
      customColorScheme: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_4__.Input
      }]
    };
  }
};
GanttChartComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_5__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_4__.Component)({
  selector: 'ngx-gantt-chart',
  template: _gantt_chart_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  providers: [_gantt_chart_service__WEBPACK_IMPORTED_MODULE_3__.GanttChartService],
  styles: [(_gantt_chart_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_5__.__metadata)("design:paramtypes", [_gantt_chart_service__WEBPACK_IMPORTED_MODULE_3__.GanttChartService, _angular_core__WEBPACK_IMPORTED_MODULE_4__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_4__.ChangeDetectorRef])], GanttChartComponent);


/***/ }),

/***/ 15013:
/*!*******************************************************************************************!*\
  !*** ./src/app/visualizationComponents/GanttComponent/gantt-chart/gantt-chart.service.ts ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GanttChartService: () => (/* binding */ GanttChartService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/core */ 37580);


let GanttChartService = class GanttChartService {
  constructor() {
    this.ganttOpacity = "0.9";
    this.monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  }
  computeRectDimensions() {
    this.rectWidth = this.width - this.xPadding * 2 - 150;
    this.rectHeight = this.ganttPhases.length * 60;
  }
  computeLegionDimensions() {
    const noOfLines = Math.ceil(this.data.length / 3);
    this.legionWidth = this.width - this.xPadding * 2 - 150;
    this.legionHeight = 40 + 40 * noOfLines;
  }
  transformX(x) {
    return this.rectWidth * x / (this.maxX - this.minX);
  }
  computeLegion() {
    const noOfLines = Math.ceil(this.data.length / 3);
    this.legion = [];
    let cnt = 0;
    for (let line = 0; line < noOfLines; line++) {
      const legionLine = [];
      for (let i = 0; i < 3; i++) {
        if (this.ganttTeams[cnt]) legionLine.push(this.ganttTeams[cnt]);
        cnt++;
      }
      this.legion.push(legionLine);
    }
    // console.log(this.legion);
  }
  transformGanttDate(d) {
    const oneDay = 24 * 60 * 60 * 1000;
    const daysSinceMinDate = Math.round(Math.abs((new Date(d).getTime() - new Date(this.ganttMinDate).getTime()) / oneDay));
    return this.rectWidth * daysSinceMinDate / (this.maxX - this.minX);
  }
  closestMultipleLessThanEqualTo(factor, num) {
    if (num % factor === 0) return num;else return this.closestMultipleLessThanEqualTo(factor, num - 1);
  }
  closestMultipleMoreThanEqualTo(factor, num) {
    if (num % factor === 0) return num;else return this.closestMultipleMoreThanEqualTo(factor, num + 1);
  }
  setValues({
    componentID: componentID,
    width: width,
    xPadding: xPadding,
    yPadding: yPadding,
    data: data
  }) {
    this.componentID = componentID;
    this.width = width;
    this.xPadding = xPadding;
    this.yPadding = yPadding;
    this.data = data;
    const froms = [];
    const tos = [];
    const phases = new Set();
    this.ganttTeams = [];
    // this.setColors();
    for (const team of this.data) {
      this.ganttTeams.push({
        name: team.name,
        color: team.color,
        opacity: team.opacity
      });
      for (const phase of Object.keys(team.timelines)) {
        phases.add(phase);
        for (const timeline of team.timelines[phase]) {
          froms.push(timeline.from);
          tos.push(timeline.to);
        }
      }
    }
    this.ganttPhases = Array.from(phases);
    const minDate = froms.filter(x => x !== null && x !== "null").reduce((a, b) => new Date(a) < new Date(b) ? a : b);
    const maxDate = tos.filter(x => x !== null && x !== "null").reduce((a, b) => new Date(a) > new Date(b) ? a : b);
    this.ganttMinDate = minDate;
    this.ganttMaxDate = maxDate;
    const noOfLines = Math.ceil(this.data.length / 3);
    this.height = this.ganttPhases.length * 60 + this.yPadding * 3 + 100 + 40 + 30 * noOfLines;
    const oneDay = 24 * 60 * 60 * 1000;
    this.ganttDateRange = Math.round(Math.abs((new Date(this.ganttMaxDate).getTime() - new Date(this.ganttMinDate).getTime()) / oneDay));
    this.minX = 0;
    this.maxX = this.ganttDateRange;
    let flag = 0;
    let qts = 1;
    let gridPrecisionX = 0;
    while (flag === 0) {
      if (this.ganttDateRange <= 90 * qts) {
        gridPrecisionX = 7 * qts;
        flag = 1;
        break;
      } else {
        qts = qts + 1;
      }
    }
    this.maxX = this.closestMultipleMoreThanEqualTo(7 * qts, this.ganttDateRange);
    this.ganttMaxDate = this.addDays(this.ganttMinDate, this.maxX);
    this.computeRectDimensions();
    this.computeLegionDimensions();
    this.computeLegion();
    // this.printAll();
  }
  addDays(date, days) {
    const newdate = new Date(date);
    newdate.setDate(new Date(date).getDate() + days);
    const day = newdate.getDate();
    const monthIndex = newdate.getMonth();
    const year = newdate.getFullYear();
    return this.monthNames[monthIndex] + ' ' + day + ', ' + year;
  }
  printAll() {
    console.log('line-graph-service');
    console.log('component ID: ' + this.componentID);
    console.log('width: ' + this.width);
    console.log('height: ' + this.height);
    console.log('xPadding: ' + this.xPadding);
    console.log('yPadding: ' + this.yPadding);
    console.log('rectWidth: ' + this.rectWidth);
    console.log('rectHeight: ' + this.rectHeight);
    console.log('ganttMinDate: ' + this.ganttMinDate);
    console.log('ganttMaxDate: ' + this.ganttMaxDate);
  }
  static {
    this.ctorParameters = () => [];
  }
};
GanttChartService = (0,tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_1__.Injectable)({
  providedIn: 'root'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_0__.__metadata)("design:paramtypes", [])], GanttChartService);


/***/ }),

/***/ 10688:
/*!**********************************************************************************!*\
  !*** ./src/app/visualizationComponents/GanttComponent/gantt-plugin.component.ts ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   GanttComponent: () => (/* binding */ GanttComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _gantt_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./gantt-plugin.component.html?ngResource */ 90020);
/* harmony import */ var _gantt_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./gantt-plugin.component.scss?ngResource */ 39930);
/* harmony import */ var _gantt_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_gantt_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @app/contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var _app_helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @app/helperClasses/dialogSettings */ 63412);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var html_to_image__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! html-to-image */ 15135);
/* harmony import */ var _app_helperClasses_customShapes__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @app/helperClasses/customShapes */ 13564);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var _gantt_chart_gantt_chart_service__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./gantt-chart/gantt-chart.service */ 15013);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! lodash */ 46227);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @app/contactTraceCommonServices/export.service */ 70616);
















let GanttComponent = class GanttComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_7__.BaseComponentDirective {
  constructor(injector, eventManager, commonService, container, ViewContainerRef, elRef, ganttChartService, cdref, gtmService, exportService) {
    super(elRef.nativeElement);
    this.eventManager = eventManager;
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.gtmService = gtmService;
    this.exportService = exportService;
    this.DisplayGlobalSettingsDialogEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_11__.EventEmitter();
    this.viewActive = true;
    this.svgStyle = {
      height: '0px',
      width: '1000px'
    };
    this.customShapes = new _app_helperClasses_customShapes__WEBPACK_IMPORTED_MODULE_6__.CustomShapes();
    this.ShowNetworkAttributes = false;
    this.ShowStatistics = false;
    this.ShowGanttExportPane = false;
    this.ShowGanttSettingsPane = false;
    this.IsDataAvailable = true;
    this.svg = null;
    this.settings = this.commonService.session.style.widgets;
    this.nodeIds = [];
    this.FieldList = [];
    this.GanttEntryName = "";
    this.GanttStartVariable = "";
    this.GanttEndVariable = "";
    this.GanttEntryColor = "#000000";
    this.ganttEntries = [];
    this.SelectedGanttChartImageFilenameVariable = "default_gantt_chart";
    // ganttChartData: Object[] = [];
    this.NetworkExportFileTypeList = [{
      label: 'png',
      value: 'png'
    }, {
      label: 'jpeg',
      value: 'jpeg'
    }, {
      label: 'svg',
      value: 'svg'
    }];
    this.SelectedNetworkExportFileTypeListVariable = 'png';
    this.GanttSettingsDialogSettings = new _app_helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_3__.DialogSettings('#gantt-settings-pane', false);
    this.visuals = commonService.visuals;
    this.commonService.visuals.gantt = this;
    this.ganttChartService = ganttChartService;
  }
  dataAvail() {
    if (!this.ganttChartData || this.ganttChartData.length === 1 && this.ganttChartData[0]["name"] === "_blank") {
      return false;
    }
    return true;
  }
  openSettings() {
    this.visuals.gantt.GanttSettingsDialogSettings.setVisibility(true);
  }
  openExport() {
    this.ShowGanttExportPane = true;
    this.visuals.microbeTrace.GlobalSettingsDialogSettings.setStateBeforeExport();
    //this.visuals.microbeTrace.GlobalSettingsLinkColorDialogSettings.setStateBeforeExport();
    //this.visuals.microbeTrace.GlobalSettingsNodeColorDialogSettings.setStateBeforeExport();
    this.isExportClosed = false;
  }
  ngOnInit() {
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/gantt",
      page_title: "Gantt Chart View"
    });
    this.nodeIds = this.getNodeIds();
    this.visuals.gantt.FieldList.push({
      label: "None",
      value: ""
    });
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    this.commonService.session.data['nodeFields'].map((d, i) => {
      this.visuals.gantt.FieldList.push({
        label: this.visuals.gantt.commonService.capitalize(d.replace('_', '')),
        value: d
      });
    });
    this.visuals.microbeTrace.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
    this.visuals.microbeTrace.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
    // this.createGanttEntry();
    this.ganttChartData = [this.makeBlankEntry()];
    this.openSettings();
    // this.ganttChartData = [this.makeGanttEntry("_blank", "Ipstart", "Ipend", "#2ca02c")];
    this.goldenLayoutComponentResize();
    this.container.on('resize', () => {
      this.goldenLayoutComponentResize();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.cdref.detectChanges();
      this.visuals.microbeTrace.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
      this.visuals.microbeTrace.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
    });
  }
  makeBlankEntry() {
    const timelineEntry = [{
      from: "2000/01/01",
      to: "2024/12/31"
    }];
    const timelines = {};
    this.nodeIds.forEach(element => {
      timelines[element] = timelineEntry;
    });
    const blankEntry = {
      name: "_blank",
      color: "#ffffff",
      timelines: timelines
    };
    return blankEntry;
    // return this.makeGanttEntry("_blank", "ipstart", "ipend", "#2ca02c");
  }
  goldenLayoutComponentResize() {
    $('#gantt-plugin').height($('ganttcomponent').height() - 19);
    $('#gantt-plugin').width($('ganttcomponent').width() - 1);
  }
  makeGanttEntry(dateName, startVariable, endVariable, entryColor) {
    const timeline = {};
    this.nodeIds.forEach(element => {
      const nodeData = this.visuals.gantt.commonService.session.data.nodes.filter(x => x._id == element);
      const hasTimeZone = /GMT.\d{4}/;
      const startDate = hasTimeZone.exec(nodeData[0][startVariable]) ? nodeData[0][startVariable].substring(4, 15) : nodeData[0][startVariable];
      const endDate = hasTimeZone.exec(nodeData[0][endVariable]) ? nodeData[0][endVariable].substring(4, 15) : nodeData[0][endVariable];
      const regExp = /^.*$/;
      if (startDate && endDate && regExp.exec(startDate) && regExp.exec(endDate)) {
        const entry = [{
          from: startDate,
          to: endDate,
          info: dateName
        }];
        timeline[element] = entry;
      }
    });
    const ganttEntry = {
      name: dateName,
      color: entryColor,
      opacity: this.ganttChartService.ganttOpacity,
      timelines: timeline
    };
    return ganttEntry;
  }
  createGanttEntry() {
    if (!this.GanttEndVariable) {
      this.GanttEndVariable = this.GanttStartVariable;
    }
    if (this.ganttEntries.length === 0) {
      //} || this.ganttChartData.length === 1 && this.ganttChartData[0]["name"] === "_blank"){
      const newEntry = this.makeGanttEntry(this.GanttEntryName, this.GanttStartVariable, this.GanttEndVariable, this.GanttEntryColor);
      this.ganttEntries = [{
        entryName: this.GanttEntryName,
        startDate: this.GanttStartVariable,
        endDate: this.GanttEndVariable,
        color: this.GanttEntryColor
      }];
      this.ganttChartData = [newEntry];
    } else {
      const newEntry = this.makeGanttEntry(this.GanttEntryName, this.GanttStartVariable, this.GanttEndVariable, this.GanttEntryColor);
      this.ganttEntries.push({
        entryName: this.GanttEntryName,
        startDate: this.GanttStartVariable,
        endDate: this.GanttEndVariable,
        color: this.GanttEntryColor
      });
      const existingData = (0,lodash__WEBPACK_IMPORTED_MODULE_9__.cloneDeep)(this.ganttChartData);
      existingData.push(newEntry);
      this.ganttChartData = existingData;
    }
    this.cdref.markForCheck();
    this.resetEntryForm();
    this.visuals.gantt.GanttSettingsDialogSettings.setVisibility(false);
  }
  removeGanttEntry(entryName) {
    const startingEntries = (0,lodash__WEBPACK_IMPORTED_MODULE_9__.cloneDeep)(this.ganttChartData);
    const endingEntries = startingEntries.filter(x => x["name"] !== entryName);
    this.ganttEntries = this.ganttEntries.filter(x => x["entryName"] !== entryName);
    this.ganttChartData = endingEntries;
  }
  resetEntryForm() {
    this.GanttEntryName = "";
    this.GanttEntryColor = "#000000";
    this.GanttEndVariable = "";
    this.GanttStartVariable = "";
  }
  updateEntryColor(entryName, event) {
    const color = event.target.value;
    const startingData = (0,lodash__WEBPACK_IMPORTED_MODULE_9__.cloneDeep)(this.ganttChartData);
    for (let i = 0; i < startingData.length; i++) {
      if (startingData[i]["name"] === entryName) {
        startingData[i]["color"] = color;
      }
    }
    this.ganttChartData = startingData;
  }
  getNodeIds() {
    const idSet = this.visuals.gantt.commonService.session.data.nodes.map(x => x._id);
    return idSet;
  }
  listGanttEntries() {
    return this.ganttEntries;
  }
  saveImage(event) {
    const fileName = this.SelectedGanttChartImageFilenameVariable;
    const domId = 'gantt';
    const exportImageType = this.SelectedNetworkExportFileTypeListVariable;
    const content = document.getElementById(domId);
    if (exportImageType === 'png') {
      html_to_image__WEBPACK_IMPORTED_MODULE_5__.toPng(content).then(dataUrl => {
        file_saver__WEBPACK_IMPORTED_MODULE_4__(dataUrl, fileName);
      });
    } else if (exportImageType === 'jpeg') {
      html_to_image__WEBPACK_IMPORTED_MODULE_5__.toJpeg(content, {
        quality: 0.85
      }).then(dataUrl => {
        file_saver__WEBPACK_IMPORTED_MODULE_4__(dataUrl, fileName);
      });
    } else if (exportImageType === 'svg') {
      // The tooltips were being displayed as black bars, so I add a rule to hide them.
      // Have to parse the string into a document, get the right element, add the rule, and reserialize it
      let svgContent = this.exportService.unparseSVG(content);
      const parser = new DOMParser();
      const deserialized = parser.parseFromString(svgContent, 'text/xml');
      console.log(deserialized);
      const style = deserialized.getElementsByTagName('style');
      console.log(style);
      style[0].innerHTML = ".tooltip { display: none !important; } .small { font-size: 80%; font-family: Roboto, 'Helvetica Neue', sans-serif; }";
      const serializer = new XMLSerializer();
      svgContent = serializer.serializeToString(deserialized);
      const blob = new Blob([svgContent], {
        type: 'image/svg+xml;charset=utf-8'
      });
      file_saver__WEBPACK_IMPORTED_MODULE_4__(blob, fileName);
    }
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_11__.Injector
    }, {
      type: _angular_platform_browser__WEBPACK_IMPORTED_MODULE_12__.EventManager
    }, {
      type: _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_13__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_11__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_7__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: undefined,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_11__.Inject,
        args: [_angular_core__WEBPACK_IMPORTED_MODULE_11__.ViewContainerRef]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_11__.ElementRef
    }, {
      type: _gantt_chart_gantt_chart_service__WEBPACK_IMPORTED_MODULE_8__.GanttChartService
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_11__.ChangeDetectorRef
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_14__.GoogleTagManagerService
    }, {
      type: _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_10__.ExportService
    }];
  }
  static {
    this.propDecorators = {
      ganttContainer: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_11__.ViewChild,
        args: ['ganttContainer', {
          read: _angular_core__WEBPACK_IMPORTED_MODULE_11__.ViewContainerRef
        }]
      }],
      DisplayGlobalSettingsDialogEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_11__.Output
      }]
    };
  }
};
GanttComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_15__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_11__.Component)({
  selector: 'GanttComponent',
  template: _gantt_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  styles: [(_gantt_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_15__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_11__.Injector, _angular_platform_browser__WEBPACK_IMPORTED_MODULE_12__.EventManager, _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_13__.ComponentContainer, Object, _angular_core__WEBPACK_IMPORTED_MODULE_11__.ElementRef, _gantt_chart_gantt_chart_service__WEBPACK_IMPORTED_MODULE_8__.GanttChartService, _angular_core__WEBPACK_IMPORTED_MODULE_11__.ChangeDetectorRef, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_14__.GoogleTagManagerService, _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_10__.ExportService])], GanttComponent);

// eslint-disable-next-line @typescript-eslint/no-namespace
(function (GanttComponent) {
  GanttComponent.componentTypeName = 'Gantt Chart';
})(GanttComponent || (GanttComponent = {}));

/***/ }),

/***/ 28775:
/*!*******************************************************************************!*\
  !*** ./src/app/visualizationComponents/HeatmapComponent/heatmap.component.ts ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   HeatmapComponent: () => (/* binding */ HeatmapComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _heatmap_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./heatmap.component.html?ngResource */ 2124);
/* harmony import */ var _heatmap_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./heatmap.component.scss?ngResource */ 72188);
/* harmony import */ var _heatmap_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_heatmap_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @app/contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var html_to_image__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! html-to-image */ 15135);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);
/* harmony import */ var _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../helperClasses/dialogSettings */ 63412);
/* harmony import */ var angular_plotly_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! angular-plotly.js */ 59627);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! lodash */ 46227);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @app/contactTraceCommonServices/export.service */ 70616);















//import * as plotlyjs from 'plotly.js-dist-min';
let HeatmapComponent = class HeatmapComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_5__.BaseComponentDirective {
  constructor(injector, eventManager, commonService, container, elRef, cdref, gtmService, renderer, exportService, plotlyModule) {
    super(elRef.nativeElement);
    this.eventManager = eventManager;
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.gtmService = gtmService;
    this.renderer = renderer;
    this.exportService = exportService;
    this.plotlyModule = plotlyModule;
    this.DisplayGlobalSettingsDialogEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_9__.EventEmitter();
    this.FieldList = [];
    this.HeatmapSettingsDialogSettings = new _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_6__.DialogSettings('#heatmap-settings-pane', false);
    this.ShowHeatmapExportPane = false;
    this.invertOptions = [{
      label: "Yes",
      value: true
    }, {
      label: "No",
      value: false
    }];
    this.SelectedImageFilenameVariable = "default_heatmap";
    this.SelectedNetworkExportFileTypeVariable = "png";
    this.NetworkExportFileTypeList = [{
      label: 'png',
      value: 'png'
    }, {
      label: 'jpeg',
      value: 'jpeg'
    }, {
      label: 'svg',
      value: 'svg'
    }];
    this.SelectedDistanceMatrixFilenameVariable = "distance_matrix.csv";
    this.visuals = commonService.visuals;
    this.visuals.heatmap = this;
    this.invertX = this.commonService.session.style.widgets['heatmap-invertX'];
    this.invertY = this.commonService.session.style.widgets['heatmap-invertY'];
    this.heatmapShowLabels = this.commonService.session.style.widgets['heatmap-axislabels-show'];
    this.loColor = this.commonService.session.style.widgets['heatmap-color-low'];
    this.medColor = this.commonService.session.style.widgets['heatmap-color-medium'];
    this.hiColor = this.commonService.session.style.widgets['heatmap-color-high'];
    this.heatmapMetric = this.commonService.session.style.widgets['default-distance-metric'].toUpperCase();
  }
  openSettings() {
    this.visuals.heatmap.HeatmapSettingsDialogSettings.setVisibility(true);
  }
  openExport() {
    this.ShowHeatmapExportPane = true;
  }
  openCenter() {
    const reCenter = {
      'xaxis.autorange': true,
      'yaxis.autorange': true
    };
    angular_plotly_js__WEBPACK_IMPORTED_MODULE_10__.PlotlyModule.plotlyjs.relayout("heatmap", reCenter);
  }
  ngOnInit() {
    this.viewActive = true;
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/heatmap",
      page_title: "Heatmap View"
    });
    this.nodeIds = this.getNodeIds();
    this.visuals.heatmap.FieldList.push({
      label: "None",
      value: ""
    });
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    this.commonService.session.data['nodeFields'].map((d, i) => {
      this.visuals.heatmap.FieldList.push({
        label: this.visuals.heatmap.commonService.capitalize(d.replace('_', '')),
        value: d
      });
    });
    //this.visuals.microbeTrace.GlobalSettingsNodeColorDialogSettings.setVisibility(false);
    //this.visuals.microbeTrace.GlobalSettingsLinkColorDialogSettings.setVisibility(false);
    this.goldenLayoutComponentResize();
    this.container.on('resize', () => {
      this.goldenLayoutComponentResize();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.cdref.detectChanges();
    });
    this.redrawHeatmap();
  }
  drawHeatmap(xLabels, yLabels, config) {
    this.commonService.getDM().then(dm => {
      if (this.invertX) {
        dm.forEach(l => l.reverse());
        xLabels.reverse();
      }
      this.heatmapLabels = xLabels;
      if (this.invertY) {
        dm.reverse();
        yLabels.reverse();
      }
      this.heatmapData = [{
        x: xLabels,
        y: yLabels,
        z: dm,
        type: 'heatmap',
        colorscale: [[0, this.loColor], [0.5, this.medColor], [1, this.hiColor]]
      }];
      /*      const parentElement = this.heatmapContainerRef.nativeElement.parentElement;
          const width = parentElement.clientWidth;
          const height = parentElement.clientHeight;
      */
      this.heatmapLayout = {
        xaxis: config,
        yaxis: config,
        width: $('#heatmap').parent().width(),
        height: $('#heatmap').parent().height()
      };
      this.heatmapConfig = {
        displaylogo: false,
        displayModeBar: false
      };
      //  this.Plotly.newPlot('heatmap', this.heatmapData, this.heatmapLayout, this.heatmapConfig);
      this.plot = angular_plotly_js__WEBPACK_IMPORTED_MODULE_10__.PlotlyModule.plotlyjs.newPlot('heatmap', this.heatmapData, this.heatmapLayout, this.heatmapConfig);
    });
  }
  goldenLayoutComponentResize() {
    const height = $('heatmapcomponent').height();
    const width = $('heatmapcomponent').width();
    if (height) $('#heatmap').height(height - 19);
    if (width) $('#heatmap').width(width - 1);
    /*    const heatmapElement = this.heatmapContainerRef.nativeElement;
        const parentElement = heatmapElement.parentElement;
      
        const height = parentElement.clientHeight;
        const width = parentElement.clientWidth;
        if (height) {
          this.renderer.setStyle(heatmapElement, 'height', `${height - 19}px`);
        }
        if (width) {
          this.renderer.setStyle(heatmapElement, 'width', `${width - 1}px`);
        }
    */
  }
  getNodeIds() {
    const idSet = this.visuals.heatmap.commonService.session.data.nodes.map(x => x._id);
    return idSet;
  }
  redrawHeatmap() {
    //if (!this.heatmapContainerRef.nativeElement.length) return;
    if (!$('#heatmap').length) return;
    if (this.plot) angular_plotly_js__WEBPACK_IMPORTED_MODULE_10__.PlotlyModule.plotlyjs.purge('heatmap');
    const labels = this.nodeIds;
    const xLabels = labels.map(d => 'N' + d);
    const yLabels = xLabels.slice();
    this.heatmapMetric = this.commonService.session.style.widgets['default-distance-metric'].toUpperCase();
    const config = {
      autotick: false,
      showticklabels: this.heatmapShowLabels
    };
    if (!config.showticklabels) {
      config["ticks"] = '';
    }
    this.drawHeatmap(xLabels, yLabels, config);
    this.setBackground();
  }
  setBackground() {
    const col = this.commonService.session.style.widgets['background-color'];
    $('#heatmap svg.main-svg').first().css('background', col);
    $('#heatmap rect.bg').css('fill', col);
    const contrast = this.commonService.session.style.widgets['background-color-contrast'];
    $('#heatmap .xtitle, .ytitle').css('fill', contrast);
    $('#heatmap .xaxislayer-above text').css('fill', contrast);
    $('#heatmap .yaxislayer-above text').css('fill', contrast);
    /*const heatmapElement: HTMLElement = this.heatmapContainerRef.nativeElement;
    const col = this.commonService.session.style.widgets['background-color'];
    const contrast = this.commonService.session.style.widgets['background-color-contrast'];
      
    // Set background color of the main SVG
    const mainSvg = heatmapElement.querySelector('svg.main-svg');
    if (mainSvg) {
      this.renderer.setStyle(mainSvg, 'background', col);
    }
         // Set fill for rect.bg
    const rectBg = heatmapElement.querySelector('rect.bg');
    if (rectBg) {
      this.renderer.setStyle(rectBg, 'fill', col);
    }
         // Set fill for titles
    const titles = heatmapElement.querySelectorAll('.xtitle, .ytitle');
    titles.forEach(title => {
      this.renderer.setStyle(title, 'fill', contrast);
    });
         // Set fill for axis layer texts
    const axisTexts = heatmapElement.querySelectorAll('.xaxislayer-above text, .yaxislayer-above text');
    axisTexts.forEach(text => {
      this.renderer.setStyle(text, 'fill', contrast);
    });*/
  }
  updateLoColor(color) {
    this.commonService.session.style.widgets["heatmap-color-low"] = color;
    this.loColor = color;
    this.redrawHeatmap();
  }
  updateMedColor(color) {
    this.commonService.session.style.widgets["heatmap-color-medium"] = color;
    this.medColor = color;
    this.redrawHeatmap();
  }
  updateHiColor(color) {
    this.commonService.session.style.widgets["heatmap-color-high"] = color;
    this.hiColor = color;
    this.redrawHeatmap();
  }
  updateInvertX(direction) {
    this.invertX = direction;
    this.commonService.session.style.widgets["heatmap-invertX"] = this.invertX;
    this.redrawHeatmap();
  }
  updateInvertY(direction) {
    this.invertY = direction;
    this.commonService.session.style.widgets["heatmap-invertY"] = this.invertY;
    this.redrawHeatmap();
  }
  saveImage() {
    const fileName = this.SelectedImageFilenameVariable;
    const domId = 'heatmap';
    const exportImageType = this.SelectedNetworkExportFileTypeVariable;
    const content = document.getElementById(domId);
    if (content) {
      const fixedContent = this.fixGradient(content);
      if (exportImageType === 'png') {
        html_to_image__WEBPACK_IMPORTED_MODULE_4__.toPng(content).then(dataUrl => {
          file_saver__WEBPACK_IMPORTED_MODULE_3__(dataUrl, fileName + "." + exportImageType);
        });
      } else if (exportImageType === 'jpeg') {
        html_to_image__WEBPACK_IMPORTED_MODULE_4__.toJpeg(content, {
          quality: 0.85
        }).then(dataUrl => {
          file_saver__WEBPACK_IMPORTED_MODULE_3__(dataUrl, fileName + "." + exportImageType);
        });
      } else if (exportImageType === 'svg') {
        const svgContent = this.exportService.unparseSVG(fixedContent);
        const blob = new Blob([svgContent], {
          type: 'image/svg+xml;charset=utf-8'
        });
        file_saver__WEBPACK_IMPORTED_MODULE_3__(blob, fileName + "." + exportImageType);
      }
    }
  }
  fixGradient(el) {
    const insertionPoint = el.getElementsByClassName("gradient_filled");
    const startingUrl = insertionPoint[0]["style"]["fill"];
    const idVal = startingUrl.substring(startingUrl.indexOf("#"));
    insertionPoint[0]["style"]["fill"] = 'url("' + idVal;
    return el;
  }
  saveDistanceMatrix() {
    const fileName = this.SelectedDistanceMatrixFilenameVariable;
    const labelArray = (0,lodash__WEBPACK_IMPORTED_MODULE_7__.cloneDeep)(this.heatmapLabels);
    this.commonService.getDM().then(dm => {
      let csvContent = "data:text/csv;charset=utf-8,";
      if (this.heatmapShowLabels) {
        labelArray.unshift("");
        csvContent += labelArray.join(",") + "\n";
        for (let i = 0; i < dm.length; i++) {
          dm[i].unshift(this.heatmapLabels[i]);
          csvContent += dm[i].join(",") + "\n";
        }
      } else {
        csvContent += dm.map(e => e.join(",")).join("\n");
      }
      file_saver__WEBPACK_IMPORTED_MODULE_3__(csvContent, fileName);
    });
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Injector
    }, {
      type: _angular_platform_browser__WEBPACK_IMPORTED_MODULE_11__.EventManager
    }, {
      type: _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_12__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_5__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ChangeDetectorRef
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_13__.GoogleTagManagerService
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Renderer2
    }, {
      type: _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_8__.ExportService
    }, {
      type: angular_plotly_js__WEBPACK_IMPORTED_MODULE_10__.PlotlyModule
    }];
  }
  static {
    this.propDecorators = {
      heatmapContainerRef: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ViewChild,
        args: ['heatmapContainer', {
          read: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef
        }]
      }],
      DisplayGlobalSettingsDialogEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Output
      }]
    };
  }
};
HeatmapComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_14__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_9__.Component)({
  selector: 'HeatmapComponent',
  template: _heatmap_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  styles: [(_heatmap_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_14__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_9__.Injector, _angular_platform_browser__WEBPACK_IMPORTED_MODULE_11__.EventManager, _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_12__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_9__.ChangeDetectorRef, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_13__.GoogleTagManagerService, _angular_core__WEBPACK_IMPORTED_MODULE_9__.Renderer2, _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_8__.ExportService, angular_plotly_js__WEBPACK_IMPORTED_MODULE_10__.PlotlyModule])], HeatmapComponent);

// eslint-disable-next-line @typescript-eslint/no-namespace
(function (HeatmapComponent) {
  HeatmapComponent.componentTypeName = 'Heatmap';
})(HeatmapComponent || (HeatmapComponent = {}));

/***/ }),

/***/ 15936:
/*!******************************************************************************!*\
  !*** ./src/app/visualizationComponents/MapComponent/map-plugin.component.ts ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MapComponent: () => (/* binding */ MapComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _map_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./map-plugin.component.html?ngResource */ 17652);
/* harmony import */ var _map_plugin_component_css_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./map-plugin.component.css?ngResource */ 11965);
/* harmony import */ var _map_plugin_component_css_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_map_plugin_component_css_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_3__);
/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! d3 */ 86164);
/* harmony import */ var dom_to_image_more__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! dom-to-image-more */ 13466);
/* harmony import */ var dom_to_image_more__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(dom_to_image_more__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! leaflet */ 67381);
/* harmony import */ var leaflet__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(leaflet__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! moment */ 39545);
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var leaflet_markercluster__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! leaflet.markercluster */ 35449);
/* harmony import */ var leaflet_markercluster__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(leaflet_markercluster__WEBPACK_IMPORTED_MODULE_8__);
/* harmony import */ var _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../helperClasses/dialogSettings */ 63412);
/* harmony import */ var _helperClasses_colorIterator__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../helperClasses/colorIterator */ 2311);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);










// import * as moment from 'moment';








class LongLatClass {}
// interface gmapMarkerInterface {
//     zip: string;
//     marker: google.maps.Marker;
// }
// class gmapMarkerClass implements gmapMarkerInterface {
//     zip: string;
//     marker: google.maps.Marker;
// }
let MapComponent = class MapComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_11__.BaseComponentDirective {
  constructor(injector, renderer, elem, eventManager, commonService, container, elRef, cdref, gtmService) {
    super(elRef.nativeElement);
    this.renderer = renderer;
    this.elem = elem;
    this.eventManager = eventManager;
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.gtmService = gtmService;
    this.DisplayGlobalSettingsDialogEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_12__.EventEmitter();
    this.viewActive = true;
    this.svgStyle = {
      'height': '0px',
      'width': '1000px'
    };
    this.nodes = [];
    this.map = null;
    this.layers = new MapLayers();
    this.IsDataAvailable = false;
    this.ShowGEOMapExportPane = false;
    this.ShowGEOMapSettingsPane = false;
    this.FieldList = [];
    this.SelectedLatitude = "None";
    this.SelectedLongitude = "None";
    this.SelectedCensusTract = "None";
    this.SelectedZipCode = "None";
    this.SelectedCounty = "None";
    this.SelectedState = "None";
    this.SelectedCountry = "None";
    this.SelectedResidenceAddress = "None";
    this.SelectedVenueAddress = "None";
    this.SelectedExposureAddress = "None";
    this.geocoder = null;
    this.address = "new york city";
    this.OriginalCenterLocation = null;
    this.markers = [];
    this.SelectedNetworkExportFilenameVariable = "";
    this.NetworkExportFileTypeList = [{
      label: 'png',
      value: 'png'
    }, {
      label: 'jpeg',
      value: 'jpeg'
    }, {
      label: 'webp',
      value: 'webp'
    }
    // { label: 'svg', value: 'svg' }
    ];
    this.SelectedNetworkExportFileTypeListVariable = "png";
    this.SelectedNetworkExportScaleVariable = 1;
    this.SelectedNetworkExportQualityVariable = 0.92;
    // view implementation of 2D to calculate resolution before export
    this.CalculatedResolutionWidth = 1918;
    this.CalculatedResolutionHeight = 909;
    this.CalculatedResolution = this.CalculatedResolutionWidth * this.SelectedNetworkExportScaleVariable + " x " + this.CalculatedResolutionHeight * this.SelectedNetworkExportScaleVariable + "px";
    this.NodesTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedNodesTypeVariable = "Show";
    this.LinksTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedLinksTypeVariable = "Show";
    this.CountriesTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedCountriesTypeVariable = "Show";
    this.StatesTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedStatesTypeVariable = "Show";
    this.CountiesTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedCountiesTypeVariable = "Hide";
    this.BasemapTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedBasemapTypeVariable = "Hide";
    this.SatelliteTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedSatelliteTypeVariable = "Hide";
    this.NodeCollapsingTypes = [{
      label: 'On',
      value: 'On'
    }, {
      label: 'Off',
      value: 'Off'
    }];
    this.SelectedNodeCollapsingTypeVariable = "On";
    this.GeospatialTypes = [{
      label: 'On',
      value: 'On'
    }, {
      label: 'Off',
      value: 'Off'
    }];
    this.SelectedGeospatialTypeVariable = "Off";
    this.SelectedNodeTransparencyVariable = 0.0;
    this.SelectedNodeJitterVariable = -2;
    this.SelectedNodeTooltipVariable = "None";
    this.SelectedLinkTransparencyVariable = 0.0;
    this.SelectedLinkTooltipVariable = "None";
    //@ViewChild('select.nodeVariables') selectList: ElementRef;
    //@ViewChildren('map-field-lat') targets: ElementRef
    //@ViewChild('gmap') mapElement: any;
    //gmap: google.maps.Map;
    //gmapMarkers: gmapMarkerInterface[];
    this.clusterImages = {
      m1: "data:image/png;base64,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",
      m2: "data:image/png;base64,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",
      m3: "data:image/png;base64,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",
      m4: "data:image/png;base64,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",
      m5: 'data:image/png;base64,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'
    };
    this.locationsFound = [];
    this.mapTooltip = '#mapTooltip';
    this.leafletMarkers = [];
    this.isExporting = false;
    this.isExportClosed = false;
    this.exportTryCount = 0;
    this.colorIterator = new _helperClasses_colorIterator__WEBPACK_IMPORTED_MODULE_10__.ColorIterator();
    this.marker = {
      triangle: '<svg version="1" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M7.5 0 L0 15 L15 15 Z" fill="{mapIconColor}"/></svg>',
      square: '<svg version="1" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><rect width="15" height="15" fill="{mapIconColor}" /></svg>',
      circle: '<svg version="1" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><circle cx="7.5" cy="7.5" r="7.5" fill="{mapIconColor}" /></svg>'
    };
    this.dateFilterRangeValues = [0, 100];
    this.dateFilterRangeMax = 100;
    this.dateFilterRangeDates = [new Date(), new Date()];
    this.geospatialNodes = [];
    this.visuals = commonService.visuals;
    this.visuals.gisMap = this;
  }
  ngOnInit() {
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/map",
      page_title: "Map View"
    });
    if (!this.NodeMapSettingsExportDialogSettings) {
      this.NodeMapSettingsExportDialogSettings = new _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_9__.DialogSettings('#map-settings-pane', false);
    }
    this.IsDataAvailable = this.commonService.session.data.nodes.length == 0 ? false : true;
    this.FieldList = [];
    this.FieldList.push({
      label: "None",
      value: "None"
    });
    this.commonService.session.data['nodeFields'].map((d, i) => {
      this.FieldList.push({
        label: this.commonService.capitalize(d.replace("_", "")),
        value: d
      });
    });
    //this.geocoder = new google.maps.Geocoder();
    this.initializeMap("US");
    if (this.commonService.temp.mapData.zipcodes == undefined) {
      this.commonService.getMapData('zipcodes.csv').then(x => {});
    }
    this.hideTooltip();
    // TODO: remove when not needed
    // this.eventManager.addGlobalEventListener('window', 'node-selected', () => {
    //     this.drawNodes();
    // });
    let that = this;
    $(document).on("node-selected", function () {
      //update this?
      that.drawNodes(false);
    });
    $(document).on("node-visibility", function () {
      // XXYY seems to re-jitter the nodes at times, so may want to look into that. thanks
      //console.log('is node vis called here? probs not right')
      let visNodes = that.commonService.getVisibleNodes();
      if (visNodes.length == that.nodes.length) {
        return;
      }
      that.nodes = visNodes;
      that.matchCoordinates(undefined, true);
      that.nodes.forEach(node => {
        if (node._jlat == undefined || node._jlon == undefined) {
          that.rerollNodeAndJitter(node);
        }
      });
      that.drawNodes(false);
      //that.centerMap();
    });
    $(document).on("link-visibility", function () {
      that.drawLinks();
    });
    this.container.on('resize', () => {
      this.lmap.invalidateSize();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.cdref.detectChanges();
    });
  }
  ngAfterViewInit() {
    setTimeout(() => this.centerMap(), 1000);
  }
  initializeMap(address) {
    this.codeAddress(["US"]).then(result => {
      console.log('map codeAddress result', result);
      if (result.length > 0) {
        let latitude = result[0].Latitude;
        let longitude = result[0].Longitude;
        this.initializeLeafletMap(latitude, longitude);
      }
    });
  }
  initializeLeafletMap(latitude, longitude) {
    //TODO: put this in a config?
    const mapTokenKey = 'sk.eyJ1IjoicndhdHR5IiwiYSI6ImNrY2RuMWlzcDAwMmUyc3A5ejl3ODEzMXoifQ.qpXOouVsI6P8-HOHUWofuQ';
    this.layers.basemap = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.tileLayer)('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 20,
      attribution: ' <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a> contributors'
    });
    this.layers.satellite = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.tileLayer)(`https://api.mapbox.com/styles/v1/mapbox/satellite-streets-v9/tiles/256/{z}/{x}/{y}?access_token=${mapTokenKey}`);
    this.leafletInitialOptions = {
      zoom: 4,
      zoomControl: true,
      maxZoom: 15,
      preferCanvas: true,
      center: (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.latLng)([latitude, longitude])
    };
    this.leafletMarkerClusterOptions = {
      showCoverageOnHover: false,
      zoomToBoundsOnClick: true,
      spiderfyOnMaxZoom: true,
      removeOutsideVisibleBounds: false,
      maxClusterRadius: 20,
      spiderLegPolylineOptions: {
        opacity: 0
      }
    };
  }
  onMapReady(map) {
    //get the leaflet map
    this.lmap = map;
    this.lmap.zoomControl.setPosition('bottomleft');
    setTimeout(() => {
      this.loadSettings();
      //this.setDefaultAddressFields();
      //this.setDateRangeFilterValues();
      //this.onDataChange(undefined);
    }, 600);
  }
  onMarkerClusterReady(markerCluster) {
    this.layers.markerClusterGroup = markerCluster;
  }
  getMarker(latitude, longitude) {
    return (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.circleMarker)([latitude, longitude], {
      color: '#3c4b8d',
      fillColor: '#3c4b8d',
      radius: 5
    });
  }
  /* Not sure goal of this at the moment
  setDefaultAddressFields() {
      const foundExposureAddressColName = this.commonService.session.data['nodeFields'].find(x => x === 'ExposureLocation');
      if (foundExposureAddressColName) this.SelectedExposureAddress = foundExposureAddressColName;
      const foundVenueAddressColName = this.commonService.session.data['nodeFields'].find(x => x === 'VenueLocation');
      if (foundVenueAddressColName) this.SelectedVenueAddress = foundVenueAddressColName;
  }*/
  onDateFilterChange(e) {
    this.dateFilterRangeDates[0] = moment__WEBPACK_IMPORTED_MODULE_7___default()(this.dateFilterRangeMinDate).add(this.dateFilterRangeValues[0], 'days').toDate();
    this.dateFilterRangeDates[1] = moment__WEBPACK_IMPORTED_MODULE_7___default()(this.dateFilterRangeMinDate).add(this.dateFilterRangeValues[1], 'days').toDate();
    this.onDataChange(undefined);
  }
  /* Not sure about this function
  setDateRangeFilterValues() {
      let markers = this.getGeospatialNodes().filter(x => x.locationDetail.Name != 'Residence');
       const dates = markers.filter(x => x.locationDetail)
          .map(x => x.locationDetail.Date);
      this.dateFilterRangeDates[0] = _.min(dates);
      this.dateFilterRangeDates[1] = _.max(dates);
      const daysDiff = moment(this.dateFilterRangeDates[1]).diff(moment(this.dateFilterRangeDates[0]), 'days');
      this.dateFilterRangeValues = [0, daysDiff];
      this.dateFilterRangeMax = daysDiff;
      this.dateFilterRangeMinDate = this.dateFilterRangeDates[0];
       this.onDataChange(undefined);
  }
      */
  showAllVisibleMarkers() {
    // var bounds = new google.maps.LatLngBounds();
    // for (var i = 0; i < this.markers.length; i++) {
    //     bounds.extend(this.markers[i].getPosition());
    // }
  }
  centerMap() {
    if (this.lmap && this.layers.nodes().getLayers().length > 0) {
      this.lmap.flyToBounds(this.layers.nodes().getBounds());
    }
  }
  /**
   * Calls clearAllMarkers_Leftlet() which removes all nodes from map and remove _jlat and _jlon value for each node
   */
  clearAllMarkers() {
    this.clearAllMarkers_Leaflet();
  }
  /*clearAllMarkers_Google() {
      for (var i = 0; i < this.markers.length; i++) {
          this.markers[i].setMap(null);
      }
       this.markers = [];
  }*/
  /**
   * Removes all nodes from map and remove _jlat and _jlon value for each node
   */
  clearAllMarkers_Leaflet() {
    this.layers.removeNodes();
    this.nodes.forEach(node => {
      node._jlat = undefined;
      node._jlon = undefined;
    });
  }
  onDataChange(event) {
    this.commonService.session.style.widgets['map-field-lat'] = this.SelectedLatitude;
    this.commonService.session.style.widgets['map-field-lon'] = this.SelectedLongitude;
    this.commonService.session.style.widgets['map-field-tract'] = this.SelectedCensusTract;
    this.commonService.session.style.widgets['map-field-zipcode'] = this.SelectedZipCode;
    this.commonService.session.style.widgets['map-field-county'] = this.SelectedCounty;
    this.commonService.session.style.widgets['map-field-state'] = this.SelectedState;
    this.commonService.session.style.widgets['map-field-country'] = this.SelectedCountry;
    this.commonService.session.style.widgets['map-field-residence-address'] = this.SelectedResidenceAddress;
    this.commonService.session.style.widgets['map-field-venue-address'] = this.SelectedVenueAddress;
    this.commonService.session.style.widgets['map-field-exposure-address'] = this.SelectedExposureAddress;
    this.clearAllMarkers();
    this.layers.removeLinks();
    this.nodes = this.commonService.getVisibleNodes();
    let cnt = 0;
    let dataFound = false;
    let that = this;
    // XXX check if reroll is need for drawNodes()
    this.matchCoordinates(function () {
      let rerollCheck = that.rerollCheck();
      if (rerollCheck) {
        that.drawNodes();
      } else {
        that.jitter();
        that.drawNodes(false);
      }
      that.drawLinks();
      that.resetStack();
      // that.visuals.gisMap.lmap.flyToBounds(that.layers.nodes().getBounds());
    }, false);
  }
  /**
   * Updates where to show or hide nodes on the Map
   * @param e 'Show' | 'Hide'
   */
  onMapNodeShowHideChange(e) {
    this.SelectedNodesTypeVariable = e;
    if (e == "Show") {
      this.commonService.session.style.widgets['map-node-show'] = true;
      this.drawNodes(false);
      //this.drawLinks();
    } else {
      this.commonService.session.style.widgets['map-node-show'] = false;
      this.layers.removeNodes();
    }
  }
  /**
   * Updates where to show or hide links on the Map
   * @param e 'Show' | 'Hide'
   */
  onMapLinksShowHideChange(e) {
    this.SelectedLinksTypeVariable = e;
    if (e == "Show") {
      this.commonService.session.style.widgets['map-link-show'] = true;
      this.drawNodes(false);
      this.drawLinks();
    } else {
      this.commonService.session.style.widgets['map-link-show'] = false;
      this.layers.links.remove();
    }
  }
  onCountriesShowHidChange(e) {
    this.SelectedCountriesTypeVariable = e;
    if (e == "Show") {
      this.commonService.session.style.widgets['map-countries-show'] = true;
      if (this.layers.countries.getLayers().length > 0) {
        this.layers.countries.addTo(this.lmap);
        this.resetStack();
      } else {
        //this.commonService.getMapData('countries.json', () => $(this).trigger('click'));
        this.getMapData('countries.json', () => {
          this.layers.countries.addTo(this.lmap);
          this.resetStack();
        });
      }
    } else {
      this.commonService.session.style.widgets['map-countries-show'] = false;
      this.layers.countries.remove();
    }
  }
  onStatesShowHideChange(e) {
    this.SelectedStatesTypeVariable = e;
    if (e == "Show") {
      this.commonService.session.style.widgets['map-states-show'] = true;
      if (this.layers.states.getLayers().length > 0) {
        this.layers.states.addTo(this.lmap);
        this.resetStack();
      } else {
        this.getMapData('states.json', () => {
          this.layers.states.addTo(this.lmap);
          this.resetStack();
        });
      }
    } else {
      this.commonService.session.style.widgets['map-states-show'] = false;
      this.layers.states.remove();
    }
  }
  onCountiesShowHideChange(e) {
    this.SelectedCountiesTypeVariable = e;
    if (e == "Show") {
      this.commonService.session.style.widgets['map-counties-show'] = true;
      if (this.layers.counties.getLayers().length > 0) {
        this.layers.counties.addTo(this.lmap);
        this.resetStack();
      } else {
        this.getMapData('counties.json', () => {
          this.layers.counties.addTo(this.lmap);
          this.resetStack();
        });
      }
    } else {
      this.commonService.session.style.widgets['map-counties-show'] = false;
      this.layers.counties.remove();
    }
  }
  onBasemapChange(e, isReload = false) {
    this.SelectedBasemapTypeVariable = e;
    if (e == "Show") {
      this.commonService.session.style.widgets['map-basemap-show'] = true;
      this.layers.basemap.addTo(this.lmap);
      this.layers.basemap.bringToFront();
      if (!isReload) {
        this.SelectedSatelliteTypeVariable = 'Hide';
        this.onSatelliteChange('Hide');
        this.onCountiesShowHideChange('Hide');
        this.onStatesShowHideChange('Hide');
        this.onCountriesShowHidChange('Hide');
      }
    } else {
      this.commonService.session.style.widgets['map-basemap-show'] = false;
      if (!isReload) {
        if (this.SelectedSatelliteTypeVariable === 'Hide' && this.SelectedBasemapTypeVariable === 'Hide') {
          this.onCountriesShowHidChange('Show');
          this.onStatesShowHideChange('Show');
        }
      }
      this.layers.basemap.remove();
    }
  }
  onSatelliteChange(e, isReload = false) {
    this.SelectedSatelliteTypeVariable = e;
    if (e == "Show") {
      this.commonService.session.style.widgets['map-satellite-show'] = true;
      this.layers.satellite.addTo(this.lmap);
      this.layers.satellite.bringToFront();
      if (!isReload) {
        this.SelectedBasemapTypeVariable = 'Hide';
        this.onBasemapChange('Hide');
        this.onCountiesShowHideChange('Hide');
        this.onStatesShowHideChange('Hide');
        this.onCountriesShowHidChange('Hide');
      }
    } else {
      this.commonService.session.style.widgets['map-satellite-show'] = false;
      if (!isReload) {
        if (this.SelectedSatelliteTypeVariable === 'Hide' && this.SelectedBasemapTypeVariable === 'Hide') {
          this.onCountriesShowHidChange('Show');
          this.onStatesShowHideChange('Show');
        }
      }
      this.layers.satellite.remove();
    }
  }
  /**
   * Updates nodes to be collapsing or not and updates the value of the widget['map-collapsing-on']
   */
  onNodeCollapsingChange(e) {
    if (this.SelectedNodeCollapsingTypeVariable == "On") {
      this.commonService.session.style.widgets['map-collapsing-on'] = true;
      this.drawNodes(false);
    } else {
      this.commonService.session.style.widgets['map-collapsing-on'] = false;
      this.drawNodes(false);
    }
  }
  /**
   * revisit if nodes need to be rerolled or not
   * @param e
   */
  onGeospatialTypeChange(e) {
    if (this.SelectedGeospatialTypeVariable == "On") {
      this.commonService.session.style.widgets['map-geospatial-type-on'] = true;
      this.drawNodes();
      this.drawLinks();
    } else {
      this.commonService.session.style.widgets['map-geospatial-type-on'] = false;
      this.drawNodes();
      this.drawLinks();
    }
  }
  /**
   * Updates transparency of the nodes and the value of the widget['map-node-transparency']
   */
  onNodeTransparencyChange(e) {
    this.commonService.session.style.widgets['map-node-transparency'] = e;
    this.drawNodes(false);
  }
  /**
   * updates node and link positions after rerolling nodes and also updates the value of the widget['map-node-jitter']
   * @param e
   */
  onNodeJitterChange(e) {
    if (e) {
      this.commonService.session.style.widgets['map-node-jitter'] = e;
    }
    this.drawNodes();
    this.drawLinks();
  }
  onNodeToolTipChange(e) {
    this.commonService.session.style.widgets['map-node-tooltip-variable'] = e;
  }
  /**
   * Updates transparency of the link and the value of the widget['map-link-transparency']
   */
  onLinkTransparencyChange(e) {
    this.commonService.session.style.widgets['map-link-transparency'] = e;
    this.drawLinks();
  }
  onLinkToolTipChange(e) {
    this.commonService.session.style.widgets['map-link-tooltip-variable'] = e;
  }
  exportVisualization(event) {
    this.visuals.gisMap.ShowGEOMapExportPane = false;
    this.isExporting = true;
    if (this.commonService.session.style.widgets['node-color-variable'] != 'None') {
      this.visuals.microbeTrace.generateNodeColorTable("#node-color-table-bottom-map", false);
    }
    if (this.commonService.session.style.widgets['link-color-variable'] != 'None') {
      this.visuals.microbeTrace.generateNodeLinkTable("#link-color-table-bottom-map", false);
    }
    if (!this.isExportClosed) {
      setTimeout(() => this.exportVisualization(undefined), 300);
    } else {
      this.exportWork();
    }
  }
  onCloseExport() {
    this.isExportClosed = true;
  }
  exportWork() {
    setTimeout(() => {
      var format = this.visuals.gisMap.SelectedNetworkExportFileTypeListVariable;
      const element = document.querySelector('MapComponent').parentElement;
      dom_to_image_more__WEBPACK_IMPORTED_MODULE_5__.toBlob(element).then(blob => {
        // Sometimes libraries don't play nice with each other.
        // Sometimes dom-to-image does not recognize the leaflet element
        // so we jiggle it and try again. Typically works the second time, but we try 10 times
        if (blob === null) {
          if (this.visuals.gisMap.exportTryCount > 10) {
            //return toast about export failed
          }
          this.visuals.gisMap.exportTryCount += 1;
          this.visuals.gisMap.lmap.flyToBounds(this.visuals.gisMap.lmap.getBounds());
          this.visuals.gisMap.exportWork();
        } else {
          file_saver__WEBPACK_IMPORTED_MODULE_3__(blob, this.visuals.gisMap.SelectedNetworkExportFilenameVariable + '.' + format);
          this.visuals.gisMap.isExporting = false;
          this.visuals.microbeTrace.clearTable("#node-color-table-bottom-map");
          this.visuals.microbeTrace.clearTable("#link-color-table-bottom-map");
          this.visuals.gisMap.exportTryCount = 0;
          this.visuals.microbeTrace.GlobalSettingsDialogSettings.restoreStateAfterExport();
          this.visuals.microbeTrace.GlobalSettingsLinkColorDialogSettings.restoreStateAfterExport();
          this.visuals.microbeTrace.GlobalSettingsNodeColorDialogSettings.restoreStateAfterExport();
          this.visuals.gisMap.NodeMapSettingsExportDialogSettings.restoreStateAfterExport();
        }
      });
    }, 1000);
  }
  displayColorOptions() {
    this.DisplayGlobalSettingsDialogEvent.emit("Styling");
  }
  codeAddress(addressList) {
    let positionList = [];
    let cnt = 0;
    return new Promise((resolve, reject) => {
      addressList.map(address => {
        if (this.geocoder) {
          this.geocoder.geocode({
            'address': address
          }, (results, status) => {
            //    debugger;
            let latLng = new LongLatClass();
            if (results != null) {
              if (results.length > 0) {
                console.log(cnt, results);
                latLng.Latitude = results[0].geometry.location.lat();
                latLng.Longitude = results[0].geometry.location.lng();
                if (status == 'OK') {
                  positionList.push(latLng);
                } else {
                  alert('Geocode was not successful for the following reason: ' + status);
                }
              }
            }
            cnt = cnt + 1;
            if (cnt >= addressList.length) resolve(positionList);
          });
        } else {
          let latLng = new LongLatClass();
          latLng.Latitude = 39.833332;
          latLng.Longitude = -98.583336;
          positionList.push(latLng);
          resolve(positionList);
        }
      });
    });
  }
  updateCalculatedResolution(event) {
    this.CalculatedResolution = Math.round(this.CalculatedResolutionWidth * this.SelectedNetworkExportScaleVariable) + " x " + Math.round(this.CalculatedResolutionHeight * this.SelectedNetworkExportScaleVariable) + "px";
    this.cdref.detectChanges();
  }
  getMapData(type, callback) {
    var name = type.split('.')[0];
    this.commonService.getMapData(type).then(data => {
      if (this.commonService.includes(['countries', 'states', 'counties'], name)) {
        this.layers[name] = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.geoJSON)(data, {
          style: {
            color: '#dadde0',
            weight: name == 'countries' ? 1 : 0.5,
            fillColor: '#fafaf8',
            fillOpacity: name == 'countries' ? 1 : 0
          }
        });
      }
      if (callback) callback();
    });
  }
  matchCoordinates(callback, norefresh) {
    if (!norefresh) this.nodes = this.commonService.getVisibleNodes();
    if (this.commonService.session.style.widgets['map-field-country'] !== 'None') {
      if (!this.commonService.temp.mapData.countries) {
        this.getMapData('countries.json', () => this.matchCoordinates(callback, true));
        return;
      }
      var val = this.commonService.session.style.widgets['map-field-country'];
      this.nodes.forEach(n => {
        var country = this.commonService.temp.mapData.countries.features.find(c => c.id == n[val] || c.properties.name == n[val]);
        if (country) {
          n._lat = country.properties._lat, n._lon = country.properties._lon;
        }
      });
    }
    if (this.commonService.session.style.widgets['map-field-state'] !== 'None') {
      if (!this.commonService.temp.mapData.states) {
        this.getMapData('states.json', () => this.matchCoordinates(callback, true));
        return;
      }
      var sval = this.commonService.session.style.widgets['map-field-state'];
      this.nodes.forEach(n => {
        var state = this.commonService.temp.mapData.states.features.find(s => s.properties.usps == n[sval] || s.properties.name == n[sval]);
        if (state) {
          n._lat = state.properties._lat;
          n._lon = state.properties._lon;
        }
      });
    }
    if (this.commonService.session.style.widgets['map-field-county'] !== 'None') {
      if (!this.commonService.temp.mapData.counties) {
        this.getMapData('counties.json', () => this.matchCoordinates(callback, true));
        return;
      }
      var sval = this.commonService.session.style.widgets['map-field-state'];
      var cval = this.commonService.session.style.widgets['map-field-county'];
      this.nodes.forEach(n => {
        var county;
        county = this.commonService.temp.mapData.counties.features.find(c => {
          return c.properties.fips == n[cval] || parseFloat(c.properties.fips) == parseFloat(n[cval]);
        });
        if (county) {
          n._lat = county.properties._lat;
          n._lon = county.properties._lon;
          return;
        }
        var state = this.commonService.temp.mapData.states.features.find(s => s.properties.usps == n[sval].toUpperCase() || s.properties.name.toLowerCase().includes(n[sval].toLowerCase()));
        county = this.commonService.temp.mapData.counties.features.find(c => {
          var small = n[cval].toLowerCase();
          return c.properties.state == state.properties.usps && (c.properties.name.includes(small) || small.includes(c.properties.name));
        });
        if (county) {
          n._lat = county.properties._lat;
          n._lon = county.properties._lon;
        }
      });
    }
    if (this.commonService.session.style.widgets['map-field-zipcode'] !== 'None') {
      if (!this.commonService.temp.mapData.zipcodes) {
        this.getMapData('zipcodes.csv', () => this.matchCoordinates(callback, true));
        return;
      }
      var val = this.commonService.session.style.widgets['map-field-zipcode'];
      this.nodes.forEach(n => {
        var zo = this.commonService.temp.mapData.zipcodes.find(z => z.zipcode == n[val]);
        if (zo) {
          n._lat = zo._lat;
          n._lon = zo._lon;
        }
      });
    }
    if (this.commonService.session.style.widgets['map-field-tract'] !== 'None') {
      if (!this.commonService.temp.mapData.tracts) {
        this.getMapData('tracts.csv', () => this.matchCoordinates(callback, true));
        return;
      }
      var val = this.commonService.session.style.widgets['map-field-tract'];
      this.nodes.forEach(n => {
        var tract = this.commonService.temp.mapData.tracts.find(t => t.tract == n[val]);
        if (tract) {
          n._lat = tract._lat;
          n._lon = tract._lon;
        }
      });
    }
    // debugger;
    if (this.commonService.session.style.widgets['map-field-lat'] !== 'None' && this.commonService.session.style.widgets['map-field-lon'] !== 'None') {
      var lat = this.commonService.session.style.widgets['map-field-lat'],
        lon = this.commonService.session.style.widgets['map-field-lon'];
      this.nodes.forEach(n => {
        if (typeof n[lat] == 'string') {
          n._lat = (n[lat].includes('S') ? -1 : 1) * parseFloat(n[lat]);
        } else {
          n._lat = n[lat];
        }
        if (typeof n[lon] == 'string') {
          n._lon = (n[lon].includes('W') ? -1 : 1) * parseFloat(n[lon]);
        } else {
          n._lon = n[lon];
        }
      });
    }
    if (callback) callback();
  }
  getResidenceMarker(nodeColor, iconCode, location, data) {
    const iconSettings = {
      mapIconUrl: iconCode,
      mapIconColor: nodeColor
    };
    const divIcon = leaflet__WEBPACK_IMPORTED_MODULE_6__.divIcon({
      className: "leaflet-data-marker",
      html: leaflet__WEBPACK_IMPORTED_MODULE_6__.Util.template(iconSettings.mapIconUrl, iconSettings),
      iconSize: [15, 15]
    });
    const locationDetail = {
      Name: location.Name,
      FullAddress: location.FullAddress,
      Date: location.Date ? new Date(location.Date) : undefined,
      Latitude: location.Latitude,
      Longitude: location.Longitude
    };
    data._jlat = location.Latitude;
    data._jlon = location.Longitude;
    let marker = leaflet__WEBPACK_IMPORTED_MODULE_6__.marker([location.Latitude, location.Longitude], {
      icon: divIcon
    });
    marker.data = data;
    marker.locationDetail = locationDetail;
    return marker;
  }
  getVenueMarker(nodeColor, iconCode, location, data) {
    const iconSettings = {
      mapIconUrl: iconCode,
      mapIconColor: nodeColor
    };
    const divIcon = leaflet__WEBPACK_IMPORTED_MODULE_6__.divIcon({
      className: "leaflet-data-marker",
      html: leaflet__WEBPACK_IMPORTED_MODULE_6__.Util.template(iconSettings.mapIconUrl, iconSettings),
      iconSize: [15, 15]
    });
    const locationDetail = {
      Name: location.Name,
      FullAddress: location.FullAddress,
      Date: location.DateOfContact ? new Date(location.DateOfContact) : undefined,
      Latitude: location.Latitude,
      Longitude: location.Longitude
    };
    if (locationDetail.Latitude != undefined && locationDetail.Longitude != undefined) {
      let marker = leaflet__WEBPACK_IMPORTED_MODULE_6__.marker([location.Latitude, location.Longitude], {
        icon: divIcon
      });
      marker.data = data;
      marker.locationDetail = locationDetail;
      return marker;
    }
    return undefined;
  }
  getExposureMarkers(nodeColor, iconCode, exposureProp, data) {
    const iconSettings = {
      mapIconUrl: iconCode,
      mapIconColor: nodeColor
    };
    const divIcon = leaflet__WEBPACK_IMPORTED_MODULE_6__.divIcon({
      className: "leaflet-data-marker",
      html: leaflet__WEBPACK_IMPORTED_MODULE_6__.Util.template(iconSettings.mapIconUrl, iconSettings),
      iconSize: [15, 15]
    });
    let markers = [];
    let locationDetails = [];
    Object.keys(exposureProp).forEach(prop => {
      const locationDetail = {
        Name: exposureProp[prop].Name,
        FullAddress: exposureProp[prop].FullAddress,
        Date: exposureProp[prop].ExposedDate ? new Date(exposureProp[prop].ExposedDate) : undefined,
        Latitude: exposureProp[prop].Latitude,
        Longitude: exposureProp[prop].Longitude
      };
      locationDetails.push(locationDetail);
      if (locationDetail.Latitude != undefined && locationDetail.Longitude != undefined) {
        let marker = leaflet__WEBPACK_IMPORTED_MODULE_6__.marker([locationDetail.Latitude, locationDetail.Longitude], {
          icon: divIcon
        });
        marker.data = data;
        marker.locationDetail = locationDetail;
        markers.push(marker);
      }
    });
    return markers;
  }
  /*getGeospatialNodes(): MarkerWithData[] {
      let returnMarkerWithData: MarkerWithData[] = [];
       let n = this.nodes.length;
       for (let i = 0; i < n; i++) {
          const venueValue = this.nodes[i][this.SelectedVenueAddress];
          const exposureValue = this.nodes[i][this.SelectedExposureAddress];
           const d = this.nodes[i];
          const nodeColor = this.colorIterator.next();
          let venueMarkers: MarkerWithData[] = [];
          let exposureMarkers: MarkerWithData[] = [];
           if (venueValue) {
              const venues: VenueLocationDetail[] = JSON.parse(venueValue);
              if (venues && Array.isArray(venues))
                  venueMarkers = venues.map(v => this.getVenueMarker(nodeColor, this.marker.triangle, v, d));
              venueMarkers = venueMarkers.filter(x => x != undefined);
          }
           if (exposureValue) {
              const exposures: any = JSON.parse(exposureValue);
              if (exposures)
                  exposureMarkers = this.getExposureMarkers(nodeColor, this.marker.square, exposures, d);
          }
           const residence = this.getResidenceNode(d);
          if (residence && residence.Latitude != 0 && residence.Longitude != 0) {
              returnMarkerWithData.push(this.getResidenceMarker(nodeColor, this.marker.circle, residence, d));
          }
           returnMarkerWithData = returnMarkerWithData.concat(venueMarkers.concat(exposureMarkers));
      }
       return returnMarkerWithData;
  }
   getResidenceNode(data: any): LocationDetail | undefined {
      if (!data ||
          isNaN(data.CasedemographicsLatitude) ||
          isNaN(data.CasedemographicsLongitude) ||
          data.CasedemographicsLatitude == '' ||
          data.CasedemographicsLongitude == '') return undefined;
       return {
          Date: new Date(),
          FullAddress: data.CasedemographicsFullAddress,
          Latitude: data.CasedemographicsLatitude,
          Longitude: data.CasedemographicsLongitude,
          Name: 'Residence'
      };
  } */
  /**
   * Calls drawLeafletMapNodes() which removes all previous nodes from map, updates _j, _theta, _jlat, _jlon for each node
   */
  drawNodes(rerollNodes = true) {
    this.drawLeafletMapNodes(rerollNodes);
  }
  /**
   * Updates map by redrawing nodes
   * @param rerollNodes if true rerolls node positioning
   */
  drawLeafletMapNodes(rerollNodes) {
    if (rerollNodes) {
      this.clearAllMarkers();
      this.rerollNodes();
    } else {
      this.layers.removeNodes();
    }
    if (!this.commonService.session.style.widgets['map-node-show']) return;
    if (this.SelectedGeospatialTypeVariable == 'On') {
      //this.drawLeafletMapNodesGeospatial();
      console.error('implement drawLeafletMapNodesGeospatial');
    } else {
      this.drawLeafletMapNodesList();
    }
  }
  /*drawLeafletMapNodesGeospatial() {
      const opacity = 1 - this.commonService.session.style.widgets['map-node-transparency'];
      const selectedColor = this.commonService.session.style.widgets['selected-color'];
       this.colorIterator.reset();
       const features: Layer[] = [];
       let markers = this.getGeospatialNodes();
      markers = markers.filter(x => x.locationDetail && (x.locationDetail.Name === 'Residence' || (x.locationDetail.Date >= this.dateFilterRangeDates[0] &&
          x.locationDetail.Date <= this.dateFilterRangeDates[1])));
       markers.forEach(m => {
          m.on('mouseover', (e) => this.showNodeTooltip(e))
              .on('mouseout', (e) => this.hideTooltip())
              .on('click', (e) => this.clickHandler(e));
           features.push(m);
      })
       if (this.commonService.session.style.widgets['map-collapsing-on']) {
          this.layers.markerClusterGroup.addLayers(features);
      } else {
          this.layers.featureGroup = featureGroup(features);
          this.lmap.addLayer(this.layers.featureGroup);
      }
  } */
  /**
   * Draws nodes on the map
   */
  drawLeafletMapNodesList() {
    var fillcolor = this.commonService.session.style.widgets['node-color'],
      colorVariable = this.commonService.session.style.widgets['node-color-variable'],
      selectedColor = this.commonService.session.style.widgets['selected-color'],
      opacity = 1 - this.commonService.session.style.widgets['map-node-transparency'];
    var features = [];
    var n = this.nodes.length;
    for (var i = 0; i < n; i++) {
      var d = this.nodes[i];
      if (!d._jlat || !d._jlon || d.visible === false) continue;
      let circleMarker = leaflet__WEBPACK_IMPORTED_MODULE_6__.circleMarker(leaflet__WEBPACK_IMPORTED_MODULE_6__.latLng(d._jlat, d._jlon), {
        color: d.selected ? selectedColor : '#ffffff',
        opacity: opacity,
        fillColor: colorVariable == 'None' ? fillcolor : this.commonService.temp.style.nodeColorMap(d[colorVariable]),
        fillOpacity: opacity,
        radius: 5
      });
      circleMarker.data = d;
      circleMarker.on('mouseover', e => this.showNodeTooltip(e)).on('mouseout', e => this.hideTooltip()).on('click', e => this.clickHandler(e));
      features.push(circleMarker);
    }
    if (this.commonService.session.style.widgets['map-collapsing-on']) {
      this.layers.markerClusterGroup.addLayers(features);
    } else {
      this.layers.featureGroup = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.featureGroup)(features);
      this.lmap.addLayer(this.layers.featureGroup);
    }
  }
  /**
   * Draws links on the map
  */
  drawLinks() {
    this.layers.removeLinks();
    if (!this.commonService.session.style.widgets['map-link-show']) return;
    var lcv = this.commonService.session.style.widgets['link-color-variable'];
    var opacity = 1 - this.commonService.session.style.widgets['map-link-transparency'];
    var links = this.commonService.getVisibleLinks();
    var features = [];
    links.forEach(d => {
      if (!d.visible) return;
      var source = this.nodes.find(node => node._id == d.source && node.visible);
      var target = this.nodes.find(node => node._id == d.target && node.visible);
      if (source && target && source._jlat && source._jlon && target._jlat && target._jlon) {
        // Handle multiple origins
        if (d.origin && d.origin.length > 1) {
          let color1 = this.commonService.temp.style.linkColorMap(d.origin[0]);
          let color2 = this.commonService.temp.style.linkColorMap(d.origin[1]);
          let dashPattern1 = '10, 10';
          let dashPattern2 = '0, 10, 10, 0';
          let polyline1 = leaflet__WEBPACK_IMPORTED_MODULE_6__.polyline([[source._jlat, source._jlon], [target._jlat, target._jlon]], {
            color: color1,
            dashArray: dashPattern1,
            opacity: opacity
          });
          let polyline2 = leaflet__WEBPACK_IMPORTED_MODULE_6__.polyline([[source._jlat, source._jlon], [target._jlat, target._jlon]], {
            color: color2,
            dashArray: dashPattern2,
            opacity: opacity
          });
          features.push(polyline1);
          features.push(polyline2);
        } else {
          // Single origin handling
          const connectorLine = leaflet__WEBPACK_IMPORTED_MODULE_6__.polyline([[source._jlat, source._jlon], [target._jlat, target._jlon]], {
            color: lcv === "None" ? this.commonService.session.style.widgets['link-color'] : this.commonService.temp.style.linkColorMap(d[lcv]),
            opacity: opacity
          });
          connectorLine.data = d;
          features.push(connectorLine);
        }
      }
    });
    this.layers.links = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.featureGroup)(features);
    this.lmap.addLayer(this.layers.links);
    if (this.commonService.session.style.widgets['map-node-show']) {
      if (this.commonService.session.style.widgets['map-collapsing-on']) {
        // Not sure how to move collapsed nodes to front with bringToFront(), they use markerClusterGroup (from leaflet.markercluster plugin) instead of featureGroup (from base leaflet)
        this.drawNodes(false);
      } else {
        this.layers.featureGroup.bringToFront();
      }
    }
  }
  showNodeTooltip(e) {
    var data = e.target.data;
    var locationData = e.target.locationDetail;
    var variable = this.commonService.session.style.widgets['map-node-tooltip-variable'];
    if (variable !== 'None' && data[variable]) {
      let htmlText = data[variable];
      if (locationData) {
        htmlText = `<p><strong>${variable}:</strong> ${data[variable]}</p>`;
        htmlText += `<p><strong>Location:</strong> ${locationData.Name}</p>`;
        htmlText += `<p><strong>Address:</strong> ${locationData.FullAddress}</p>`;
      }
      d3__WEBPACK_IMPORTED_MODULE_4__.select(this.mapTooltip).html(htmlText).style('position', 'absolute').style('left', e.containerPoint.x - 50 + 'px').style('top', e.containerPoint.y - 50 + 'px').style('visibility', 'visible').style('z-index', 1001).transition().duration(100).style('opacity', 1);
    }
  }
  showLinkTooltip(e) {
    var d = e.layer.data;
    var v = this.commonService.session.style.widgets['map-link-tooltip-variable'];
    if (v !== 'None' && d[v]) {
      d3__WEBPACK_IMPORTED_MODULE_4__.select(this.mapTooltip).html(d[v]).style('left', e.originalEvent.pageX + 8 + 'px').style('top', e.originalEvent.pageY + 18 + 'px').style('z-index', 1001).transition().duration(100).style('opacity', 1);
    }
  }
  hideTooltip() {
    var tooltip = d3__WEBPACK_IMPORTED_MODULE_4__.select(this.mapTooltip);
    tooltip.transition().duration(100).style('opacity', 0).on('end', () => tooltip.style('z-index', -1));
  }
  /**
   * Clicking on a node updates that status of node selected properties. Other nodes will be unselected and then triggers a document node-selected event
   */
  clickHandler(e) {
    var node = e.sourceTarget.data;
    var d = this.visuals.gisMap.commonService.session.data.nodes.find(d => d._id == node._id);
    if (!e.originalEvent.ctrlKey) {
      this.visuals.gisMap.commonService.session.data.nodes.filter(node => node._id !== d._id).forEach(node => node.selected = false);
    }
    d.selected = !d.selected;
    $(document).trigger('node-selected');
    //window.dispatchEvent(new Event('node-selected'));
  }
  /**
   * @returns an array [X, Y] of the position of mouse relative to alignment view. Global position (i.e. d3.event.pageX) doesn't work for a dashboard
   */
  getRelativeMousePosition(e) {
    let rect = document.querySelector('mapcomponent').getBoundingClientRect();
    let X = e.pageX - rect.left;
    let Y = e.pageY - rect.top;
    return [X, Y];
  }
  resetStack() {
    //Tile Layers, in reverse order:
    if (this.layers.satellite && this.commonService.session.style.widgets['map-satellite-show']) this.layers.satellite.bringToBack();
    if (this.layers.basemap && this.commonService.session.style.widgets['map-basemap-show']) this.layers.basemap.bringToBack();
    //Background Layers, in order:
    if (this.layers.countries && this.commonService.session.style.widgets['map-countries-show']) this.layers.countries.bringToFront();
    if (this.layers.states && this.commonService.session.style.widgets['map-states-show']) this.layers.states.bringToFront();
    if (this.layers.counties && this.commonService.session.style.widgets['map-counties-show']) this.layers.counties.bringToFront();
    //User Layers:
    Object.keys(this.layers).filter(l => !this.commonService.includes(['countries', 'states', 'counties', 'satellite', 'basemap', 'links', 'nodes'], l)).forEach(l => this.layers[l].bringToFront());
    //Foreground Layers, in order:
    if (this.layers.links && this.commonService.session.style.widgets['map-link-show']) this.layers.links.bringToFront();
    if (this.layers.nodes() && this.commonService.session.style.widgets['map-node-show']) {
      if (this.commonService.session.style.widgets['map-collapsing-on']) {
        this.drawNodes(false); //This did not work with clusters//this.layers.nodes().bringToFront();
      } else {
        this.layers.nodes().bringToFront();
      }
    }
  }
  rerollCheck() {
    return this.nodes.some(node => node._theta == undefined || node._j == undefined);
  }
  /**
   * Reroll and jitter function for an individual node
   */
  rerollNodeAndJitter(node) {
    node._theta = this.commonService.r01() * Math.PI * 2;
    node._j = this.commonService.r01();
    var v = this.commonService.session.style.widgets['map-node-jitter'] == -2 ? 0 : Math.pow(2, this.commonService.session.style.widgets['map-node-jitter']);
    node._jlon = parseFloat(node._lon) + v * node._j * Math.cos(node._theta);
    node._jlat = parseFloat(node._lat) + v * node._j * Math.sin(node._theta);
  }
  /**
   * Updates _jlon and _jLat for each node using _theta & _j values from each node and widget['map-node-jitter']
   */
  jitter() {
    //debugger;
    var v = this.commonService.session.style.widgets['map-node-jitter'] == -2 ? 0 : Math.pow(2, this.commonService.session.style.widgets['map-node-jitter']);
    var n = this.nodes.length;
    for (var i = 0; i < n; i++) {
      var node = this.nodes[i];
      this.nodes[i]._jlon = parseFloat(node._lon) + v * node._j * Math.cos(node._theta);
      this.nodes[i]._jlat = parseFloat(node._lat) + v * node._j * Math.sin(node._theta);
    }
  }
  /**
   * Updates _theta and _j for each node. Then calls jitter() which uses those values to upate _jlon and _jlat
   */
  rerollNodes() {
    //debugger;
    this.nodes.forEach(node => {
      node._theta = this.commonService.r01() * Math.PI * 2;
      node._j = this.commonService.r01();
    });
    this.jitter();
  }
  /*makeGeoJSON() {
      var features = [];
      var jitter = this.commonService.session.style.widgets['map-node-jitter'] > 0;
      this.nodes.forEach((d) => {
          if (d._lat && d._lon) {
              features.push({
                  type: 'Feature',
                  geometry: {
                      type: 'Point',
                      coordinates: jitter ? [d._lon + d._jlon, d._lat + d._jlat] : [d._lon, d._lat]
                  },
                  properties: d
              });
          }
      });
      this.commonService.getVisibleLinks().forEach((d) => {
          if (!d.visible) return;
          var source = this.nodes.find(node => node.id == d.source);
          var target = this.nodes.find(node => node.id == d.target);
          if (source && target) {
              if (source._lat && source._lon && target._lat && target._lon) {
                  features.push({
                      type: 'Feature',
                      geometry: {
                          type: 'LineString',
                          coordinates: jitter ? [
                              [source._lon + source._jlon, source._lat + source._jlat],
                              [target._lon + target._jlon, target._lat + target._jlat]
                          ] : [
                              [source._lon, source._lat],
                              [target._lon, target._lat]
                          ]
                      },
                      properties: d
                  });
              }
          }
      });
      return {
          type: 'FeatureCollection',
          features: features
      };
  } */
  openSettings() {
    this.NodeMapSettingsExportDialogSettings.setVisibility(true);
  }
  openExport() {
    this.ShowGEOMapExportPane = true;
    this.visuals.microbeTrace.GlobalSettingsDialogSettings.setStateBeforeExport();
    this.visuals.microbeTrace.GlobalSettingsLinkColorDialogSettings.setStateBeforeExport();
    this.visuals.microbeTrace.GlobalSettingsNodeColorDialogSettings.setStateBeforeExport();
    this.visuals.gisMap.NodeMapSettingsExportDialogSettings.setStateBeforeExport();
  }
  openCenter() {
    this.centerMap();
  }
  //openPinAllNodes() {
  //}
  openRefreshScreen() {
    this.centerMap();
  }
  openSelectDataSetScreen() {}
  updateNodeColors() {
    this.drawNodes(false);
    this.drawLinks();
  }
  updateVisualization() {
    this.drawNodes(false);
    this.drawLinks();
  }
  applyStyleFileSettings() {
    this.loadSettings();
    //this.widgets = (window as any).context.commonService.session.style.widgets;
  }
  updateLinkColor() {
    this.drawLinks();
  }
  onRecallSession() {
    // nothing to do here. loadSettings is called when the map is ready (onMapReady)
  }
  onLoadNewData() {
    this.onDataChange(undefined);
  }
  onFilterDataChange() {
    this.onDataChange(undefined);
  }
  loadSettings() {
    //Components|Online|Basemap
    console.log('SelectedBasemapTypeVariable: ', this.SelectedBasemapTypeVariable);
    this.SelectedBasemapTypeVariable = this.commonService.session.style.widgets['map-basemap-show'] ? 'Show' : 'Hide';
    if (this.SelectedBasemapTypeVariable === 'Show') {
      this.onBasemapChange(this.SelectedBasemapTypeVariable, true);
    }
    //Components|Online|Satellite
    this.SelectedSatelliteTypeVariable = this.commonService.session.style.widgets['map-satellite-show'] ? 'Show' : 'Hide';
    if (this.SelectedSatelliteTypeVariable === 'Show') {
      this.onSatelliteChange(this.SelectedSatelliteTypeVariable, true);
    }
    if (this.SelectedBasemapTypeVariable === 'Hide' && this.SelectedSatelliteTypeVariable === 'Hide') {
      this.SelectedBasemapTypeVariable = 'Show';
      this.onBasemapChange(this.SelectedBasemapTypeVariable, true);
    }
    //Components|Network|Nodes
    this.SelectedNodesTypeVariable = this.commonService.session.style.widgets['map-node-show'] ? 'Show' : 'Hide';
    this.onMapNodeShowHideChange(this.SelectedNodesTypeVariable);
    //Components|Network|Links
    this.SelectedLinksTypeVariable = this.commonService.session.style.widgets['map-link-show'] ? 'Show' : 'Hide';
    this.onMapLinksShowHideChange(this.SelectedLinksTypeVariable);
    //Components|Offline|Countries
    this.SelectedCountriesTypeVariable = this.commonService.session.style.widgets['map-countries-show'] ? 'Show' : 'Hide';
    this.onCountriesShowHidChange(this.SelectedCountriesTypeVariable);
    //Components|Offline|States
    this.SelectedStatesTypeVariable = this.commonService.session.style.widgets['map-states-show'] ? 'Show' : 'Hide';
    this.onStatesShowHideChange(this.SelectedStatesTypeVariable);
    //Components|Offline|Counties
    this.SelectedCountiesTypeVariable = this.commonService.session.style.widgets['map-counties-show'] ? 'Show' : 'Hide';
    this.onCountiesShowHideChange(this.SelectedCountiesTypeVariable);
    //Data|Geospatial
    this.SelectedGeospatialTypeVariable = this.commonService.session.style.widgets['map-geospatial-type-on'] ? 'On' : 'Off';
    this.onGeospatialTypeChange(undefined);
    //Data|Latitude
    this.SelectedLatitude = this.commonService.session.style.widgets['map-field-lat'];
    //Data|Longitude
    this.SelectedLongitude = this.commonService.session.style.widgets['map-field-lon'];
    //Data|Census Tract
    this.SelectedCensusTract = this.commonService.session.style.widgets['map-field-tract'];
    //Data|Zipcode
    this.SelectedZipCode = this.commonService.session.style.widgets['map-field-zipcode'];
    //Data|County
    this.SelectedCounty = this.commonService.session.style.widgets['map-field-county'];
    //Data|State
    this.SelectedState = this.commonService.session.style.widgets['map-field-state'];
    //Data|Country
    this.SelectedCountry = this.commonService.session.style.widgets['map-field-country'];
    //Data|Country
    this.SelectedResidenceAddress = this.commonService.session.style.widgets['map-field-residence-address'];
    //Data|Country
    this.SelectedVenueAddress = this.commonService.session.style.widgets['map-field-venue-address'];
    //Data|Country
    this.SelectedExposureAddress = this.commonService.session.style.widgets['map-field-exposure-address'];
    this.onDataChange(undefined);
    //Nodes|Collapsing
    this.SelectedNodeCollapsingTypeVariable = this.commonService.session.style.widgets['map-collapsing-on'] ? 'On' : 'Off';
    this.onNodeCollapsingChange(undefined);
    //Nodes|Transparency
    this.SelectedNodeTransparencyVariable = this.commonService.session.style.widgets['map-node-transparency'];
    this.onNodeTransparencyChange(this.SelectedNodeTransparencyVariable);
    //Nodes|Jitter
    this.SelectedNodeJitterVariable = this.commonService.session.style.widgets['map-node-jitter'];
    this.onNodeJitterChange(this.SelectedNodeJitterVariable);
    //Nodes|Tooltip
    this.SelectedNodeTooltipVariable = this.commonService.session.style.widgets['map-node-tooltip-variable'];
    this.onNodeToolTipChange(this.SelectedNodeTooltipVariable);
    //Links|Transparency
    this.SelectedLinkTransparencyVariable = this.commonService.session.style.widgets['map-link-transparency'];
    this.onLinkTransparencyChange(this.SelectedLinkTransparencyVariable);
    //Links|Tooltip
    this.SelectedLinkTooltipVariable = this.commonService.session.style.widgets['map-link-tooltip-variable'];
    this.onLinkToolTipChange(this.SelectedLinkTooltipVariable);
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.Injector
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.Renderer2
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.ElementRef
    }, {
      type: _angular_platform_browser__WEBPACK_IMPORTED_MODULE_13__.EventManager
    }, {
      type: _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_14__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_11__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.ChangeDetectorRef
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_15__.GoogleTagManagerService
    }];
  }
  static {
    this.propDecorators = {
      DisplayGlobalSettingsDialogEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.Output
      }]
    };
  }
};
MapComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_16__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_12__.Component)({
  selector: 'MapComponent',
  template: _map_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  styles: [(_map_plugin_component_css_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_16__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_12__.Injector, _angular_core__WEBPACK_IMPORTED_MODULE_12__.Renderer2, _angular_core__WEBPACK_IMPORTED_MODULE_12__.ElementRef, _angular_platform_browser__WEBPACK_IMPORTED_MODULE_13__.EventManager, _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_14__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_12__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_12__.ChangeDetectorRef, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_15__.GoogleTagManagerService])], MapComponent);

//MOVE CLASSES TO NEW FILE
class MapLayers {
  constructor() {
    this.featureGroup = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.featureGroup)();
    this.markerClusterGroup = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.markerClusterGroup)();
    this.links = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.featureGroup)();
    this.countries = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.geoJSON)();
    this.states = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.geoJSON)();
    this.counties = (0,leaflet__WEBPACK_IMPORTED_MODULE_6__.geoJSON)();
  }
  nodes() {
    if (this.markerClusterGroup.getLayers().length) return this.markerClusterGroup;
    return this.featureGroup;
  }
  removeNodes() {
    this.featureGroup.clearLayers();
    this.markerClusterGroup.clearLayers();
  }
  removeLinks() {
    this.links.clearLayers();
  }
}
class MarkerWithData extends leaflet__WEBPACK_IMPORTED_MODULE_6__.Marker {}
class CircleWithData extends leaflet__WEBPACK_IMPORTED_MODULE_6__.CircleMarker {}
class PolyLineWithData extends leaflet__WEBPACK_IMPORTED_MODULE_6__.Polyline {}
(function (MapComponent) {
  MapComponent.componentTypeName = 'Map';
})(MapComponent || (MapComponent = {}));

/***/ }),

/***/ 52516:
/*!************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/PhylogeneticComponent/phylogenetic-plugin.component.ts ***!
  \************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PhylogeneticComponent: () => (/* binding */ PhylogeneticComponent)
/* harmony export */ });
/* harmony import */ var _Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 89204);
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _phylogenetic_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./phylogenetic-plugin.component.html?ngResource */ 93824);
/* harmony import */ var _phylogenetic_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./phylogenetic-plugin.component.scss?ngResource */ 81398);
/* harmony import */ var _phylogenetic_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_phylogenetic_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @app/contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var html_to_image__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! html-to-image */ 15135);
/* harmony import */ var _app_helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @app/helperClasses/dialogSettings */ 63412);
/* harmony import */ var _app_helperClasses_customShapes__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @app/helperClasses/customShapes */ 13564);
/* harmony import */ var _tidytree__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./tidytree */ 14758);
/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! d3 */ 86164);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);
/* harmony import */ var _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @app/contactTraceCommonServices/export.service */ 70616);

















/**
 * @title PhylogeneticComponent
 */
let PhylogeneticComponent = class PhylogeneticComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_10__.BaseComponentDirective {
  constructor(injector, eventManager, commonService, container, elRef, cdref, gtmService, exportService) {
    var _this;
    super(elRef.nativeElement);
    _this = this;
    this.eventManager = eventManager;
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.gtmService = gtmService;
    this.exportService = exportService;
    this.DisplayGlobalSettingsDialogEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_12__.EventEmitter();
    this.viewActive = true;
    this.svgStyle = {
      height: '0px',
      width: '1000px'
    };
    this.customShapes = new _app_helperClasses_customShapes__WEBPACK_IMPORTED_MODULE_7__.CustomShapes();
    this.ShowNetworkAttributes = false;
    this.ShowStatistics = false;
    this.ShowPhylogeneticExportPane = false;
    this.ShowPhylogeneticSettingsPane = false;
    this.IsDataAvailable = false;
    this.svg = {};
    this.settings = this.commonService.session.style.widgets;
    this.radToDeg = 180 / Math.PI;
    this.selected = false;
    this.multidrag = false;
    this.zoom = 1;
    this.FieldList = [];
    this.ToolTipFieldList = [];
    this.nodeMin = 3;
    this.nodeMax = 27;
    this.nodeScale = d3__WEBPACK_IMPORTED_MODULE_9__.scaleLinear().domain([0, 1]).range([0, 1]);
    this.nodeMid = 1;
    this.debugMode = false;
    // Tree Tab
    this.TreeLayouts = [{
      label: 'Horizontal',
      value: 'horizontal'
    }, {
      label: 'Vertical',
      value: 'vertical'
    }, {
      label: 'Circular',
      value: 'circular'
    }];
    this.SelectedTreeLayoutVariable = 'horizontal';
    this.TreeModes = [{
      label: 'Smooth',
      value: 'smooth'
    }, {
      label: 'Square',
      value: 'square'
    }, {
      label: 'Straight',
      value: 'straight'
    }];
    this.SelectedTreeModeVariable = 'square';
    this.TreeTypes = [{
      label: 'Weighted',
      value: 'weighted'
    }, {
      label: 'Unweighted (Tree)',
      value: 'tree'
    }, {
      label: 'Dendrogram',
      value: 'dendrogram'
    }];
    this.SelectedTreeTypeVariable = 'weighted'; // 'weighted';
    this.SelectedVerticalStretchVariable = 1;
    this.SelectedHorizontalStretchVariable = 1;
    // Leaves Tab
    this.SelectedLeafLabelShowVariable = true;
    this.SelectedLeafLabelVariable = '_id';
    this.LeafLabelFieldList = [];
    this.SelectedLeafLabelSizeVariable = 12;
    this.SelectedLeafTooltipShowVariable = true;
    this.SelectedLeafTooltipVariable = 'id';
    this.LeafTooltipFieldList = [];
    this.SelectedLeafNodeShowVariable = true;
    this.SelectedLeafNodeSizeVariable = 'None';
    this.SelectedLeafNodeSize = 5;
    this.SelectedLeafNodeColorVariable = this.settings['node-color'];
    this.SelectedSelectedLeafNodeColorVariable = this.settings['selected-color'];
    // Branch Tab
    this.SelectedBranchNodeShowVariable = false;
    this.SelectedBranchNodeSizeVariable = 5;
    this.SelectedBranchNodeColorVariable = this.settings['node-color'];
    this.SelectedBranchSizeVariable = 3;
    this.SelectedBranchLabelSizeVariable = 12;
    this.SelectedLinkColorVariable = this.settings['link-color'];
    this.SelectedBranchLabelShowVariable = false;
    this.SelectedBranchDistanceShowVariable = false;
    this.SelectedBranchDistanceSizeVariable = 12;
    this.SelectedBranchTooltipShowVariable = false;
    this.hideShowOptions = [{
      label: 'Hide',
      value: false
    }, {
      label: 'Show',
      value: true
    }];
    // Export Settings
    this.isExportClosed = false;
    this.isExporting = false;
    this.SelectedTreeImageFilenameVariable = 'default_tree';
    this.SelectedNewickStringFilenameVariable = 'default_tree.nwk';
    this.NetworkExportFileTypeList = [{
      label: 'png',
      value: 'png'
    }, {
      label: 'jpeg',
      value: 'jpeg'
    }, {
      label: 'svg',
      value: 'svg'
    }];
    this.SelectedNetworkExportFileTypeListVariable = 'png';
    this.SelectedNetworkExportScaleVariable = 1;
    this.SelectedNetworkExportQualityVariable = 0.92;
    this.CalculatedResolutionWidth = 1918;
    this.CalculatedResolutionHeight = 909;
    this.CalculatedResolution = this.CalculatedResolutionWidth * this.SelectedNetworkExportScaleVariable + ' x ' + this.CalculatedResolutionHeight * this.SelectedNetworkExportScaleVariable + 'px';
    this.ShowAdvancedExport = true;
    this.PhylogeneticTreeExportDialogSettings = new _app_helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_6__.DialogSettings('#phylotree-settings-pane', false);
    this.ContextSelectedNodeAttributes = [];
    this.tree = null;
    this.openTree = /*#__PURE__*/(0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      /*
      if (this.visuals.phylogenetic.commonService.session.data.newickString) {
        this.tree = new TidyTree(this.visuals.phylogenetic.commonService.session.data.tree,
                                 this.getTreeOptions(),
                                 this.getTreeHandlers());
        console.log(this.visuals.phylogenetic.commonService.session.data.tree);
        console.log(this.tree);
        this.hideTooltip();
        this.styleTree();
      } else {
      */
      //@ts-ignore
      if (_this.visuals.phylogenetic.commonService.session.data.hasOwnProperty("newickString") && _this.visuals.phylogenetic.commonService.session.data.newickString) {
        //@ts-ignore
        const newickString = _this.visuals.phylogenetic.commonService.session.data.newickString;
        const tree = _this.buildTree(newickString);
        _this.tree = tree;
        _this.commonService.visuals.phylogenetic.tree = tree;
        _this.mergeNodeData();
        _this.hideTooltip();
        _this.styleTree();
      } else {
        const newickString = yield _this.commonService.computeTree();
        console.log(newickString);
        //newickString.then((x) => {
        const tree = _this.buildTree(newickString);
        _this.tree = tree;
        _this.commonService.visuals.phylogenetic.tree = tree;
        _this.mergeNodeData();
        _this.hideTooltip();
        _this.styleTree();
        //});
      }
      // d3.select('svg#network').exit().remove();
      // this.visuals.phylogenetic.svg = d3.select('svg#network').append('g');
      _this.LeafLabelFieldList.push({
        label: 'None',
        value: 'None'
      });
      console.log("getting node fields");
      _this.commonService.session.data['nodeFields'].map((d, i) => {
        _this.visuals.phylogenetic.LeafLabelFieldList.push({
          label: _this.visuals.phylogenetic.commonService.capitalize(d.replace('_', '')),
          value: d
        });
      });
      console.log(_this.visuals.phylogenetic.LeafLabelFieldList);
      // }
    });
    this.styleTree = () => {
      this.svg = d3__WEBPACK_IMPORTED_MODULE_9__.select('#tidytree');
      let nodes = this.visuals.phylogenetic.commonService.session.data;
      nodes = this.svg.select('g.nodes').selectAll('g').data(nodes, d => d.id).join(enter => {
        const g = enter.append('g').attr('tabindex', '0').on('mouseenter focusin', x => this.showTooltip(x)).on('mouseout focusout', x => this.hideTooltip()).on('contextmenu', x => this.showContextMenu(x)).on('click', x => this.clickHandler(x)).on('keydown', n => {
          if (d3__WEBPACK_IMPORTED_MODULE_9__.event.code === 'Space') this.clickHandler(n);
          if (d3__WEBPACK_IMPORTED_MODULE_9__.event.shiftKey && d3__WEBPACK_IMPORTED_MODULE_9__.event.key === 'F10') this.showContextMenu(n);
        });
        g.append('path').style('stroke', 'black').style('stroke-width', '2px');
        g.append('text').attr('dy', 5).attr('dx', 8);
        return g;
      });
      this.tree.setBranchLabels(this.SelectedBranchLabelShowVariable);
      this.tree.eachBranchLabel(this.styleBranchLabel);
      this.tree.setBranchNodes(this.SelectedBranchNodeShowVariable);
      this.tree.eachBranchNode(this.styleBranchNode);
      this.tree.setBranchDistances(this.SelectedBranchDistanceShowVariable);
      this.tree.eachBranchDistance(this.styleBranchDistance);
      this.tree.setLeafNodes(this.SelectedLeafNodeSizeVariable);
      if (typeof this.SelectedLeafNodeSizeVariable === "string") {
        this.updateMinMaxNode();
      }
      this.tree.eachLeafNode(this.styleLeafNode);
      this.onLeafLabelVariableChange(this.SelectedLeafLabelVariable);
      this.tree.setLeafLabels(this.SelectedLeafLabelShowVariable);
      this.tree.eachLeafLabel(this.styleLeafLabel);
      const branchEls = document.querySelectorAll('g.tidytree-link > path');
      this.svg.style('height', '88vh;');
      branchEls.forEach(this.styleBranch);
      this.svg.style('background-color', '#ffffff');
    };
    this.styleBranch = el => {
      d3__WEBPACK_IMPORTED_MODULE_9__.select(el).style('stroke', this.SelectedLinkColorVariable);
      d3__WEBPACK_IMPORTED_MODULE_9__.select(el).style('stroke-width', `${this.SelectedBranchSizeVariable}px`);
    };
    this.styleBranchLabel = (label, data) => {
      d3__WEBPACK_IMPORTED_MODULE_9__.select(label).style('font-size', `${this.SelectedBranchLabelSizeVariable}px`);
    };
    this.styleBranchNode = (node, data) => {
      d3__WEBPACK_IMPORTED_MODULE_9__.select(node).attr('r', this.SelectedBranchNodeSizeVariable);
      d3__WEBPACK_IMPORTED_MODULE_9__.select(node).style('fill', this.SelectedBranchNodeColorVariable);
    };
    this.styleBranchDistance = (label, data) => {
      d3__WEBPACK_IMPORTED_MODULE_9__.select(label).style('font-size', `${this.SelectedBranchDistanceSizeVariable}px`);
    };
    this.styleLeafLabel = (label, data) => {
      d3__WEBPACK_IMPORTED_MODULE_9__.select(label).style('font-size', `${this.SelectedLeafLabelSizeVariable}px`);
    };
    this.getLeafSize = (node_id, variable) => {
      let defaultSize = this.SelectedLeafNodeSize;
      let size = defaultSize,
        med = defaultSize,
        oldrng,
        min,
        max;
      let nodes = this.visuals.phylogenetic.commonService.session.data.nodes;
      const node = nodes.filter(x => {
        if (x._id === node_id) {
          return true;
        }
      });
      if (variable === 'None') {
        return defaultSize;
      } else {
        let v = node[0][variable];
        if (variable === "Cluster" || variable === "Cluster size") {
          return parseInt(v);
        }
        if (!this.isNumber(v)) v = this.nodeMid;
        // Check the type of v before calling linkScale
        // Ensure v is a number before using linkScale
        if (typeof v === 'number') {
          let scaleValue = this.nodeScale(v);
          if (this.debugMode) {
            console.log('link scale', scaleValue);
          }
          return scaleValue;
        } else {
          if (this.debugMode) {
            console.error('v is not a number:', v);
          }
          return this.nodeScale; // Default to scalar if v is not a number
        }
      }
    };
    this.styleLeafNode = (node, data) => {
      let nodes = this.visuals.phylogenetic.commonService.session.data.nodes;
      let leafSize;
      const variable = this.visuals.phylogenetic.commonService.session.style.widgets['node-color-variable'];
      leafSize = this.getLeafSize(data.data.id, this.SelectedLeafNodeSizeVariable);
      d3__WEBPACK_IMPORTED_MODULE_9__.select(node).attr('r', leafSize);
      if (variable === 'None') {
        d3__WEBPACK_IMPORTED_MODULE_9__.select(node).style('fill', this.SelectedLeafNodeColorVariable);
      } else {
        d3__WEBPACK_IMPORTED_MODULE_9__.select(node).style('fill', d => {
          const node_values = nodes.filter(m => {
            if (m._id === d.data.id) {
              return true;
            } else {
              return false;
            }
          });
          const node_color = this.visuals.phylogenetic.commonService.temp.style.nodeColorMap(node_values[0][variable]);
          return node_color;
        });
        // d3.select(node).style('opacity', d => this.visuals.phylogenetic.commonService.temp.style.nodeAlphaMap(d[variable]));
        //  this.context.microbeTrace.generateNodeColorTable("#node-color-table-bottom", false);
      }
    };
    this.buildTree = newick => {
      const tree = new _tidytree__WEBPACK_IMPORTED_MODULE_8__["default"](newick ? newick : this.tree.data.clone(), this.getTreeOptions(), this.getTreeHandlers());
      return tree;
    };
    this.getTreeOptions = () => {
      const treeOpts = {
        parent: '#phylocanvas',
        layout: this.SelectedTreeLayoutVariable,
        mode: this.SelectedTreeModeVariable,
        type: this.SelectedTreeTypeVariable,
        leafNodes: this.SelectedLeafNodeShowVariable,
        branchNodes: this.SelectedBranchNodeSizeVariable,
        leafLabels: this.SelectedLeafLabelSizeVariable,
        branchLabels: this.SelectedBranchLabelSizeVariable,
        branchDistances: this.SelectedBranchDistanceSizeVariable,
        ruler: true,
        animation: parseFloat('0'),
        // range 0-2000 in steps of 10
        margin: [10, 10, 70, 30]
      };
      return treeOpts;
    };
    this.getTreeHandlers = () => {
      const handlers = {
        contextmenu: this.showContextMenu,
        showtooltip: this.showTooltip,
        hidetooltip: this.hideTooltip
      };
      return handlers;
    };
    this.getContextLeftVal = xPos => {
      if (xPos - 175 < 0) {
        return xPos + 25;
      } else {
        return xPos - 175;
      }
    };
    this.getContextTopVal = yPos => {
      if (yPos > this.svg.clientHeight - 125) {
        return yPos - 125;
      } else {
        return yPos + 25;
      }
    };
    this.showContextMenu = d => {
      // d3.event.preventDefault();
      this.hideTooltip();
      const tree = this.tree;
      const leftVal = this.getContextLeftVal(d3__WEBPACK_IMPORTED_MODULE_9__.event.pageX);
      const topVal = this.getContextTopVal(d3__WEBPACK_IMPORTED_MODULE_9__.event.pageY);
      d3__WEBPACK_IMPORTED_MODULE_9__.select('#phylo-context-menu').style('z-index', 1000).style('display', 'block').style('opacity', 1).style('left', `${leftVal}px`).style('top', `${topVal}px`);
      d3__WEBPACK_IMPORTED_MODULE_9__.select('#reroot').on('click', c => {
        tree.setData(d[0].data.reroot());
        this.styleTree();
        this.hideContextMenu();
      });
      d3__WEBPACK_IMPORTED_MODULE_9__.select('#rotate').on('click', c => {
        tree.setData(d[0].data.rotate().getRoot());
        this.styleTree();
        this.hideContextMenu();
      });
      d3__WEBPACK_IMPORTED_MODULE_9__.select('#flip').on('click', c => {
        tree.setData(d[0].data.flip().getRoot());
        this.styleTree();
        this.hideContextMenu();
      });
      d3__WEBPACK_IMPORTED_MODULE_9__.select('#tidytree').on('click', c => {
        this.hideContextMenu();
      });
    };
    this.hideContextMenu = () => {
      $('#phylo-context-menu').animate({
        opacity: 0
      }, 80, () => {
        $(this).css('z-index', -1);
      });
    };
    this.clickHandler = n => {
      if (d3__WEBPACK_IMPORTED_MODULE_9__.event.ctrlKey) {
        this.visuals.phylogenetic.commonService.session.data.nodes.find(node => node._id === n._id).selected = !n.selected;
      } else {
        this.visuals.phylogenetic.commonService.session.data.nodes.forEach(node => {
          if (node._id === n._id) {
            node.selected = !n.selected;
          } else {
            node.selected = false;
          }
        });
      }
    };
    this.showTooltip = d => {
      if (this.SelectedLeafTooltipShowVariable) {
        let htmlValue = this.SelectedLeafTooltipVariable;
        let [X, Y] = this.getRelativeMousePosition();
        // $('#tooltip').css({ top: d3.event.pageY - 28, left: d3.event.pageX + 8, position: 'absolute' });
        // const leftVal = X + 8;
        // const topVal = Y - 28;
        let node = this.commonService.session.data.nodes.find(n => n.id === d[0].data.id);
        if (node === undefined) {
          node = this.commonService.session.data.nodes.find(n => n._id === d[0].data.id);
          if (htmlValue === "id") htmlValue = "_id";
        }
        console.log(node);
        // Pre D3
        const leftVal = d3__WEBPACK_IMPORTED_MODULE_9__.event.pageX + 8;
        const topVal = d3__WEBPACK_IMPORTED_MODULE_9__.event.pageY - 8;
        console.log(topVal + " " + leftVal);
        d3__WEBPACK_IMPORTED_MODULE_9__.select('#phyloTooltip').html(node[htmlValue]).style('position', 'absolute').style('display', 'block').style('left', `${leftVal}px`).style('top', `${topVal}px`).style('z-index', 1000).transition().duration(100).style('opacity', 1).style('color', '#333333').style('background', '#f5f5f5').style('border', '1px solid #cccccc').style('border-radius', '.25rem').style('padding', '.25rem');
      }
    };
    this.hideTooltip = () => {
      const tooltip = d3__WEBPACK_IMPORTED_MODULE_9__.select('#phyloTooltip');
      tooltip.transition().duration(100).style('opacity', 0).on('end', () => tooltip.style('z-index', -1));
    };
    this.visuals = commonService.visuals;
    this.commonService.visuals.phylogenetic = this;
  }
  mergeNodeData() {
    let data = this.commonService.session.data.nodes;
    console.log(this.tree.data);
    let leafNodes = this.tree.data.getLeaves();
  }
  isNumber(a) {
    return typeof a == "number";
  }
  updateMinMaxNode() {
    const visNodes = this.commonService.getVisibleNodes();
    let n = visNodes.length;
    let maxWidth = 20;
    let minWidth = this.SelectedLeafNodeSize;
    this.nodeMin = Number.MAX_VALUE;
    this.nodeMax = Number.MIN_VALUE;
    for (let i = 0; i < n; i++) {
      let size = visNodes[i][this.SelectedLeafNodeSizeVariable];
      if (typeof size == 'undefined') continue;
      if (size < this.nodeMin) this.nodeMin = size;
      if (size > this.nodeMax) this.nodeMax = size;
    }
    this.nodeMid = (this.nodeMax - this.nodeMin) / 2;
    this.nodeScale = d3__WEBPACK_IMPORTED_MODULE_9__.scaleLinear().domain([this.nodeMin, this.nodeMax]).range([minWidth, maxWidth]);
  }
  ngOnInit() {
    let that = this;
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/phylogenetic",
      page_title: "Phylogenetic Tree View"
    });
    $(document).on("node-selected", function () {
      that.updateNodeColors();
    });
    this.goldenLayoutComponentResize();
    this.openTree();
    this.container.on('resize', () => {
      this.goldenLayoutComponentResize();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.cdref.detectChanges();
    });
  }
  goldenLayoutComponentResize() {
    $('#phylocanvas').height($('phylogeneticcomponent').height() - 19);
    $('#phylocanvas').width($('phylogeneticcomponent').width() - 1);
  }
  InitView() {
    this.visuals.phylogenetic.IsDataAvailable = this.visuals.phylogenetic.commonService.session.data.nodes.length === 0 ? false : true;
    if (this.visuals.phylogenetic.IsDataAvailable === true && this.visuals.phylogenetic.zoom == null) {
      // d3.select('svg#network').exit().remove();
      // this.visuals.phylogenetic.svg = d3.select('svg#network').append('g');
      this.LeafLabelFieldList.push({
        label: 'None',
        value: 'None'
      });
      console.log("getting node fields");
      this.commonService.session.data['nodeFields'].map((d, i) => {
        this.visuals.phylogenetic.LeafLabelFieldList.push({
          label: this.visuals.phylogenetic.commonService.capitalize(d.replace('_', '')),
          value: d
        });
      });
      console.log(this.visuals.phylogenetic.LeafLabelFieldList);
    }
  }
  openSettings() {
    this.visuals.phylogenetic.PhylogeneticTreeExportDialogSettings.setVisibility(true);
    // this.context.twoD.ShowStatistics = !this.context.twoD.Show2DSettingsPane;
  }
  openExport() {
    this.ShowPhylogeneticExportPane = true;
    this.visuals.microbeTrace.GlobalSettingsDialogSettings.setStateBeforeExport();
    this.visuals.microbeTrace.GlobalSettingsLinkColorDialogSettings.setStateBeforeExport();
    this.visuals.microbeTrace.GlobalSettingsNodeColorDialogSettings.setStateBeforeExport();
    this.isExportClosed = false;
  }
  openCenter() {
    const thisTree = this.commonService.visuals.phylogenetic.tree;
    thisTree.recenter().redraw();
    this.styleTree();
  }
  //openPinAllNodes() {
  //}
  openRefreshScreen() {}
  openSelectDataSetScreen() {}
  onTreeLayoutChange(event) {
    if (this.tree) {
      this.SelectedTreeLayoutVariable = event;
      this.tree.setLayout(event);
      this.openCenter();
      this.styleTree();
    }
  }
  onTreeModeChange(event) {
    if (this.tree) {
      this.SelectedTreeModeVariable = event;
      this.tree.setMode(event);
      this.openCenter();
      this.styleTree();
    }
  }
  onTreeTypeChange(event) {
    this.SelectedTreeTypeVariable = event;
    this.tree.setType(event);
    this.openCenter();
    this.styleTree();
  }
  onLeafLabelVariableChange(event) {
    this.SelectedLeafLabelVariable = event;
    let labelVar = event;
    this.tree.eachLeafLabel(label => {
      d3__WEBPACK_IMPORTED_MODULE_9__.select(label).text(data => {
        let id = data.data.id;
        let node = this.commonService.session.data.nodes.find(node => node.id == id);
        if (node === undefined) node = this.commonService.session.data.nodes.find(d => d._id === data.data.id);
        return node[labelVar];
      }).attr('dx', 8);
    });
  }
  onLeafTooltipVariableChange(event) {
    this.SelectedLeafTooltipVariable = event;
    let labelVar = event;
    this.tree.eachLeafNode((circle, data) => {
      let node = this.commonService.session.data.nodes.find(d => d.id === data.data.id);
      if (node === undefined) node = this.commonService.session.data.nodes.find(d => d._id === data.data.id);
      d3__WEBPACK_IMPORTED_MODULE_9__.select(circle).attr('title', node[labelVar]);
    });
    this.styleTree();
  }
  onHorizontalStretchChange(event) {
    let cached = this.tree.animation;
    this.tree.setAnimation(0);
    this.tree.setHStretch(this.SelectedHorizontalStretchVariable);
    this.tree.setAnimation(cached);
    this.styleTree();
  }
  onVerticalStretchChange(event) {
    let cached = this.tree.animation;
    this.tree.setAnimation(0);
    this.tree.setVStretch(this.SelectedVerticalStretchVariable);
    this.tree.setAnimation(cached);
    this.styleTree();
  }
  onBranchLabelShowChange(event) {
    this.SelectedBranchLabelShowVariable = event;
    this.tree.setBranchLabels(event);
    this.styleTree();
  }
  onBranchLabelSizeChange(event) {
    this.SelectedBranchLabelSizeVariable = event;
    this.styleTree();
  }
  onBranchDistanceShowChange(event) {
    this.SelectedBranchDistanceShowVariable = event;
    this.tree.setBranchDistances(event);
    this.styleTree();
  }
  onBranchDistanceSizeChange(event) {
    this.SelectedBranchDistanceSizeVariable = event;
    this.styleTree();
  }
  onBranchNodeShowChange(event) {
    this.SelectedBranchNodeShowVariable = event;
    this.tree.setBranchNodes(event);
    this.styleTree();
  }
  onBranchNodeSizeChange(event) {
    this.SelectedBranchNodeSizeVariable = event;
    this.styleTree();
  }
  onBranchTooltipShowChange(event) {
    this.SelectedBranchTooltipShowVariable = event;
    this.styleTree();
  }
  onLeafLabelTooltipShowChange(event) {
    this.SelectedLeafTooltipShowVariable = event;
    this.styleTree();
  }
  onLeafLabelShowChange(event) {
    this.SelectedLeafLabelShowVariable = event;
    this.tree.setLeafLabels(event);
    this.styleTree();
  }
  showGlobalSettings() {
    this.DisplayGlobalSettingsDialogEvent.emit('Styling');
  }
  onLeafNodeSizeChange(event) {
    this.SelectedLeafNodeSize = event;
    this.styleTree();
  }
  onLeafNodeSizeVariableChange(event) {
    this.SelectedLeafNodeSizeVariable = event;
    this.styleTree();
  }
  onLeafLabelSizeChange(event) {
    this.SelectedLeafLabelSizeVariable = event;
    this.styleTree();
  }
  onBranchSizeChange(event) {
    this.SelectedBranchSizeVariable = event;
    this.styleTree();
  }
  onCloseExport() {
    this.isExportClosed = true;
  }
  updateNodeColors() {
    let variable = this.visuals.phylogenetic.commonService.session.style.widgets['node-color-variable'];
    const nodeColor = this.visuals.phylogenetic.commonService.session.style.widgets['node-color'];
    this.SelectedLeafNodeColorVariable = nodeColor;
    this.styleTree();
    const selectedColor = this.visuals.phylogenetic.commonService.GlobalSettingsModel.SelectedColorVariable;
  }
  updateLinkColor() {
    const linkColor = this.visuals.phylogenetic.commonService.session.style.widgets['link-color'];
    this.SelectedLinkColorVariable = linkColor;
    this.styleTree();
  }
  saveImage(event) {
    const thisTree = this.commonService.visuals.phylogenetic.tree;
    const fileName = this.SelectedTreeImageFilenameVariable;
    const treeId = 'tidytree';
    const exportImageType = this.SelectedNetworkExportFileTypeListVariable;
    const content = document.getElementById(treeId);
    if (exportImageType === 'png') {
      html_to_image__WEBPACK_IMPORTED_MODULE_5__.toPng(content).then(dataUrl => {
        file_saver__WEBPACK_IMPORTED_MODULE_4__(dataUrl, fileName);
      });
    } else if (exportImageType === 'jpeg') {
      html_to_image__WEBPACK_IMPORTED_MODULE_5__.toJpeg(content, {
        quality: 0.85
      }).then(dataUrl => {
        file_saver__WEBPACK_IMPORTED_MODULE_4__(dataUrl, fileName);
      });
    } else if (exportImageType === 'svg') {
      const svgContent = this.exportService.unparseSVG(content);
      const blob = new Blob([svgContent], {
        type: 'image/svg+xml;charset=utf-8'
      });
      file_saver__WEBPACK_IMPORTED_MODULE_4__(blob, fileName);
    }
  }
  saveNewickString(event) {
    const thisTree = this.commonService.visuals.phylogenetic.tree;
    const newickBlob = new Blob([thisTree.data.toNewick(false)], {
      type: 'text/plain;charset=utf-8'
    });
    file_saver__WEBPACK_IMPORTED_MODULE_4__(newickBlob, this.SelectedNewickStringFilenameVariable);
  }
  /**
   * @returns an array [X, Y] of the position of mouse relative to twodcomponent. Global position (i.e. d3.event.pageX) doesn't work for a dashboard
   */
  getRelativeMousePosition() {
    // let rect = d3.select('phylogeneticcomponent').node().getBoundingClientRect();
    // let X = d3.event.pageX - rect.left;
    // let Y = d3.event.pageY - rect.top; 
    return [0, 0];
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.Injector
    }, {
      type: _angular_platform_browser__WEBPACK_IMPORTED_MODULE_13__.EventManager
    }, {
      type: _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_14__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_10__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.ChangeDetectorRef
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_15__.GoogleTagManagerService
    }, {
      type: _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_11__.ExportService
    }];
  }
  static {
    this.propDecorators = {
      DisplayGlobalSettingsDialogEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_12__.Output
      }]
    };
  }
};
PhylogeneticComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_16__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_12__.Component)({
  selector: 'PhylogeneticComponent',
  template: _phylogenetic_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__,
  styles: [(_phylogenetic_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_16__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_12__.Injector, _angular_platform_browser__WEBPACK_IMPORTED_MODULE_13__.EventManager, _app_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_14__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_12__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_12__.ChangeDetectorRef, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_15__.GoogleTagManagerService, _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_11__.ExportService])], PhylogeneticComponent);

(function (PhylogeneticComponent) {
  PhylogeneticComponent.componentTypeName = 'Phylogenetic Tree';
})(PhylogeneticComponent || (PhylogeneticComponent = {}));

/***/ }),

/***/ 6811:
/*!**********************************************************************************!*\
  !*** ./src/app/visualizationComponents/TableComponent/table-plugin-component.ts ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   TableComponent: () => (/* binding */ TableComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _table_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./table-plugin-component.html?ngResource */ 72557);
/* harmony import */ var _table_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./table-plugin-component.less?ngResource */ 52082);
/* harmony import */ var _table_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_table_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_4__);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);











/**
 * @title Complex Example
 */
let TableComponent = class TableComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__.BaseComponentDirective {
  constructor(injector, container, elRef, cdref, eventManager, commonService, gtmService) {
    super(elRef.nativeElement);
    this.container = container;
    this.cdref = cdref;
    this.eventManager = eventManager;
    this.commonService = commonService;
    this.gtmService = gtmService;
    this.DisplayGlobalSettingsDialogEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_5__.EventEmitter();
    this.viewActive = true;
    this.SelectedTableExportFilenameVariable = "";
    this.TableExportFileTypeList = [{
      label: 'xlsx',
      value: 'xlsx'
    }, {
      label: 'csv',
      value: 'csv'
    }];
    this.exportColumnOptions = [{
      label: 'All',
      value: true
    }, {
      label: 'Current',
      value: false
    }];
    this.exportAllColumns = false;
    this.SelectedTableExportFileTypeListVariable = "csv";
    this.SelectedTextSizeVariable = 14;
    this.ShowTableExportPane = false;
    this.ShowTableSettingsPane = false;
    this.IsDataAvailable = false;
    this.meta = ['selected', 'visible'];
    this.TableColumns = [];
    this.SelectableTableColumns = [];
    this.AvailableColumns = [];
    this.TableDatas = [];
    this.TableDataSelection = [];
    this.TableType = 'node';
    this.filterTypes = [{
      label: 'Contains',
      value: 'contains'
    }, {
      label: '=',
      value: 'equals'
    }, {
      label: '!=',
      value: 'notEquals'
    }, {
      label: 'Starts With',
      value: 'startsWith'
    }, {
      label: 'Ends With',
      value: 'endsWith'
    }, {
      label: 'In',
      value: 'in'
    }, {
      label: '<',
      value: 'lt'
    }, {
      label: '<=',
      value: 'lte'
    }, {
      label: '>',
      value: 'gt'
    }, {
      label: '>=',
      value: 'gte'
    }];
    this.selectedSize = '';
    this.sizes = [{
      name: 'Small',
      class: 'p-datatable-sm'
    }, {
      name: 'Normal',
      class: ''
    }, {
      name: 'Large',
      class: 'p-datatable-lg'
    }];
    this.selectedRows = 10;
    this.visuals = commonService.visuals;
    this.commonService.visuals.tableComp = this;
  }
  ngOnInit() {
    // this.InitView();
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/table",
      page_title: "Table View"
    });
    this.dataSetView = [];
    this.dataSetView.push({
      label: 'Nodes',
      value: 'Node'
    });
    this.dataSetView.push({
      label: 'Links',
      value: 'Link'
    });
    this.dataSetView.push({
      label: 'Clusters',
      value: 'Cluster'
    });
    this.dataSetViewSelected = "Node";
    this.IsDataAvailable = this.commonService.session.data.nodes.length == 0 ? false : true;
    if (this.IsDataAvailable == true) {
      if (!this.SelectedTableData || this.SelectedTableData.tableColumns.length == 0) {
        this.createTable(this.dataSetViewSelected);
      }
    }
    let that = this;
    $(document).on("node-selected", function () {
      if (that.viewActive) {
        that.visuals.tableComp.setSelectedNodes();
      }
    });
    window.addEventListener("node-selected", () => {
      if (!this.visuals.microbeTrace.homepageTabs.find(x => x.isActive && x.label === 'Table')) {
        this.visuals.tableComp.setSelectedNodes();
      }
    });
    // offsets: 70 table-wrapper padding-top, 60 p-paginator, 10 table-wrapper padding-bottom
    this.scrollHeight = $('tableComponent').height() - 70 - 60 - 10 + 'px';
    let width = $('tableComponent').width() - 23 + 'px';
    this.tableStyle = {
      'max-width': width,
      'display': 'block'
    };
    this.container.on('resize', () => {
      this.goldenLayoutComponentResize();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.setSelectedNodes();
      this.cdref.detectChanges();
    });
  }
  /**
   * Exports table
   *
   * For exporting as excel file it calls this.saveAsExcelFile();
   *
   * For exporting as a csv it uses exportCSV() which is built into primeNG table object
   */
  exportVisualization() {
    if (this.SelectedTableExportFileTypeListVariable == 'xlsx') {
      this.saveAsExcelFile();
    } else {
      this.dataTable.exportFilename = this.SelectedTableExportFilenameVariable;
      if (this.exportAllColumns) {
        let temp = this.SelectedTableData.tableColumns;
        let temp2 = [];
        this.SelectedTableData.availableColumns.forEach(column => temp2.push(column.value));
        this.dataTable.columns = temp2;
        this.dataTable.exportCSV();
        this.dataTable.columns = temp;
      } else {
        this.dataTable.exportCSV();
      }
    }
    this.ShowTableExportPane = !this.ShowTableExportPane;
  }
  /**
   * Allows users to export the table as an excel file
   * @param fileName optional if not given will use this.SelectedtableExportFilenameVariable
   */
  saveAsExcelFile(fileName) {
    if (fileName == undefined) {
      fileName = this.SelectedTableExportFilenameVariable;
    }
    Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! xlsx */ 13857)).then(xlsx => {
      // if a filtered is applied use filteredValue else use all values
      let rowData = this.dataTable.filteredValue || this.dataTable.value;
      if (this.exportAllColumns) {
        // change name of data fields to header to be consistent with the other exports on this component
        rowData = rowData.map(row => {
          let output = {};
          this.SelectedTableData.availableColumns.forEach(key => output[key.value.header] = row[key.value.field]);
          return output;
        });
      } else {
        // gets only the current/visible columns for export and also changes data field name to the header name
        rowData = rowData.map(row => {
          let output = {};
          this.SelectedTableData.tableColumns.forEach(key => output[key.header] = row[key.field]);
          return output;
        });
      }
      let worksheet = xlsx.utils.json_to_sheet(rowData);
      const workbook = {
        Sheets: {
          'data': worksheet
        },
        SheetNames: ['data']
      };
      const excelBuffer = xlsx.write(workbook, {
        bookType: 'xlsx',
        type: 'array'
      });
      const EXCEL_TYPE = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8';
      const EXCEL_EXTENSION = '.xlsx';
      const data = new Blob([excelBuffer], {
        type: EXCEL_TYPE
      });
      file_saver__WEBPACK_IMPORTED_MODULE_4__(data, fileName + EXCEL_EXTENSION);
    });
  }
  /**
   * Called first when filter is applied it applys filter to this.dataTable to update this.dataTable.filterValue
   * @param col
   */
  onTableFilter(col) {
    this.dataTable.filter(col.filterValue, col.field, col.filterType);
  }
  /**
   * Called second when a filter is applied, it updates values sotred in commonService.session.data and this.selectedRows if needed
   * @param event
   */
  onFilter(event) {
    let filteredValues = [];
    switch (this.visuals.tableComp.TableType) {
      case 'node':
        filteredValues = this.visuals.tableComp.commonService.session.data.nodes.filter(x => event.filteredValue.find(y => y.index === x.index));
        break;
      case 'link':
        filteredValues = this.visuals.tableComp.commonService.session.data.links.filter(x => event.filteredValue.find(y => y.index === x.index));
        break;
      case 'cluster':
        filteredValues = this.visuals.tableComp.commonService.session.data.clusters.filter(x => event.filteredValue.find(y => y.id === x.id));
        break;
    }
    this.visuals.tableComp.SelectedTableData.filter = event.filters;
    // these lines can used to update nodes/data used for other views; publishFilterDataChange() calls onFilterDataChange for each view 
    // onFilterDataChange will need to be updated for implimenting this; also a bug in labeling by index sometimes changes the numbering of nodes
    /*this.visuals.tableComp.commonService.session.data[this.visuals.tableComp.TableType + 'Filter'] = event.filters;
    this.visuals.tableComp.commonService.session.data[this.visuals.tableComp.TableType + 'FilteredValues'] = filteredValues;
    this.visuals.microbeTrace.publishFilterDataChange(); */
    // updates number of rows when filter is changed (without there is a visual bug when removing a filter)
    if ($('.p-paginator-rpp-options span').text() == 'All') {
      this.selectedRows = event.filteredValue.length;
    }
  }
  // XXXXX changing font size in settings pane currently calls this function
  onDataChange(event) {}
  onFilterDataChange() {
    //Nothing to do here
  }
  /**
   * Function is called when a user selects a row by clicking on it.
   * It calls nodeSelect(event, true), which updates commonService.session.data.nodes/nodeFilteredValues
   * to be selected for the row/node and also emits a 'node-selected' event
   */
  onRowSelect(event) {
    this.nodeSelect(event, true);
  }
  /**
   * Function is called when a user unselects a row.
   * It calls nodeSelect(event, false), which updates commonService.session.data.nodes/nodeFilteredValues
   * to be selected for the row/node and also emits a 'node-selected' event
   */
  onRowUnselect(event) {
    this.nodeSelect(event, false);
  }
  /**
   * Called when a node is selected/unselected by clicking on a row. This function updates
   * commonService.session.data.nodes/nodeFilteredValues to be selected for the row/node and also emits a 'node-selected' event
   */
  nodeSelect(event, isSelect) {
    if (event.data === undefined) return;
    if (this.visuals.tableComp.TableType === 'node') {
      this.visuals.tableComp.commonService.session.data.nodes.filter(x => x.index === event.data.index).forEach(x => x.selected = isSelect);
      this.visuals.tableComp.commonService.session.data.nodeFilteredValues.filter(x => x.index === event.data.index).forEach(x => x.selected = isSelect);
    }
    $(document).trigger('node-selected');
    //window.dispatchEvent(new Event('node-selected'));
  }
  /**
   * Update variables (such as TableType, selectedTableData) needed to update the contents of the table
   * @param type The type of data (node, link, cluster) to create table with
   */
  createTable(type = "node") {
    type = type.toLowerCase();
    this.visuals.tableComp.TableType = type;
    // checks if data for tableData exists in TableDatas, if not, creates a new TableData object and adds it to TableDatas
    let tableData = this.TableDatas.find(x => x.tableType === type);
    const isNewTableData = tableData == undefined;
    if (isNewTableData) {
      tableData = {
        tableType: type,
        data: [],
        dataSelection: [],
        tableColumns: this.visuals.tableComp.commonService.session.data[type + 'TableColumns'],
        availableColumns: [],
        selectedTableColumns: [],
        filter: this.visuals.tableComp.commonService.session.data[type + 'Filter']
      };
      this.TableDatas.push(tableData);
    }
    this.visuals.tableComp.TableColumns = [];
    if (this.dataTable) {
      this.dataTable.reset();
      this.dataTable.filters = tableData.filter;
    }
    this.visuals.tableComp.commonService.session.data[type + 'Fields'].map((d, i) => {
      if (this.visuals.tableComp.meta.includes(d)) return;
      let filterValue = "";
      if (tableData.filter) {
        const foundFilterItem = tableData.filter[d];
        if (foundFilterItem) {
          filterValue = foundFilterItem.value;
        }
      }
      const column = {
        field: d,
        header: d == 'nn' ? 'Nearest Neighbor' : this.visuals.tableComp.capitalize(d.replace("_", "")),
        filterValue: filterValue,
        filterType: 'contains'
      };
      const foundAvailableColumn = tableData.availableColumns.find(x => x.label === column.header);
      if (foundAvailableColumn) {
        foundAvailableColumn.filterValue = column.filterValue;
      } else {
        tableData.availableColumns.push({
          label: column.header,
          value: column,
          disabled: column.field === 'index'
        });
      }
    });
    if (!tableData.tableColumns.length) {
      tableData.tableColumns = tableData.availableColumns.filter((curVal, index) => index <= 5).map(x => x.value);
    }
    tableData.tableColumns.forEach(x => {
      const c = tableData.availableColumns.find(y => y.value.header === x.header).value.filterValue;
      x.filterValue = c;
    });
    tableData.data = [];
    let typeData = type + "s";
    this.visuals.tableComp.commonService.session.data[typeData].map((d, i) => {
      if (this.visuals.tableComp.meta.includes(d)) return;
      let nrow = {};
      tableData.availableColumns.map((e, n) => {
        const field = e.value.field;
        let stringVal = d[field];
        if (stringVal === undefined || stringVal === null) {
          nrow[field] = "";
        } else {
          nrow[field] = stringVal.toString().indexOf(",") > -1 ? stringVal.toString().split(",", 100).length > 1 ? stringVal.toString().split(",", 100).join('\n') : d[field] : d[field];
        }
      });
      tableData.data.push(nrow);
    });
    const foundTableData = this.TableDatas.find(x => x.tableType === type);
    if (foundTableData) {
      this.SelectedTableData = foundTableData;
    }
    //set selected nodes
    this.visuals.tableComp.setSelectedNodes();
  }
  /**
   * If this.TableType == 'node' update the node TableData.dataSelection to the nodes that are selected in commonService.session.data.nodes
   */
  setSelectedNodes() {
    if (this.visuals.tableComp.TableType === 'node') {
      const foundTableData = this.TableDatas.find(x => x.tableType === 'node');
      if (foundTableData) {
        const selectedNodes = this.visuals.tableComp.commonService.session.data.nodes.filter(x => x.selected);
        foundTableData.dataSelection = this.SelectedTableData.data.filter(x => selectedNodes.find(y => y.index == x.index));
      }
    }
  }
  /**
   * @param s string
   * @returns s but with first letter capitatlized, if s is not string type returns empty string
   */
  capitalize(s) {
    if (typeof s !== 'string') return '';
    return s.charAt(0).toUpperCase() + s.slice(1);
  }
  // XXXXX need to revisit for changing text size in table; currently unable to change size of text and changing the setting calls onDataChange()
  resetTextsize() {
    let s = $('#table-font-size').val();
    $('#table').css({
      'font-size': s + 'px',
      'line-height': s / 10
    });
  }
  reorderColumns() {
    let temp = this.SelectedTableData.tableColumns[2];
    this.SelectedTableData.tableColumns[2] = this.SelectedTableData.tableColumns[3];
    this.SelectedTableData.tableColumns[3] = temp;
  }
  /**
   * Opens settings pane for table component
   */
  openSettings() {
    this.visuals.tableComp.ShowTableSettingsPane = !this.visuals.tableComp.ShowTableSettingsPane;
  }
  /**
   * Opens export pane for table component
   */
  openExport() {
    this.visuals.tableComp.ShowTableExportPane = !this.visuals.tableComp.ShowTableExportPane;
  }
  openCenter() {}
  //openPinAllNodes() {
  //}
  openRefreshScreen() {}
  /**
   * This function is called when the type of data to display in the table is changed (Nodes, Links, Cluster)
   * @param e event
   */
  openSelectDataSetScreen(e) {
    this.visuals.tableComp.createTable(e.value);
    // after changing table type sometimes there is a visual bug that the following code fixes
    if ($('.p-paginator-rpp-options span').text() == 'All') {
      this.selectedRows = this.SelectedTableData.data.length;
    }
  }
  onLoadNewData() {
    this.createTable(this.visuals.microbeTrace.dataSetViewSelected);
  }
  updateNodeColors() {
    //Not Relevant
  }
  updateVisualization() {
    //Not Relevant
  }
  applyStyleFileSettings() {
    //this.widgets = (window as any).context.commonService.session.style.widgets;
    //this.loadSettings();
  }
  updateLinkColor() {
    //Not Relevant
  }
  onRecallSession() {}
  goldenLayoutComponentResize() {
    this.scrollHeight = $('tableComponent').height() - 70 - 60 - 10 + 'px';
    let width = $('tableComponent').width() - 23 + 'px';
    this.tableStyle = {
      'width': width,
      'display': 'block'
    };
  }
  /**
   * Called before the comonent is destroyed; it save tableColumns for each node, link, and cluster in commonService.session.data
   */
  ngOnDestroy() {
    let foundTableData = this.TableDatas.find(x => x.tableType === 'node');
    if (foundTableData) {
      this.visuals.tableComp.commonService.session.data.nodeTableColumns = foundTableData.tableColumns;
    }
    foundTableData = this.TableDatas.find(x => x.tableType === 'link');
    if (foundTableData) {
      this.visuals.tableComp.commonService.session.data.linkTableColumns = foundTableData.tableColumns;
    }
    foundTableData = this.TableDatas.find(x => x.tableType === 'cluster');
    if (foundTableData) {
      this.visuals.tableComp.commonService.session.data.clusterTableColumns = foundTableData.tableColumns;
    }
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.Injector
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_6__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.ChangeDetectorRef
    }, {
      type: _angular_platform_browser__WEBPACK_IMPORTED_MODULE_7__.EventManager
    }, {
      type: _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_8__.GoogleTagManagerService
    }];
  }
  static {
    this.propDecorators = {
      DisplayGlobalSettingsDialogEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.Output
      }],
      dataTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.ViewChild,
        args: ['dt']
      }]
    };
  }
};
TableComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_9__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_5__.Component)({
  selector: 'TableComponent',
  template: _table_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  styles: [(_table_plugin_component_less_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_9__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_5__.Injector, golden_layout__WEBPACK_IMPORTED_MODULE_6__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_5__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_5__.ChangeDetectorRef, _angular_platform_browser__WEBPACK_IMPORTED_MODULE_7__.EventManager, _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_8__.GoogleTagManagerService])], TableComponent);

(function (TableComponent) {
  TableComponent.componentTypeName = 'Table';
})(TableComponent || (TableComponent = {}));

/***/ }),

/***/ 38510:
/*!*******************************************************************************************!*\
  !*** ./src/app/visualizationComponents/TimelineComponent/timeline-component.component.ts ***!
  \*******************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   TimelineComponent: () => (/* binding */ TimelineComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _timeline_component_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./timeline-component.component.html?ngResource */ 26498);
/* harmony import */ var _timeline_component_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./timeline-component.component.scss?ngResource */ 97110);
/* harmony import */ var _timeline_component_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_timeline_component_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! d3 */ 86164);
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! moment */ 39545);
/* harmony import */ var moment__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! file-saver */ 85841);
/* harmony import */ var file_saver__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(file_saver__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var save_svg_as_png__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! save-svg-as-png */ 494);
/* harmony import */ var save_svg_as_png__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(save_svg_as_png__WEBPACK_IMPORTED_MODULE_7__);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);
/* harmony import */ var _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @app/contactTraceCommonServices/export.service */ 70616);













let TimelineComponent = class TimelineComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__.BaseComponentDirective {
  constructor(commonService, container, elRef, cdref, gtmService, exportService) {
    super(elRef.nativeElement);
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.gtmService = gtmService;
    this.exportService = exportService;
    this.DisplayGlobalSettingsDialogEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_9__.EventEmitter();
    this.viewActive = true;
    this.FieldList = [];
    this.FieldListStack = [];
    this.binSizes = ['Day', 'Week', 'Month', 'Quarter', 'Year'];
    this.graphTypes = ['Single Date Field', 'Multi: Side by Side', 'Multi: Overlay'];
    this.selectedGraphType = 'Single Date Field';
    this.legendPositionOptions = ['Hide', 'Left', 'Right', 'Bottom'];
    this.ShowEpiSettingsPane = false;
    this.ShowEpiExportPane = false;
    this.EpiExportFileName = "";
    this.EpiExportFileType = "png";
    this.SelectedNetworkExportScaleVariable = 1;
    this.SelectedNetworkExportQualityVariable = 0.92;
    this.localColorMap = x => {};
    this.margin = {
      top: 5,
      left: 45,
      right: 20,
      bottom: 50
    };
    this.tick = 0;
    this.isPlaying = false;
    this.vnodes = []; // Replace with your actual data
    this.visuals = commonService.visuals;
    this.commonService.visuals.epiCurve = this;
    this.widgets = this.commonService.session.style.widgets;
    this.setDefaultsWidgets();
  }
  ngOnInit() {
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/timeline",
      page_title: "Timeline View"
    });
    // populate this.twoD.FieldList with [None, ...nodeFields]
    this.visuals.epiCurve.FieldList = [];
    this.visuals.epiCurve.FieldListStack = [];
    this.visuals.epiCurve.FieldList.push({
      label: "None",
      value: "None"
    });
    this.visuals.epiCurve.FieldListStack.push({
      label: "None",
      value: 'None'
    }, {
      label: "Node Color",
      value: "Node Color"
    });
    this.visuals.epiCurve.commonService.session.data['nodeFields'].map((d, i) => {
      if (d != 'seq' && d != 'sequence') {
        this.visuals.epiCurve.FieldList.push({
          label: this.visuals.epiCurve.commonService.capitalize(d.replace("_", "")),
          value: d
        });
        this.visuals.epiCurve.FieldListStack.push({
          label: this.visuals.epiCurve.commonService.capitalize(d.replace("_", "")),
          value: d
        });
      }
    });
    this.tickInterval = 1;
    this.updateSettingsRows();
  }
  setDefaultsWidgets() {
    // graphType
    if (this.widgets['epiCurve-graphType'] == undefined) {
      this.widgets['epiCurve-graphType'] = 'Single Date Field';
    }
    this.selectedGraphType = this.widgets['epiCurve-graphType'];
    // date fields
    if (this.widgets['epiCurve-date-fields'] == undefined) {
      if (this.widgets['epi-timeline-date-field'] != undefined) {
        this.widgets['epiCurve-date-fields'] = [this.widgets['epi-timeline-date-field'], 'None', 'None'];
      } else {
        this.widgets['epiCurve-date-fields'] = ['None', 'None', 'None'];
      }
    } else if (this.widgets['epiCurve-date-fields'].length < 3) {
      while (this.widgets['epiCurve-date-fields'] < 3) {
        this.widgets['epiCurve-date-fields'].push('None');
      }
    }
    this.SelectedDateFieldVariable = this.widgets['epiCurve-date-fields'][0];
    this.SelectedDateFieldVariable2 = this.widgets['epiCurve-date-fields'][1];
    this.SelectedDateFieldVariable3 = this.widgets['epiCurve-date-fields'][2];
    // colors
    if (this.widgets['epiCurve-colors'] == undefined) {
      this.widgets['epiCurve-colors'] = ['#f5d742', '#f20fff', '#20ff1a'];
    }
    // stackColorBy field
    if (this.widgets['epiCurve-stackColorBy'] == undefined) {
      this.widgets['epiCurve-stackColorBy'] = 'None';
    }
    // binSize
    if (this.widgets['epiCurve-binSize'] == undefined) {
      this.widgets['epiCurve-binSize'] = 'Month';
    }
    //
    if (this.widgets['epiCurve-cumulative'] == undefined) {
      this.widgets['epiCurve-cumulative'] = false;
    }
    // legendPosition
    if (this.widgets['epiCurve-legendPosition'] == undefined) {
      this.widgets['epiCurve-legendPosition'] = 'Left';
    }
  }
  ngAfterViewInit() {
    // this.initializeD3Chart();
    this.setupEventListeners();
    if (this.widgets['epiCurve-legendPosition'] == 'Bottom') {
      this.margin.bottom = 100;
    } else {
      this.margin.bottom = 50;
    }
    this.refresh();
  }
  /**
   * Clears previous histogram/epi curve and creates a new one; calls refreshMulti if needed
   */
  refresh() {
    if (this.selectedGraphType == 'Multi: Overlay' || this.selectedGraphType == 'Multi: Side by Side') {
      this.refreshMulti();
      return;
    } else if (this.SelectedDateFieldVariable == 'None') {
      return;
    }
    $('#epiCurveSVG').empty();
    this.updateSizes();
    if (this.height < 0) {
      return;
    }
    const field = this.SelectedDateFieldVariable;
    let times = this.getTimes([field]);
    // updates this.timeDomainStart and this.timeDomainInterval and returns the bin interval
    let binInterval = this.calculateBinInterval(times);
    if (binInterval == 0) {
      return;
    }
    this.x = d3__WEBPACK_IMPORTED_MODULE_4__.scaleTime().domain([this.timeDomainStart, this.timeDomainEnd]).rangeRound([0, this.width]);
    this.y = d3__WEBPACK_IMPORTED_MODULE_4__.scaleLinear().range([this.height, 0]);
    //@ts-ignore
    this.histogram = d3__WEBPACK_IMPORTED_MODULE_4__.histogram().value(d => d[field]).domain(this.x.domain()).thresholds(binInterval);
    this.svg = d3__WEBPACK_IMPORTED_MODULE_4__.select(this.epiCurveSVGElement.nativeElement).attr("width", this.width + this.margin.left + this.margin.right).attr("height", this.height + this.margin.top + this.margin.bottom);
    //.attr("transform", `translate(0, ${this.margin.top})`);
    const epiCurve = this.svg.append("g").classed("epiCurve-epi-curve", true).attr("transform", `translate(${this.margin.left}, 5)`);
    let bins = this.histogram(this.vnodes);
    let colorVariable = this.commonService.session.style.widgets['node-color-variable'];
    let nodeColorKeys;
    if (colorVariable != 'None' && this.widgets['epiCurve-stackColorBy'] == 'Node Color') {
      nodeColorKeys = this.commonService.session.style.nodeColorsTableKeys[colorVariable].map(value => value == 'null' ? null : value);
      this.localColorMap = this.commonService.temp.style.nodeColorMap;
    } else if (this.widgets['epiCurve-stackColorBy'] != 'None') {
      nodeColorKeys = this.updateLocalColorMap();
    }
    let maxCount = 0;
    [maxCount, bins] = this.updateBins(bins, this.widgets['epiCurve-stackColorBy'] == 'Node Color' ? colorVariable : this.widgets['epiCurve-stackColorBy'], nodeColorKeys);
    this.y.domain([0, maxCount]).nice(); //d3.max(bins, d => d.length)]);
    if (colorVariable != 'None' && this.widgets['epiCurve-stackColorBy'] == 'Node Color' || this.widgets['epiCurve-stackColorBy'] != 'None' && this.widgets['epiCurve-stackColorBy'] != 'Node Color') {
      let nodeColors = [];
      nodeColorKeys.forEach((value, ind) => {
        epiCurve.selectAll(`rect${ind}`).data(bins).enter().append("rect").attr("transform", d => `translate(${this.x(d.x0)}, ${this.y(d.height[ind])})`).attr("width", d => this.x(d.x1) - this.x(d.x0)).attr("height", d => this.height - this.y(d.length2[ind])).attr("fill", this.localColorMap(value));
        nodeColors.push(this.localColorMap(value));
      });
      this.generateLegend(epiCurve, nodeColors, nodeColorKeys);
    } else {
      let color = this.widgets['epiCurve-stackColorBy'] == 'None' ? this.widgets['epiCurve-colors'][0] : this.widgets["node-color"];
      epiCurve.selectAll("rect").data(bins).enter().append("rect").attr("transform", d => `translate(${this.x(d.x0)}, ${this.y(d.length)})`).attr("width", d => this.x(d.x1) - this.x(d.x0)).attr("height", d => this.height - this.y(d.length)).attr("fill", color);
      this.generateLegend(epiCurve, [color], [this.SelectedDateFieldVariable]);
    }
    this.updateAxes();
  }
  /**
   * Updated version of refresh that works for multiple date fields to generate the epi curve graph
   * Calls refresh() instead if needed
   */
  refreshMulti() {
    if (this.selectedGraphType == 'Single Date Field') {
      this.refresh();
      return;
    } else if (this.SelectedDateFieldVariable == 'None' && this.SelectedDateFieldVariable2 == 'None' && this.SelectedDateFieldVariable3 == 'None') {
      return;
    }
    $('#epiCurveSVG').empty();
    this.updateSizes();
    if (this.height < 0) {
      return;
    }
    let fields = [];
    let colors = [];
    [this.SelectedDateFieldVariable, this.SelectedDateFieldVariable2, this.SelectedDateFieldVariable3].forEach((dateField, ind) => {
      if (dateField != 'None') {
        fields.push(dateField);
        colors.push(this.widgets["epiCurve-colors"][ind]);
      }
    });
    if (fields.length == 0) {
      return;
    }
    // current implementation of times is only used to calculate min and max time of all data given when setting up x axis and bins; there isn't a current need to link times by datapoint with times
    let times = this.getTimes(fields);
    // updates this.timeDomainStart and this.timeDomainInterval and returns the bin interval
    let binInterval = this.calculateBinInterval(times);
    if (binInterval == 0) {
      return;
    }
    this.x = d3__WEBPACK_IMPORTED_MODULE_4__.scaleTime().domain([this.timeDomainStart, this.timeDomainEnd]).rangeRound([0, this.width]);
    this.y = d3__WEBPACK_IMPORTED_MODULE_4__.scaleLinear().range([this.height, 0]);
    //@ts-ignore
    this.histogram = d3__WEBPACK_IMPORTED_MODULE_4__.histogram().domain(this.x.domain()).thresholds(binInterval);
    this.svg = d3__WEBPACK_IMPORTED_MODULE_4__.select(this.epiCurveSVGElement.nativeElement).attr("width", this.width + this.margin.left + this.margin.right).attr("height", this.height + this.margin.top + this.margin.bottom).attr("transform", `translate(0, ${this.margin.top})`);
    const epiCurve = this.svg.append("g").classed("epiCurve-epi-curve", true).attr("transform", `translate(${this.margin.left}, 5)`);
    let maxCount = 0;
    let bins = [];
    fields.forEach(field => {
      if (field != 'None') {
        let currentCount = 0;
        let currentbin = this.histogram(this.vnodes.map(d => d[field]).filter(value => value != null));
        [currentCount, currentbin] = this.updateBins(currentbin);
        bins.push(currentbin);
        if (currentCount > maxCount) maxCount = currentCount;
      }
    });
    this.y.domain([0, maxCount]).nice();
    if (this.selectedGraphType == 'Multi: Overlay') {
      fields.forEach((_, ind) => {
        epiCurve.selectAll(`rect${ind}`).data(bins[ind]).enter().append("rect").attr("transform", d => `translate(${this.x(d.x0)}, ${this.y(d.length)})`).attr("width", d => this.x(d.x1) - this.x(d.x0)).attr("height", d => this.height - this.y(d.length)).attr("fill", colors[ind]).attr("opacity", 0.6);
      });
    } else {
      let numberOfBins = fields.length;
      let width;
      let xOffset = [];
      if (numberOfBins == 1) {
        width = d => this.x(d.x1) - this.x(d.x0);
        xOffset = [function (d, c) {
          return c.x(d.x0);
        }];
      } else if (numberOfBins == 2) {
        width = d => (this.x(d.x1) - this.x(d.x0)) / 2;
        xOffset = [function (d, c) {
          return c.x(d.x0);
        }, function (d, c) {
          return c.x(d.x0) + (c.x(d.x1) - c.x(d.x0)) / 2;
        }];
      } else {
        width = d => (this.x(d.x1) - this.x(d.x0)) / 3;
        xOffset = [function (d, c) {
          return c.x(d.x0);
        }, function (d, c) {
          return c.x(d.x0) + (c.x(d.x1) - c.x(d.x0)) / 3;
        }, function (d, c) {
          return c.x(d.x0) + 2 * (c.x(d.x1) - c.x(d.x0)) / 3;
        }];
      }
      let that = this;
      fields.forEach((_, ind) => {
        epiCurve.selectAll(`rect${ind}`).data(bins[ind]).enter().append("rect").attr("transform", d => `translate(${xOffset[ind](d, that)}, ${this.y(d.length)})`).attr("width", width).attr("height", d => this.height - this.y(d.length)).attr("fill", colors[ind]);
      });
    }
    this.updateAxes();
    this.generateLegend(epiCurve, colors, fields);
  }
  /**
   * Return an array of unique options for nodes[this.widgets['epiCurve-stackColorBy']] and then also used that information to update localColorMap function
   */
  updateLocalColorMap() {
    let nodeColorTableKeys = [];
    this.commonService.session.data.nodes.forEach(node => {
      if (!node.visible) return;
      if (!nodeColorTableKeys.some(value => value == node[this.widgets['epiCurve-stackColorBy']])) {
        nodeColorTableKeys.push(node[this.widgets['epiCurve-stackColorBy']]);
      }
    });
    this.localColorMap = d3__WEBPACK_IMPORTED_MODULE_4__.scaleOrdinal(this.commonService.session.style.nodeColors).domain(nodeColorTableKeys);
    return nodeColorTableKeys;
  }
  updateSizes() {
    const wrapper = $(this.epiCurveElement.nativeElement).parent();
    $('#epiCurve').height(wrapper.height() - 50);
    this.width = wrapper.width() - this.margin.left - this.margin.right;
    // height represents the height of y axis
    this.height = wrapper.height() - this.margin.top - this.margin.bottom - 50;
    this.middle = this.height / 2;
  }
  getTimes(fields) {
    let times = [];
    this.vnodes = JSON.parse(JSON.stringify(this.commonService.session.data.nodes));
    this.vnodes.forEach(d => {
      fields.forEach(field => {
        const time = moment__WEBPACK_IMPORTED_MODULE_5___default()(d[field]); // Cast 'field' as string
        if (time.isValid()) {
          d[field] = time.toDate();
          times.push(d[field]); // Cast 'field' as string
        } else {
          d[field] = null; // Cast 'field' as string
        }
      });
    });
    if (times.length < 2) {
      times = [new Date(2000, 1, 1), new Date()];
    }
    return times;
  }
  updateAxes() {
    let [xAxis, xLabelOffset] = this.configureXAxisSettings();
    this.svg.append("g").attr("class", "axis axis--x").attr("transform", `translate(${this.margin.left}, ${this.height + 5})`).call(xAxis).attr("text-anchor", "center").selectAll("text").attr("x", xLabelOffset);
    this.svg.append("g").attr("class", "axis axis--y").attr("transform", `translate(${this.margin.left}, 5)`).call(d3__WEBPACK_IMPORTED_MODULE_4__.axisLeft(this.y)).attr("text-anchor", null).selectAll("text").attr("x", -20);
    this.svg.append("text").attr("class", "x label").attr("text-anchor", "center").attr("x", this.width / 2).attr("y", this.height + 40).text(`Date (${this.widgets['epiCurve-binSize'] == 'Day' ? 'Dai' : this.widgets['epiCurve-binSize']}ly Bins)`);
    this.svg.append("text").attr("class", "y label").attr("text-anchor", "center").attr("y", 15).attr("x", -this.middle - this.margin.top - this.margin.bottom).attr("transform", "rotate(-90)").text("Number of Cases");
    /*this.brush = d3.brushX()
      .extent([[0, 0], [this.width, this.height]])
      .on("start brush", () => {
        this.selection = d3.brushSelection(this.brushG.node());
        if (!this.selection) return;
        if (this.selection[0] > 0) {
          this.selection[0] = 0;
          this.brushG.call(this.brush.move, this.selection);
        }
      })
      .on("end", function () {
        this.selection = d3.brushSelection(this.brushG.node());
        if (!this.selection) return;
        if (this.selection[0] > 0) {
          this.selection[0] = 0;
          this.brushG.call(this.brush.move, this.selection);
          this.propagate();
        }
      });
             this.brushG = this.svg
      .append("g")
      .attr("class", "brush")
      .attr("transform", "translate(" + this.margin.left + ",0)")
      .call(this.brush);
      */
  }
  generateLegend(epiCurve, colors, fieldNames) {
    let xOffset = 50; // default for left position
    if (this.widgets['epiCurve-legendPosition'] == 'Hide') {
      return;
    } else if (this.widgets['epiCurve-legendPosition'] == 'Bottom') {
      let prevLength = 0;
      let rowCount = 0;
      let y = this.height + 50;
      if (this.selectedGraphType == 'Single Date Field' && this.widgets['epiCurve-stackColorBy'] == 'Node Color' && this.commonService.session.style.widgets['node-color-variable'] != 'None') {
        let field = this.commonService.capitalize(this.commonService.session.style.widgets['node-color-variable']);
        epiCurve.append("text").attr("x", 70).attr("y", y).text(field + ': ').style("font-size", "15px").attr("alignment-baseline", "middle");
        prevLength += field.length + 3;
      } else if (this.selectedGraphType == 'Single Date Field' && this.widgets['epiCurve-stackColorBy'] != 'Node Color' && this.widgets['epiCurve-stackColorBy'] != 'None') {
        epiCurve.append("text").attr("x", 70).attr("y", y).text(this.widgets['epiCurve-stackColorBy'] + ': ').style("font-size", "15px").attr("alignment-baseline", "middle");
        prevLength += this.widgets['epiCurve-stackColorBy'].length + 3;
      }
      fieldNames.forEach((name, i) => {
        // this first section calculates the location for each item/name in the legend
        let nLength = name == null ? 7 : name.toString().length;
        let baseX = 70 + 40 * rowCount + prevLength * 7.5;
        if (baseX + 24 + nLength * 3 > this.width - 70) {
          rowCount = 0;
          y += 30;
          prevLength = 0;
          baseX = 70;
        }
        epiCurve.append("circle").attr("cx", baseX).attr("cy", y).attr("r", 6).style("fill", colors[i]);
        epiCurve.append("text").attr("x", baseX + 10).attr("y", y).text(this.commonService.capitalize(name == null ? '(Empty)' : name.toString())).style("font-size", "15px").attr("alignment-baseline", "middle");
        prevLength += nLength;
        rowCount += 1;
      });
      return;
    } else if (this.widgets['epiCurve-legendPosition'] == 'Right') {
      xOffset = this.width - 120;
    }
    let count = 0;
    if (this.selectedGraphType == 'Single Date Field' && this.widgets['epiCurve-stackColorBy'] == 'Node Color' && this.commonService.session.style.widgets['node-color-variable'] != 'None') {
      let field = this.commonService.capitalize(this.commonService.session.style.widgets['node-color-variable']);
      epiCurve.append("text").attr("x", xOffset).attr("y", 30).text(field + ': ').style("font-size", "15px").attr("alignment-baseline", "middle");
      count += 1;
    } else if (this.selectedGraphType == 'Single Date Field' && this.widgets['epiCurve-stackColorBy'] != 'Node Color' && this.widgets['epiCurve-stackColorBy'] != 'None') {
      epiCurve.append("text").attr("x", xOffset).attr("y", 30).text(this.widgets['epiCurve-stackColorBy'] + ': ').style("font-size", "15px").attr("alignment-baseline", "middle");
      count += 1;
    }
    fieldNames.forEach((name, i) => {
      epiCurve.append("circle").attr("cx", xOffset).attr("cy", 30 * (count + 1)).attr("r", 6).style("fill", colors[i]);
      epiCurve.append("text").attr("x", xOffset + 20).attr("y", 30 * (count + 1)).text(this.commonService.capitalize(name == null ? '(Empty)' : name.toString())).style("font-size", "15px").attr("alignment-baseline", "middle");
      count += 1;
    });
  }
  setupEventListeners() {
    $('#timeline-play').click(() => {
      if (this.isPlaying) {
        $('#timeline-play').html('<span class="oi oi-media-play"></span>');
        this.stopTimeline();
      } else {
        $('#timeline-play').html('<span class="oi oi-media-pause"></span>');
        this.startTimeline();
      }
    });
    $(window).on('node-color-change', () => {
      this.svg.selectAll(".epiCurve-epi-curve rect").attr("fill", this.commonService.session.style.widgets["node-color-variable"]);
    });
    $('#timeline-speed').on('change', () => {
      this.setTimer();
    });
    this.container.on('resize', () => {
      this.goldenLayoutComponentResize();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.cdref.detectChanges();
    });
  }
  /**
   * Updates this.timeDomainStart and this.timeDomainEnd based on dates and this.widgets['epiCurve-binSize'];
   *
   * @param times array of date objects
   * @returns return a d3 time range such as d3.timeMonth.range()
   */
  calculateBinInterval(times) {
    let minTime = Math.min(...times);
    let maxTime = Math.max(...times);
    if (this.widgets['epiCurve-binSize'] == 'Day') {
      //@ts-ignore
      this.timeDomainStart = d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth(minTime);
      //@ts-ignore
      this.timeDomainEnd = d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth.ceil(maxTime);
      return d3__WEBPACK_IMPORTED_MODULE_4__.timeDay.range(this.timeDomainStart, this.timeDomainEnd);
    } else if (this.widgets['epiCurve-binSize'] == 'Week') {
      //@ts-ignore
      this.timeDomainStart = d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth(minTime);
      //@ts-ignore
      this.timeDomainEnd = d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth.ceil(maxTime);
      return d3__WEBPACK_IMPORTED_MODULE_4__.timeMonday.range(this.timeDomainStart, this.timeDomainEnd);
    } else if (this.widgets['epiCurve-binSize'] == 'Month') {
      //@ts-ignore
      this.timeDomainStart = d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth(minTime);
      //@ts-ignore
      this.timeDomainEnd = d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth.ceil(maxTime);
      return d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth.range(this.timeDomainStart, this.timeDomainEnd);
    } else if (this.widgets['epiCurve-binSize'] == 'Quarter') {
      //@ts-ignore
      this.timeDomainStart = d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth(minTime, 3);
      //@ts-ignore
      this.timeDomainEnd = d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth.ceil(maxTime, 3);
      // for quarter we may need to update earliest month so that quarters are consistant (always start on Jan, April, July, or October)
      if ([1, 2].includes(this.timeDomainStart.getMonth())) {
        this.timeDomainStart.setMonth(0);
      } else if ([4, 5].includes(this.timeDomainStart.getMonth())) {
        this.timeDomainStart.setMonth(3);
      } else if ([7, 8].includes(this.timeDomainStart.getMonth())) {
        this.timeDomainStart.setMonth(6);
      } else if ([10, 11].includes(this.timeDomainStart.getMonth())) {
        this.timeDomainStart.setMonth(9);
      }
      return d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth.range(this.timeDomainStart, this.timeDomainEnd, 3);
    } else if (this.widgets['epiCurve-binSize'] == 'Year') {
      //@ts-ignore
      this.timeDomainStart = d3__WEBPACK_IMPORTED_MODULE_4__.timeYear(minTime);
      //@ts-ignore
      this.timeDomainEnd = d3__WEBPACK_IMPORTED_MODULE_4__.timeYear.ceil(maxTime);
      return d3__WEBPACK_IMPORTED_MODULE_4__.timeYear.range(this.timeDomainStart, this.timeDomainEnd);
    } else {
      alert("Invalid bin size selected");
      return 0;
    }
  }
  /**
   * @returns updated bins with new attributes. bin.length2 is array of height of each group (ie. 'M', 'F') needed for that bin interval, bin.height represents the offset of that group.
   *
   * Also returns maxCount which is used for setting y axis max value
   */
  updateBins(bins, colorVariable = 'None', nodeColorKeys = undefined) {
    let maxCount = 0;
    // cumulative with multiple colors per column
    if (this.widgets['epiCurve-stackColorBy'] != 'None' && this.widgets['epiCurve-cumulative'] && colorVariable != 'None') {
      //useNodeColors
      //heights represents the size of each rect, offset represent the offset of each rect
      let heights = new Array(nodeColorKeys.length).fill(0);
      let offsets = new Array(nodeColorKeys.length).fill(0);
      bins.forEach(bin => {
        bin.length2 = [];
        bin.height = [];
        nodeColorKeys.forEach((value, ind) => {
          let currentCount = bin.filter(obj => obj[colorVariable] == value).length;
          heights[ind] += currentCount;
          bin.length2.push(heights[ind]);
          offsets[ind] = bin.length2.reduce((paritalSum, a) => paritalSum + a, 0);
          bin.height.push(offsets[ind]);
        });
        maxCount += bin.length;
      });
      // noncumulative with multiple colors per column
    } else if (this.widgets['epiCurve-stackColorBy'] != 'None' && colorVariable != 'None') {
      bins.forEach(bin => {
        bin.length2 = [];
        bin.height = [];
        nodeColorKeys.forEach(value => {
          bin.length2.push(bin.filter(obj => obj[colorVariable] == value).length);
          bin.height.push(bin.length2.reduce((paritalSum, a) => paritalSum + a, 0));
        });
        if (bin.length > maxCount) maxCount = bin.length;
      });
      // else if (useNodeColor == False || (useNodeColor && colorVariable=='None')) and using cumulative
      // cumulative with one color 
    } else if (this.widgets['epiCurve-cumulative']) {
      bins.forEach(bin => {
        maxCount += bin.length;
        bin.length = maxCount;
      });
      // noncumulative with one color
    } else {
      bins.forEach(bin => {
        if (bin.length > maxCount) maxCount = bin.length;
      });
    }
    return [maxCount, bins];
  }
  /**
   *
   * @return xAxis which is used to determine the interval and label for xAxis ticks and xLabelOffet which determine how much to shift each label
   */
  configureXAxisSettings() {
    let xAxis;
    let numberOfDays = d3__WEBPACK_IMPORTED_MODULE_4__.timeDay.count(this.timeDomainStart, this.timeDomainEnd);
    let xLabelOffset = -10;
    if (this.widgets['epiCurve-binSize'] == 'Year') {
      xAxis = d3__WEBPACK_IMPORTED_MODULE_4__.axisBottom(this.x).ticks(d3__WEBPACK_IMPORTED_MODULE_4__.timeYear).tickFormat(d3__WEBPACK_IMPORTED_MODULE_4__.timeFormat("%Y"));
    } else if (numberOfDays < 366) {
      xAxis = d3__WEBPACK_IMPORTED_MODULE_4__.axisBottom(this.x).ticks(d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth.every(this.tickInterval)).tickFormat(d3__WEBPACK_IMPORTED_MODULE_4__.timeFormat("%b %Y"));
      xLabelOffset = -25;
    } else if (this.widgets['epiCurve-binSize'] == 'Quarter') {
      xAxis = d3__WEBPACK_IMPORTED_MODULE_4__.axisBottom(this.x).ticks(d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth.every(this.tickInterval < 3 ? this.tickInterval * 3 : 12)).tickFormat(d => d <= d3__WEBPACK_IMPORTED_MODULE_4__.timeYear(d) ? d.getFullYear().toString() : null);
    } else {
      xAxis = d3__WEBPACK_IMPORTED_MODULE_4__.axisBottom(this.x).ticks(d3__WEBPACK_IMPORTED_MODULE_4__.timeMonth.every(this.tickInterval)).tickFormat(d => d <= d3__WEBPACK_IMPORTED_MODULE_4__.timeYear(d) ? d.getFullYear().toString() : null);
    }
    return [xAxis, xLabelOffset];
  }
  goldenLayoutComponentResize() {
    this.refresh();
    if (this.ShowEpiExportPane && this.EpiExportFileType != 'svg') {
      this.setCalculatedResolution();
    }
  }
  // Handle the change event of the date field
  onDateFieldChange(index) {
    if (index == 0) {
      this.widgets["epiCurve-date-fields"][index] = this.SelectedDateFieldVariable;
    } else if (index == 1) {
      this.widgets["epiCurve-date-fields"][index] = this.SelectedDateFieldVariable2;
    } else if (index == 2) {
      this.widgets["epiCurve-date-fields"][index] = this.SelectedDateFieldVariable3;
    }
    this.refresh();
  }
  onBinSizeChange() {
    if (this.widgets['epiCurve-binSize'] == 'Year') {
      $('#epi-tick-size').slideUp();
    } else {
      if (this.widgets['epiCurve-binSize'] == 'Quarter') {
        this.tickInterval = 1;
      }
      $('#epi-tick-size').slideDown();
    }
    this.refresh();
  }
  updateSettingsRows() {
    this.ShowEpiSettingsPane = true;
    setTimeout(() => {
      if (this.selectedGraphType == 'Multi: Overlay' || this.selectedGraphType == 'Multi: Side by Side') {
        $('#useNodeColorRow').slideUp();
        $('.additionalDateField').slideDown();
        //$('#epi-color-select').slideUp();
      } else {
        $('.additionalDateField').slideUp();
        $('#useNodeColorRow').slideDown();
        if (this.widgets['epiCurve-stackColorBy'] == 'None') {
          $('#epi-color-select').slideDown();
        }
      }
      //this.ShowEpiSettingsPane = false;
    }, 0);
  }
  onGraphTypeChange(refresh = true) {
    this.updateSettingsRows();
    this.widgets['epiCurve-graphType'] = this.selectedGraphType;
    if (refresh) this.refresh();
  }
  onUseNodeColorChange() {
    if (this.widgets['epiCurve-stackColorBy'] == 'None') {
      $('#epi-color-select').slideDown();
    } else {
      $('#epi-color-select').slideUp();
    }
    this.refresh();
  }
  onTickIntevalChange() {
    this.refresh();
  }
  onNodeColorChanged() {
    this.refresh();
  }
  onLegendPositionChange() {
    if (this.widgets['epiCurve-legendPosition'] == 'Bottom') {
      this.margin.bottom = 100;
    } else {
      this.margin.bottom = 50;
    }
    this.refresh();
  }
  openSettings() {
    this.visuals.epiCurve.ShowEpiSettingsPane = !this.visuals.epiCurve.ShowEpiSettingsPane;
  }
  setCumulative(value) {
    this.widgets['epiCurve-cumulative'] = value;
    this.refresh();
  }
  /**
   * Sets CalculatedResolution variable to string such as '1250 x 855px'. Only called when export is first opened
   */
  setCalculatedResolution() {
    let [width, height] = this.getImageDimensions();
    this.CalculatedResolution = Math.round(width * this.SelectedNetworkExportScaleVariable) + " x " + Math.round(height * this.SelectedNetworkExportScaleVariable) + "px";
  }
  /**
   * Updates CalculatedResolution variable to string such as '1250 x 855px' based on ImageDimensions and SelectedNetworkExportScaleVariable.
   * This is called anytime SelectedNetworkExportScaleVariable is updated.
   */
  updateCalculatedResolution() {
    let [width, height] = this.getImageDimensions();
    this.CalculatedResolution = Math.round(width * this.SelectedNetworkExportScaleVariable) + " x " + Math.round(height * this.SelectedNetworkExportScaleVariable) + "px";
    this.cdref.detectChanges();
  }
  /**
   * @returns an array [width, height] of the svg image
   */
  getImageDimensions() {
    let parent = this.svg.node();
    return [parent.clientWidth, parent.clientHeight];
  }
  startTimeline() {
    this.isPlaying = true;
    this.setTimer();
  }
  stopTimeline() {
    this.isPlaying = false;
    if (this.timer) {
      this.timer.stop();
    }
  }
  setTimer() {
    if (this.timer) {
      this.timer.stop();
      d3__WEBPACK_IMPORTED_MODULE_4__.timerFlush();
    }
    this.timer = d3__WEBPACK_IMPORTED_MODULE_4__.interval(() => {
      const selection = d3__WEBPACK_IMPORTED_MODULE_4__.brushSelection(this.brushG.node());
      if (!selection) return this.timer.stop(); // Ignore empty selections
      if (selection[1] >= this.width) {
        this.startTimeline();
        return;
      }
      this.brushG.call(this.brush.move, selection.map(s => s + 1));
      if (++this.tick % 5 == 0) this.propagate();
    }, 110 - parseInt($("#timeline-speed").val()));
    if (!this.isPlaying) this.timer.stop();
  }
  propagate() {
    this.commonService.session.state.timeStart = this.x.invert(this.selection[0]);
    this.commonService.session.state.timeEnd = this.x.invert(this.selection[1]);
    this.commonService.setNodeVisibility(true);
    this.commonService.setLinkVisibility(true);
    this.commonService.tagClusters().then(() => {
      ["node", "link"].forEach(thing => {
        window.trigger(thing + "-visibility");
      });
    });
  }
  // private initializeD3Chart(): void {
  //   this.clearSvg();
  //   this.setupDimensions();
  //   this.setupScales();
  //   this.createSvg();
  //   this.populateData();
  //   this.drawHistogram();
  //   this.setupBrush();
  // }
  // private clearSvg(): void {
  //   d3.select(this.timelineElement.nativeElement).selectAll("*").remove();
  // }
  // private setupDimensions(): void {
  //   const wrapper = this.timelineElement.nativeElement;
  //   this.width = wrapper.clientWidth - this.margin.left - this.margin.right;
  //   this.height = wrapper.clientHeight - this.margin.top - this.margin.bottom;
  // }
  // private setupScales(): void {
  //   this.x = d3.scaleTime().range([0, this.width]);
  //   this.y = d3.scaleLinear().range([this.height, 0]);
  // }
  // private createSvg(): void {
  //   this.svg = d3.select(this.timelineElement.nativeElement)
  //     .append("svg")
  //     .attr("width", this.width + this.margin.left + this.margin.right)
  //     .attr("height", this.height + this.margin.top + this.margin.bottom)
  //     .append("g")
  //     .attr("transform", `translate(${this.margin.left},${this.margin.top})`);
  // }
  // private populateData(): void {
  //   // Transform your data here
  //   this.vnodes.forEach(d => {
  //     const time = moment(d.date); // Replace 'date' with your actual date field
  //     if (time.isValid()) {
  //       d.date = time.toDate();
  //     } else {
  //       d.date = null;
  //     }
  //   });
  //   this.timeDomainStart = d3.min(this.vnodes, d => d.date);
  //   this.timeDomainEnd = d3.max(this.vnodes, d => d.date);
  //   this.x.domain([this.timeDomainStart, this.timeDomainEnd]);
  // }
  // private drawHistogram(): void {
  //   // Draw your histogram here
  //   this.histogram = d3.histogram()
  //     .value(d => d.date) // Replace 'date' with your actual date field
  //     .domain(this.x.domain())
  //     .thresholds(d3.thresholdScott);
  //   const bins = this.histogram(this.vnodes);
  //   if (this.cumulative) {
  //     let sum = 0;
  //     bins.forEach(bin => {
  //       sum += bin.length;
  //       bin.length = sum;
  //     });
  //   }
  //   this.y.domain([0, d3.max(bins, d => d.length)]);
  //   this.svg.selectAll("rect")
  //     .data(bins)
  //     .enter()
  //     .append("rect")
  //     .attr("x", d => this.x(d.x0))
  //     .attr("y", d => this.y(d.length))
  //     .attr("width", d => this.x(d.x1) - this.x(d.x0))
  //     .attr("height", d => this.height - this.y(d.length))
  //     .attr("fill", "steelblue"); // Change fill as necessary
  // }
  // private setupBrush(): void {
  //   this.brush = d3.brushX()
  //     .extent([[0, 0], [this.width, this.height]])
  //     .on("end", () => this.onBrushEnd());
  //   this.brushG = this.svg.append("g")
  //     .attr("class", "brush")
  //     .call(this.brush);
  // }
  // private onBrushEnd(): void {
  //   this.selection = d3.brushSelection(this.brushG.node());
  //   if (this.selection) {
  //     // Handle brush selection change
  //   }
  // }
  // playPauseTimeline(): void {
  //   if (this.isPlaying) {
  //     this.stopTimeline();
  //   } else {
  //     this.startTimeline();
  //   }
  // }
  // startTimeline(): void {
  //   this.isPlaying = true;
  //   this.setTimer();
  // }
  // stopTimeline(): void {
  //   this.isPlaying = false;
  //   if (this.timer) {
  //     this.timer.stop();
  //   }
  // }
  // setTimer(): void {
  //   if (this.timer) {
  //     this.timer.stop();
  //   }
  //   this.timer = d3.interval(() => {
  //     // Timer logic for updating the timeline
  //     // this.updateTimeline();
  //   }, 100); // Adjust interval as needed
  // }
  updateNodeColors() {
    this.refresh();
  }
  updateVisualization() {
    //Not Relevant
  }
  applyStyleFileSettings() {
    this.widgets = window.context.commonService.session.style.widgets;
    this.setDefaultsWidgets();
    this.updateSettingsRows();
    this.onLegendPositionChange();
  }
  updateLinkColor() {
    //Not Relevant
  }
  onRecallSession() {}
  openExport() {
    this.setCalculatedResolution();
    this.ShowEpiExportPane = !this.ShowEpiExportPane;
  }
  exportVisualization() {
    if (this.EpiExportFileType == 'svg') {
      let content = this.exportService.unparseSVG(this.epiCurveSVGElement.nativeElement);
      let blob = new Blob([content], {
        type: 'image/svg+xml;charset=utf-8'
      });
      file_saver__WEBPACK_IMPORTED_MODULE_6__(blob, this.EpiExportFileName + '.' + this.EpiExportFileType);
    } else {
      (0,save_svg_as_png__WEBPACK_IMPORTED_MODULE_7__.saveSvgAsPng)(this.epiCurveSVGElement.nativeElement, this.EpiExportFileName + '.' + this.EpiExportFileType, {
        scale: this.SelectedNetworkExportScaleVariable,
        backgroundColor: "#ffffff",
        encoderType: 'image/' + this.EpiExportFileType
        //encoderOptions: this.SelectedNetworkExportQualityVariable
      });
    }
    this.ShowEpiExportPane = false;
  }
  openRefreshScreen() {}
  onLoadNewData() {
    throw new Error('Method not implemented.');
  }
  onFilterDataChange() {
    throw new Error('Method not implemented.');
  }
  static {
    this.ctorParameters = () => [{
      type: _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_10__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ChangeDetectorRef
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_11__.GoogleTagManagerService
    }, {
      type: _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_8__.ExportService
    }];
  }
  static {
    this.propDecorators = {
      DisplayGlobalSettingsDialogEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.Output
      }],
      epiCurveElement: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ViewChild,
        args: ['epiCurve']
      }],
      epiCurveSVGElement: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_9__.ViewChild,
        args: ['epiCurveSVG']
      }]
    };
  }
};
TimelineComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_12__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_9__.Component)({
  selector: 'app-timeline-component',
  template: _timeline_component_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  styles: [(_timeline_component_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_12__.__metadata)("design:paramtypes", [_contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_10__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_9__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_9__.ChangeDetectorRef, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_11__.GoogleTagManagerService, _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_8__.ExportService])], TimelineComponent);

(function (TimelineComponent) {
  TimelineComponent.componentTypeName = 'Epi Curve';
})(TimelineComponent || (TimelineComponent = {}));

/***/ }),

/***/ 27316:
/*!********************************************************************************!*\
  !*** ./src/app/visualizationComponents/TwoDComponent/twoD-plugin.component.ts ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   TwoDComponent: () => (/* binding */ TwoDComponent)
/* harmony export */ });
/* harmony import */ var _Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js */ 89204);
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _twoD_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./twoD-plugin.component.html?ngResource */ 13336);
/* harmony import */ var _twoD_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./twoD-plugin.component.scss?ngResource */ 68550);
/* harmony import */ var _twoD_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_twoD_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_platform_browser__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @angular/platform-browser */ 80436);
/* harmony import */ var _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! d3 */ 86164);
/* harmony import */ var _angular_cdk_clipboard__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @angular/cdk/clipboard */ 52352);
/* harmony import */ var _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../helperClasses/dialogSettings */ 63412);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! lodash */ 46227);
/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_6__);
/* harmony import */ var _app_helperClasses_customShapes__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @app/helperClasses/customShapes */ 13564);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @app/base-component.directive */ 18784);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);
/* harmony import */ var cytoscape__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! cytoscape */ 15363);
/* harmony import */ var cytoscape_svg__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! cytoscape-svg */ 27515);
/* harmony import */ var cytoscape_svg__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(cytoscape_svg__WEBPACK_IMPORTED_MODULE_10__);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! rxjs */ 10819);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! rxjs */ 33900);
/* harmony import */ var _app_contactTraceCommonServices_common_store_services__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @app/contactTraceCommonServices/common-store.services */ 16546);
/* harmony import */ var _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @app/contactTraceCommonServices/export.service */ 70616);




















let TwoDComponent = class TwoDComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_8__.BaseComponentDirective {
  constructor(injector, eventManager, commonService, container, elRef, cdref, clipboard, gtmService, store, exportService) {
    super(elRef.nativeElement);
    this.eventManager = eventManager;
    this.commonService = commonService;
    this.container = container;
    this.cdref = cdref;
    this.clipboard = clipboard;
    this.gtmService = gtmService;
    this.store = store;
    this.exportService = exportService;
    this.DisplayGlobalSettingsDialogEvent = new _angular_core__WEBPACK_IMPORTED_MODULE_13__.EventEmitter();
    this.vizLoaded = true;
    this.nodePositions = new Map();
    this.layoutParallelNodesPerColumn = 4;
    this.debugMode = false;
    this.overideTransparency = false;
    this.containerHeight = 800; // or any other number you want
    this.graphData = {
      nodes: [],
      links: []
    };
    this.selectedNodeId = undefined;
    this.selectedNodeShape = 'ellipse'; // Default shapeDF
    this.symbolMapping = [{
      key: 'ellipse',
      value: '\u2b24',
      name: ' (Circle) '
    }, {
      key: "triangle",
      value: '\u25b2',
      name: ' (Triangle)'
    }, {
      key: "rectangle",
      value: '\u25fc',
      name: ' (Square)'
    }, {
      key: "rhomboid",
      value: '\u25b0',
      name: ' (Rhombus)'
    }, {
      key: "diamond",
      value: '\u25c6',
      name: ' (Diamond)'
    }, {
      key: "heptagon",
      value: '\u2b23',
      name: ' (Heptagon)'
    }, {
      key: "pentagon",
      value: '\u2b1f',
      name: ' (Pentagon)'
    }, {
      key: "hexagon",
      value: '\u2b22',
      name: ' (Hexagon)'
    }, {
      key: "barrel",
      value: '',
      name: ' (Barrel)'
    }, {
      key: "octagon",
      value: '\u2bc3',
      name: ' (Octagon)'
    }, {
      key: "star",
      value: '\u2605',
      name: ' (Star)'
    }, {
      key: "tag",
      value: '\u2617',
      name: ' (Tag)'
    }, {
      key: "vee",
      value: 'V',
      name: ' (Vee)'
    }];
    this.shapeAggregates = [];
    this.shapeSort = {
      key: 'count',
      assending: true
    };
    this.linkMin = 3;
    this.linkMax = 27;
    this.linkMid = 1;
    this.nodeMin = 3;
    this.nodeMax = 27;
    this.nodeScale = d3__WEBPACK_IMPORTED_MODULE_4__.scaleLinear().domain([0, 1]).range([0, 1]);
    this.nodeMid = 1;
    // TODO determine if this is needed anymore after transition to cytoscape
    this.autoFit = true;
    this.ShowNetworkAttributes = false;
    this.ShowStatistics = true;
    this.Show2DExportPane = false;
    this.Show2DSettingsPane = false;
    this.IsDataAvailable = false;
    this.halfWidth = null;
    this.halfHeight = null;
    this.transform = null;
    this.force = null;
    this.radToDeg = 180 / Math.PI;
    this.selected = null;
    this.zoom = null;
    this.FieldList = [];
    this.ToolTipFieldList = [];
    this.LinkToolTipList = [];
    this.ctrlPressed = false;
    this.dragging = false;
    this.isLoading = true;
    this.viewActive = true;
    //Polygon Tab
    this.SelectedPolygonLabelVariable = "None";
    this.SelectedPolygonColorVariable = "None";
    this.SelectedPolygonLabelOrientationVariable = "top";
    this.SelectedPolygonLabelSizeVariable = 0.0;
    this.SelectedPolygonGatherValue = 0.0;
    this.CenterPolygonVariable = "None";
    this.SelectedPolygonLabelShowVariable = "Hide";
    this.SelectedPolygonColorShowVariable = "Hide";
    this.SelectedPolygonColorTableShowVariable = "Hide";
    // Node Tab    
    this.SelectedNodeLabelVariable = "None";
    this.SelectedNodeTooltipVariable = "None";
    this.SelectedNodeSymbolVariable = "None";
    this.SelectedNodeShapeVariable = "symbolCircle";
    this.SelectedNodeRadiusVariable = "None";
    this.SelectedNodeRadiusSizeVariable = "None";
    this.TableTypes = [{
      label: 'Show',
      value: 'Show'
    }, {
      label: 'Hide',
      value: 'Hide'
    }];
    this.SelectedNetworkTableTypeVariable = "Hide";
    // Link Tab
    this.SelectedLinkTooltipVariable = "None";
    this.SelectedLinkLabelVariable = "None";
    this.SelectedLinkDecimalVariable = 3;
    this.SelectedLinkTransparencyVariable = 0;
    this.SelectedLinkWidthByVariable = "None";
    this.SelectedLinkWidthMax = 27;
    this.SelectedLinkWidthMin = 3;
    this.ReciprocalTypes = [{
      label: 'Reciprocal',
      value: 'Reciprocal'
    }, {
      label: 'Non-Reciprocal',
      value: 'Non-Reciprocal'
    }];
    this.SelectedLinkReciprocalTypeVariable = "Reciprocal";
    this.SelectedLinkWidthVariable = 0;
    this.SelectedLinkLengthVariable = 0;
    this.ArrowTypes = [{
      label: 'Hide',
      value: 'Hide'
    }, {
      label: 'Show',
      value: 'Show'
    }];
    this.hideShowOptions = [{
      label: 'Hide',
      value: false
    }, {
      label: 'Show',
      value: true
    }];
    this.bidirectionalOptions = [{
      label: 'Hide',
      value: 'Hide'
    }, {
      label: 'Show',
      value: 'Show'
    }];
    this.SelectedLinkArrowTypeVariable = "Hide";
    this.SelectedLinkBidirectionalTypeVariable = "Hide";
    // Network 
    this.NeighborTypes = [{
      label: 'Normal',
      value: 'Normal'
    }, {
      label: 'Highlighted',
      value: 'Highlighted'
    }];
    this.SelectedNetworkNeighborTypeVariable = "Normal";
    this.GridLineTypes = [{
      label: 'Hide',
      value: 'Hide'
    }, {
      label: 'Show',
      value: 'Show'
    }];
    this.SelectedNetworkGridLineTypeVariable = "Hide";
    this.SelecetedNetworkLinkStrengthVariable = 0.123;
    this.SelectedNetworkExportFilenameVariable = "";
    this.NetworkExportFileTypeList = [{
      label: 'png',
      value: 'png'
    }, {
      label: 'jpeg',
      value: 'jpeg'
    }, {
      label: 'webp',
      value: 'webp'
    }, {
      label: 'svg',
      value: 'svg'
    }];
    this.SelectedNetworkExportFileTypeListVariable = "png";
    this.SelectedNetworkExportScaleVariable = 1;
    this.SelectedNetworkExportQualityVariable = 0.92;
    this.SelectedNodeLabelSizeVariable = 16;
    this.nodeBorderWidth = 2.0;
    this.ShowNodeSymbolWrapper = false;
    this.ShowNodeSymbolTable = false;
    this.ShowPolygonColorTable = false;
    this.ShowAdvancedExport = true;
    this.NodeSymbolTableWrapperDialogSettings = new _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_5__.DialogSettings('#node-symbol-table-wrapper', false);
    this.PolygonColorTableWrapperDialogSettings = new _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_5__.DialogSettings('#polygon-color-table-wrapper', false);
    this.Node2DNetworkExportDialogSettings = new _helperClasses_dialogSettings__WEBPACK_IMPORTED_MODULE_5__.DialogSettings('#network-settings-pane', false);
    this.ContextSelectedNodeAttributes = [];
    // TODO see if needed after transition to cytoscape
    // zoomScaleExtent: [number, number] = [0.005, 5]; // Minimum zoom of 0.1 and maximum zoom of 2
    this.customShapes = new _app_helperClasses_customShapes__WEBPACK_IMPORTED_MODULE_7__.CustomShapes();
    this.symbolTableWrapper = null;
    this.linkColorTableWrapper = null;
    this.nodeColorTableWrapper = null;
    this.isExportClosed = false;
    /* XXXXXnot sure if this boolean is necessary; Related to exportWork, and bottom-table s (ie. node-symbol-table-bottom)
     currently exportWork2 is used which don't make use of isExporting and bottom-table s XXXXX */
    this.isExporting = false;
    this.isMac = navigator.userAgent.toUpperCase().indexOf('MAC') >= 0;
    this.destroy$ = new rxjs__WEBPACK_IMPORTED_MODULE_14__.Subject();
    this.svgDefs = `
    <path id="blob" d="M 19.415 1.0564 C 20.585 2.47 20.225 5.89 21.665 8.2612 C 23.06 10.678 26.345 12.046 28.325 14.554 C 30.305 17.1076 31.025 20.8012 28.865 21.9412 C 26.75 23.1268 21.755 21.7588 18.605 23.3092 C 15.455 24.8596 14.105 29.3284 12.485 29.8756 C 10.865 30.3772 8.93 27.0028 6.41 25.042 C 3.89 23.1268 0.83 22.6708 0.38 20.9836 C -0.07 19.2964 2.135 16.378 2.54 13.642 C 2.945 10.9516 1.55 8.4892 2.135 7.03 C 2.72 5.5708 5.285 5.1148 7.355 4.294 C 9.47 3.4276 11.135 2.1964 13.34 1.2388 C 15.545 0.3268 18.245 -0.3116 19.415 1.0564 Z"/>
    <path id="cloud" d="M 14 -1 A 9 9 90 0 0 5 8 A 9 9 90 0 0 5.1055 9.3125 A 6 6 90 0 0 1 15 A 6 6 90 0 0 7 21 L 22 21 A 7 7 90 0 0 29 14 A 7 7 90 0 0 22.9414 7.0703 A 9 9 90 0 0 14 -1 z"/>
    <polygon id="diamond" points="0,15 15,0 30,15 15,30"/>
    <polygon id="house" points="4,18 4,30 13,30 13,24 17,24 17,30 26,30 26,18 30,18 15,0 0,18"/>
    `;
    // this.setExpanded(this.mainSite);
    this.widgets = this.commonService.session.style.widgets;
    this.container.on('resize', () => {
      this.fit();
    });
    this.container.on('hide', () => {
      this.viewActive = false;
      this.cdref.detectChanges();
    });
    this.container.on('show', () => {
      this.viewActive = true;
      this.cdref.detectChanges();
      setTimeout(() => {
        this.fit();
        this.commonService.onStatisticsChanged("Show");
      }, 50);
    });
    // Initialize the selectedNodeShape from the settings
    this.widgets['node-symbol'] = this.mapPreviousShapeNameToCurrent(this.widgets['node-symbol']);
    this.selectedNodeShape = this.widgets['node-symbol'];
    cytoscape__WEBPACK_IMPORTED_MODULE_9__["default"].use((cytoscape_svg__WEBPACK_IMPORTED_MODULE_10___default()));
  }
  ngOnInit() {
    // Console log this out to see what the window objetc has like temp
    // const windowKeys = Reflect.ownKeys(window);
    // this.commonService.updateNetwork();
    console.log('--- TwoD ngOnInit called');
    console.log(this.cyContainer);
    this.networkUpdatedSubscription = this.store.networkUpdated$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_15__.takeUntil)(this.destroy$)).subscribe(newPruned => {
      console.log('--- TwoD DATA network updated', newPruned);
      if (this.data && this.store.settingsLoadedValue && newPruned && this.commonService.activeTab === '2D Network') {
        console.log('--- TwoD DATA network updated pruned', newPruned);
        this._rerender();
        //this.loadSettings();
      }
    });
    this.settingsLoadedSubscription = this.store.settingsLoaded$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_15__.takeUntil)(this.destroy$)).subscribe(loaded => {
      if (loaded && this.commonService.activeTab === '2D Network') {
        this._rerender();
      }
    });
    this.thresholdSubscription = this.store.linkThreshold$.pipe((0,rxjs__WEBPACK_IMPORTED_MODULE_15__.takeUntil)(this.destroy$)).subscribe(newThreshold => {
      if (!this.commonService.session.network.isFullyLoaded) return;
      if (this.commonService.activeTab === '2D Network') {
        if (this.threshold !== newThreshold) {
          console.log('--- TwoD partial threshold changed', newThreshold);
          this._partialUpdate();
        }
      }
    });
    this.InitView();
  }
  ngAfterViewInit() {
    console.log('--- TwoD ngAfterViewInit called');
  }
  mapDataToCytoscapeElements(data, timelineTick = false) {
    console.log('--- TwoD mapDataToCytoscapeElements called');
    // Create a set to track unique parent nodes
    const parentNodes = new Set();
    const edges = data.links.map(link => ({
      data: {
        id: link.id,
        source: link.source,
        target: link.target,
        lineSelectedColor: this.widgets['selected-color'],
        label: this.getLinkLabel(link).text,
        // Existing link label
        lineColor: this.getLinkColor(link).color,
        // Default to black if not specified
        lineOpacity: this.getLinkColor(link).opacity,
        // Default to fully opaque if not specified
        width: this.getLinkWidth(link),
        // Include any additional edge-specific data properties
        ...link
      }
    }));
    console.log('--- TwoD mapDataToCytoscapeElements Links Done');
    const nodes = data.nodes.map(node => {
      // If the node has a parentId, add it to the parentNodes set
      if (node.group && this.widgets['polygons-show']) {
        parentNodes.add(node.group);
      }
      if (timelineTick) {
        // otherwise data: label gets overridden to be undefined
        node.label = this.getNodeLabel(node);
        node.nodeSize = Number(this.getNodeSize(node));
        [node.nodeColor, node.bgOpacity] = this.getNodeColor(node);
        return {
          data: {
            id: node.id,
            parent: node.group && this.widgets['polygons-show'] || undefined,
            // Assign parent if exists
            //nodeColor: this.getNodeColor(node), // <-- Added for dynamic node color
            selectedBorderColor: this.widgets['selected-color'],
            fontSize: this.getNodeFontSize(node),
            // <-- Added for dynamic label size
            shape: this.getNodeShape(node),
            // Include any additional node-specific data properties
            ...node
          },
          position: {
            x: node.x || this.nodePositions.get(node.id)?.x || Math.random() * 500,
            y: node.y || this.nodePositions.get(node.id)?.y || Math.random() * 500
          }
        };
      } else {
        node.label = this.getNodeLabel(node);
        [node.nodeColor, node.bgOpacity] = this.getNodeColor(node); // <-- Added for dynamic node color
        return {
          data: {
            id: node.id,
            //label: (this.widgets['node-label-variable'] === 'None' || !node.label) ? '' : node.label,
            parent: node.group && this.widgets['polygons-show'] || undefined,
            // Assign parent if exists
            nodeSize: Number(this.getNodeSize(node)),
            // Existing node size
            //nodeColor: this.getNodeColor(node), // <-- Added for dynamic node color
            borderWidth: this.getNodeBorderWidth(node),
            // <-- Added for dynamic border width
            selectedBorderColor: this.widgets['selected-color'],
            fontSize: this.getNodeFontSize(node),
            // <-- Added for dynamic label size
            shape: this.getNodeShape(node),
            // Include any additional node-specific data properties
            ...node
          },
          position: {
            x: node.x || this.nodePositions.get(node.id)?.x || Math.random() * 500,
            y: node.y || this.nodePositions.get(node.id)?.y || Math.random() * 500
          }
        };
      }
    });
    console.log('--- TwoD mapDataToCytoscapeElements nodes done');
    return {
      edges: edges,
      nodes: nodes
    };
  }
  getCytoscapeStyles() {
    return [{
      selector: 'node',
      css: {
        'background-color': 'data(nodeColor)',
        // Use dynamic node color
        // 'width': 'mapData(nodeSize, 0, 100, 10, 50)', // Existing dynamic sizing
        // 'height': 'mapData(nodeSize, 0, 100, 10, 50)',
        'border-width': 'data(borderWidth)',
        // Use dynamic border width
        // 'border-color': '#000',
        'text-valign': 'center',
        'color': 'black',
        // @ts-ignore
        'shape': 'data(shape)',
        'z-index': 10 // Not a standard Cytoscape property, but kept for clarity
        // 'font-size': 'data(fontSize)' // Ensure this line is included
      }
    }, {
      selector: 'node[label]',
      css: {
        'label': 'data(label)'
      }
    }, {
      selector: 'node[!label]',
      css: {
        'label': '' // or omit entirely
      }
    },
    // Apply styles only to nodes with nodeSize defined
    {
      selector: 'node[nodeSize]',
      css: {
        'width': 'mapData(nodeSize, 0, 100, 10, 50)',
        'height': 'mapData(nodeSize, 0, 100, 10, 50)'
      }
    }, {
      selector: 'node[bgOpacity]',
      css: {
        // @ts-ignore
        'background-opacity': 'data(bgOpacity)'
      }
    }, {
      selector: '.hidden',
      css: {
        display: 'none'
      }
    },
    // Apply styles only to nodes with nodeColor defined
    {
      selector: 'node[nodeColor]',
      css: {
        'background-color': 'data(nodeColor)'
      }
    },
    // Apply styles only to nodes with fontSize defined
    {
      selector: 'node[fontSize]',
      css: {
        'font-size': 'data(fontSize)'
      }
    }, {
      selector: 'node[shape]',
      css: {
        // @ts-ignore
        'shape': 'data(shape)'
      }
    }, {
      selector: 'node.parent',
      css: {
        'z-index': 20,
        // Not a standard Cytoscape property, but kept for clarity
        // We also need to ensure that it uses data(...) for color & alpha:
        'background-color': 'data(nodeColor)',
        'border-width': 'data(borderWidth)'
        // The critical addition (can also be 'opacity' but that will fade the label, border, etc.):
        // 'z-compound-depth': 'back',  // ensures parent is behind children
      }
    }, {
      selector: 'node.parent[bgOpacity]',
      css: {
        // @ts-ignore
        'background-opacity': 'data(bgOpacity)'
      }
    }, {
      selector: 'edge',
      css: {
        'width': 'data(width)',
        // Existing dynamic edge width
        'line-color': 'data(lineColor)',
        // Maps 'lineColor' data attribute to 'line-color' style
        // @ts-ignore
        'line-opacity': 'data(lineOpacity)',
        // Explicitly control link transparency
        'label': 'data(label)',
        // 'target-arrow-color': '#ccc',
        // 'target-arrow-shape': 'triangle',
        'curve-style': 'bezier'
        // 'opacity': 'data(opacity)' // Existing opacity
      }
    }, {
      selector: 'node:selected',
      css: {
        'background-color': 'data(nodeColor)',
        'border-color': 'data(selectedBorderColor)',
        'border-width': 3
      }
    }, {
      selector: 'edge:selected',
      css: {
        // 'line-color': '#f00',
        // 'target-arrow-color': '#f00',
        'width': 3
      }
    }, {
      selector: 'edge.highlighted',
      css: {
        'line-color': 'data(lineSelectedColor)',
        // Highlight color
        'width': '3px',
        'opacity': 1
      }
    }];
  }
  attachCytoscapeEvents() {
    console.log('--- TwoD attachCytoscapeEvents called');
    this.cy.on('tap', 'node', evt => {
      const node = evt.target;
      console.log('Selected node:', node.data());
      // Update selectedNodeId and trigger change detection or re-render if necessary
      this.selectedNodeId = node.id();
      // Update with selected color set in global settings
      node.data('selectedBorderColor', this.widgets['selected-color']);
      this.cy.style().update();
    });
    this.cy.on('mouseover', 'node', evt => {
      const node = evt.target;
      this.showNodeTooltip(node.data(), evt.originalEvent);
      // Set cursor to grab
      $('html,body').css('cursor', 'grab');
      if (this.widgets['node-highlight']) {
        // Highlight connected edges
        node.connectedEdges().addClass('highlighted');
      }
    });
    this.cy.on('mouseout', 'node', evt => {
      const node = evt.target;
      this.hideTooltip();
      $('html,body').css('cursor', 'default');
      if (this.widgets['node-highlight']) {
        // Remove highlight from connected edges
        node.connectedEdges().removeClass('highlighted');
      }
    });
    // Edge events
    this.cy.on('mouseover', 'edge', evt => {
      const edge = evt.target;
      this.showLinkTooltip(edge.data(), evt.originalEvent);
    });
    this.cy.on('mouseout', 'edge', () => {
      this.hideTooltip();
    });
    // Selection and Dragging
    this.cy.on('select', 'node', evt => {
      const node = evt.target;
      // Handle selection logic
    });
    this.cy.on('dragfree', 'node', evt => {
      const node = evt.target;
      let skip = node.children().length > 0 || node.classes().includes('hidden'); // no need to update position of parent or hidden nodes
      if (!skip) {
        this.updateNodePos(node);
      }
      // Handle node drag logic
    });
  }
  /**
   * Used to gather nodes within a group and separate them from other groups
   * @param initial - if true runs iterations of gather force first, then run second simulation that both gathers nodes within a group and separates them from other groups
   * @returns
   */
  gatherGroups(initial = true) {
    var _this = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      let visNodes = _this.commonService.getVisibleNodes();
      if (initial) {
        const {
          nodes: laidOutNodes,
          links: laidOutLinks
        } = yield _this.applyGatherForce(10);
        _this.cy.nodes().forEach(node => {
          if (laidOutNodes.map(n => n.id).includes(node.id())) {
            let cNode = laidOutNodes.find(n => n.id === node.id());
            node.position({
              x: cNode.x,
              y: cNode.y
            });
          }
        });
        // second iteration leads to better layout, skip if number of nodes > 500
        if (_this.commonService.session.data.nodeFilteredValues.length < 500) {
          const {
            nodes: laidOutNodes3,
            links: laidOutLinks3
          } = yield _this.applyGatherForce(10);
          _this.cy.nodes().forEach(node => {
            if (laidOutNodes3.map(n => n.id).includes(node.id())) {
              let cNode = laidOutNodes3.find(n => n.id === node.id());
              node.position({
                x: cNode.x,
                y: cNode.y
              });
            }
          });
        }
      }
      const {
        nodes: laidOutNodes2,
        links: laidOutLinks2,
        parentNodes: pNodes2
      } = yield _this.applySeparationForce();
      // moves individual (child and independent) nodes
      laidOutNodes2.forEach(node => {
        let cyNode = _this.cy.nodes().toArray().find(n => n.id() === node.id);
        if (cyNode) {
          cyNode.position({
            x: node.x,
            y: node.y
          });
        }
      });
      // moves parent (parent and indepent) nodes
      if (_this.widgets['polygons-foci'] != 'None') {
        pNodes2.forEach(node => {
          let cyNode = _this.cy.nodes().toArray().find(n => n.id() === node.id);
          if (cyNode) {
            cyNode.position({
              x: node.x,
              y: node.y
            });
          }
        });
      }
      // updates node position values (x, y) stored in commonService 
      visNodes.forEach(node => {
        let currentNode = _this.cy.nodes().toArray().find(n => n.id() == node.id);
        if (currentNode) {
          node.x = currentNode.position('x');
          node.y = currentNode.position('y');
        }
      });
      _this.fit();
      return {
        nodes: [],
        links: []
      };
    })();
  }
  /**
   * Applies force to gather nodes within a group
   * @param ticks - number of ticks to run the simulation for
   */
  applyGatherForce(ticks = 10) {
    var _this2 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      //let nodes = this.commonService.getVisibleNodes()
      let links = _this2.commonService.getVisibleLinks().map(link => {
        return {
          'source': link.source,
          'target': link.target
        };
      });
      let tickCount = 0;
      let childNodes = [];
      _this2.cy.nodes().forEach(node => {
        if (node.children().length > 0) {
          return;
        } else if (node.parent().length > 0) {
          childNodes.push({
            id: node.id(),
            parentX: node.parent()[0].position('x'),
            parentY: node.parent()[0].position('y'),
            x: node.position('x'),
            y: node.position('y')
          });
        } else {
          childNodes.push({
            id: node.id(),
            parentX: 0,
            parentY: 0,
            x: node.position('x'),
            y: node.position('y')
          });
        }
      });
      let gatherSimulation = d3__WEBPACK_IMPORTED_MODULE_4__.forceSimulation(childNodes).force('charge', d3__WEBPACK_IMPORTED_MODULE_4__.forceManyBody().strength(-10)).force('link', d3__WEBPACK_IMPORTED_MODULE_4__.forceLink(links).id(d => d.id).distance(30)).force('center', d3__WEBPACK_IMPORTED_MODULE_4__.forceCenter(0, 0)).force('collide', d3__WEBPACK_IMPORTED_MODULE_4__.forceCollide().radius(20)).force('x', d3__WEBPACK_IMPORTED_MODULE_4__.forceX(d => d.parentX).strength(d => d.parentX == 0 ? .005 : .35)).force('y', d3__WEBPACK_IMPORTED_MODULE_4__.forceY(d => d.parentY).strength(d => d.parentY == 0 ? .005 : .35)).stop();
      return new Promise(resolve => {
        function tick() {
          gatherSimulation.tick();
          tickCount++;
          if (tickCount < ticks) {
            // Use setTimeout to yield control to the browser between ticks
            setTimeout(tick, 0);
          } else {
            // After all ticks, resolve the promise with the updated nodes and links.
            resolve({
              nodes: childNodes,
              links
            });
          }
        }
        tick();
      });
    })();
  }
  /**
   * Applies force to gather nodes within a group and separate them from other groups
   */
  applySeparationForce() {
    var _this3 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      let links = _this3.commonService.getVisibleLinks().map(link => {
        return {
          'source': link.source,
          'target': link.target
        };
      });
      let ticks = 20;
      let tickCount = 0;
      let parentNodes = [];
      let childNodes = [];
      _this3.cy.nodes().forEach(node => {
        if (node.children().length > 0) {
          //console.log(node);
          parentNodes.push({
            id: node.id(),
            max_dim: Math.max(node.boundingBox().w, node.boundingBox().h),
            x: node.position('x'),
            y: node.position('y'),
            group: true
          });
        } else if (node.parent().length > 0) {
          childNodes.push({
            id: node.id(),
            parent: node.parent()[0].data('id'),
            x: node.position('x'),
            y: node.position('y')
          });
        } else {
          parentNodes.push({
            id: node.id(),
            max_dim: 35,
            x: node.position('x'),
            y: node.position('y'),
            group: false
          });
          childNodes.push({
            id: node.id(),
            parent: null,
            x: node.position('x'),
            y: node.position('y')
          });
        }
      });
      let separationSimulation = yield d3__WEBPACK_IMPORTED_MODULE_4__.forceSimulation(parentNodes).force('charge', d3__WEBPACK_IMPORTED_MODULE_4__.forceManyBody().strength(-30)).force('collide', d3__WEBPACK_IMPORTED_MODULE_4__.forceCollide().radius(d => d.max_dim / 1.5)).force('x', d3__WEBPACK_IMPORTED_MODULE_4__.forceX().strength(.005)).force('y', d3__WEBPACK_IMPORTED_MODULE_4__.forceY().strength(.005)).stop();
      let gatherSimulation = d3__WEBPACK_IMPORTED_MODULE_4__.forceSimulation(childNodes).force('charge', d3__WEBPACK_IMPORTED_MODULE_4__.forceManyBody().strength(-30)).force('link', d3__WEBPACK_IMPORTED_MODULE_4__.forceLink(links).id(d => d.id).distance(50)).force('center', d3__WEBPACK_IMPORTED_MODULE_4__.forceCenter(0, 0)).force('collide', d3__WEBPACK_IMPORTED_MODULE_4__.forceCollide().radius(20)).force('x', d3__WEBPACK_IMPORTED_MODULE_4__.forceX(d => d.parent == null ? 0 : parentNodes.find(p => p.id == d.parent).x).strength(d => d.parent == null ? .005 : .1)).force('y', d3__WEBPACK_IMPORTED_MODULE_4__.forceY(d => d.parent == null ? 0 : parentNodes.find(p => p.id == d.parent).y).strength(d => d.parent == null ? .005 : .1)).stop();
      return new Promise(resolve => {
        function tick() {
          gatherSimulation.tick();
          separationSimulation.tick();
          tickCount++;
          if (tickCount == ticks) {
            separationSimulation.tick();
          }
          if (tickCount < ticks) {
            // Use setTimeout to yield control to the browser between ticks
            setTimeout(tick, 0);
          } else {
            // After all ticks, resolve the promise with the updated nodes and links.
            resolve({
              nodes: childNodes,
              links,
              parentNodes
            });
          }
        }
        tick();
      });
    })();
  }
  precomputePositionsWithD3(nodes, links, ticks = 300, initial = true) {
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      let simulation;
      if (initial) {
        simulation = d3__WEBPACK_IMPORTED_MODULE_4__.forceSimulation(nodes).force('charge', d3__WEBPACK_IMPORTED_MODULE_4__.forceManyBody().strength(-30)).force('link', d3__WEBPACK_IMPORTED_MODULE_4__.forceLink(links).id(d => d.id).distance(50)).force('center', d3__WEBPACK_IMPORTED_MODULE_4__.forceCenter(0, 0)).stop(); // Stop auto-stepping so we can control the ticks manually
      } else {
        simulation = d3__WEBPACK_IMPORTED_MODULE_4__.forceSimulation(nodes).force('charge', d3__WEBPACK_IMPORTED_MODULE_4__.forceManyBody().strength(-30)).force('link', d3__WEBPACK_IMPORTED_MODULE_4__.forceLink(links).id(d => d.id).distance(50)).force('center', d3__WEBPACK_IMPORTED_MODULE_4__.forceCenter(0, 0)).force('collide', d3__WEBPACK_IMPORTED_MODULE_4__.forceCollide().radius(20)).force('x', d3__WEBPACK_IMPORTED_MODULE_4__.forceX().strength(.005)).force('y', d3__WEBPACK_IMPORTED_MODULE_4__.forceY().strength(.005)).stop();
      }
      let tickCount = 0;
      return new Promise(resolve => {
        function tick() {
          simulation.tick();
          tickCount++;
          if (tickCount < ticks) {
            // Use setTimeout to yield control to the browser between ticks
            setTimeout(tick, 0);
          } else {
            // After all ticks, resolve the promise with the updated nodes and links.
            resolve({
              nodes,
              links
            });
          }
        }
        tick();
      });
    })();
  }
  /**
   * Updates the saved postion of a node when it is dragged by the user
   * @param node
   */
  updateNodePos(node) {
    let globalNode = this.commonService.getVisibleNodes().find(x => x._id == node.data('id')); // need to update so it works with grouped nodes/polygons
    globalNode['x'] = node.position().x;
    globalNode['y'] = node.position().y;
  }
  /** Initializes the view.
   *
   * Defines the structure of the svg of twoD network and adds functionalities such as click, zoom, forces, etc...
   *
   * Populates various lists for Fieldlist (options for node-label-variable, node-symbol-variable, node-radius-variable, polygon-foci),
   * ToolTipFieldList (options for link-width-variable, link-label-variable), and LinkToolTipList (link-toolitp-variable)
   *
   */
  InitView() {
    console.log('--- TwoD InitView called');
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/2d_network",
      page_title: "2D Network View"
    });
    this.IsDataAvailable = this.commonService.session.data.nodes.length === 0 ? false : true;
    if (!this.widgets['default-distance-metric']) {
      this.widgets['default-distance-metric'] = this.commonService.GlobalSettingsModel.SelectedDistanceMetricVariable;
      this.widgets['link-threshold'] = this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable;
    }
    // Subscribe to style file applied event
    this.styleFileSub = this.store.styleFileApplied$.subscribe(() => {
      console.log('--- TwoD InitView stylefile sub');
      this.applyStyleFileSettings();
    });
    // Use this method to prepare your variables before they're used in the template
    this.commonService.session.style.widgets['node-tooltip-variable'] = this.ensureArray(this.commonService.session.style.widgets['node-tooltip-variable']);
    this.commonService.session.style.widgets['link-tooltip-variable'] = this.ensureArray(this.commonService.session.style.widgets['link-tooltip-variable']);
    let that = this;
    if (this.IsDataAvailable === true && this.zoom === null) {
      console.log('--- TwoD InitView IsDataAvailable true');
      // populate this.twoD.FieldList with [None, ...nodeFields]
      this.FieldList = [];
      this.FieldList.push({
        label: "None",
        value: "None"
      });
      this.commonService.session.data['nodeFields'].map((d, i) => {
        if (d != 'seq' && d != 'sequence') {
          this.FieldList.push({
            label: this.commonService.capitalize(d.replace("_", "")),
            value: d
          });
        }
      });
      // populate this.ToolTipFieldList and this.LinkToolTipList
      this.ToolTipFieldList = [];
      this.LinkToolTipList = [];
      this.ToolTipFieldList.push({
        label: "None",
        value: "None"
      });
      this.commonService.session.data['linkFields'].map((d, i) => {
        if (d == 'source') {
          let data = [{
            label: 'Source ID',
            value: 'source_id'
          }, {
            label: 'Source Index',
            value: 'source_index'
          }];
          this.ToolTipFieldList = this.ToolTipFieldList.concat(data);
          this.LinkToolTipList = this.LinkToolTipList.concat(data);
        } else if (d == 'target') {
          let data = [{
            label: 'Target ID',
            value: 'target_id'
          }, {
            label: 'Target Index',
            value: 'target_index'
          }];
          this.ToolTipFieldList = this.ToolTipFieldList.concat(data);
          this.LinkToolTipList = this.LinkToolTipList.concat(data);
        } else {
          this.LinkToolTipList.push({
            label: this.commonService.capitalize(d.replace("_", "")),
            value: d
          });
          this.ToolTipFieldList.push({
            label: this.commonService.capitalize(d.replace("_", "")),
            value: d
          });
        }
      });
      this.halfWidth = $('#network').parent().width() / 2;
      this.halfHeight = $('#network').parent().parent().parent().height() / 2;
      // let networkData = {
      //     nodes: this.commonService.getVisibleNodes(),
      //     links: this.commonService.getVisibleLinks()
      // }
      // this.data = this.commonService.convertToGraphDataArray(networkData);
      // if (this.debugMode) {
      //     console.log('data: ', this.data);
      // }
      // this._rerender();
      $(document).on("node-visibility", function () {
        console.log('node-visibility called');
        that._rerender(true);
      });
      // $(document).on("link-visibility", async function () {
      // });
      // $(document).on("cluster-visibility", function () {
      // });
      // TODO move this to a subscribed event than use document jquery
      $(document).on("node-selected", function () {
        let mtSelectedNode = that.commonService.getSelectedNode(that.commonService.getVisibleNodes());
        if (mtSelectedNode && mtSelectedNode.id) {
          that.selectedNodeId = mtSelectedNode.id;
        } else if (mtSelectedNode && !mtSelectedNode.id) {
          that.selectedNodeId = mtSelectedNode._id;
        }
        // Deselect all nodes first
        that.cy.elements().unselect();
        // Select the newly selected node
        if (that.selectedNodeId) {
          const node = that.cy.getElementById(that.selectedNodeId);
          if (node) {
            node.select();
          }
        }
        // that.debouncedRerender();
        if (that.debugMode) {
          console.log('node-selected in 2d: ', that.selectedNodeId);
          console.log('node-selected in data: ', that.data.nodes.find(node => node.id == that.selectedNodeId));
        }
      });
      if (this.commonService.session.files.length > 1) $('#link-color-variable').val('origin').change();
      if (this.widgets['background-color']) $('#cy').css('background-color', this.widgets['background-color']);
      console.log('--- TwoD InitView onStatisticsChanged');
      this.commonService.onStatisticsChanged();
      console.log('--- TwoD InitView loadSettings');
      this.loadSettings();
      if (this.widgets['node-symbol-variable'] !== 'None') {
        $('#node-symbol-variable').change(); //.trigger('change');
      }
      console.log('--- TwoD InitView End');
    } else {
      console.log('--- TwoD InitView DATA NOTE AVAILABLE');
    }
  }
  // Method to ensure the value is an array
  ensureArray(value) {
    if (Array.isArray(value)) {
      return value; // It's already an array, return as is
    } else if (value !== null && value !== undefined) {
      return [value]; // Not an array, but has a value, wrap it in an array
    } else {
      return []; // No value, return an empty array
    }
  }
  /**
   * @returns an array [X, Y] of the position of mouse relative to twodcomponent. Global position (i.e. d3.event.pageX) doesn't work for a dashboard
   */
  getRelativeMousePosition(event) {
    // Get position based on container
    let rect = document.getElementById('cy').getBoundingClientRect();
    const X = event['clientX'] - rect.left;
    const Y = event['clientY'] - rect.top;
    return [X, Y];
  }
  /**
   * Updates calculated resolution based on scale
   * @param event Event from scale input
   */
  updateCalculatedResolution() {
    let height = Math.floor(this.cyContainer.nativeElement.offsetHeight * this.SelectedNetworkExportScaleVariable);
    let width = Math.floor(this.cyContainer.nativeElement.offsetWidth * this.SelectedNetworkExportScaleVariable);
    this.CalculatedResolution = `${width} x ${height}`;
  }
  /**
   * Opens Global Setting Dialog
   */
  showGlobalSettings() {
    //console.log("threshold: ",  this.commonService.GlobalSettingsModel.SelectedLinkThresholdVariable);
    this.DisplayGlobalSettingsDialogEvent.emit("Styling");
  }
  /**
   * Debounced version of the _rerender function.
   * Delays the execution until after 1000ms have elapsed since the last call.
   */
  debouncedRerender() {
    const debounceDelay = 1000; // 1 second
    if (this.rerenderTimeout) {
      clearTimeout(this.rerenderTimeout);
    }
    this.rerenderTimeout = setTimeout(() => {
      this._rerender(); // Call the actual rerender method
      this.rerenderTimeout = null; // Clear the timeout reference
    }, debounceDelay);
  }
  /**
   * Hides export pane, sets isExporting variable to true and calls exportWork2 to export the twoD network image
   */
  exportVisualization(event) {
    // Prepare export options
    const exportOptions = {
      filename: this.SelectedNetworkExportFilenameVariable,
      filetype: this.SelectedNetworkExportFileTypeListVariable,
      scale: this.SelectedNetworkExportScaleVariable,
      quality: this.SelectedNetworkExportQualityVariable
    };
    // Set export options in the service
    this.exportService.setExportOptions(exportOptions);
    if (this.SelectedNetworkExportFileTypeListVariable == 'svg') {
      let options = {
        scale: 1,
        full: true,
        bg: '#ffffff'
      };
      let content = this.cy.svg(options);
      // gets width and height which is needed to position the network statistics table
      const parser = new DOMParser();
      const doc = parser.parseFromString(content, 'image/svg+xml');
      const svg1 = doc.documentElement;
      let width = parseFloat(svg1.getAttribute('width'));
      let height = parseFloat(svg1.getAttribute('height'));
      // Add the network statistics table to the svg
      let statTable = this.exportService.exportTableAsSVG(this.networkStatisticsTable.nativeElement);
      statTable.svg = statTable.svg.replace('<g>', `<g transform="translate(${width - statTable.width - 2}, ${height - statTable.height - 2})" fill="#f8f9fa">`);
      content = content.replace('</svg>', statTable.svg + '</svg>');
      let elementsToExport = [];
      if (this.widgets['node-symbol-table-visible'] != 'Hide') {
        elementsToExport.push(this.nodeSymbolTable.nativeElement);
      }
      if (this.widgets["polygon-color-table-visible"]) {
        elementsToExport.push(this.polygonColorTable.nativeElement);
      }
      this.exportService.requestSVGExport(elementsToExport, content, true, true);
    } else {
      // Request export
      let elementsToExport = [this.exportContainer.nativeElement];
      if (this.widgets['node-symbol-table-visible'] != 'Hide') {
        elementsToExport.push(this.nodeSymbolTable.nativeElement);
      }
      if (this.widgets["polygon-color-table-visible"]) {
        elementsToExport.push(this.polygonColorTable.nativeElement);
      }
      this.exportService.requestExport(elementsToExport, true, true);
    }
    // Optionally, close the export modal after initiating the export
    this.Show2DExportPane = false;
  }
  /**
   * Sets this.isExportClosed to true
   */
  onCloseExport() {
    this.isExportClosed = true;
  }
  /**
   * Handles file type change
   * @param event New file type value
   */
  onNetworkExportFiletypeChange(event) {
    this.SelectedNetworkExportFileTypeListVariable = event;
    if (event == "svg") {
      this.ShowAdvancedExport = false;
    } else {
      this.ShowAdvancedExport = true;
    }
  }
  /**
   * Toggles advanced export options visibility
   */
  toggleAdvancedExport() {
    this.ShowAdvancedExport = !this.ShowAdvancedExport;
  }
  /**
   * Handles filename change
   * @param event New filename value
   */
  onDataChange(event) {
    this.SelectedNetworkExportFilenameVariable = event;
  }
  /**
   * When the svg is clicked, this function is called and it removes color transparency slider that appears when updating color transparency in node/link color tables
   */
  networkWhitespaceClicked() {
    // The color transparency slider should dissapear if clicked out
    $("#color-transparency-wrapper").css({
      display: "none"
    });
    this.commonService.session.network.nodes.forEach(node => {
      node.selected = false;
    });
  }
  /**
   * Generates Polygon Color Selection Table, updates polygonColorMap and polygonAlphaMap functions, and then calls render to show/update network
   *
   */
  updatePolygonColors() {
    let polygonColorTable = $("#polygon-color-table").empty().append("<tr>" + "<th class='p-1 table-header-row'><div class='header-content'><span contenteditable>Group " + this.commonService.titleize(this.widgets['polygons-foci']) + "</span><a class='sort-button sortName' style='cursor: pointer'></a></div></th>" + `<th class='table-header-row tableCount' ${this.widgets['polygon-color-table-counts'] ? "" : "style='display: none'"}><div class='header-content'><span contenteditable>Count</span><a class='sort-button sortCount' style='cursor: pointer'></a></div></th>` + `<th class='table-header-row tableFrequency' ${this.widgets['polygon-color-table-frequencies'] ? "" : "style='display: none'"}><div class='header-content'><span contenteditable>Frequency</span><a class='sort-button sortCount' style='cursor: pointer'></a></div></th>` + "<th>Color</th>" + "</tr>");
    //.append(polygonHeader)
    // .append(countHeader)
    // .append((this.widgets["polygon-color-table-frequencies"] ? "<th>Frequency</th>" : ""))
    // .append("<th>Color</th>");
    if (!this.commonService.session.style['polygonValueNames']) this.commonService.session.style['polygonValueNames'] = {};
    let aggregates = this.commonService.createPolygonColorMap();
    let values = Object.keys(aggregates);
    // By default both are set to "DESC", if one changed the other is set to ""; Default sort is by counts DESC
    if (this.widgets["polygon-color-table-counts-sort"] == "ASC") {
      values.sort(function (a, b) {
        return aggregates[a] - aggregates[b];
      });
    } else if (this.widgets["polygon-color-table-name-sort"] == "ASC") {
      values.sort(function (a, b) {
        return a - b;
      });
    } else if (this.widgets["polygon-color-table-counts-sort"] == "DESC") {
      values.sort(function (a, b) {
        return aggregates[b] - aggregates[a];
      });
    } else {
      // if (this.widgets["polygon-color-table-name-sort"] == "DESC")
      values.sort(function (a, b) {
        return b - a;
      });
    }
    let total = 0;
    values.forEach(d => total += aggregates[d]);
    let that = this;
    values.forEach((value, i) => {
      let colorinput = $('<input type="color" value="' + that.commonService.temp.style.polygonColorMap(value) + '">').on("change", function (e) {
        let locInPolygonColors = that.commonService.session.style['polygonColors'].indexOf(that.commonService.temp.style.polygonColorMap(value));
        // need to update the value in the dom which is used when exportings
        e.currentTarget.attributes[1].value = e.target['value'];
        that.commonService.session.style['polygonColors'].splice(locInPolygonColors, 1, $(this).val());
        that.commonService.createPolygonColorMap();
        that.updateGroupNodeColors();
      });
      let alphainput = $("<a class='transparency-symbol'></a>").on("click", e => {
        $("#color-transparency-wrapper").css({
          top: e.clientY + 129,
          left: e.clientX,
          display: "block"
        });
        $("#color-transparency").val(that.commonService.session.style['polygonAlphas'][i]).one("change", function () {
          // changing transparency of 1 works, changing transparency of a 2nd group causes both to change, the 3rd causes all 3 to change...    
          that.commonService.session.style['polygonAlphas'].splice(i, 1, parseFloat($(this).val()));
          that.commonService.temp.style.polygonAlphaMap = d3__WEBPACK_IMPORTED_MODULE_4__.scaleOrdinal(that.commonService.session.style['polygonAlphas']).domain(values);
          $("#color-transparency-wrapper").fadeOut();
          that.updateGroupNodeColors();
        });
      });
      let cell = $("<td></td>").append(colorinput).append(alphainput);
      let row = $("<tr>" + "<td data-value='" + value + "'>" + (that.commonService.session.style['polygonValueNames'][value] ? that.commonService.session.style['polygonValueNames'][value] : that.commonService.titleize("" + value)) + "</td>" + `<td class='tableCount' ${that.widgets["polygon-color-table-counts"] ? "" : "style='display: none'"}>${aggregates[value]}</td>` + `<td class='tableFrequency' ${that.widgets["polygon-color-table-frequencies"] ? "" : "style='display: none'"}>${(aggregates[value] / total).toLocaleString()}</td>` + "</tr>").append(cell);
      polygonColorTable.append(row);
    });
    // PRE D3
    // this.commonService.temp.style.polygonColorMap = d3
    //   .scaleOrdinal(this.commonService.session.style['polygonColors'])
    //   .domain(values);
    //   this.commonService.temp.style.polygonAlphaMap = d3
    //   .scaleOrdinal(this.commonService.session.style['polygonAlphas'])
    //   .domain(values);
    polygonColorTable.find("td").on("dblclick", function () {
      // $(this).attr("contenteditable", true).focus();
    }).on("focusout", function () {
      let $this = $(this);
      // $this.attr("contenteditable", false);
      that.commonService.session.style['polygonValueNames'][$this.data("value")] = $this.text();
    });
    polygonColorTable.find(".p-1").on("focusout", function () {
      that.commonService.session.style['overwrite']['polygonColorHeaderVariable'] = that.widgets["polygons-foci"];
      that.commonService.session.style['overwrite']['polygonColorHeaderTitle'] = $($(this).contents()[0]).text();
    });
    // The sorting functionality is added here
    $('#polygon-color-table').off('click', 'th .sort-button').on('click', 'th .sort-button', function (e) {
      let isAscending;
      let index;
      if (e.currentTarget.classList.value.includes('sortName')) {
        index = 0;
        isAscending = that.widgets["polygon-color-table-name-sort"] == "DESC" ? true : false;
        that.widgets["polygon-color-table-name-sort"] = isAscending ? "ASC" : "DESC";
        that.widgets["polygon-color-table-counts-sort"] = "";
      } else {
        index = 1;
        isAscending = that.widgets["polygon-color-table-counts-sort"] == "DESC" ? true : false;
        that.widgets["polygon-color-table-counts-sort"] = isAscending ? "ASC" : "DESC";
        that.widgets["polygon-color-table-name-sort"] = "";
      }
      let table = $(this).parents('table').eq(0);
      let rows = table.find('tr:gt(0)').toArray().sort(comparer(index));
      if (!isAscending) {
        rows = rows.reverse();
      }
      for (let i = 0; i < rows.length; i++) {
        table.append(rows[i]);
      }
    });
    function comparer(index) {
      return function (a, b) {
        let valA = getCellValue(a, index),
          valB = getCellValue(b, index);
        console.log(`Comparing: ${valA} and ${valB}`); // New line
        return !isNaN(Number(valA)) && !isNaN(Number(valB)) ? Number(valA) - Number(valB) : valA.toString().localeCompare(valB);
      };
    }
    function getCellValue(row, index) {
      return $(row).children('td').eq(index).text();
    }
  }
  /**
   * This function is called when polygon-show widget is updated from the template.
   * That widget controls whether polygons are shown or not
   *
   */
  polygonsToggle(flag) {
    this.widgets['polygons-show'] = flag;
    this.updateNodeGrouping(flag);
    if (flag) {
      // Ensure the label orientation is updated when polygons are turned on
      this.onPolygonLabelOrientationChange(this.widgets['polygon-label-orientation']);
    } else {
      $(".polygons-settings-row").slideUp();
      //$('.polygons-label-row').slideUp();
      $("#polygon-color-table-row").slideUp();
      $("#polygon-color-value-row").slideUp();
      $("#polygon-color-table").empty();
      this.PolygonColorTableWrapperDialogSettings.setVisibility(false);
    }
  }
  /**
   * Updates node grouping based on the polygons-show flag.
   * @param flag boolean indicating whether to show polygons/groups
   */
  updateNodeGrouping(flag) {
    if (!this.cy) {
      return;
    }
    const cy = this.cy; // Reference to Cytoscape instance
    cy.batch(() => {
      if (flag) {
        this.addParentNodesAndGroupChildren(cy);
      } else {
        this.removeParentNodesAndUngroupChildren(cy);
      }
    });
    // Trigger layout after grouping
    // this.applyLayout();
  }
  /**
   * Adds parent nodes for each group and assigns child nodes to these parents.
   * @param cy Cytoscape instance
   */
  addParentNodesAndGroupChildren(cy) {
    const groupMap = new Map();
    let foci = this.commonService.session.style.widgets['polygons-foci'];
    cy.nodes().forEach(node => {
      const group = node.data(foci);
      if (group || group == 0) {
        if (!groupMap.has(group)) {
          groupMap.set(group, []);
        }
        groupMap.get(group)?.push(node);
      }
    });
    const polygonGroups = Array.from(groupMap.entries()).map(([key, values]) => ({
      key,
      values: values.map(node => node.data('id'))
    }));
    this.commonService.temp.polygonGroups = polygonGroups;
    groupMap.forEach((nodesInGroup, group) => {
      const parentId = `${group}`;
      if (cy.getElementById(parentId).length === 0) {
        let color = this.commonService.session.style.widgets['polygons-color-show'] ? this.commonService.temp.style.polygonColorMap(group) : this.commonService.session.style.widgets['polygon-color'];
        const alphaVal = this.commonService.temp.style.polygonAlphaMap(group) ?? 1;
        cy.add({
          group: 'nodes',
          data: {
            id: parentId,
            label: parentId,
            isParent: true,
            nodeColor: color,
            borderWidth: 1,
            shape: 'rectangle',
            bgOpacity: alphaVal
          },
          classes: 'parent' // Assigning the 'parent' class
        });
      }
    });
    cy.nodes().forEach(node => {
      const group = node.data(foci);
      if (group || group == 0) {
        const parentId = `${group}`;
        node.move({
          parent: parentId
        });
      }
    });
    // **Step 6:** Create and Assign the `groups` Object for polygonGroups
    const groups = Array.from(groupMap.entries()).map(([key, values]) => ({
      key,
      values: values.map(node => node.data('id'))
    }));
    // Assign the groups to polygonGroups in commonService.temp
    this.commonService.temp.polygonGroups = groups;
  }
  /**
   * Removes all parent (group) nodes and unassigns child nodes from any parents.
   * @param cy Cytoscape instance
   */
  removeParentNodesAndUngroupChildren(cy) {
    // Identify all parent nodes by class
    const parentNodes = cy.nodes('.parent');
    // Unassign child nodes from parents
    parentNodes.forEach(parent => {
      cy.nodes(`[parent = "${parent.id()}"]`).forEach(child => {
        child.move({
          parent: null
        });
      });
    });
    // Remove parent nodes
    cy.remove(parentNodes);
  }
  updateGroupNodeColors() {
    const cy = this.cy;
    if (!cy) {
      console.error('Cytoscape instance is not initialized.');
      return;
    }
    cy.nodes('.parent').forEach(parentNode => {
      const groupName = parentNode.data('label'); // Assuming 'label' holds the group name
      let color = this.commonService.session.style.widgets['polygons-color-show'] ? this.commonService.temp.style.polygonColorMap(groupName) : this.commonService.session.style.widgets['polygon-color'];
      // Determine the new color based on the groupColorMap
      const newColor = color || '#000'; // Default to black
      const alphaVal = this.commonService.temp.style.polygonAlphaMap(groupName) ?? 1; // fallback = 1
      // Update the nodeColor data attribute
      parentNode.data('nodeColor', newColor);
      parentNode.data('bgOpacity', alphaVal); // <--- The crucial piece!
      // Optionally, update the node's color style if not data-driven
      // parentNode.style('background-color', newColor);
    });
    // Refresh Cytoscape styles to apply changes
    cy.style().update();
    console.log('Group node colors updated.');
  }
  /**
   * This function is called when polygon-color-show widget is updated from the template.
   * This widget controls whether polygon should be colored the same or different.
   */
  polygonColorsToggle(e) {
    console.log('polygonColorsToggle: ', e);
    if (e) {
      this.widgets['polygons-color-show'] = true;
      $("#polygon-color-value-row").slideUp();
      $("#polygon-color-table-row").slideDown();
      this.PolygonColorTableWrapperDialogSettings.setVisibility(true);
      //setTimeout(() => {
      //this.updatePolygonColors();
      //this.updateGroupNodeColors();
      //}, 200);
    } else {
      this.widgets['polygons-color-show'] = false;
      $("#polygon-color-value-row").slideDown();
      $("#polygon-color-table-row").slideUp();
      $("#polygon-color-table").empty();
      this.PolygonColorTableWrapperDialogSettings.setVisibility(false);
      setTimeout(() => {
        // first removes polygons, if needed second call add them back
        this.updateNodeGrouping(false);
        if (this.commonService.session.style.widgets['polygons-show']) this.updateNodeGrouping(true);
      }, 200);
    }
  }
  /**
   * This function is called when polygon-color widget is updated from the template.
   * It is only available when polygon-color-show is false/hide
   * This widget control polygon color when they are all colored the same.
   *
   * XXXXX I think this function wasn't updated with the move to Angular.
   * Evaluate whether function can be reduce/eliminated. XXXXX
   */
  onPolygonColorChanged(e) {
    this.widgets["polygon-color"] = e;
    this.updateGroupNodeColors();
  }
  /**
   * This function is called when polygon-color-table-visible widget is updated from the template.
   * It is only available when polygon-color-show is true/show
   * This widget controls whether the polygon color table is visible.
   *
   */
  polygonColorsTableToggle(e) {
    console.log('polygonColorsTableToggle: ', e);
    this.SelectedNetworkTableTypeVariable = e == true ? 'Show' : 'Hide';
    this.PolygonColorTableWrapperDialogSettings.setVisibility(e);
  }
  /**
   * Gets a list of all visible links objects; Similar to getLlinks(), and commonService.getVisibleLinks()
   *
   * Each link object has a single origin, so any links that have more than one origin are stored as separed link objects
   *
   * Each link's source and target are node object
   * @returns a array of link objects; each link's source and target are node object
   */
  getVLinks() {
    let vlinks = this.commonService.getVisibleLinks(true);
    let output = [];
    let n = vlinks.length;
    let nodes = this.commonService.session.network.nodes;
    for (let i = 0; i < n; i++) {
      if (vlinks[i].origin) {
        if (typeof vlinks[i].origin === 'object') {
          if (vlinks[i].origin.length > 0) {
            // 0 = current, j = index, l = array
            vlinks[i].origin.forEach((o, j, l) => {
              const holder = Object.assign({}, vlinks[i], {
                origin: o,
                oNum: j,
                origins: l.length,
                source: nodes.find(d => d._id === vlinks[i].source || d.id === vlinks[i].source),
                target: nodes.find(d => d._id === vlinks[i].target || d.id === vlinks[i].target)
              });
              output.push(holder);
            });
          } else {
            const holder = Object.assign({}, vlinks[i], {
              oNum: 0,
              origins: 1,
              source: nodes.find(d => d._id === vlinks[i].source || d.id === vlinks[i].source),
              target: nodes.find(d => d._id === vlinks[i].target || d.id === vlinks[i].target)
            });
            output.push(holder);
          }
        } else {
          const holder = Object.assign({}, vlinks[i], {
            oNum: 0,
            origins: 1,
            source: nodes.find(d => d._id === vlinks[i].source || d.id === vlinks[i].source),
            target: nodes.find(d => d._id === vlinks[i].target || d.id === vlinks[i].target)
          });
          //console.log(holder);
          output.push(holder);
        }
      } else {
        const holder = Object.assign({}, vlinks[i], {
          origin: 'Unknown',
          oNum: 0,
          origins: 1,
          source: nodes.find(d => d._id === vlinks[i].source || d.id === vlinks[i].source),
          target: nodes.find(d => d._id === vlinks[i].target || d.id === vlinks[i].target)
        });
        output.push(holder);
      }
    }
    output = output.filter(x => x.source != undefined && x.target != undefined);
    return output;
  }
  /**
   * Gets a list of all visible links objects; Similar to getVlinks(), and commonService.getVisibleLinks()
   *
   * A link that has multiple origins is stored as a single object
   *
   * Each link's source and target are node object
   * @returns a array of link objects; each link's source and target are node object
   */
  getLLinks() {
    let vlinks = this.commonService.getVisibleLinks(true);
    let n = vlinks.length;
    for (let i = 0; i < n; i++) {
      vlinks[i].source = this.commonService.session.network.nodes.find(d => d._id == vlinks[i].source);
      vlinks[i].target = this.commonService.session.network.nodes.find(d => d._id == vlinks[i].target);
    }
    return vlinks;
  }
  /**
   * Used to calculate the angle between two nodes. It is used when setting link label
   * @param source source node
   * @param target target node
   */
  calcAngle(source, target) {
    return Math.atan((source.y - target.y) / (source.x - target.x)) * this.radToDeg;
  }
  copyID() {
    let id = $('#copyID').attr('data-clipboard-text');
    this.clipboard.copy(id);
    this.hideContextMenu();
  }
  /**
   * Used from Context Menu and copy node's sequence to the user's clipboard
   */
  copySeq() {
    let seq = $('#copySeq').attr('data-clipboard-text');
    this.clipboard.copy(seq);
    this.hideContextMenu();
  }
  /**
   * Upon right clicking a node, d, the context menu will appear, which allows the user to option to pin node, copy id, copy sequence, or view attributes
   * @param d the node right clicked
   */
  showContextMenu(d) {}
  /**
   * Hides the Context Menu
   */
  hideContextMenu() {
    $('#context-menu').animate({
      'opacity': 0
    }, 80, function () {
      $(this).css('z-index', -1);
    });
  }
  /**
   * This function capitalizes the first letter of each word in a string.
   * @param str input string
   * @returns input string with first letter capitalized
   */
  titleize(str) {
    return str.replace(/\b\w/g, l => l.toUpperCase());
  }
  /**
   * Generate a tabular HTML string from the data array
   * @param data [ [Col1, ...], ...] - An Array of arrays where arrays within outer array represent different rows and
   *  values within inner array represent the cells within that row
   * @returns an HTML string with a table representation of the data
   */
  tabulate(data) {
    let tableHtml = `
            <style>
            div:has(> table#tooltip-table) {
              padding: 0px;
            }

            #tooltip-table {
                border-spacing: 0;
                width: 100%;
                border: 1px solid #ddd;
                z-index: 1000;
            }
            
            #tooltip-table td, #tooltip-table th {
                text-align: left;
                padding: 10px;
                border: 1px solid #ddd;
            }
            
            #tooltip-table tr:nth-child(even) {
                background-color: #f2f2f2;
            }
            
            #tooltip-table tr:nth-child(odd) {
                background-color: #fff;
            }
            </style>
            <table id="tooltip-table"><tbody>`;
    for (let row of data) {
      tableHtml += '<tr>';
      for (let cell of row) {
        tableHtml += '<td>' + cell + '</td>';
      }
      tableHtml += '</tr>';
    }
    tableHtml += '</tbody></table>';
    return tableHtml;
  }
  /**
   * Gets data from current node needed for tooltip and displays it in the tooltip also hightlights neighbors if that option is selected
   * @param d a node
   */
  showNodeTooltip(d, event) {
    // Only show tooltip for nodes, not parent/group nodes
    if (d.isParent) {
      return;
    }
    if (this.widgets['node-highlight']) {
      this.selectedNodeId = d.id;
    }
    let tt_var_len = this.widgets['node-tooltip-variable'].length;
    let tooltipHtml;
    if (tt_var_len == 0) {
      return null;
    } else if (tt_var_len == 1) {
      tooltipHtml = `${d[this.widgets['node-tooltip-variable'][0]]}`;
    } else {
      tooltipHtml = this.tabulate(this.widgets['node-tooltip-variable'].map(variable => [this.titleize(variable), d[variable]]));
    }
    let [X, Y] = this.getRelativeMousePosition(event);
    d3__WEBPACK_IMPORTED_MODULE_4__.select('#tooltip').html(tooltipHtml).style('position', 'absolute').style('left', X + 10 + 'px').style('top', Y - 10 + 'px').style('z-index', 1000).transition().duration(100).style('opacity', 1);
  }
  /**
   * Gets data from current link needed for tooltip and displays it in the tooltip
   * @param d link
   */
  showLinkTooltip(d, event) {
    let v = this.SelectedLinkTooltipVariable;
    if (v == 'None') return;
    // Tooltip variables can be a single string or an array
    let tooltipVariables = this.SelectedLinkTooltipVariable;
    if (!Array.isArray(tooltipVariables)) {
      tooltipVariables = [tooltipVariables];
      this.SelectedLinkTooltipVariable = tooltipVariables; // Update SelectedLinkTooltipVariable to be an array
    }
    // If no tooltip variable is selected, we shouldn't show a tooltip
    if (tooltipVariables.length > 0 && tooltipVariables[0] == 'None') return;
    /**
     * @param data link
     * @param varName name of variable
     * @returns the value of the link for the variable
     */
    let getData = (data, varName) => {
      if (varName == 'source_id') {
        return data['source']._id;
      } else if (varName == 'source_index') {
        return data['source'].index;
      } else if (varName == 'target_id') {
        return data['target']._id;
      } else if (varName == 'target_index') {
        return data['target'].index;
      } else {
        return data[varName];
      }
    };
    // Generate the HTML for the tooltip
    let tooltipHtml = '';
    if (tooltipVariables.length > 1) {
      tooltipHtml = this.tabulate(tooltipVariables.map(variable => [this.titleize(variable), getData(d, variable)]));
    } else {
      tooltipHtml = getData(d, tooltipVariables[0]);
    }
    let [X, Y] = this.getRelativeMousePosition(event);
    d3__WEBPACK_IMPORTED_MODULE_4__.select('#tooltip').html(tooltipHtml).style('position', 'absolute').style('left', X + 10 + 'px').style('top', Y - 10 + 'px').style('z-index', 1000).transition().duration(100).style('opacity', 1);
  }
  /**
   * Hides the Tooltip
   */
  hideTooltip() {
    if (this.widgets['node-highlight']) {
      this.selectedNodeId = undefined;
    }
    let tooltip = d3__WEBPACK_IMPORTED_MODULE_4__.select('#tooltip');
    tooltip.transition().duration(100).style('opacity', 0).on('end', () => tooltip.style('z-index', -1));
  }
  /**
   * @returns {boolean} if a is a number
   */
  isNumber(a) {
    return typeof a == "number";
  }
  /**
   * This is called when the variable used to grouped by/created polygons is changed
   *
   */
  centerPolygons(e, updateLayout = true) {
    var _this4 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      _this4.widgets['polygons-foci'] = e;
      if (_this4.widgets['polygons-color-show'] == true) {
        console.log('centerPolygons: show ');
        $("#polygon-color-table").empty();
        _this4.updateGroupAssignments(e);
        _this4.updatePolygonColors();
        _this4.updateGroupNodeColors();
        // Just update group assignments since not showing different colors
      } else {
        _this4.updateGroupAssignments(e);
      }
      if (updateLayout) yield _this4.updateLayout();
    })();
  }
  updateLayout() {
    if (this.commonService.session.style.widgets['polygons-show'] == false || this.commonService.session.style.widgets['polygons-foci'] == 'None') {
      this._partialUpdate();
    } else {
      this.gatherGroups();
    }
  }
  updateGroupAssignments(foci) {
    const cy = this.cy; // Reference to Cytoscape instance
    if (!cy) {
      console.error('Cytoscape instance is not initialized.');
      return;
    }
    cy.batch(() => {
      // Identify existing parent nodes and remove them if necessary
      const existingParents = cy.nodes('.parent');
      console.log('Removing existing parent nodes:', existingParents.map(p => p.id()));
      existingParents.forEach(parent => {
        // **Step 1:** Ungroup child nodes by setting their parent to null
        parent.children().forEach(child => {
          child.move({
            parent: null
          });
        });
        // **Step 2:** Remove the parent node without affecting child nodes
        cy.remove(parent);
      });
      // Determine new groups based on foci
      const groupMap = new Map();
      cy.nodes().forEach(node => {
        // if(node.data('id') === '30578_KF773488_D99cl05') {
        //     console.log('nodeee1: ', node.data());
        //     console.log('nodeee2: ', node.data(foci));
        // }
        const rawGroup = node.data(foci); // Assuming foci corresponds to a data attribute
        const group = Array.isArray(rawGroup) ? rawGroup[0] : rawGroup; // Use first element if array
        if (group !== undefined && group !== null && group !== 'None') {
          if (!groupMap.has(group)) {
            groupMap.set(group, []);
          }
          groupMap.get(group)?.push(node);
        }
      });
      // Create new parent nodes and assign child nodes
      groupMap.forEach((nodesInGroup, groupName) => {
        const parentId = `group-${groupName}`;
        let color = this.commonService.session.style.widgets['polygons-color-show'] ? this.commonService.temp.style.polygonColorMap(groupName) : this.commonService.session.style.widgets['polygon-color'];
        const alphaVal = this.commonService.temp.style.polygonAlphaMap(groupName) ?? 1; // fallback = 1
        // Add a new parent node
        const parentNode = cy.add({
          group: 'nodes',
          data: {
            id: parentId,
            label: `${groupName}`,
            // Use group name as label
            isParent: true,
            nodeColor: color || '#000',
            // Default to black if not found
            borderWidth: 1,
            shape: 'rectangle',
            bgOpacity: alphaVal // Use the alpha value for background opacity
          },
          classes: 'parent' // Assigning the 'parent' class
        });
        // Assign child nodes to the new parent
        nodesInGroup.forEach(childNode => {
          childNode.move({
            parent: parentId
          });
        });
      });
      // Handle nodes without a group (optional)
      cy.nodes().forEach(node => {
        if (!node.parent().length && node.data(foci) !== 'None') {
          node.move({
            parent: null
          });
        }
      });
      if (this.commonService.session.style.widgets['polygons-label-show'] == false) {
        cy.style().selector('node.parent').style({
          'label': ''
        }).update();
      } else {
        // Refresh Cytoscape styles to apply changes
        cy.style().update();
      }
      // **Step 6:** Create and Assign the `groups` Object for polygonGroups
      const groups = Array.from(groupMap.entries()).map(([key, values]) => ({
        key,
        values: values.map(node => node.data('id'))
      }));
      // Assign the groups to polygonGroups in commonService.temp
      // TODO: Decide on one
      this.commonService.temp.polygonGroups = groups;
    });
  }
  /**
   * Calls setPolygonLabelSize to update polygon-label-size widget and then redraws polygon labels
   */
  onPolygonLabelSizeChange(e) {
    this.widgets['polygons-label-size'] = parseFloat(e);
    // Update the font size of parent/group node labels in Cytoscape
    if (this.cy) {
      this.cy.style().selector('node.parent').style({
        'font-size': `${this.widgets['polygons-label-size']}px`
      }).update();
    }
  }
  /**
   * Updates polygon-label-orientation widget and then redraws polygon labels
   */
  onPolygonLabelOrientationChange(e) {
    this.widgets['polygon-label-orientation'] = e;
    // Adjust the orientation of the parent/group node labels in Cytoscape
    if (this.cy) {
      let textValign;
      let textHalign = 'center'; // Default horizontal alignment
      // Determine vertical alignment based on the selected orientation
      switch (e.toLowerCase()) {
        case 'top':
          textValign = 'top';
          break;
        case 'bottom':
          textValign = 'bottom';
          break;
        case 'middle':
        default:
          textValign = 'center';
          break;
      }
      this.cy.style().selector('node.parent').style({
        'text-valign': textValign,
        'text-halign': textHalign
      }).update();
    }
  }
  /**
   * Updates polygons-label-show widget and the renders the network again
   */
  onPolygonLabelShowChange(e) {
    if (e) {
      this.widgets['polygons-label-show'] = true;
    } else {
      this.widgets['polygons-label-show'] = false;
    }
    // Update the parent/group nodes' labels in Cytoscape
    if (this.cy) {
      if (e) {
        // Show labels: Set the label to the group name
        this.cy.style().selector('node.parent').style({
          'label': 'data(label)',
          // Assumes parent nodes have a 'label' data field
          'text-valign': this.SelectedPolygonLabelOrientationVariable,
          'text-halign': 'center',
          'font-size': `${this.commonService.session.style.widgets['polygons-label-size']}px`,
          // Adjust as needed
          //'text-background-color': '#ffffff',
          //'text-background-opacity': 1,
          //'text-background-padding': '2px',
          // We also need to ensure that it uses data(...) for color & alpha:
          'background-color': 'data(nodeColor)',
          // The critical addition (can also be 'opacity' but that will fade the label, border, etc.):
          // @ts-ignore
          'background-opacity': 'data(bgOpacity)'
        }).update();
      } else {
        // Hide labels: Remove the label by setting it to an empty string
        this.cy.style().selector('node.parent').style({
          'label': '',
          'text-background-opacity': 0
        }).update();
      }
    }
  }
  /**
   * XXXXX reevaluate if need to be combined with polygonColorsTableToggle; when called from polygonColorsTableToggle e is 'Show'/'Hide' when called
   * from template e is true/false XXXXX
   */
  onPolygonColorTableChange(e) {
    console.log('onPolygonColorTableChange: ', e);
    this.widgets["polygon-color-table-visible"] = e;
    if (e) {
      this.SelectedNetworkTableTypeVariable = 'Show';
      setTimeout(() => {
        this.updatePolygonColors();
        this.updateGroupNodeColors();
      }, 0);
    } else {
      this.SelectedNetworkTableTypeVariable = 'Hide';
    }
  }
  /*/
      Node Events
  /*/
  /**
   * updates the value of the appropriate widget, add/removes rows from dialog menu, and calls redrawLabels to update labels on svg/view
   * @param e the name of variable to change labels to
   */
  onNodeLabelVaribleChange(e) {
    this.widgets['node-label-variable'] = e;
    if (e == 'None') {
      $('.node-label-row').slideUp();
    } else {
      $('.node-label-row').css('display', 'flex');
    }
    this.updateNodeLabels();
  }
  mapPreviousShapeNameToCurrent(name) {
    if (this.symbolMapping.some(x => x.key === name)) {
      return name;
    }
    switch (name) {
      case 'symbolCircle':
        return 'ellipse';
      case "symbolTriangle":
      case "symbolTriangleDown":
        return 'triangle';
      case "symbolSquare":
        return 'rectangle';
      case "symbolDiamond":
      case "symbolDiamondAlt":
        return 'rhomboid';
      case "symbolDiamondSquare":
        return 'diamond';
      case "symbolOctagonAlt":
      case "symbolHexagonAlt":
        return 'heptagon';
      case "symbolPentagon":
        return 'pentagon';
      case "symbolHexagon":
        return 'hexagon';
      case "symbolCross":
        return 'barrel';
      case "symbolOctagon":
        return 'octagon';
      case "symbolStar":
        return 'star';
      case "symbolTriangleLeft":
      case "symbolTriangleRight":
        return 'tag';
      case "symbolX":
      case "symbolWye":
        return 'vee';
      default:
        return 'ellipse';
    }
  }
  onNodeShapeSort(sortBy) {
    if (sortBy == this.shapeSort.key) {
      this.shapeSort.assending = !this.shapeSort.assending;
    } else {
      this.shapeSort.key = sortBy;
      this.shapeSort.assending = true;
    }
    if (sortBy == 'key' && this.shapeSort.assending) {
      this.shapeAggregates.sort((a, b) => {
        let aKey = a.key == 'null' ? '(Empty)' : a.key.toString();
        let bKey = b.key == 'null' ? '(Empty)' : b.key.toString();
        return bKey.localeCompare(aKey);
      });
    } else if (sortBy == 'key') {
      this.shapeAggregates.sort((a, b) => {
        let aKey = a.key == 'null' ? '(Empty)' : a.key.toString();
        let bKey = b.key == 'null' ? '(Empty)' : b.key.toString();
        return aKey.localeCompare(bKey);
      });
    } else if (this.shapeSort.assending) {
      this.shapeAggregates.sort((a, b) => Number(b[this.shapeSort.key]) - Number(a[this.shapeSort.key]));
    } else {
      this.shapeAggregates.sort((a, b) => Number(a[this.shapeSort.key]) - Number(b[this.shapeSort.key]));
    }
  }
  /**
   * updates the value of the nodeSymbolMap and updates the nodes on the 2D network. Called from node shape table dropdown
   * @param newShape a string of node shape (see this.symbolMapping.key)
   * @param group a string of the group to change
   */
  onNodeShapeTableChange(newShape, group) {
    let i = this.shapeAggregates.findIndex(x => x.key === group);
    this.commonService.session.style.nodeSymbols.splice(i, 1, newShape);
    let values = this.shapeAggregates.map(x => x.key);
    this.commonService.temp.style.nodeSymbolMap = d3__WEBPACK_IMPORTED_MODULE_4__.scaleOrdinal(this.commonService.session.style.nodeSymbols).domain(values);
    this.updateNodeShapes();
  }
  // Method to handle shape change from the dropdown
  onNodeShapeChange(newShape) {
    this.selectedNodeShape = newShape;
    this.updateNodeShapes();
  }
  getNodeSize(node) {
    let defaultSize = this.widgets['node-radius'];
    let size = defaultSize,
      med = defaultSize,
      oldrng,
      min,
      max;
    let sizeVariable = this.widgets['node-radius-variable'];
    if (this.widgets['node-radius-variable'] == 'None') {
      return this.widgets['node-radius'];
    } else {
      let v = node[sizeVariable];
      if (!this.isNumber(v)) v = this.nodeMid;
      // Check the type of v before calling linkScale
      // Ensure v is a number before using linkScale
      if (typeof v === 'number') {
        let scaleValue = this.nodeScale(v);
        if (this.debugMode) {
          console.log('link scale', scaleValue);
        }
        return scaleValue;
      } else {
        if (this.debugMode) {
          console.error('v is not a number:', v);
        }
        return this.nodeScale; // Default to scalar if v is not a number
      }
    }
  }
  getNodeColor(node) {
    // If this node is a parent (polygon group), keep using polygonColorMap
    if (node.isParent) {
      return this.commonService.temp.style.polygonColorMap(node.label);
    }
    // Otherwise, use nodeColorMap or a single color from the widget
    const variable = this.widgets['node-color-variable'];
    if (variable === 'None') {
      return [this.widgets['node-color'], 1 - this.widgets['node-opacity']];
    }
    return [this.commonService.temp.style.nodeColorMap(node[variable]), this.commonService.temp.style.nodeAlphaMap(node[variable])];
  }
  getLinkWidth(link) {
    let scalar = this.widgets['link-width'];
    let variable = this.widgets['link-width-variable'];
    // console.log('--- TwoD getLinkWidth link1: ', scalar, variable);
    if (variable == 'None') return scalar;else {
      let mid = (this.linkMax - this.linkMin) / 2 + this.linkMin;
      let v = link[variable];
      if (!this.isNumber(v)) v = mid;
      // Ensure v is a number before using linkScale
      if (typeof v === 'number') {
        let scaleValue = this.linkScale(v);
        return scaleValue;
      } else {
        return scalar; // Default to scalar if v is not a number
      }
    }
  }
  getLinkColor(link) {
    let variable = this.widgets['link-color-variable'];
    let color = this.widgets['link-color'];
    let finalColor;
    let alphaValue;
    if ((variable == 'Origin' || variable == 'origin') && link.origin.length > 1) {
      finalColor = this.commonService.temp.style.linkColorMap("Duo-Link");
      alphaValue = this.commonService.temp.style.linkAlphaMap("Duo-Link");
    } else {
      finalColor = variable == 'None' ? color : this.commonService.temp.style.linkColorMap(link[variable]);
      alphaValue = this.commonService.temp.style.linkAlphaMap(link[variable]);
    }
    if (this.overideTransparency) {
      alphaValue = this.widgets['link-opacity'];
    }
    return {
      color: finalColor,
      opacity: alphaValue
    };
  }
  /**
   * Gets the label for a node based on node label variable
   * @param node the node retrieve to get the value of the variable
   */
  getNodeLabel(node) {
    // If no label variable then should be none
    return this.widgets['node-label-variable'] == 'None' ? '' : String(node[this.widgets['node-label-variable']]) || '';
  }
  /**
   * Gets the label for a link based on link label variable
   * @param link the link we retrieve to get the value of the variable
   */
  getLinkLabel(link) {
    // console.log('link variable: ',this.widgets['link-label-variable'] );
    let labelVariable = this.widgets['link-label-variable'];
    // If no label variable then should be none
    if (labelVariable == 'None') {
      return {
        text: ''
      };
    } else {
      // console.log('link variable2: ',this.commonService.session.data.links[index]);
      if (labelVariable == 'source_id') {
        return link['source']['id'];
      } else if (labelVariable == 'source_index') {
        return link['source']['index'];
      } else if (labelVariable == 'target_id') {
        return link['target']['id'];
      } else if (labelVariable == 'target_index') {
        return link['target']['index'];
      } else if (labelVariable != 'distance') {
        return {
          text: link[labelVariable]
        };
      }
      if (this.debugMode) {
        console.log('cluster link: ', link);
      }
      const labelValue = link[labelVariable];
      // check if link has a distance origin and if the distance origin is included in the link.origin array, if not then the label should be 0
      if (link.distanceOrigin && !link.origin.includes(link.distanceOrigin)) {
        return {
          text: 0
        };
      }
      if (typeof labelValue === 'number' || !isNaN(parseFloat(labelValue))) {
        // console.log('is number');
        if (this.widgets['default-distance-metric'] == 'snps') {
          return {
            text: Math.round(parseFloat(labelValue))
          };
        } else {
          return labelValue != 0 ? {
            text: parseFloat(labelValue).toFixed(this.widgets['link-label-decimal-length'])
          } : {
            text: ''
          };
        }
      } else {
        return {
          text: labelValue
        };
      }
    }
  }
  /**
   * Calls setNodeLabelSize to update label-size and redraw labels
   */
  onNodeLabelSizeChange(e) {
    this.setNodeLabelSize(e.target.value);
  }
  /**
   * Updates node-label-size and then redraws labels
   */
  setNodeLabelSize(size) {
    this.widgets['node-label-size'] = parseFloat(size);
    this.updateNodeLabelSizes(); // Update label sizes without rerendering the entire network
    // document.documentElement.style.setProperty('--vis-graph-node-label-font-size', `${this.SelectedNodeLabelSizeVariable}pt`);
  }
  /**
   * Updates node-label-orientation and then redraws labels
   * @param e orientation such as Right, Left, Top, Bottom, Middle
   */
  onNodeLabelOrientationChange(e) {
    this.widgets['node-label-orientation'] = e;
  }
  /**
   * updates node-tooltip-variable
   */
  onNodeTooltipVariableChange(e) {
    let selectedValue = e;
    if (!Array.isArray(selectedValue)) {
      selectedValue = [selectedValue];
    }
    this.widgets['node-tooltip-variable'] = selectedValue;
  }
  onNodeSymbolVariableChange(e, setVisibility = true) {
    console.log('sumbol variable: ', this.widgets['node-symbol-variable']);
    console.log('selected node symbol variable: ', this.SelectedNodeSymbolVariable);
    this.widgets['node-symbol-variable'] = this.SelectedNodeSymbolVariable;
    if (setVisibility) {
      this.NodeSymbolTableWrapperDialogSettings.setVisibility(true);
      this.SelectedNetworkTableTypeVariable = "Show";
      if (this.SelectedNodeSymbolVariable !== 'None') {
        $('#node-symbol-row').slideUp();
        //If hidden by default, unhide to perform slide up and down
        if (!this.ShowNodeSymbolTable) {
          this.ShowNodeSymbolTable = true;
        } else {
          $('#node-symbol-table-row').slideDown();
        }
        if (!this.ShowNodeSymbolWrapper) {
          this.ShowNodeSymbolWrapper = true;
        }
        // No shape by variable selected
        // show shape, hide table 
      } else {
        $('#node-symbol-row').slideDown();
        $('#node-symbol-table-row').slideUp();
        if (this.ShowNodeSymbolWrapper) {
          this.ShowNodeSymbolWrapper = false;
        }
        this.onNodeSymbolTableChange('Hide');
      }
    }
    this.generateNodeSymbolSelectionTable("#node-symbol-table", e);
  }
  generateNodeSymbolSelectionTable(tableId, variable, isEditable = true) {
    this.commonService.onTableCleared(tableId);
    this.commonService.session.style.nodeSymbols = ['ellipse', 'triangle', 'rectangle', 'pentagon', 'rhomboid', 'diamond', 'hexagon', 'tag', 'star', 'vee', 'heptagon', 'barrel', 'octagon'];
    this.widgets['node-symbol-variable'] = variable;
    if (variable === 'None' && !isEditable) return;
    if (variable == 'None') return;
    let values = [];
    let aggregates = {};
    let nodes = this.commonService.session.data.nodes;
    let n = nodes.length;
    let vnodes = 0;
    // So aggrate to get since just one symbol
    if (variable !== 'None') {
      for (let i = 0; i < n; i++) {
        let d = nodes[i];
        if (!d || typeof d !== 'object') continue; // guard against null/undefined
        if (!d.visible) continue;
        vnodes++;
        let dv = d[variable];
        // Optionally, if you expect the value to be defined:
        if (dv === undefined) {
          console.warn(`Node at index ${i} does not have property "${variable}"`);
          continue;
        }
        if (values.indexOf(dv) === -1) values.push(dv);
        if (dv in aggregates) {
          aggregates[dv]++;
        } else {
          aggregates[dv] = 1;
        }
      }
    }
    this.shapeAggregates = [];
    this.shapeAggregates = Object.keys(aggregates).map(key => ({
      'key': key,
      'count': aggregates[key],
      'frequency': parseFloat((aggregates[key] / vnodes).toFixed(3))
    }));
    this.shapeAggregates.sort((a, b) => Number(b.count) - Number(a.count));
    if (values.length > this.commonService.session.style.nodeSymbols.length) {
      let symbols = [];
      let m = Math.ceil(values.length / this.commonService.session.style.nodeSymbols.length);
      while (m-- > 0) {
        symbols = symbols.concat(this.commonService.session.style.nodeSymbols);
      }
      this.commonService.session.style.nodeSymbols = symbols;
      console.log('node symbols: ', symbols);
    }
    values.sort((a, b) => {
      return aggregates[b] - aggregates[a];
    });
    this.commonService.temp.style.nodeSymbolMap = d3__WEBPACK_IMPORTED_MODULE_4__.scaleOrdinal(this.commonService.session.style.nodeSymbols).domain(values);
    this.updateNodeShapes();
    //}, 100);
  }
  onNodeRadiusVariableChange(e) {
    this.widgets['node-radius-variable'] = e;
    if (e == 'None') {
      $('#node-max-radius-row').slideUp();
      $('#node-min-radius-row').slideUp();
      $('#node-radius-row').slideDown();
    } else {
      this.updateMinMaxNode();
      $('#node-max-radius-row').css('display', 'flex');
      $('#node-min-radius-row').css('display', 'flex');
      $('#node-radius-row').slideUp();
    }
    this.updateNodeSizes();
  }
  closeSettingsPane(id) {
    //$('#nodeShapeTableSettings').on('mouseleave', () => { console.log('abc'); 
    $(`#${id}`).delay(500).css('display', 'none');
  }
  /**
   * Updates node-radius-max widget and redraws nodes
   */
  onNodeRadiusMaxChange(e) {
    console.log('onNodeRadiusMaxChange: ', e);
    this.widgets['node-radius-max'] = e;
    this.updateMinMaxNode();
    this.updateNodeSizes();
  }
  /**
   * Updates node-radius-min widget and redraws nodes
   */
  onNodeRadiusMinChange(e) {
    this.widgets['node-radius-min'] = e;
    this.updateMinMaxNode();
    this.updateNodeSizes();
  }
  /**
   * Updates node-border-width widget and redraws nodes
   */
  onNodeBorderWidthChange(e) {
    this.widgets['node-border-width'] = e;
    this.updateMinMaxNode();
    this.updateNodeBorders(); // Update border widths without rerendering the entire network
  }
  /**
   * Updates node-radius widget and redraws nodes
   */
  onNodeRadiusChange(e) {
    this.widgets['node-radius'] = e;
    this.updateNodeSizes(); // Update node sizes without rerendering the entire network
  }
  /**
   * Rerenders whole data set by resetting data object
   */
  _rerender(timelineTick = false) {
    var _this5 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      console.log('--- TwoD DATA network rerender');
      if (!timelineTick) {
        // If the network is in the middle of rendering, don't rerender
        if (_this5.commonService.session.network.rendering) return;
        // Set rendering to true to prevent actions during rerendering
        _this5.commonService.session.network.rendering = true;
        // Set rendered to false so to prevent other changes.  Needed to check to differentiate network has rendered for the first time vs checking if rendering is false
        _this5.store.setNetworkRendered(false);
      }
      let networkData;
      if (timelineTick) {
        if (_this5.data === undefined) {
          return;
        }
        let nodes = _this5.commonService.getVisibleNodes();
        if (nodes.length == _this5.data.nodes.length) {
          return;
        }
        let links = _this5.commonService.getVisibleLinks();
        let visLinks = [];
        links.forEach(d => {
          if (!d.visible) return;
          var source = nodes.find(node => node._id == d.source && node.visible);
          var target = nodes.find(node => node._id == d.target && node.visible);
          if (source && target) {
            visLinks.push(d);
          }
        });
        networkData = {
          nodes: nodes,
          links: visLinks
        };
      } else {
        networkData = {
          nodes: _this5.commonService.getVisibleNodes(),
          links: _this5.commonService.getVisibleLinks()
        };
      }
      // Need to convert source and target to string ids for cytoscape
      networkData.links.forEach(link => {
        // If link.source is an object, grab its _id and convert to string
        if (typeof link.source === 'object') {
          link.source = link.source._id.toString();
        }
        // Same for link.target
        if (typeof link.target === 'object') {
          link.target = link.target._id.toString();
        }
      });
      const nodeIds = new Set(networkData.nodes.map(n => n.id));
      // Instead of calling synchronously, await the precomputation:
      if (!_this5.cy) {
        const {
          nodes: laidOutNodes,
          links: laidOutLinks
        } = yield _this5.precomputePositionsWithD3(networkData.nodes, networkData.links, 300).then(({
          nodes: n,
          links: l
        }) => {
          return _this5.precomputePositionsWithD3(n, l, 5, false);
        });
        console.log('--- TwoD networkData after precompute0: ', lodash__WEBPACK_IMPORTED_MODULE_6__.cloneDeep(networkData.links));
        // Update networkData with the precomputed positions
        networkData.nodes = laidOutNodes;
        networkData.links = laidOutLinks;
        networkData.links.forEach((link, i) => {
          // If link.source is an object, grab its _id and convert to string
          if (typeof link.source === 'object') {
            link.source = link.source._id.toString();
          }
          // Same for link.target
          if (typeof link.target === 'object') {
            link.target = link.target._id.toString();
          }
        });
        networkData.links.forEach(link => {
          if (!nodeIds.has(link.source)) {
            console.warn('Link source not found in nodes:', link.source, link);
          }
          if (!nodeIds.has(link.target)) {
            console.warn('Link target not found in nodes:', link.target, link);
          }
        });
      }
      // Update Cytoscape visualization if it exists
      if (_this5.cy && !timelineTick) {
        _this5._partialUpdate().then(() => _this5.ensurePolygon());
      } else if (_this5.cy && timelineTick) {
        _this5.data = _this5.commonService.convertToGraphDataArray(networkData);
        // Add new nodes and edges
        _this5.cy.elements().remove();
        const newElements = _this5.mapDataToCytoscapeElements(_this5.data, true);
        _this5.cy.add(newElements);
        // Apply the Cose layout to arrange the nodes
        // const layout = this.cy.layout({
        //     name: 'preset',
        //     fit: true, // Fit the graph within the viewport
        //     padding: 30, // Padding around the graph
        // });
        // layout.run();
        _this5.ensurePolygon(false);
      } else {
        _this5.data = _this5.commonService.convertToGraphDataArray(networkData);
        // 1) Log raw incoming data
        console.log(" Debug: raw networkData links:", networkData.links);
        console.log(" Debug: raw networkData nodes:", networkData.nodes);
        // 2) Log the converted data
        console.log(" Debug: data from convertToGraphDataArray:", _this5.data);
        // Destroy old instance if any
        if (_this5.cy) {
          _this5.cy.destroy();
        }
        // 3) Build Cytoscape elements
        const el = _this5.mapDataToCytoscapeElements(_this5.data);
        console.log(" Debug: mapDataToCytoscapeElements output:", lodash__WEBPACK_IMPORTED_MODULE_6__.cloneDeep(el));
        // Optional: check for duplicates & invalid references
        const seenIds = new Set();
        el.edges.forEach(edge => {
          const {
            id,
            source,
            target
          } = edge.data;
          // 3A) Check for duplicate edge IDs
          if (seenIds.has(id)) {
            console.warn(" Duplicate edge ID:", id, edge);
          } else {
            seenIds.add(id);
          }
          // 3B) Check for missing node references
          const hasSource = el.nodes.some(n => n.data.id === source);
          const hasTarget = el.nodes.some(n => n.data.id === target);
          if (!hasSource || !hasTarget) {
            console.warn(" Edge references invalid node:", edge.data);
          }
        });
        // 4) Actually create Cytoscape
        let startTime;
        console.log(_this5.cyContainer);
        _this5.cy = (0,cytoscape__WEBPACK_IMPORTED_MODULE_9__["default"])({
          container: _this5.cyContainer.nativeElement,
          elements: el,
          style: _this5.getCytoscapeStyles(),
          layout: {
            name: 'preset',
            fit: true,
            padding: 100
          },
          zoomingEnabled: true,
          userZoomingEnabled: true,
          panningEnabled: true,
          userPanningEnabled: true
        });
        // Attach events
        _this5.attachCytoscapeEvents();
        // 5) Debug layout start & stop
        _this5.cy.one('layoutstart', () => {
          startTime = performance.now();
          console.log(` Cytoscape layout started at: ${startTime.toFixed(2)}ms`);
        });
        _this5.cy.one('layoutstop', () => {
          const endTime = performance.now();
          console.log(` Cytoscape layout done in ${(endTime - startTime).toFixed(2)}ms`);
          console.log('twod 1 polygons show: ', _this5.widgets['polygons-show']);
          // Update polygons to show if they should be
          if (_this5.commonService.session.style.widgets['polygons-show']) {
            console.log('twod 2323 polygons color show: ', _this5.commonService.session.style.widgets['polygons-color-show']);
            _this5.polygonsToggle(true);
            _this5.centerPolygons(_this5.commonService.session.style.widgets['polygons-foci']);
            console.log('twod 11 polygons color show: ', _this5.commonService.session.style.widgets['polygons-color-show']);
            if (_this5.commonService.session.style.widgets['polygons-color-show']) {
              _this5.commonService.session.style.widgets['polygon-color-table-visible'] = true;
              _this5.onPolygonColorTableChange(true);
              // this.polygonColorsToggle(this.widgets['polygon-color-table-visible'])
              // this.updateGroupNodeColors();
              console.log('twod 2polygons show: ', _this5.commonService.session.style.widgets['polygon-color-table-visible']);
            }
          }
          // Mark as rendered
          _this5.store.setNetworkRendered(true);
          _this5.store.setNetworkUpdated(false);
          _this5.commonService.session.network.rendering = false;
          _this5.commonService.demoNetworkRendered = true;
        });
        // Run the layout
        // @ts-ignore
        _this5.cy.layout({
          name: 'preset',
          animate: 'end'
        }).run();
      }
      console.log('--- TwoD DATA network rerender complete');
    })();
  }
  ensurePolygon(updateLayout = true) {
    if (this.commonService.session.style.widgets['polygons-show']) {
      this.polygonsToggle(true);
      this.centerPolygons(this.commonService.session.style.widgets['polygons-foci'], updateLayout);
      this.cy.nodes().forEach(node => {
        if (node.classes().includes('parent')) {
          let numVisibleChildren = node.children().filter(child => child.visible()).length;
          if (numVisibleChildren === 0) {
            node.addClass('hidden'); // Hide parent nodes if needed
          }
        }
      });
      this.openCenter();
    }
  }
  getNodeShape(node) {
    //* Shapes:
    let symbolVariable = this.widgets['node-symbol-variable'];
    if (symbolVariable == "None") {
      // console.log('node symbol: ', this.selectedNodeShape);
      return this.selectedNodeShape;
      // return this.widgets['node-symbol-variable'];
    } else {
      let type = this.commonService.temp.style.nodeSymbolMap(node[symbolVariable]);
      return type;
    }
  }
  /**
   * Updates the appropriate widget value and then updates the 'polygon-color' or 'node-shape' table
   * @param table 'polygon-color' or 'node-shape'
   * @param column 'tableCouts' or 'tableFreq'
  */
  toggleTableColumns(table, column) {
    if (table == 'node-shape' && column == 'tableCounts') {
      this.widgets['node-symbol-table-counts'] = !this.widgets['node-symbol-table-counts'];
    } else if (table == 'node-shape' && column == 'tableFreq') {
      this.widgets['node-symbol-table-frequencies'] = !this.widgets['node-symbol-table-frequencies'];
    } else if (table == 'polygon-color' && column == 'tableCounts') {
      this.widgets['polygon-color-table-counts'] = !this.widgets['polygon-color-table-counts'];
    } else if (table == 'polygon-color' && column == 'tableFreq') {
      this.widgets['polygon-color-table-frequencies'] = !this.widgets['polygon-color-table-frequencies'];
    } else {
      return;
    }
    if (table == 'polygon-color') {
      this.updateCountFreqTable(table);
    }
  }
  /**
   * Toggles the setting menu for polygon-color or node-shape table. This menu allow users to show/hide counts and/or frequencies
   * @param tableName 'polygon-color' or 'node-shape'
   */
  toggleColorTableSettings(tableName) {
    let settingsPane;
    if (tableName == 'node-shape') {
      settingsPane = $('#nodeShapeTableSettings');
    } else if (tableName == 'polygon-color') {
      settingsPane = $('#polygonColorTableSettings');
    } else {
      return;
    }
    if (settingsPane.css('display') == 'none') {
      settingsPane.css('display', 'block');
    } else {
      settingsPane.css('display', 'none');
    }
  }
  /**
  * Updates the polygon-color-table based on value of widgets; it doesn't recalculate anything; just shows/hide columns (No longer need for node shape table)
  * @param tableName 'polygon-color'
  */
  updateCountFreqTable(tableName) {
    let tableReferenceName, showCount, showFreq;
    if (tableName == 'polygon-color') {
      tableReferenceName = '#polygon-color-table-wrapper';
      showCount = this.widgets['polygon-color-table-counts'];
      showFreq = this.widgets['polygon-color-table-frequencies'];
    }
    const countColumn = $(tableReferenceName + ' .tableCount');
    const freqColumn = $(tableReferenceName + ' .tableFrequency');
    console.log(showCount, showFreq, countColumn, freqColumn);
    showCount ? countColumn.slideDown() : countColumn.slideUp();
    showFreq ? freqColumn.slideDown() : freqColumn.slideUp();
  }
  /**
   * Updates node-symbol widget and redraws nodes
   */
  onNodeSymbolChange(e) {
    this.widgets['node-symbol'] = e;
  }
  /**
   * Sets whether node symbol table is visible or not
   * @param e 'Show' or 'Hide'
   */
  onNodeSymbolTableChange(e) {
    this.SelectedNetworkTableTypeVariable = e;
    this.widgets["node-symbol-table-visible"] = this.SelectedNetworkTableTypeVariable;
    if (this.SelectedNetworkTableTypeVariable == "Show") {
      this.NodeSymbolTableWrapperDialogSettings.setVisibility(true);
    } else {
      this.NodeSymbolTableWrapperDialogSettings.setVisibility(false);
    }
  }
  /**
   * Updates link-tooltip-variable and SelectedLinkTooltipVariable to update what tooltip displays for links
   */
  onLinkTooltipVariableChange(e) {
    if (!Array.isArray(e)) {
      e = [e];
    }
    e = e.filter(item => item !== 'None');
    this.widgets['link-tooltip-variable'] = e;
    this.SelectedLinkTooltipVariable = this.widgets['link-tooltip-variable'];
  }
  /**
   * Updates link-label-variable widget and link labels
   */
  onLinkLabelVariableChange(e) {
    let label = e;
    this.widgets['link-label-variable'] = label;
    if (!this.cy) return;
    this.cy.edges().forEach(edge => {
      const newLabel = this.getLinkLabel(edge.data()).text;
      edge.data('label', newLabel);
    });
  }
  /**
   * Updates link-label-decimal-length widget and updates label with updated number of decimal points
   */
  onLinkDecimalVariableChange(e) {
    this.widgets['link-label-decimal-length'] = e;
    if (!this.cy) return;
    this.cy.edges().forEach(edge => {
      const newLabel = this.getLinkLabel(edge.data()).text;
      edge.data('label', newLabel);
    });
  }
  /**
   * Updates link-opacity widget and the opacity for all links
   */
  onLinkOpacityChange(e) {
    this.widgets['link-opacity'] = e;
    this.overideTransparency = true;
    this.updateLinkColor();
    this.overideTransparency = false;
  }
  updateLinkWidthRows(e) {
    if (e == 'None') {
      setTimeout(() => {
        $('#link-reciprocalthickness-row').slideUp();
        $('#link-max-width-row').slideUp();
        $('#link-min-width-row').slideUp();
        $('#link-width-row').slideDown();
      }, 5);
    } else {
      setTimeout(() => {
        $('#link-reciprocalthickness-row').css('display', 'flex');
        $('#link-max-width-row').css('display', 'flex');
        $('#link-min-width-row').css('display', 'flex');
        $('#link-width-row').slideUp();
      }, 5);
    }
  }
  /**
   * Updates link-width-variable widget and updates link width; Also cause min, max and reciprocal link width row to appear/disappear
   */
  onLinkWidthVariableChange(e) {
    this.updateLinkWidthRows(e);
    this.widgets['link-width-variable'] = e;
    this.updateMinMaxLink();
    this.scaleLinkWidth();
  }
  updateMinMaxNode() {
    this.visNodes = this.commonService.getVisibleNodes();
    let n = this.visNodes.length;
    let maxWidth = this.widgets['node-radius-max'];
    let minWidth = this.widgets['node-radius-min'];
    let sizeVariable = this.widgets['node-radius-variable'];
    this.nodeMin = Number.MAX_VALUE;
    this.nodeMax = Number.MIN_VALUE;
    for (let i = 0; i < n; i++) {
      let size = this.visNodes[i][sizeVariable];
      if (typeof size == 'undefined') continue;
      if (size < this.nodeMin) this.nodeMin = size;
      if (size > this.nodeMax) this.nodeMax = size;
    }
    this.nodeMid = (this.nodeMax - this.nodeMin) / 2;
    this.nodeScale = d3__WEBPACK_IMPORTED_MODULE_4__.scaleLinear().domain([this.nodeMin, this.nodeMax]).range([minWidth, maxWidth]);
  }
  updateMinMaxLink() {
    let maxWidth = this.widgets['link-width-max'];
    if (maxWidth == 'None') {
      this.widgets['link-width-max'] = 15;
      maxWidth = 15;
    }
    let minWidth = this.widgets['link-width-min'];
    if (minWidth == 'None') {
      this.widgets['link-width-min'] = 0;
      minWidth = 0;
    }
    let variable = this.widgets['link-width-variable'];
    this.visLinks = this.getVLinks();
    let n = this.visLinks.length;
    this.linkMax = -Infinity;
    this.linkMin = Infinity;
    for (let i = 0; i < n; i++) {
      const link = this.visLinks[i];
      // Check if the link has a distanceOrigin and if it's not included in origin array
      let value = 0;
      if (link.distanceOrigin && link.origin.includes(link.distanceOrigin)) {
        value = link[variable];
      }
      // Skip if value is not a number
      if (!this.isNumber(value)) continue;
      // Update min and max
      if (value > this.linkMax) this.linkMax = value;
      if (value < this.linkMin) this.linkMin = value;
    }
    this.linkScale = d3__WEBPACK_IMPORTED_MODULE_4__.scaleLinear().domain([this.linkMin, this.linkMax]).range([minWidth, maxWidth]);
  }
  /**
   * Updates link-width-reciprocal widget and updates link width
   * This widget controls whether to set width smallest -> largest or largest -> smallest
   */
  onLinkWidthReciprocalNonReciprocalChange(e) {
    if (e == "Reciprocal") {
      this.widgets['link-width-reciprocal'] = true;
      this.scaleLinkWidth();
    } else {
      this.widgets['link-width-reciprocal'] = false;
      this.scaleLinkWidth();
    }
  }
  /**
   * Updates link-width widget and link width
   */
  onLinkWidthChange(e) {
    this.widgets['link-width'] = e;
    this.scaleLinkWidth();
  }
  /**
   * Updates link-width-max widget and link width
   */
  onLinkWidthMaxChange(e) {
    this.widgets['link-width-max'] = e;
    this.updateMinMaxLink();
    this.scaleLinkWidth();
  }
  /**
   * Updates link-width-min widget and link width
   */
  onLinkWidthMinChange(e) {
    this.widgets['link-width-min'] = e;
    this.updateMinMaxLink();
    this.scaleLinkWidth();
  }
  /**
   * Updates link-length widget and link force distance
   */
  onLinkLengthChange(e) {
    // this.force.force('link').distance(e);
    // this.force.alpha(0.3).alphaTarget(0).restart();
    this.widgets['link-length'] = e;
  }
  /**
   * Updates link-directed widget. When directed, links have an arrow added; when undirected, links have no arrow
   */
  onLinkDirectedUndirectedChange(e) {
    if (e === "Show") {
      $('#link-bidirectional-row').slideDown().css('display', 'flex');
      this.widgets['link-directed'] = true;
    } else {
      this.widgets['link-directed'] = false;
      $("#link-bidirectional-row").slideUp();
    }
    // Update Cytoscape edge styles
    if (this.cy) {
      const isDirected = this.widgets['link-directed'];
      this.cy.style().selector('edge').style({
        'target-arrow-shape': this.widgets['link-directed'] ? 'triangle' : 'none',
        'source-arrow-shape': 'none',
        // Ensure source arrow is hidden when undirected
        'curve-style': isDirected ? 'unbundled-bezier' : 'straight'
        // Add more style properties here if needed
      }).update();
    }
  }
  onLinkBidirectionalChange(e) {
    // Determine the arrow shapes based on the selected option
    const sourceArrowShape = e === "Show" ? 'triangle' : 'none';
    const targetArrowShape = 'triangle'; // Assuming target arrows are always shown
    // Update the widget state
    this.widgets['link-bidirectional'] = e === "Show";
    // Update Cytoscape edge styles
    if (this.cy) {
      const isDirected = this.widgets['link-directed'];
      this.cy.style().selector('edge').style({
        'source-arrow-shape': sourceArrowShape,
        'target-arrow-shape': targetArrowShape,
        'curve-style': isDirected ? 'unbundled-bezier' : 'straight'
        // Add more style properties here if needed
      }).update();
    }
  }
  /**
   * Updates node-highlight widget. When true and a node is mouseoved current node, all it of links, and neighbor nodes will be highlighted
   */
  onDontHighlightNeighborsHighlightNeighborsChange(e) {
    if (e == "Normal") {
      this.widgets['node-highlight'] = false;
    } else {
      this.widgets['node-highlight'] = true;
    }
  }
  /**
   * Calculates the minimum and maximum values for the selected link-width variable.
   */
  calculateLinkWidthScale() {
    const variable = this.widgets['link-width-variable'];
    if (variable === 'None') {
      // No scaling needed
      return null;
    }
    const vlinks = this.commonService.getVisibleLinks(true).filter(link => {
      console.log("link", link);
      console.log("variable", variable);
      console.log("value", link[variable]);
      const value = link[variable];
      if (variable == 'distance' && link.distanceOrigin && !link.origin.includes(link.distanceOrigin)) {
        return false;
      }
      return this.isNumber(value) || !this.isNumber(value) && !isNaN(Number(value));
    });
    if (vlinks.length === 0) {
      console.warn('No valid link-width data available for scaling.');
      return null;
    }
    const values = vlinks.map(link => link[variable]);
    const min = Math.min(...values);
    const max = Math.max(...values);
    return {
      min,
      max
    };
  }
  /**
   * Creates a linear scale based on the widget settings and data range.
   * @param value The value to scale.
   * @param dataMin Minimum value of the data.
   * @param dataMax Maximum value of the data.
   * @param minWidth Minimum width for links.
   * @param maxWidth Maximum width for links.
   * @param reciprocal Whether to invert the scale.
   * @returns The scaled width.
   */
  linearScale(value, dataMin, dataMax, minWidth, maxWidth, reciprocal) {
    if (dataMax === dataMin) {
      // Avoid division by zero; return average width
      return (minWidth + maxWidth) / 2;
    }
    let scaledValue = (value - dataMin) / (dataMax - dataMin);
    if (reciprocal) {
      scaledValue = 1 - scaledValue;
    }
    return scaledValue * (maxWidth - minWidth) + minWidth;
  }
  /**
   * Take input from 2D Networks settings dialog box from template and update the widget and show/hides gridlines
   * @param e string either 'Show' or 'Hide'
   */
  onNetworkGridlinesShowHideChange(e) {
    if (e === "Show") {
      this.widgets['network-gridlines-show'] = true;
    } else {
      this.widgets['network-gridlines-show'] = false;
    }
  }
  /**
   * Changes value of charge force (d3.many-body-force). Sets charge to -e meaning each node will repell every other node
   * @param {number} e value from 0-400
   */
  onNodeChargeChange(e) {
    // this.force.force('charge').strength(-e);
    // this.force.alpha(0.3).alphaTarget(0).restart();
    this.widgets['node-charge'] = e;
  }
  /**
   * Changes value of gravity force (d3-force-attract) which pulls nodes to the center. Sets strength e
   * @param {number} e value from 0.025-1
   */
  onNetworkGravityChange(e) {
    // this.force.force('gravity').strength(e);
    // this.force.alpha(0.3).alphaTarget(0).restart();
    this.widgets['network-gravity'] = e;
  }
  /**
   * Changes value of velocityDecay (d3 velocityDecay). Sets too low causing network to oscillate
   * @param {number} e value from 0-1 (default 0.4)
   */
  onNetworkFrictionChange(e) {
    // this.force.velocityDecay(e);
    // this.force.alpha(0.3).alphaTarget(0).restart();
    this.widgets['network-friction'] = e;
  }
  /**
   * Changes value of network-link-strength (d3.forceLink) which pulls the pair of nodes together
   * @param {number} e value from 0-1 (default 0.4)
   */
  onNetworkLinkStrengthVariableChange(e) {
    //console.log('st change: ', e);
    let v = parseFloat(e);
    // this.force.force('link').strength(v);
    // this.force.alpha(0.3).alphaTarget(0).restart();
    this.widgets['network-link-strength'] = e;
  }
  /**
   * Updates the color of nodes and transparency based on node-color-variable, the value from nodeColorMap and nodeAlphaMap, and whether the node is selected
   */
  updateNodeColors() {
    if (!this.cy) return;
    let variable = this.widgets['node-color-variable'];
    let color = this.widgets['node-color'];
    let stroke = this.widgets['selected-node-stroke-color'];
    let stroke_width = parseInt(this.widgets['selected-node-stroke-width']);
    if (variable == 'None') {
      this.data.nodes.forEach(x => {
        x.color = color;
      });
    } else {
      this.data.nodes.forEach((x, index) => {
        x.color = this.commonService.temp.style.nodeColorMap(this.commonService.session.data.nodes[index][variable]);
      });
    }
    this.cy.nodes().forEach(node => {
      const [newColor, opacity] = this.getNodeColor(node.data());
      node.data('nodeColor', newColor);
      node.data('bgOpacity', opacity);
      node.data('borderColor', newColor);
    });
    this.cy.style().update(); // Refresh Cytoscape styles to apply changes
  }
  /**
   * Updates the width of the links using link-width, link-width-variable, link-width-max, link-width-min, and link-width-reciprocal
   */
  /**
  * Scales link widths based on the selected variable and updates Cytoscape styles.
  */
  scaleLinkWidth() {
    const variable = this.widgets['link-width-variable'];
    if (!this.cy) return;
    if (variable === 'None') {
      // Apply a default width to all links
      this.cy.style().selector('edge').style({
        'width': this.widgets['link-width']
      }).update();
      return;
    }
    const scaleValues = this.calculateLinkWidthScale();
    if (!scaleValues) {
      // If scaling isn't applicable, set a default width
      this.cy.style().selector('edge').style({
        'width': this.widgets['link-width']
      }).update();
      return;
    }
    const {
      min,
      max
    } = scaleValues;
    //     let vlinks = this.getVLinks();
    //     if (variable == 'None') return  scalar;
    //     let n = vlinks.length;
    const maxWidth = this.widgets['link-width-max'];
    const minWidth = this.widgets['link-width-min'];
    const reciprocal = this.widgets['link-width-reciprocal'];
    // Iterate over each edge and set the scaled width
    this.cy.edges().forEach(edge => {
      let dataValue = edge.data(variable);
      if (variable == 'distance' && edge.data('distanceOrigin') && !edge.data('origin').includes(edge.data('distanceOrigin'))) {
        dataValue = 0;
      }
      if (this.isNumber(dataValue)) {
        const scaledWidth = this.linearScale(dataValue, min, max, minWidth, maxWidth, reciprocal);
        edge.data('scaledWidth', scaledWidth);
      } else {
        // Handle non-numeric values if necessary
        edge.data('scaledWidth', minWidth);
      }
    });
    // Update Cytoscape stylesheet to use the scaledWidth data
    this.cy.style().selector('edge').style({
      'width': 'data(scaledWidth)'
    }).update();
  }
  /**
   * centers the view
   */
  fit() {
    if (this.cy) this.cy.fit(this.cy.nodes(), 30);
  }
  /**
   * XXXXX Function is never called; Review if necessary XXXXX
   * @param nodeData
   * @returns
   */
  isFiltered(nodeData) {
    if (nodeData) {
      return this.commonService.session.data.nodeFilteredValues.find(x => x.index === nodeData.index) !== undefined;
    }
    return true;
  }
  /**
   * On click of settings button, show/hide settings dialog
   */
  openSettings() {
    this.Node2DNetworkExportDialogSettings.isVisible ? this.Node2DNetworkExportDialogSettings.setVisibility(false) : this.Node2DNetworkExportDialogSettings.setVisibility(true);
    this.ShowStatistics = !this.Show2DSettingsPane;
    this.updateLinkWidthRows(this.SelectedLinkWidthByVariable);
  }
  /**
   * Updates ShowStatistics variables to opposite of current value
   *
   * XXXXX Not currently executed; reevaluate if this function is needed XXXXX
   */
  enableSettings() {
    this.ShowStatistics = !this.ShowStatistics;
    this.cdref.detectChanges();
  }
  /**
   * On click of export button, show export dialog
   */
  openExport() {
    this.isExportClosed = false;
    this.Show2DExportPane = true;
    this.updateCalculatedResolution();
  }
  /**
   * On click of center button, show centers the view
   */
  openCenter() {
    if (this.cy) {
      this.cy.fit(this.cy.nodes(), 30);
    } else {
      console.error('Cytoscape instance is not initialized.');
    }
  }
  /**
   * XXXXX empty function; may be added later XXXXX
   */
  onRecallSession() {
    //this.loadSettings();
  }
  openRefreshScreen() {
    this.loadSettings();
    setTimeout(this.fit, 2000);
  }
  /**
   * renders the network
   */
  updateVisualization() {
    console.log('updateVisualization');
    this._rerender();
    if (this.SelectedNodeLabelVariable != 'None') {
      this.updateNodeLabels();
    }
  }
  /**
  * Synchronizes current Cytoscape instance with new data (adds/removes/updates
  * nodes and links) instead of completely rerendering.
  */
  _partialUpdate() {
    var _this6 = this;
    return (0,_Users_evanmoscoso_Desktop_EvanGit_MicrobeTrace_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_0__["default"])(function* () {
      console.log('--- TwoD _partialUpdate called');
      if (!_this6.cy) {
        console.error('Cytoscape instance not initialized; cannot update partially.');
        return;
      }
      // Cache positions BEFORE making changes to the graph
      if (!_this6.nodePositions) {
        _this6.nodePositions = new Map();
      }
      _this6.cy.nodes().forEach(node => {
        const currentPosition = node.position();
        if (!_this6.nodePositions.has(node.id())) {
          _this6.nodePositions.set(node.id(), currentPosition); // Cache position
        }
      });
      // Retrieve fresh node/link data
      const networkData = {
        nodes: _this6.commonService.getVisibleNodes(),
        links: _this6.commonService.getVisibleLinks()
      };
      const {
        nodes: laidOutNodes,
        links: laidOutLinks
      } = yield _this6.precomputePositionsWithD3(networkData.nodes, networkData.links, 30, false);
      networkData.nodes = laidOutNodes;
      networkData.links = laidOutLinks;
      // Use batch mode to disable auto-panning during updates
      _this6.cy.batch(() => {
        networkData.nodes.forEach(node => {
          node.id = node._id.toString();
        });
        networkData.links.forEach((link, i) => {
          // Set a unique link id if desired
          //link.id =  i.toString();  // or link.index.toString()
          // If link.source is an object, grab its _id and convert to string
          if (typeof link.source === 'object') {
            link.source = link.source._id.toString();
          }
          // Same for link.target
          if (typeof link.target === 'object') {
            link.target = link.target._id.toString();
          }
        });
        const nodeIds = new Set(networkData.nodes.map(n => n.id));
        networkData.links.forEach(link => {
          if (!nodeIds.has(link.source)) {
            console.warn('Link source not found in nodes:', link.source, link);
          }
          if (!nodeIds.has(link.target)) {
            console.warn('Link target not found in nodes:', link.target, link);
          }
        });
        console.log('--- TwoDComponent _partialUpdate called:  ', networkData.links);
        _this6.data = _this6.commonService.convertToGraphDataArray(networkData);
        const newElements = _this6.mapDataToCytoscapeElements(_this6.data);
        // Collect new IDs for membership checks
        const newNodeIds = new Set(newElements.nodes.map(n => n.data.id));
        // @ts-ignore
        const newLinkIds = new Set(newElements.edges.map(l => l.data.id));
        // Update node visibility and restore positions
        _this6.cy.nodes().forEach(node => {
          if (!newNodeIds.has(node.id()) && !node.hasClass('parent')) {
            // Hide node but keep its cached position
            node.addClass('hidden');
          } else {
            // Ensure node is visible
            node.removeClass('hidden');
            // Restore position from cache
            const newNode = newElements.nodes.find(n => n.data.id === node.id());
            if (newNode) {
              node.data({
                ...node.data(),
                ...newNode.data
              });
              node.position({
                x: newNode.data.x,
                y: newNode.data.y
              }); // Restore position
            }
          }
        });
        // Remove old edges
        _this6.cy.edges().forEach(edge => {
          if (!newLinkIds.has(edge.id())) {
            _this6.cy.remove(edge);
          }
        });
        const linkMap = new Map(networkData.links.map(l => [l.id, l]));
        // Add/Update new edges
        newElements.edges.forEach(e => {
          const cyEdge = _this6.cy.getElementById(e.data.id);
          if (!cyEdge || !cyEdge.length) {
            _this6.cy.add(e); // Add edge
          } else {
            cyEdge.data({
              ...cyEdge.data(),
              ...e.data
            }); // Update edge data
          }
          // Ensure label is updated based on filtered link data
          const data = linkMap.get(cyEdge.id());
          const labelVal = _this6.getLinkLabel(data).text;
          cyEdge.data('label', labelVal ?? "");
        });
        console.log('----DUo Edge2: ', newElements.edges.filter(edge => edge.data.source === 'MZ745515' && edge.data.target === 'MZ712879' || edge.data.source === 'MZ712879' && edge.data.target === 'MZ745515'));
        // console.log('----newedges: ', _.cloneDeep(newElements.edges));
      });
      // Restore positions for all visible nodes explicitly
      // this.cy.nodes(':visible').forEach(node => {
      //     const position = this.nodePositions.get(node.id());
      //     if (position) {
      //         node.position({x: position.x, y: position.y });
      //     }
      // });
      _this6.fit();
      // Set rendered to true now that network has rendered
      _this6.store.setNetworkRendered(true);
      // Now we can set network update to false after its been updated fully
      _this6.store.setNetworkUpdated(false);
      _this6.commonService.session.network.rendering = false;
    })();
  }
  applyStyleFileSettings() {
    this.widgets = this.commonService.session.style.widgets;
    this.loadSettings();
    this._partialUpdate();
  }
  ngOnDestroy() {
    console.log("calling destroy");
    this.destroy$.next();
    this.destroy$.complete();
    this.styleFileSub.unsubscribe();
    this.settingsLoadedSubscription.unsubscribe();
    if (this.cy) {
      this.cy.removeAllListeners();
      this.cy.destroy();
    }
    this.cyContainer = null;
  }
  /**
   * renders the network
   */
  onLoadNewData() {
    if (this.debugMode) {
      console.log('render new data');
    }
    console.log('onLoadNewData');
    // this.debouncedRerender();
  }
  /**
   * renders the network; sets this.showStatistics to false
   */
  onFilterDataChange() {
    if (this.debugMode) {
      console.log('render filter change');
    }
    console.log('onFilterDataChange');
    // render doesn't do anything unless this.isLoading == true; so need to ensure that before call render
    this.debouncedRerender();
  }
  /**
   * Sets twoD component variable based on the value in the appropriate widget and then calls appropriate function to update the view
   *
   * XXXXX this function should probably be reevaluated/refacted as well because sections of code are being evaluated multiple times
   * (ie. onPolygonLabelVariableChange, onPolygonLabelVariableChange, onPolygonLabelOrientationChange all call redrawPolygonLabels) XXXXX
   */
  loadSettings() {
    //Polygons|Label Size
    this.SelectedPolygonLabelSizeVariable = this.widgets['polygons-label-size'];
    this.onPolygonLabelSizeChange(this.SelectedPolygonLabelSizeVariable);
    //Node|Orientation
    this.SelectedPolygonLabelOrientationVariable = this.widgets['polygon-label-orientation'];
    this.onPolygonLabelOrientationChange(this.SelectedPolygonLabelOrientationVariable);
    this.polygonsToggle(this.widgets['polygons-show']);
    if (this.commonService.session.style.widgets['polygons-show']) {
      this.updatePolygonColors();
      this.polygonColorsToggle(this.commonService.session.style.widgets['polygon-color-table-visible']);
      this.updateGroupNodeColors();
    }
    //Nodes|Label
    this.SelectedNodeLabelVariable = this.widgets['node-label-variable'];
    console.log('----TWOD SelectedNodeLabelVariable: ', this.SelectedNodeLabelVariable);
    this.onNodeLabelVaribleChange(this.SelectedNodeLabelVariable);
    //Node|Label Size
    this.SelectedNodeLabelSizeVariable = this.widgets['node-label-size'];
    this.setNodeLabelSize(this.SelectedNodeLabelSizeVariable);
    if (!Array.isArray(this.widgets['node-tooltip-variable'])) {
      this.widgets['node-tooltip-variable'] = [this.widgets['node-tooltip-variable']];
    }
    this.SelectedNodeTooltipVariable = this.widgets['node-tooltip-variable'];
    this.onNodeTooltipVariableChange(this.SelectedNodeTooltipVariable);
    //Nodes|Shape By Table
    if (this.widgets['node-symbol-variable'] != undefined && this.widgets['node-symbol-variable'] != 'None') {
      this.widgets["node-symbol-table-visible"] = 'Show';
    }
    this.SelectedNetworkTableTypeVariable = this.widgets["node-symbol-table-visible"];
    this.onNodeSymbolTableChange(this.SelectedNetworkTableTypeVariable);
    //Nodes|Shape By
    this.SelectedNodeSymbolVariable = this.widgets['node-symbol-variable'];
    this.onNodeSymbolVariableChange(this.widgets['node-symbol-variable'], this.SelectedNetworkTableTypeVariable === "Show");
    //Nodes|Shape
    this.widgets['node-symbol'] = this.mapPreviousShapeNameToCurrent(this.widgets['node-symbol']);
    this.SelectedNodeShapeVariable = this.widgets['node-symbol'];
    this.onNodeSymbolChange(this.SelectedNodeShapeVariable);
    //Nodes|Size By
    this.SelectedNodeRadiusVariable = this.widgets['node-radius-variable'];
    this.onNodeRadiusVariableChange(this.SelectedNodeRadiusVariable);
    //Nodes|Size
    if (Number(this.widgets['node-radius']) > 100 || Number(this.widgets['node-radius']) < 0) {
      this.widgets['node-radius'] = 20;
    }
    this.SelectedNodeRadiusSizeVariable = this.widgets['node-radius'].toString();
    this.onNodeRadiusChange(this.SelectedNodeRadiusSizeVariable);
    this.nodeBorderWidth = this.widgets['node-border-width'];
    //Links|Tooltip
    this.SelectedLinkTooltipVariable = this.widgets['link-tooltip-variable'];
    this.onLinkTooltipVariableChange(this.SelectedLinkTooltipVariable);
    //Links|Label
    this.SelectedLinkLabelVariable = this.widgets['link-label-variable'];
    this.onLinkLabelVariableChange(this.SelectedLinkLabelVariable);
    //Links|Decimal Length
    this.SelectedLinkDecimalVariable = this.widgets['link-label-decimal-length'];
    this.onLinkDecimalVariableChange(this.SelectedLinkDecimalVariable);
    //Links|Transparency
    this.SelectedLinkTransparencyVariable = this.widgets['link-opacity'];
    this.onLinkOpacityChange(this.SelectedLinkTransparencyVariable);
    //Links|Width By
    this.SelectedLinkWidthByVariable = this.widgets['link-width-variable'];
    this.onLinkWidthVariableChange(this.SelectedLinkWidthByVariable);
    //Links|Reciprical
    this.SelectedLinkReciprocalTypeVariable = this.widgets['link-width-reciprocal'] ? "Reciprocal" : "Non-Reciprocal";
    this.onLinkWidthReciprocalNonReciprocalChange(this.SelectedLinkReciprocalTypeVariable);
    //Links|Width
    this.SelectedLinkWidthVariable = this.widgets['link-width'];
    this.onLinkWidthChange(this.SelectedLinkWidthVariable);
    //Links|Width Max
    this.SelectedLinkWidthMax = this.widgets['link-width-max'];
    this.onLinkWidthMaxChange(this.SelectedLinkWidthMax);
    //Links|Width Min
    this.SelectedLinkWidthMin = this.widgets['link-width-min'];
    this.onLinkWidthMinChange(this.SelectedLinkWidthMin);
    //Links|Length
    this.SelectedLinkLengthVariable = this.widgets['link-length'];
    this.onLinkLengthChange(this.SelectedLinkLengthVariable);
    //Links|Arrows
    this.SelectedLinkArrowTypeVariable = this.widgets['link-directed'] ? "Show" : "Hide";
    this.onLinkDirectedUndirectedChange(this.SelectedLinkArrowTypeVariable);
    //Network|Neighbors
    this.SelectedNetworkNeighborTypeVariable = this.widgets['node-highlight'] ? "Highlighted" : "Normal";
    this.onDontHighlightNeighborsHighlightNeighborsChange(this.SelectedNetworkNeighborTypeVariable);
    //Network|Gridlines
    this.SelectedNetworkGridLineTypeVariable = this.widgets['network-gridlines-show'] ? "Show" : "Hide";
    this.onNetworkGridlinesShowHideChange(this.SelectedNetworkGridLineTypeVariable);
    //Network|Link Strength
    this.SelecetedNetworkLinkStrengthVariable = this.widgets['network-link-strength'];
    this.onNetworkFrictionChange(this.SelecetedNetworkLinkStrengthVariable);
    // Ensure proper orientation is set
    if (this.widgets['polygon-label-orientation'] !== 'top' || this.widgets['polygon-label-orientation'] !== 'bottom' || this.widgets['polygon-label-orientation'] !== 'middle') {
      this.widgets['polygon-label-orientation'] = 'top';
    }
    //Network|Polygon Orientation
    this.SelectedPolygonLabelOrientationVariable = this.widgets['polygon-label-orientation'];
    this.onPolygonLabelOrientationChange(this.SelectedPolygonLabelOrientationVariable);
  }
  /**
   * Updates the sizes of all nodes based on the current widget settings.
   */
  updateLinkColor() {
    console.log('----TWOD updateLinkColor called');
    if (!this.cy) return;
    this.cy.edges().forEach(link => {
      const {
        color,
        opacity
      } = this.getLinkColor(link.data());
      link.data('lineColor', color);
      link.data('lineOpacity', opacity); // Ensure transparency is explicitly set
    });
    // this.cy.style().update(); // Refresh Cytoscape styles to apply changes
  }
  /**
   * Updates the sizes of all nodes based on the current widget settings.
   */
  updateNodeSizes() {
    if (!this.cy) return;
    this.cy.nodes().forEach(node => {
      const newSize = Number(this.getNodeSize(node.data()));
      node.data('nodeSize', newSize);
    });
    this.cy.style().update(); // Refresh Cytoscape styles to apply changes
  }
  /**
  * Updates the border widths of all nodes based on the current widget settings.
  */
  updateNodeBorders() {
    if (!this.cy) return;
    this.cy.nodes().forEach(node => {
      const newBorderWidth = this.getNodeBorderWidth(node.data());
      node.data('borderWidth', newBorderWidth);
    });
    this.cy.style().update(); // Refresh Cytoscape styles to apply changes
  }
  /**
   * Updates the labels of all nodes based on the current widget settings.
   */
  updateNodeLabels() {
    console.log('----TWOD updateNodeLabels called');
    if (!this.cy) return;
    this.cy.nodes().forEach(node => {
      if (node.children().length > 0) return; // Skip parent nodes
      const newLabel = this.getNodeLabel(node.data());
      node.data('label', newLabel);
    });
    console.log('--- TwoDComponent updateNodeLabels ended ');
    this.cy.style().update(); // Refresh Cytoscape styles to apply changes
  }
  /**
   * Updates the labels of all nodes based on the current widget settings.
   */
  updateLinkWidths() {
    this.cy.edges().forEach(edge => {
      const newWidth = this.getLinkWidth(edge.data());
      edge.data('width', newWidth);
    });
    // this.cy.style().update(); // Refresh Cytoscape styles to apply changes
  }
  /**
   * Updates the font sizes of all node labels based on the current widget settings.
   */
  updateNodeLabelSizes() {
    if (!this.cy) return;
    this.cy.nodes().forEach(node => {
      const newFontSize = this.getNodeFontSize(node.data());
      node.data('fontSize', newFontSize);
    });
    this.cy.style().update(); // Refresh Cytoscape styles to apply changes
  }
  updateNodeShapes() {
    if (!this.cy) return;
    this.cy.nodes().forEach(node => {
      const newShape = this.getNodeShape(node.data());
      node.data('shape', newShape);
    });
    this.cy.style().update(); // Refresh Cytoscape styles to apply changes
  }
  /**
   * Handles changes to the node label widget.
   * @param e New label value from the widget.
   */
  onNodeLabelChange(e) {
    this.widgets['node-label'] = e;
    this.updateNodeLabels(); // Update labels without rerendering the entire network
  }
  /**
   * Handles changes to the node color widget.
   * @param e New color value from the widget.
   */
  onNodeColorChange(e) {
    console.log('node color changeddd');
    this.widgets['node-color'] = e;
    this.updateNodeColors(); // Update node colors without rerendering the entire network
  }
  /**
   * Retrieves the border width for a node based on current widget settings.
   * @param node The node data object.
   * @returns The border width.
   */
  getNodeBorderWidth(node) {
    return this.widgets['node-border-width'] || 2; // Default to 2 if not set
  }
  /**
   * Retrieves the font size for a node label based on current widget settings.
   * @param node The node data object.
   * @returns The font size in pixels.
   */
  getNodeFontSize(node) {
    return this.widgets['node-label-size'] || 12; // Default to 12px if not set
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.Injector
    }, {
      type: _angular_platform_browser__WEBPACK_IMPORTED_MODULE_16__.EventManager
    }, {
      type: _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService
    }, {
      type: golden_layout__WEBPACK_IMPORTED_MODULE_17__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_8__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.ElementRef
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.ChangeDetectorRef
    }, {
      type: _angular_cdk_clipboard__WEBPACK_IMPORTED_MODULE_18__.Clipboard
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_19__.GoogleTagManagerService
    }, {
      type: _app_contactTraceCommonServices_common_store_services__WEBPACK_IMPORTED_MODULE_11__.CommonStoreService
    }, {
      type: _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_12__.ExportService
    }];
  }
  static {
    this.propDecorators = {
      DisplayGlobalSettingsDialogEvent: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.Output
      }],
      cyContainer: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.ViewChild,
        args: ['cy', {
          static: false
        }]
      }],
      exportContainer: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.ViewChild,
        args: ['exportContainer']
      }],
      nodeSymbolTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.ViewChild,
        args: ['nodeSymbolTable']
      }],
      polygonColorTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.ViewChild,
        args: ['polygonColorTable']
      }],
      networkStatisticsTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_13__.ViewChild,
        args: ['networkStats']
      }]
    };
  }
};
TwoDComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_20__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_13__.Component)({
  selector: 'TwoDComponent',
  template: _twoD_plugin_component_html_ngResource__WEBPACK_IMPORTED_MODULE_1__,
  changeDetection: _angular_core__WEBPACK_IMPORTED_MODULE_13__.ChangeDetectionStrategy.OnPush,
  styles: [(_twoD_plugin_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_2___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_20__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_13__.Injector, _angular_platform_browser__WEBPACK_IMPORTED_MODULE_16__.EventManager, _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_3__.CommonService, golden_layout__WEBPACK_IMPORTED_MODULE_17__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_13__.ElementRef, _angular_core__WEBPACK_IMPORTED_MODULE_13__.ChangeDetectorRef, _angular_cdk_clipboard__WEBPACK_IMPORTED_MODULE_18__.Clipboard, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_19__.GoogleTagManagerService, _app_contactTraceCommonServices_common_store_services__WEBPACK_IMPORTED_MODULE_11__.CommonStoreService, _app_contactTraceCommonServices_export_service__WEBPACK_IMPORTED_MODULE_12__.ExportService])], TwoDComponent);

(function (TwoDComponent) {
  TwoDComponent.componentTypeName = '2D Network';
})(TwoDComponent || (TwoDComponent = {}));

/***/ }),

/***/ 75312:
/*!***********************************************************************************!*\
  !*** ./src/app/visualizationComponents/WaterfallComponent/waterfall.component.ts ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   WaterfallComponent: () => (/* binding */ WaterfallComponent)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _waterfall_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./waterfall.component.html?ngResource */ 19704);
/* harmony import */ var _waterfall_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./waterfall.component.scss?ngResource */ 16436);
/* harmony import */ var _waterfall_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_waterfall_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var golden_layout__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! golden-layout */ 41735);
/* harmony import */ var angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! angular-google-tag-manager */ 10409);
/* harmony import */ var _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../contactTraceCommonServices/common.service */ 42107);
/* harmony import */ var _app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @app/base-component.directive */ 18784);









let WaterfallComponent = class WaterfallComponent extends _app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__.BaseComponentDirective {
  constructor(container, elRef, commonService, gtmService) {
    super(elRef.nativeElement);
    this.container = container;
    this.commonService = commonService;
    this.gtmService = gtmService;
    this.scrollHeight = '800px';
    this.IsDataAvailable = true;
    this.metaDataToSkip = ['index', 'id', 'visible', 'degree', 'seq', 'cluster', 'directed', 'source', 'target'];
    this.expandedClusterRowData = [];
    this.expandedNodeRowData = [];
    this.expandedLinkRowData = [];
    this.commonService.visuals.waterfall = this;
  }
  ngOnInit() {
    this.gtmService.pushTag({
      event: "page_view",
      page_location: "/waterfall",
      page_title: "Waterfall View"
    });
    this.clusterTableData = [];
    this.nodeTableData = [];
    this.linkTableData = [];
    this.commonService.session.data.clusters.forEach(cl => {
      this.clusterTableData.push({
        'id': cl.id,
        'nodeCount': cl.nodes
      });
    });
    // TODO: XXX revisit; doesn't always do as expected when view is resized; also make sure height is correct (currently set to 800px static)
    this.container.on('resize', () => {
      this.updateTableWidths();
    });
  }
  ngAfterViewInit() {
    this.updateTableWidths();
  }
  updateTableWidths() {
    this.clusterTableWidth = this.clusterTable._totalTableWidth().reduce((total, current) => total += current, 0) - 28;
    this.nodeTableWidth = this.nodeTable._totalTableWidth().reduce((total, current) => total += current, 0) - 28;
    this.linkTableWidth = this.linkTable._totalTableWidth().reduce((total, current) => total += current, 0) - 28;
  }
  onClusterRowSelect(e) {
    let clusterID = e.data.id;
    this.nodeTableData = [];
    // why are these different and why is session.data.nodes and nodeFilteredValues wrong for degree? session.network.nodes might be correct for a different distance and isn't updated?
    // TODO: XXX need to update how degree is calculated so it's correct centrally instead of calculating here
    this.commonService.session.data.nodeFilteredValues.forEach(node => {
      //this.commonService.session.network.nodes.forEach(node => {
      if (node.cluster == clusterID) {
        let degreeCount = this.commonService.session.data.links.filter(link => {
          return link.visible && (link.source == node._id || link.target == node._id);
        }).length;
        if (node.index == 0) {
          console.log('here: ', node, degreeCount);
        }
        this.nodeTableData.push({
          'id': node._id,
          'degree': degreeCount
        });
      }
    });
    let cluster = this.commonService.session.data.clusters.find(cl => cl.id == clusterID);
    this.expandedClusterRowData = [];
    Object.keys(cluster).filter(k => !(this.metaDataToSkip.includes(k) || k.charAt(0) == '_' || typeof cluster[k] == 'object')).forEach(k => {
      let prop = this.commonService.titleize(k);
      this.expandedClusterRowData.push({
        'key': prop,
        'value': cluster[k]
      });
    });
    this.selectedNodeRow = null;
    this.selectedLinkRow = null;
    this.linkTableData = [];
    this.expandedNodeRowData = [];
    this.expandedLinkRowData = [];
  }
  onClusterRowUnselect() {
    this.selectedNodeRow = null;
    this.selectedLinkRow = null;
    this.nodeTableData = [];
    this.linkTableData = [];
    this.expandedClusterRowData = [];
    this.expandedNodeRowData = [];
    this.expandedLinkRowData = [];
  }
  onNodeRowSelect(e) {
    let node = e.data.id;
    this.linkTableData = [];
    this.commonService.session.data.links.forEach(link => {
      if (link.visible) {
        if (node) if (link.source == node) {
          this.linkTableData.push({
            'id': link.target,
            'distance': link.distance,
            'index': link.index
          });
        } else if (link.target == node) {
          this.linkTableData.push({
            'id': link.source,
            'distance': link.distance,
            'index': link.index
          });
        }
      }
    });
    let nodeData = this.commonService.getVisibleNodes().find(n => n._id == node);
    this.expandedNodeRowData = [];
    Object.keys(nodeData).filter(k => !(this.metaDataToSkip.includes(k) || k.charAt(0) == '_' || typeof nodeData[k] == 'object')).forEach(k => {
      let prop = this.commonService.titleize(k);
      this.expandedNodeRowData.push({
        'key': prop,
        'value': nodeData[k]
      });
    });
    this.selectedLinkRow = null;
    this.expandedLinkRowData = [];
  }
  onNodeRowUnselect() {
    this.linkTableData = [];
    this.selectedLinkRow = null;
    this.expandedNodeRowData = [];
    this.expandedLinkRowData = [];
  }
  onLinkRowSelect(e) {
    let linkIndex = e.data.index;
    let linkData = this.commonService.session.data.links.find(l => l.index == linkIndex);
    this.expandedLinkRowData = [];
    Object.keys(linkData).filter(k => !(this.metaDataToSkip.includes(k) || k.charAt(0) == '_' || typeof linkData[k] == 'object')).forEach(k => {
      let prop = this.commonService.titleize(k);
      this.expandedLinkRowData.push({
        'key': prop,
        'value': linkData[k]
      });
    });
  }
  onLinkRowUnselect() {
    this.expandedLinkRowData = [];
  }
  updateNodeColors() {}
  updateVisualization() {}
  applyStyleFileSettings() {}
  updateLinkColor() {}
  openRefreshScreen() {}
  openExport() {}
  onFilterDataChange() {}
  onRecallSession() {}
  onLoadNewData() {}
  static {
    this.ctorParameters = () => [{
      type: golden_layout__WEBPACK_IMPORTED_MODULE_4__.ComponentContainer,
      decorators: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.Inject,
        args: [_app_base_component_directive__WEBPACK_IMPORTED_MODULE_3__.BaseComponentDirective.GoldenLayoutContainerInjectionToken]
      }]
    }, {
      type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.ElementRef
    }, {
      type: _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService
    }, {
      type: angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_6__.GoogleTagManagerService
    }];
  }
  static {
    this.propDecorators = {
      clusterTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.ViewChild,
        args: ['clusterTable']
      }],
      nodeTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.ViewChild,
        args: ['nodeTable']
      }],
      linkTable: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_5__.ViewChild,
        args: ['linkTable']
      }]
    };
  }
};
WaterfallComponent = (0,tslib__WEBPACK_IMPORTED_MODULE_7__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_5__.Component)({
  selector: 'app-waterfall-component',
  template: _waterfall_component_html_ngResource__WEBPACK_IMPORTED_MODULE_0__,
  styles: [(_waterfall_component_scss_ngResource__WEBPACK_IMPORTED_MODULE_1___default())]
}), (0,tslib__WEBPACK_IMPORTED_MODULE_7__.__metadata)("design:paramtypes", [golden_layout__WEBPACK_IMPORTED_MODULE_4__.ComponentContainer, _angular_core__WEBPACK_IMPORTED_MODULE_5__.ElementRef, _contactTraceCommonServices_common_service__WEBPACK_IMPORTED_MODULE_2__.CommonService, angular_google_tag_manager__WEBPACK_IMPORTED_MODULE_6__.GoogleTagManagerService])], WaterfallComponent);

(function (WaterfallComponent) {
  WaterfallComponent.componentTypeName = 'Waterfall';
})(WaterfallComponent || (WaterfallComponent = {}));

/***/ }),

/***/ 53597:
/*!***************************************!*\
  !*** ./src/app/workers/workModule.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   WorkerModule: () => (/* binding */ WorkerModule)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../helperClasses/inlineWorker */ 58406);
/* harmony import */ var bioseq__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bioseq */ 87996);
/* harmony import */ var bioseq__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bioseq__WEBPACK_IMPORTED_MODULE_1__);




let WorkerModule = class WorkerModule {
  constructor() {
    this.compute_parse_csv_matrixWorker = new Worker('assets/parse-csv-matrix.js');
  }
  ngOnInit() {}
  // Factory method for align worker
  getAlignWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker(() => {
      const compute_align_sw = e => {
        let start = Date.now();
        let subset = e.nodes;
        let reference = e.reference;
        let n = subset.length;
        for (let i = 0; i < n; i++) {
          let node = subset[i];
          let rst = bioseq__WEBPACK_IMPORTED_MODULE_1__.align(reference, node.seq, false, e.match, e.gap);
          let fmt = bioseq__WEBPACK_IMPORTED_MODULE_1__.cigar2gaps(reference, node.seq, rst.position, rst.CIGAR, true);
          node._score = rst.score;
          node._padding = rst.position;
          node._cigar = rst.CIGAR;
          node._seq = fmt[1];
        }
        console.log("Alignment time: ", (Date.now() - start).toLocaleString(), "ms");
        start = Date.now();
        let encoder = new TextEncoder();
        let output = encoder.encode(JSON.stringify(subset)).buffer;
        const response = {
          data: output,
          start: start
        };
        postMessage(response, null, null);
      };
      onmessage = evt => {
        compute_align_sw(evt.data);
      };
    });
  }
  // Factory method for consensus worker
  getConsensusWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker(() => {
      const compute_consensus = e => {
        let start = Date.now();
        let subset = e.data !== undefined ? e.data : e;
        let n = subset.length;
        let output = [];
        for (let i = 0; i < n; i++) {
          let seq = subset[i].seq.toUpperCase();
          for (let j = 0; j < seq.length; j++) {
            if (!output[j]) output.push({
              A: 0,
              C: 0,
              G: 0,
              T: 0,
              '-': 0
            });
            output[j][seq[j]]++;
          }
        }
        let consensus = "";
        let m = output.length;
        let entry, maxKey, maxVal;
        for (let k = 0; k < m; k++) {
          entry = output[k];
          maxKey = 'A';
          maxVal = entry[maxKey];
          Object.keys(entry).forEach(char => {
            if (maxVal <= entry[char]) {
              maxVal = entry[char];
              maxKey = char;
            }
          });
          consensus += maxKey;
        }
        console.log('Consensus Compute time: ', (Date.now() - start).toLocaleString(), 'ms');
        start = Date.now();
        let encoder = new TextEncoder();
        consensus = encoder.encode(consensus).buffer;
        let response = {
          consensus: consensus,
          start: start,
          data: consensus
        };
        postMessage(response, null, null);
      };
      onmessage = evt => {
        compute_consensus(evt.data);
      };
    });
  }
  // Factory method for ambiguity counts worker
  getAmbiguityCountsWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker(() => {
      const compute_ambiguity_counts = e => {
        const start = Date.now();
        const subset = e.data !== undefined ? e.data : e;
        const n = subset.length;
        let output = new Float32Array(n);
        for (let i = 0; i < n; i++) {
          const sequence = subset[i]["_seqInt"];
          const sequenceLength = sequence.length;
          let count = 0;
          for (let j = 0; j < sequenceLength; j++) {
            count += sequence[j] > 3 ? 1 : 0;
          }
          output[i] = count / sequenceLength;
        }
        console.log("Ambiguity Count time: ", (Date.now() - start).toLocaleString(), "ms");
        let response = {
          counts: output.buffer,
          start: Date.now(),
          data: output.buffer
        };
        postMessage(response, null, null);
      };
      onmessage = evt => {
        compute_ambiguity_counts(evt.data);
      };
    });
  }
  // Factory method for links worker
  getLinksWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker(() => {
      const compute_links = e => {
        const snps = (s1, s2) => {
          let n = Math.min(s1.length, s2.length);
          let sum = 0;
          for (let i = 0; i < n; i++) {
            let c1 = s1[i];
            let c2 = s2[i];
            sum += c1 !== c2 && c1 !== 17 && c2 !== 17 ? 1 : 0;
          }
          return sum;
        };
        let start = Date.now(),
          t = 0,
          output;
        const subset = e.nodes,
          n = subset.length,
          threshold = parseFloat(e.threshold),
          strategy = e.strategy.toUpperCase(),
          metric = e.metric;
        if (metric === 'snps') {
          output = new Uint16Array((n * n - n) / 2);
          for (let i = 0; i < n; i++) {
            let source = subset[i];
            for (let j = 0; j < i; j++) {
              output[t++] = snps(source['_seqInt'], subset[j]['_seqInt']);
            }
          }
        } else {
          output = new Float32Array((n * n - n) / 2);
          if (strategy !== "HIVTRACE-G") {
            for (let i = 0; i < n; i++) {
              let source = subset[i]['_seqInt'];
              for (let j = 0; j < i; j++) {
                // @ts-ignore
                output[t++] = tn93.onInts(source, subset[j]['_seqInt'], strategy);
              }
            }
          } else {
            for (let i = 0; i < n; i++) {
              let source = subset[i];
              let sourceInThreshold = source['_ambiguity'] < threshold;
              let sourceSeq = source['_seqInt'];
              for (let j = 0; j < i; j++) {
                let target = subset[j];
                // @ts-ignore
                output[t++] = tn93.onInts(sourceSeq, target['_seqInt'], sourceInThreshold && target['_ambiguity'] < threshold ? "RESOLVE" : "AVERAGE");
              }
            }
          }
        }
        console.log('Links Compute time: ', (Date.now() - start).toLocaleString(), 'ms');
        start = Date.now();
        let response = {
          links: output.buffer,
          start,
          data: output.buffer
        };
        postMessage(response, null, null);
      };
      onmessage = evt => {
        compute_links(evt.data);
      };
    });
  }
  // Factory method for tree worker
  getTreeWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker((patristic, tn93) => {
      const compute_tree = e => {
        let start = Date.now();
        const matrix = e.matrix;
        console.log('parsingggg');
        let output;
        try {
          console.log('matrix', matrix);
          console.log('labels', e.labels);
          // @ts-ignore
          const RNJ = parseMatrix(matrix, e.labels);
          console.log('RNJ', RNJ);
          console.log('Tree Compute time: ', (Date.now() - start).toLocaleString(), 'ms');
          start = Date.now();
          const encoder = new TextEncoder();
          output = encoder.encode(JSON.stringify(RNJ.toObject())).buffer;
        } catch {
          console.log('unable to compute tree');
          const encoder = new TextEncoder();
          output = encoder.encode(JSON.stringify({})).buffer;
        }
        let response = {
          tree: output,
          start: start,
          data: output
        };
        postMessage(response, null, null);
      };
      onmessage = evt => {
        compute_tree(evt.data);
      };
    });
  }
  // Factory method for directionality worker
  getDirectionalityWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker(() => {
      const compute_directionality = e => {
        const start = Date.now();
        const links = e.links;
        const n = links.length;
        // @ts-ignore
        const tree = parseJSON(e.tree);
        let flips = new Uint8Array(n);
        for (let i = 0; i < n; i++) {
          const link = links[i];
          const source = tree.getDescendant(link.source);
          const target = tree.getDescendant(link.target);
          // @ts-ignore
          if (source instanceof Branch && target instanceof Branch) {
            if (target.sources(source)) {
              flips[i] = 1;
            }
          }
        }
        console.log('Directionality Inference time: ', (Date.now() - start).toLocaleString(), 'ms');
        let response = {
          output: flips.buffer,
          start: Date.now(),
          data: flips.buffer
        };
        postMessage(response, null, null);
      };
      onmessage = evt => {
        compute_directionality(evt.data);
      };
    });
  }
  // Factory method for MST worker
  getMSTWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker(() => {
      const compute_mst = e => {
        const start = Date.now();
        const links = e.links;
        const found = links.find(l => l.source === "MZ712879" && l.target === "MZ745515" || l.source === "MZ745515" && l.target === "MZ712879");
        console.log("Found link in links array?", found);
        const dm = e.matrix;
        const labels = Object.keys(dm);
        const epsilon = Math.pow(10, e.epsilon);
        const metric = e.metric;
        const n = labels.length;
        const m = links.length;
        let output = new Uint8Array(m);
        let matrix = [];
        let map = [];
        for (let i = 0; i < n; i++) {
          let minDist = Number.MAX_VALUE;
          let targets = [];
          const nodeid = labels[i];
          const row = dm[nodeid];
          for (let j = 0; j < n; j++) {
            let cell = row[labels[j]];
            if (!cell) {
              targets.push(0);
              continue;
            }
            let value = cell[metric];
            targets.push(value);
          }
          matrix.push(targets);
          map.push(nodeid);
        }
        const minKey = (key, mstSet, V) => {
          let min = Number.MAX_VALUE;
          let min_index = -1;
          for (let v = 0; v < V; v++) {
            if (!mstSet[v] && key[v] < min) {
              min = key[v];
              min_index = v;
            }
          }
          return min_index;
        };
        const primMST = graph => {
          const V = graph.length;
          let parent = [];
          let key = [];
          let mstSet = [];
          for (let i = 0; i < V; i++) {
            key[i] = Number.MAX_VALUE;
            mstSet[i] = false;
          }
          key[0] = 0.0;
          parent[0] = -1;
          for (let count = 0; count < V - 1; count++) {
            let u = minKey(key, mstSet, V);
            if (u < 0) continue;
            mstSet[u] = true;
            if (graph[u].reduce((a, b) => a + b, 0) === 0 && u !== 0) continue;
            for (let v = 0; v < V; v++) {
              if (graph[u][v] >= 0 && !mstSet[v] && graph[u][v] < key[v]) {
                parent[v] = u;
                key[v] = graph[u][v];
              }
            }
          }
          return parent;
        };
        const nearest_neighbour_graph = (graph, mst_parents, epsilon) => {
          const V = graph.length;
          let mst = [];
          for (let i = 0; i < V; ++i) {
            mst.push([]);
          }
          for (let i = 1; i < V; ++i) {
            mst[i].push(mst_parents[i]);
            mst[mst_parents[i]].push(i);
          }
          let nng = [];
          let longest_edge = [];
          for (let i = 0; i < V; ++i) {
            nng.push([]);
            longest_edge.push([]);
            for (let j = 0; j < V; ++j) {
              longest_edge[i][j] = 0;
            }
          }
          for (let i = 0; i < V; ++i) {
            bfs_update_matrix(mst, matrix, i, longest_edge);
          }
          for (let i = 0; i < V; ++i) {
            for (let j = 0; j < V; ++j) {
              if (graph[i][j] > 0 && graph[i][j] <= longest_edge[i][j] * (1.0 + epsilon)) {
                nng[i].push(j);
                nng[j].push(i);
              }
            }
          }
          return nng;
        };
        const bfs_update_matrix = (mst, weights, root, longest_edge) => {
          let visited = [];
          let queue = [];
          queue.push(root);
          while (queue.length) {
            let v = queue.shift();
            visited[v] = true;
            mst[v].forEach(u => {
              if (visited[u]) return;
              queue.push(u);
              const value = Math.max(weights[v][u], Math.max(longest_edge[root][u], longest_edge[root][v]));
              // LOG if root=19 or 9, or if (v,u) = (19,0)/(0,9)/(9,0)/(0,19)
              if (root === 19 || root === 9 || v === 19 || v === 9 || u === 19 || u === 9) {
                console.log(`BFS root=${root}, v=${v}, u=${u}`, 'weights[v][u]=', weights[v][u], 'longest_edge[root][v]=', longest_edge[root][v], 'longest_edge[root][u]=', longest_edge[root][u], '=> new value=', value);
              }
              longest_edge[root][u] = value;
              longest_edge[u][root] = value;
            });
          }
        };
        // Right before or after building `map` in compute_mst:
        console.log('Index of MZ712879:', map.indexOf('MZ712879'));
        console.log('Index of MZ745515:', map.indexOf('MZ745515'));
        // Right after building 'matrix'
        const idxA = map.indexOf('MZ712879');
        const idxB = map.indexOf('MZ745515');
        if (idxA >= 0 && idxB >= 0) {
          console.log('Distance from MZ712879 -> MZ745515:', matrix[idxA][idxB], 'Distance from MZ745515 -> MZ712879:', matrix[idxB][idxA]);
        }
        const mst = primMST(matrix);
        const nng = nearest_neighbour_graph(matrix, mst, epsilon);
        // After `const mst = primMST(matrix);`
        console.log('Parent array from MST:', mst);
        // Then specifically:
        console.log('Parent of MZ712879 (idxA):', mst[idxA], 'Parent of MZ745515 (idxB):', mst[idxB]);
        for (let i = 0; i < n; i++) {
          const source = map[i];
          nng[i].push(mst[i]);
          Array.from(new Set(nng[i])).forEach(u => {
            const target = map[parseInt(u)];
            for (let k = 0; k < m; k++) {
              let l = links[k];
              if (l.source === source && l.target === target || l.source === target && l.target === source) {
                output[k] = 1;
              }
            }
          });
          if (source === "MZ712879" || source === "MZ745515") {
            console.log("nng[i] for", source, nng[i]);
            console.log("MST parent for", source, mst[i]);
          }
        }
        console.log('MST Compute time: ', (Date.now() - start).toLocaleString(), 'ms');
        let response = {
          links: output.buffer,
          start: Date.now(),
          data: output.buffer
        };
        postMessage(response);
      };
      onmessage = evt => {
        compute_mst(evt.data);
      };
    });
  }
  // Factory method for NN worker
  getNNWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker(() => {
      const compute_nn = e => {
        const includes = (container, value) => {
          return container.indexOf(value) >= 0;
        };
        const start = Date.now();
        const links = e.links,
          dm = e.matrix,
          labels = Object.keys(dm),
          epsilon = Math.pow(10, e.epsilon),
          metric = e.metric;
        const n = labels.length,
          m = links.length;
        let output = new Uint8Array(m);
        for (let i = 0; i < n; i++) {
          let minDist = Number.MAX_VALUE;
          let targets = [];
          const nodeid = labels[i];
          const row = dm[nodeid];
          for (let j = 0; j < i; j++) {
            let cell = row[labels[j]];
            if (!cell) continue;
            let value = cell[metric];
            if (typeof value !== 'number' || isNaN(value)) continue;
            if (value < minDist) minDist = value;
          }
          for (let h = 0; h < i; h++) {
            let node = labels[h];
            let cell = row[node];
            if (!cell) continue;
            let value = cell[metric];
            if (typeof value !== 'number' || isNaN(value)) continue;
            if (Math.abs(value - minDist) < epsilon) {
              targets.push(node);
            }
          }
          for (let k = 0; k < m; k++) {
            let l = links[k];
            if (l.source === nodeid && includes(targets, l.target) || l.target === nodeid && includes(targets, l.source)) {
              output[k] = 1;
            }
          }
        }
        console.log('NN Compute time: ', (Date.now() - start).toLocaleString(), 'ms');
        let response = {
          links: output.buffer,
          start: Date.now(),
          data: output.buffer
        };
        postMessage(response, null, null);
      };
      onmessage = evt => {
        compute_nn(evt.data);
      };
    });
  }
  // Factory method for triangulation worker
  getTriangulationWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker(() => {
      const compute_triangulation = e => {
        let start = Date.now();
        let m = e.matrix;
        let n = m.length;
        for (let i = 0; i < n; i++) {
          for (let j = 0; j < i; j++) {
            let missingCell = m[i][j];
            if (typeof missingCell === 'number') continue;
            let minRange = Infinity,
              min = Infinity;
            for (let k = 0; k < i; k++) {
              let companionA = m[i][k];
              if (typeof companionA !== 'number') continue;
              for (let l = j + 1; l < n; l++) {
                let companionB = m[l][j];
                if (typeof companionB !== 'number') continue;
                let diff = Math.abs(companionA - companionB);
                if (minRange > diff) {
                  minRange = diff;
                  min = Math.min(companionA, companionB);
                }
              }
            }
            if (minRange < Infinity) {
              let newVal = min + minRange / 2;
              m[i][j] = newVal;
              m[j][i] = newVal;
            }
          }
        }
        console.log('Triangulation Compute time: ', (Date.now() - start).toLocaleString(), 'ms');
        start = Date.now();
        let encoder = new TextEncoder();
        let output = encoder.encode(JSON.stringify(m)).buffer;
        let response = {
          matrix: output,
          start: start,
          data: output
        };
        postMessage(response, null, null);
      };
      onmessage = evt => {
        compute_triangulation(evt.data);
      };
    });
  }
  // Factory method for parse FASTA worker
  // Factory method for parse FASTA worker
  getParseFastaWorker() {
    return new _helperClasses_inlineWorker__WEBPACK_IMPORTED_MODULE_0__.InlineWorker(() => {
      const compute_parse_fasta = e => {
        let start = Date.now();
        // Check if e.data is an object with a "data" property; otherwise, use e.data directly.
        let text = typeof e.data === 'object' && e.data.data ? e.data.data : e.data;
        if (!text || text.length === 0) return [];
        let seqs = [];
        let currentSeq = {};
        let lines = text.split(/[\r\n]+/g);
        let n = lines.length;
        let isblank = /^\s*$/;
        for (let i = 0; i < n; i++) {
          let line = lines[i];
          if (isblank.test(line) || line[0] === ';') continue;
          if (line[0] === '>') {
            if (i > 0) seqs.push(currentSeq);
            currentSeq = {
              id: line.slice(1),
              seq: ''
            };
          } else {
            currentSeq.seq += line.toUpperCase();
          }
        }
        seqs.push(currentSeq);
        console.log('FASTA Parse time: ', (Date.now() - start).toLocaleString(), 'ms');
        start = Date.now();
        let encoder = new TextEncoder();
        let output = encoder.encode(JSON.stringify(seqs)).buffer;
        let response = {
          nodes: output,
          start: start,
          data: output
        };
        postMessage(response, null, null);
      };
      onmessage = evt => {
        compute_parse_fasta(evt);
      };
    });
  }
  static {
    this.ctorParameters = () => [];
  }
};
WorkerModule = (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_3__.Injectable)({
  providedIn: 'root'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__metadata)("design:paramtypes", [])], WorkerModule);


/***/ }),

/***/ 73651:
/*!*****************************************************!*\
  !*** ./src/assets/metronic/app/core/core.module.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   CoreModule: () => (/* binding */ CoreModule)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_common__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @angular/common */ 60316);
/* harmony import */ var _directives_menu_aside_directive__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./directives/menu-aside.directive */ 90210);
/* harmony import */ var _directives_menu_aside_offcanvas_directive__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./directives/menu-aside-offcanvas.directive */ 7890);
/* harmony import */ var _directives_menu_horizontal_offcanvas_directive__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./directives/menu-horizontal-offcanvas.directive */ 23194);
/* harmony import */ var _directives_menu_horizontal_directive__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./directives/menu-horizontal.directive */ 8826);
/* harmony import */ var _directives_menu_aside_toggle_directive__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./directives/menu-aside-toggle.directive */ 94617);








let CoreModule = class CoreModule {};
CoreModule = (0,tslib__WEBPACK_IMPORTED_MODULE_5__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_6__.NgModule)({
  imports: [_angular_common__WEBPACK_IMPORTED_MODULE_7__.CommonModule],
  declarations: [
  // directives
  _directives_menu_aside_directive__WEBPACK_IMPORTED_MODULE_0__.MenuAsideDirective, _directives_menu_aside_offcanvas_directive__WEBPACK_IMPORTED_MODULE_1__.MenuAsideOffcanvasDirective, _directives_menu_horizontal_offcanvas_directive__WEBPACK_IMPORTED_MODULE_2__.MenuHorizontalOffcanvasDirective, _directives_menu_horizontal_directive__WEBPACK_IMPORTED_MODULE_3__.MenuHorizontalDirective, _directives_menu_aside_toggle_directive__WEBPACK_IMPORTED_MODULE_4__.MenuAsideToggleDirective],
  exports: [
  // directives
  _directives_menu_aside_directive__WEBPACK_IMPORTED_MODULE_0__.MenuAsideDirective, _directives_menu_aside_offcanvas_directive__WEBPACK_IMPORTED_MODULE_1__.MenuAsideOffcanvasDirective, _directives_menu_horizontal_offcanvas_directive__WEBPACK_IMPORTED_MODULE_2__.MenuHorizontalOffcanvasDirective, _directives_menu_horizontal_directive__WEBPACK_IMPORTED_MODULE_3__.MenuHorizontalDirective, _directives_menu_aside_toggle_directive__WEBPACK_IMPORTED_MODULE_4__.MenuAsideToggleDirective],
  providers: []
})], CoreModule);


/***/ }),

/***/ 7890:
/*!***********************************************************************************!*\
  !*** ./src/assets/metronic/app/core/directives/menu-aside-offcanvas.directive.ts ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MenuAsideOffcanvasDirective: () => (/* binding */ MenuAsideOffcanvasDirective)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! rxjs/operators */ 51567);
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ 95072);




let MenuAsideOffcanvasDirective = class MenuAsideOffcanvasDirective {
  constructor(el, router) {
    this.el = el;
    this.router = router;
  }
  ngAfterViewInit() {
    const offcanvasClass = mUtil.hasClass(this.el.nativeElement, 'm-aside-left--offcanvas-default') ? 'm-aside-left--offcanvas-default' : 'm-aside-left';
    this.menuOffcanvas = new mOffcanvas(this.el.nativeElement, {
      baseClass: offcanvasClass,
      overlay: true,
      closeBy: 'm_aside_left_close_btn',
      toggleBy: [{
        target: 'm_aside_left_offcanvas_toggle',
        state: 'm-brand__toggler--active'
      }, {
        target: 'm_aside_left_offcanvas_mobile_toggle',
        state: 'm-brand__toggler--active'
      }]
    });
    this.router.events.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_0__.filter)(event => event instanceof _angular_router__WEBPACK_IMPORTED_MODULE_1__.NavigationEnd)).subscribe(event => {
      if (mUtil.isMobileDevice()) {
        this.menuOffcanvas.hide();
      }
    });
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_2__.ElementRef
    }, {
      type: _angular_router__WEBPACK_IMPORTED_MODULE_1__.Router
    }];
  }
};
MenuAsideOffcanvasDirective = (0,tslib__WEBPACK_IMPORTED_MODULE_3__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.Directive)({
  selector: '[mMenuAsideOffcanvas]'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_3__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_2__.ElementRef, _angular_router__WEBPACK_IMPORTED_MODULE_1__.Router])], MenuAsideOffcanvasDirective);


/***/ }),

/***/ 94617:
/*!********************************************************************************!*\
  !*** ./src/assets/metronic/app/core/directives/menu-aside-toggle.directive.ts ***!
  \********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MenuAsideToggleDirective: () => (/* binding */ MenuAsideToggleDirective)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ 37580);


let MenuAsideToggleDirective = class MenuAsideToggleDirective {
  constructor(el) {
    this.el = el;
  }
  ngAfterViewInit() {
    this.toggle = new mToggle(this.el.nativeElement, {
      target: 'body',
      targetState: 'm-brand--minimize m-aside-left--minimize',
      togglerState: 'm-brand__toggler--active'
    });
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.ElementRef
    }];
  }
};
MenuAsideToggleDirective = (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.Directive)({
  selector: '[mMenuAsideToggle]'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_0__.ElementRef])], MenuAsideToggleDirective);


/***/ }),

/***/ 90210:
/*!*************************************************************************!*\
  !*** ./src/assets/metronic/app/core/directives/menu-aside.directive.ts ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MenuAsideDirective: () => (/* binding */ MenuAsideDirective)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _services_layout_config_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../services/layout-config.service */ 38839);
/* harmony import */ var object_path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! object-path */ 41366);
/* harmony import */ var object_path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(object_path__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _services_layout_layout_ref_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../services/layout/layout-ref.service */ 30945);
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! rxjs/operators */ 13255);






let MenuAsideDirective = class MenuAsideDirective {
  constructor(el, layoutConfigService, layoutRefService) {
    this.el = el;
    this.layoutConfigService = layoutConfigService;
    this.layoutRefService = layoutRefService;
    this.layoutConfigService.onLayoutConfigUpdated$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_3__.mergeMap)(() => {
      return this.layoutRefService.layoutRefs$;
    })).subscribe(layout => {
      this.layout = layout;
      this.initMenu();
    });
  }
  initMenu() {
    if (!this.layout.hasOwnProperty('header')) {
      return;
    }
    let scroll;
    if (mUtil.attr(this.el.nativeElement, 'm-menu-scrollable') === '1') {
      const headerHeight = parseInt(window.getComputedStyle(object_path__WEBPACK_IMPORTED_MODULE_1__.get(this.layout, 'header'))['height'], null);
      scroll = {
        height() {
          return mUtil.getViewPort().height - headerHeight;
        }
      };
    }
    const options = {
      // vertical scroll
      scroll: scroll,
      // submenu setup
      submenu: {
        desktop: {
          // by default the menu mode set to accordion in desktop mode
          default: 'accordion',
          // whenever body has this class switch the menu mode to dropdown
          state: {
            body: 'm-aside-left--minimize',
            mode: 'dropdown'
          }
        },
        tablet: 'accordion',
        // menu set to accordion in tablet mode
        mobile: 'accordion' // menu set to accordion in mobile mode
      },
      // accordion setup
      accordion: {
        autoScroll: false,
        expandAll: false
      }
    };
    // init the mMenu plugin
    if (this.menu instanceof mMenu) {
      this.menu.update(options);
    } else {
      this.menu = new mMenu(this.el.nativeElement, options);
    }
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_4__.ElementRef
    }, {
      type: _services_layout_config_service__WEBPACK_IMPORTED_MODULE_0__.LayoutConfigService
    }, {
      type: _services_layout_layout_ref_service__WEBPACK_IMPORTED_MODULE_2__.LayoutRefService
    }];
  }
};
MenuAsideDirective = (0,tslib__WEBPACK_IMPORTED_MODULE_5__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_4__.Directive)({
  selector: '[mMenuAside]'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_5__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_4__.ElementRef, _services_layout_config_service__WEBPACK_IMPORTED_MODULE_0__.LayoutConfigService, _services_layout_layout_ref_service__WEBPACK_IMPORTED_MODULE_2__.LayoutRefService])], MenuAsideDirective);


/***/ }),

/***/ 23194:
/*!****************************************************************************************!*\
  !*** ./src/assets/metronic/app/core/directives/menu-horizontal-offcanvas.directive.ts ***!
  \****************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MenuHorizontalOffcanvasDirective: () => (/* binding */ MenuHorizontalOffcanvasDirective)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! rxjs/operators */ 51567);
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/router */ 95072);




let MenuHorizontalOffcanvasDirective = class MenuHorizontalOffcanvasDirective {
  constructor(el, router) {
    this.el = el;
    this.router = router;
  }
  ngAfterViewInit() {
    // init the mOffcanvas plugin
    this.menuOffcanvas = new mOffcanvas(this.el.nativeElement, {
      overlay: true,
      baseClass: 'm-aside-header-menu-mobile',
      closeBy: 'm_aside_header_menu_mobile_close_btn',
      toggleBy: {
        target: 'm_aside_header_menu_mobile_toggle',
        state: 'm-brand__toggler--active'
      }
    });
    this.router.events.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_0__.filter)(event => event instanceof _angular_router__WEBPACK_IMPORTED_MODULE_1__.NavigationEnd)).subscribe(event => {
      if (mUtil.isMobileDevice()) {
        this.menuOffcanvas.hide();
      }
    });
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_2__.ElementRef
    }, {
      type: _angular_router__WEBPACK_IMPORTED_MODULE_1__.Router
    }];
  }
};
MenuHorizontalOffcanvasDirective = (0,tslib__WEBPACK_IMPORTED_MODULE_3__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.Directive)({
  selector: '[mMenuHorizontalOffcanvas]'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_3__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_2__.ElementRef, _angular_router__WEBPACK_IMPORTED_MODULE_1__.Router])], MenuHorizontalOffcanvasDirective);


/***/ }),

/***/ 8826:
/*!******************************************************************************!*\
  !*** ./src/assets/metronic/app/core/directives/menu-horizontal.directive.ts ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MenuHorizontalDirective: () => (/* binding */ MenuHorizontalDirective)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ 37580);


let MenuHorizontalDirective = class MenuHorizontalDirective {
  constructor(el) {
    this.el = el;
  }
  ngAfterViewInit() {
    // init the mMenu plugin
    this.menu = new mMenu(this.el.nativeElement, {
      submenu: {
        desktop: 'dropdown',
        tablet: 'accordion',
        mobile: 'accordion'
      },
      accordion: {
        slideSpeed: 200,
        // accordion toggle slide speed in milliseconds
        autoScroll: true,
        // enable auto scrolling(focus) to the clicked menu item
        expandAll: false // allow having multiple expanded accordions in the menu
      }
    });
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.ElementRef
    }];
  }
};
MenuHorizontalDirective = (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.Directive)({
  selector: '[mMenuHorizontal]'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_0__.ElementRef])], MenuHorizontalDirective);


/***/ }),

/***/ 38839:
/*!************************************************************************!*\
  !*** ./src/assets/metronic/app/core/services/layout-config.service.ts ***!
  \************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   LayoutConfigService: () => (/* binding */ LayoutConfigService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! rxjs */ 75797);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var rxjs_operators__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! rxjs/operators */ 51567);
/* harmony import */ var _angular_router__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @angular/router */ 95072);
/* harmony import */ var _utils_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./utils.service */ 50637);






let LayoutConfigService = class LayoutConfigService {
  constructor(router, utils) {
    this.router = router;
    this.utils = utils;
    // register on config changed event and set default config
    this.onLayoutConfigUpdated$ = new rxjs__WEBPACK_IMPORTED_MODULE_1__.BehaviorSubject(null);
    this.router.events.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_2__.filter)(event => event instanceof _angular_router__WEBPACK_IMPORTED_MODULE_3__.NavigationEnd)).subscribe(() => {
      this.onLayoutConfigUpdated$.next(null);
    });
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_router__WEBPACK_IMPORTED_MODULE_3__.Router
    }, {
      type: _utils_service__WEBPACK_IMPORTED_MODULE_0__.UtilsService
    }];
  }
};
LayoutConfigService = (0,tslib__WEBPACK_IMPORTED_MODULE_4__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_5__.Injectable)(), (0,tslib__WEBPACK_IMPORTED_MODULE_4__.__metadata)("design:paramtypes", [_angular_router__WEBPACK_IMPORTED_MODULE_3__.Router, _utils_service__WEBPACK_IMPORTED_MODULE_0__.UtilsService])], LayoutConfigService);


/***/ }),

/***/ 30945:
/*!****************************************************************************!*\
  !*** ./src/assets/metronic/app/core/services/layout/layout-ref.service.ts ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   LayoutRefService: () => (/* binding */ LayoutRefService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var rxjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! rxjs */ 75797);



let LayoutRefService = class LayoutRefService {
  constructor() {
    this.layoutRefs$ = new rxjs__WEBPACK_IMPORTED_MODULE_0__.BehaviorSubject({});
    this.layoutRefs = {};
  }
  addElement(name, element) {
    const obj = {};
    obj[name] = element;
    this.layoutRefs$.next(Object.assign(this.layoutRefs, obj));
  }
};
LayoutRefService = (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.Injectable)()], LayoutRefService);


/***/ }),

/***/ 50637:
/*!****************************************************************!*\
  !*** ./src/assets/metronic/app/core/services/utils.service.ts ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   UtilsService: () => (/* binding */ UtilsService),
/* harmony export */   isInteger: () => (/* binding */ isInteger),
/* harmony export */   isString: () => (/* binding */ isString)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_common_http__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/common/http */ 46443);



let UtilsService = class UtilsService {
  constructor() {}
  /**
   * Build url parameters key and value pairs from array or object
   * @param obj
   */
  urlParam(obj) {
    return Object.keys(obj).map(k => k + '=' + encodeURIComponent(obj[k])).join('&');
  }
  /**
   * Simple object check.
   * @param item
   * @returns {boolean}
   */
  isObject(item) {
    return item && typeof item === 'object' && !Array.isArray(item);
  }
  /**
   * Deep merge two objects.
   * @param target
   * @param ...sources
   * @see https://stackoverflow.com/a/34749873/1316921
   */
  mergeDeep(target, ...sources) {
    if (!sources.length) {
      return target;
    }
    const source = sources.shift();
    if (this.isObject(target) && this.isObject(source)) {
      for (const key in source) {
        if (this.isObject(source[key])) {
          if (!target[key]) {
            Object.assign(target, {
              [key]: {}
            });
          }
          this.mergeDeep(target[key], source[key]);
        } else {
          Object.assign(target, {
            [key]: source[key]
          });
        }
      }
    }
    return this.mergeDeep(target, ...sources);
  }
  getPath(obj, val, path) {
    path = path || '';
    let fullpath = '';
    for (const b in obj) {
      if (obj[b] === val) {
        return path + '/' + b;
      } else if (typeof obj[b] === 'object') {
        fullpath = this.getPath(obj[b], val, path + '/' + b) || fullpath;
      }
    }
    return fullpath;
  }
  getFindHTTPParams(queryParams) {
    const params = new _angular_common_http__WEBPACK_IMPORTED_MODULE_0__.HttpParams().set('lastNamefilter', queryParams.filter).set('sortOrder', queryParams.sortOrder).set('sortField', queryParams.sortField).set('pageNumber', queryParams.pageNumber.toString()).set('pageSize', queryParams.pageSize.toString());
    return params;
  }
  getHTTPHeader() {
    return {
      headers: new _angular_common_http__WEBPACK_IMPORTED_MODULE_0__.HttpHeaders({
        'Content-Type': 'application/json'
      })
    };
  }
  static {
    this.ctorParameters = () => [];
  }
};
UtilsService = (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.Injectable)(), (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__metadata)("design:paramtypes", [])], UtilsService);

function isInteger(value) {
  return typeof value === 'number' && isFinite(value) && Math.floor(value) === value;
}
function isString(value) {
  return typeof value === 'string';
}

/***/ }),

/***/ 45312:
/*!*****************************************!*\
  !*** ./src/environments/environment.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   environment: () => (/* binding */ environment)
/* harmony export */ });
const environment = {
  production: true
};

/***/ }),

/***/ 84429:
/*!*********************!*\
  !*** ./src/main.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var hammerjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! hammerjs */ 85684);
/* harmony import */ var hammerjs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(hammerjs__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _angular_platform_browser_dynamic__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @angular/platform-browser-dynamic */ 52476);
/* harmony import */ var _app_app_module__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./app/app.module */ 50635);
/* harmony import */ var _environments_environment__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./environments/environment */ 45312);





if (_environments_environment__WEBPACK_IMPORTED_MODULE_2__.environment.production) {
  (0,_angular_core__WEBPACK_IMPORTED_MODULE_3__.enableProdMode)();
}
(0,_angular_platform_browser_dynamic__WEBPACK_IMPORTED_MODULE_4__.platformBrowserDynamic)().bootstrapModule(_app_app_module__WEBPACK_IMPORTED_MODULE_1__.AppModule).catch(err => console.error(err));

/***/ }),

/***/ 99998:
/*!*************************************!*\
  !*** ./src/shared/app.constants.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AppConsts: () => (/* binding */ AppConsts)
/* harmony export */ });
class AppConsts {
  static {
    this.tenancyNamePlaceHolderInUrl = '{TENANCY_NAME}';
  }
  static {
    this.localeMappings = [];
  }
  static {
    this.userManagement = {
      defaultAdminUserName: 'admin'
    };
  }
  static {
    this.localization = {
      defaultLocalizationSourceName: 'BPAASDashboard'
    };
  }
  static {
    this.authorization = {
      encrptedAuthTokenName: 'enc_auth_token'
    };
  }
  static {
    this.grid = {
      defaultPageSize: 10
    };
  }
}

/***/ }),

/***/ 2449:
/*!*************************************************!*\
  !*** ./src/shared/common/app-component-base.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AppComponentBase: () => (/* binding */ AppComponentBase)
/* harmony export */ });
/* harmony import */ var _shared_app_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @shared/app.constants */ 99998);
/* harmony import */ var _shared_common_nav_app_url_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @shared/common/nav/app-url.service */ 81014);
/* harmony import */ var _shared_common_session_app_session_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @shared/common/session/app-session.service */ 50686);
/* harmony import */ var _shared_common_ui_app_ui_customization_service__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @shared/common/ui/app-ui-customization.service */ 69720);
/* harmony import */ var _shared_helpers_PrimengTableHelper__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @shared/helpers/PrimengTableHelper */ 15406);





// import { UiCustomizationSettingsDto } from '@shared/service-proxies/service-proxies';
class AppComponentBase {
  constructor(injector) {
    this.localizationSourceName = _shared_app_constants__WEBPACK_IMPORTED_MODULE_0__.AppConsts.localization.defaultLocalizationSourceName;
    // this.localization = injector.get(LocalizationService);
    // this.permission = injector.get(PermissionCheckerService);
    // this.feature = injector.get(FeatureCheckerService);
    // this.notify = injector.get(NotifyService);
    // this.setting = injector.get(SettingService);
    // this.message = injector.get(MessageService);
    // this.multiTenancy = injector.get(AbpMultiTenancyService);
    this.appSession = injector.get(_shared_common_session_app_session_service__WEBPACK_IMPORTED_MODULE_2__.AppSessionService);
    this.ui = injector.get(_shared_common_ui_app_ui_customization_service__WEBPACK_IMPORTED_MODULE_3__.AppUiCustomizationService);
    this.appUrlService = injector.get(_shared_common_nav_app_url_service__WEBPACK_IMPORTED_MODULE_1__.AppUrlService);
    this.primengTableHelper = new _shared_helpers_PrimengTableHelper__WEBPACK_IMPORTED_MODULE_4__.PrimengTableHelper();
  }
  flattenDeep(array) {
    return array.reduce((acc, val) => Array.isArray(val) ? acc.concat(this.flattenDeep(val)) : acc.concat(val), []);
  }
  l(key, ...args) {
    args.unshift(key);
    args.unshift(this.localizationSourceName);
    return this.ls.apply(this, args);
  }
  ls(sourcename, key, ...args) {
    let localizedText = this.localization.localize(key, sourcename);
    if (!localizedText) {
      localizedText = key;
    }
    if (!args || !args.length) {
      return localizedText;
    }
    args.unshift(localizedText);
    return localizedText;
    // return abp.utils.formatString.apply(this, this.flattenDeep(args));
  }
  isGranted(permissionName) {
    return this.permission.isGranted(permissionName);
  }
  isGrantedAny(...permissions) {
    if (!permissions) {
      return false;
    }
    for (const permission of permissions) {
      if (this.isGranted(permission)) {
        return true;
      }
    }
    return false;
  }
  s(key) {
    return key;
    // return abp.setting.get(key);
  }
  appRootUrl() {
    return this.appUrlService.appRootUrl;
  }
}

/***/ }),

/***/ 81014:
/*!**************************************************!*\
  !*** ./src/shared/common/nav/app-url.service.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AppUrlService: () => (/* binding */ AppUrlService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _shared_app_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @shared/app.constants */ 99998);
/* harmony import */ var _shared_common_session_app_session_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @shared/common/session/app-session.service */ 50686);
var AppUrlService_1;




let AppUrlService = class AppUrlService {
  static {
    AppUrlService_1 = this;
  }
  static {
    this.tenancyNamePlaceHolder = '{TENANCY_NAME}';
  }
  constructor(_appSessionService) {
    this._appSessionService = _appSessionService;
  }
  get appRootUrl() {
    // if (this._appSessionService.tenant) {
    //     return this.getAppRootUrlOfTenant(this._appSessionService.tenant.tenancyName);
    // } else {
    //     return this.getAppRootUrlOfTenant(null);
    // }
    return "";
  }
  /**
   * Returning url ends with '/'.
   */
  getAppRootUrlOfTenant(tenancyName) {
    if (!tenancyName) return undefined;
    let baseUrl = this.ensureEndsWith(_shared_app_constants__WEBPACK_IMPORTED_MODULE_0__.AppConsts.appBaseUrlFormat, '/');
    //Add base href if it is not configured in appconfig.json
    if (baseUrl.indexOf(_shared_app_constants__WEBPACK_IMPORTED_MODULE_0__.AppConsts.appBaseHref) < 0) {
      baseUrl = baseUrl + this.removeFromStart(_shared_app_constants__WEBPACK_IMPORTED_MODULE_0__.AppConsts.appBaseHref, '/');
    }
    if (baseUrl.indexOf(AppUrlService_1.tenancyNamePlaceHolder) < 0) {
      return baseUrl;
    }
    if (baseUrl.indexOf(AppUrlService_1.tenancyNamePlaceHolder + '.') >= 0) {
      baseUrl = baseUrl.replace(AppUrlService_1.tenancyNamePlaceHolder + '.', AppUrlService_1.tenancyNamePlaceHolder);
      if (tenancyName) {
        tenancyName = tenancyName + '.';
      }
    }
    if (!tenancyName) {
      return baseUrl.replace(AppUrlService_1.tenancyNamePlaceHolder, '');
    }
    return baseUrl.replace(AppUrlService_1.tenancyNamePlaceHolder, tenancyName);
  }
  ensureEndsWith(str, c) {
    if (str && str.charAt(str.length - 1) !== c) {
      str = str + c;
    }
    return str;
  }
  removeFromEnd(str, c) {
    if (str && str.charAt(str.length - 1) === c) {
      str = str.substr(0, str.length - 1);
    }
    return str;
  }
  removeFromStart(str, c) {
    if (str && str.charAt(0) === c) {
      str = str.substr(1, str.length - 1);
    }
    return str;
  }
  static {
    this.ctorParameters = () => [{
      type: _shared_common_session_app_session_service__WEBPACK_IMPORTED_MODULE_1__.AppSessionService
    }];
  }
};
AppUrlService = AppUrlService_1 = (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_3__.Injectable)(), (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__metadata)("design:paramtypes", [_shared_common_session_app_session_service__WEBPACK_IMPORTED_MODULE_1__.AppSessionService])], AppUrlService);


/***/ }),

/***/ 39295:
/*!**************************************************!*\
  !*** ./src/shared/common/pipes/localize.pipe.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   LocalizePipe: () => (/* binding */ LocalizePipe)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _shared_app_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @shared/app.constants */ 99998);



// import { LocalizationService } from '@abp/localization/localization.service';
let LocalizePipe = class LocalizePipe {
  // localization: LocalizationService;
  constructor(injector) {
    this.localizationSourceName = _shared_app_constants__WEBPACK_IMPORTED_MODULE_0__.AppConsts.localization.defaultLocalizationSourceName;
    // this.localization = injector.get(LocalizationService);
  }
  l(key, ...args) {
    args.unshift(key);
    args.unshift(this.localizationSourceName);
    return this.ls.apply(this, args);
  }
  ls(sourcename, key, ...args) {
    return key;
    // let localizedText = this.localization.localize(key, sourcename);
    // if (!localizedText) {
    //     localizedText = key;
    // }
    // if (!args || !args.length) {
    //     return localizedText;
    // }
    // args.unshift(localizedText);
    // return this.localizedText;
    // return abp.utils.formatString.apply(this, this.flattenDeep(args));
  }
  transform(key, ...args) {
    return this.l(key, args);
  }
  flattenDeep(array) {
    return array.reduce((acc, val) => Array.isArray(val) ? acc.concat(this.flattenDeep(val)) : acc.concat(val), []);
  }
  static {
    this.ctorParameters = () => [{
      type: _angular_core__WEBPACK_IMPORTED_MODULE_1__.Injector
    }];
  }
};
LocalizePipe = (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_1__.Pipe)({
  name: 'localize'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__metadata)("design:paramtypes", [_angular_core__WEBPACK_IMPORTED_MODULE_1__.Injector])], LocalizePipe);


/***/ }),

/***/ 50686:
/*!**********************************************************!*\
  !*** ./src/shared/common/session/app-session.service.ts ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AppSessionService: () => (/* binding */ AppSessionService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/core */ 37580);

// import { AbpMultiTenancyService } from '@abp/multi-tenancy/abp-multi-tenancy.service';

// import { ApplicationInfoDto, GetCurrentLoginInformationsOutput, SessionServiceProxy, TenantLoginInfoDto, UserLoginInfoDto, UiCustomizationSettingsDto } from '@shared/service-proxies/service-proxies';
let AppSessionService = class AppSessionService {};
AppSessionService = (0,tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_1__.Injectable)()], AppSessionService);


/***/ }),

/***/ 69720:
/*!**************************************************************!*\
  !*** ./src/shared/common/ui/app-ui-customization.service.ts ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AppUiCustomizationService: () => (/* binding */ AppUiCustomizationService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @angular/core */ 37580);


// import { UiCustomizationSettingsDto } from '@shared/service-proxies/service-proxies';
let AppUiCustomizationService = class AppUiCustomizationService {
  // init(theme: UiCustomizationSettingsDto): void {
  //     this._theme = theme;
  // }
  init() {}
  getContainerClass() {
    if (this._theme.baseSettings.layout.layoutType === 'fluid') {
      return 'm-container--fluid';
    }
    return 'm-container--responsive m-container--xxl';
  }
  isLeftMenuUsed() {
    return this._theme.baseSettings.menu.position === 'left';
  }
  getAppModuleBodyClass() {
    let topMenuUsed = this._theme.baseSettings.menu.position === 'top';
    return 'm-page--' + this._theme.baseSettings.layout.layoutType + ' m--skin-' + this._theme.baseSettings.layout.contentSkin + ' ' + (this._theme.baseSettings.layout.contentSkin !== '' ? 'm-content--skin-' + this._theme.baseSettings.layout.contentSkin : '') + ' ' + 'm-header--' + (this._theme.baseSettings.header.desktopFixedHeader ? 'fixed' : 'static') + ' ' + (this._theme.baseSettings.header.mobileFixedHeader ? 'm-header--fixed-mobile' : '') + ' ' + (this._theme.baseSettings.menu.fixedAside && !topMenuUsed ? 'm-aside-left--fixed' : '') + ' ' + (this._theme.baseSettings.menu.defaultMinimizedAside ? 'm-aside-left--minimize m-brand--minimize' : '') + ' ' + (this._theme.baseSettings.menu.defaultHiddenAside || this._theme.baseSettings.menu.position === 'top' ? 'm-aside-left--hide' : '') + ' ' + (this.isLeftMenuUsed() ? 'm-aside-left--enabled' : '') + ' ' + 'm-aside-left--skin-' + this._theme.baseSettings.menu.asideSkin + ' ' + 'm-aside-left--offcanvas' + ' ' + (this._theme.baseSettings.footer.fixedFooter && this._theme.baseSettings.layout.layoutType !== 'boxed' ? 'm-footer--fixed' : '') + ' ' + (this._theme.baseSettings.layout.fixedBody ? 'm-body--fixed' : '') + ' ' + (this._theme.baseSettings.layout.mobileFixedBody ? 'm-body--mobile-fixed' : '');
  }
  getAccountModuleBodyClass() {
    return 'm--skin- m-header--fixed m-header--fixed-mobile ' + (this.isLeftMenuUsed() ? ' m-aside-left--enabled' : '') + ' m-aside-left--skin-dark m-aside-left--offcanvas m-footer--push m-aside--offcanvas-default';
  }
  getSelectEditionBodyClass() {
    return 'm--skin-';
  }
  getSideBarMenuClass() {
    let menuCssClass = 'm-aside-menu m-aside-menu--skin-' + this._theme.baseSettings.menu.asideSkin;
    menuCssClass += ' m-aside-menu--submenu-skin-';
    menuCssClass += this._theme.baseSettings.menu.asideSkin;
    if (!this._theme.baseSettings.menu.fixedAside && this._theme.baseSettings.menu.submenuToggle === 'Dropdown') {
      menuCssClass += ' m-aside-menu--dropdown';
    }
    return menuCssClass;
  }
  getMenuListClass() {
    return 'm-menu__nav--dropdown-submenu-arrow';
  }
  getTopBarMenuContainerClass() {
    let menuCssClass = 'm-header__bottom m-header-menu--skin-' + this._theme.baseSettings.menu.asideSkin + ' m-container m-container--full-height m-container--responsive';
    if (this._theme.baseSettings.layout.layoutType === 'boxed') {
      return menuCssClass + ' m-container--xxl';
    }
    return menuCssClass;
  }
  getIsMenuScrollable() {
    return this._theme.allowMenuScroll && this._theme.baseSettings.menu.fixedAside;
  }
  getSideBarMenuItemClass(item, isMenuActive) {
    let menuCssClass = 'm-menu__item';
    if (item.items.length) {
      menuCssClass += ' m-menu__item--submenu';
    }
    if (isMenuActive) {
      menuCssClass += ' m-menu__item--open m-menu__item--expanded m-menu__item--active';
    }
    return menuCssClass;
  }
};
AppUiCustomizationService = (0,tslib__WEBPACK_IMPORTED_MODULE_0__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_1__.Injectable)()], AppUiCustomizationService);


/***/ }),

/***/ 70515:
/*!*************************************!*\
  !*** ./src/shared/dnd.directive.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   DndDirective: () => (/* binding */ DndDirective)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ 37580);


let DndDirective = class DndDirective {
  constructor() {
    this.fileDropped = new _angular_core__WEBPACK_IMPORTED_MODULE_0__.EventEmitter();
  }
  onDragOver(evt) {
    evt.preventDefault();
    evt.stopPropagation();
    this.fileOver = true;
  }
  onDragLeave(evt) {
    evt.preventDefault();
    evt.stopPropagation();
    this.fileOver = false;
  }
  ondrop(evt) {
    evt.preventDefault();
    evt.stopPropagation();
    this.fileOver = false;
    let files = evt.dataTransfer.files;
    if (files.length > 0) {
      this.fileDropped.emit(files);
    }
  }
  static {
    this.propDecorators = {
      fileOver: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.HostBinding,
        args: ['class.fileover']
      }],
      fileDropped: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.Output
      }],
      onDragOver: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.HostListener,
        args: ['dragover', ['$event']]
      }],
      onDragLeave: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.HostListener,
        args: ['dragleave', ['$event']]
      }],
      ondrop: [{
        type: _angular_core__WEBPACK_IMPORTED_MODULE_0__.HostListener,
        args: ['drop', ['$event']]
      }]
    };
  }
};
DndDirective = (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.Directive)({
  selector: '[appDnd]'
})], DndDirective);


/***/ }),

/***/ 15406:
/*!**************************************************!*\
  !*** ./src/shared/helpers/PrimengTableHelper.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PrimengTableHelper: () => (/* binding */ PrimengTableHelper)
/* harmony export */ });
class PrimengTableHelper {
  constructor() {
    this.predefinedRecordsCountPerPage = [5, 10, 25, 50, 100, 250, 500];
    this.defaultRecordsCountPerPage = 10;
    this.isResponsive = true;
    this.totalRecordsCount = 0;
    this.isLoading = false;
  }
  showLoadingIndicator() {
    setTimeout(() => {
      this.isLoading = true;
    }, 0);
  }
  hideLoadingIndicator() {
    setTimeout(() => {
      this.isLoading = false;
    }, 0);
  }
  getSorting(table) {
    let sorting;
    if (table.sortField) {
      sorting = table.sortField;
      if (table.sortOrder === 1) {
        sorting += ' ASC';
      } else if (table.sortOrder === -1) {
        sorting += ' DESC';
      }
    }
    return sorting;
  }
  getMaxResultCount(paginator, event) {
    if (paginator.rows) {
      return paginator.rows;
    }
    if (!event) {
      return 0;
    }
    return event.rows;
  }
  getSkipCount(paginator, event) {
    if (paginator.first) {
      return paginator.first;
    }
    if (!event) {
      return 0;
    }
    return event.first;
  }
  shouldResetPaging(event) {
    if (!event /*|| event.sortField*/) {
      // if you want to reset after sorting, comment out parameter
      return true;
    }
    return false;
  }
}

/***/ }),

/***/ 44734:
/*!***************************************************!*\
  !*** ./src/shared/utils/event-emitter.service.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   EventEmitterService: () => (/* binding */ EventEmitterService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var rxjs_internal_Subscription__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! rxjs/internal/Subscription */ 2510);



let EventEmitterService = class EventEmitterService {
  constructor() {
    this.invokeFirstComponentFunction = new _angular_core__WEBPACK_IMPORTED_MODULE_0__.EventEmitter();
    this.subsVar = new rxjs_internal_Subscription__WEBPACK_IMPORTED_MODULE_1__.Subscription();
  }
  onFirstComponentButtonClick() {
    this.invokeFirstComponentFunction.emit();
  }
  static {
    this.ctorParameters = () => [];
  }
};
EventEmitterService = (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_0__.Injectable)({
  providedIn: 'root'
}), (0,tslib__WEBPACK_IMPORTED_MODULE_2__.__metadata)("design:paramtypes", [])], EventEmitterService);


/***/ }),

/***/ 47674:
/*!***************************************************!*\
  !*** ./src/shared/utils/local-storage.service.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   LocalStorageService: () => (/* binding */ LocalStorageService)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var localforage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! localforage */ 55218);
/* harmony import */ var localforage__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(localforage__WEBPACK_IMPORTED_MODULE_0__);



let LocalStorageService = class LocalStorageService {
  getItem(key, callback) {
    if (!localforage__WEBPACK_IMPORTED_MODULE_0__) {
      return;
    }
    localforage__WEBPACK_IMPORTED_MODULE_0__.getItem(key, callback);
  }
  setItem(key, value) {
    if (!localforage__WEBPACK_IMPORTED_MODULE_0__) {
      return;
    }
    if (value === null) {
      value = undefined;
    }
    localforage__WEBPACK_IMPORTED_MODULE_0__.setItem(key, value);
  }
  removeItem(key, value) {
    if (!localforage__WEBPACK_IMPORTED_MODULE_0__) {
      return;
    }
    if (value === null) {
      value = undefined;
    }
    localforage__WEBPACK_IMPORTED_MODULE_0__.removeItem(key, value);
  }
  keys() {
    if (!localforage__WEBPACK_IMPORTED_MODULE_0__) {
      return;
    }
    return localforage__WEBPACK_IMPORTED_MODULE_0__.keys();
  }
};
LocalStorageService = (0,tslib__WEBPACK_IMPORTED_MODULE_1__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.Injectable)()], LocalStorageService);


/***/ }),

/***/ 80907:
/*!******************************************!*\
  !*** ./src/shared/utils/utils.module.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   UtilsModule: () => (/* binding */ UtilsModule)
/* harmony export */ });
/* harmony import */ var tslib__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! tslib */ 24398);
/* harmony import */ var _angular_common__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @angular/common */ 60316);
/* harmony import */ var _angular_core__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @angular/core */ 37580);
/* harmony import */ var _local_storage_service__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./local-storage.service */ 47674);
/* harmony import */ var _shared_common_pipes_localize_pipe__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @shared/common/pipes/localize.pipe */ 39295);
/* harmony import */ var _event_emitter_service__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./event-emitter.service */ 44734);



//import { ButtonBusyDirective } from './button-busy.directive';
// import { FriendProfilePictureComponent } from './friend-profile-picture.component';



let UtilsModule = class UtilsModule {};
UtilsModule = (0,tslib__WEBPACK_IMPORTED_MODULE_3__.__decorate)([(0,_angular_core__WEBPACK_IMPORTED_MODULE_4__.NgModule)({
  imports: [_angular_common__WEBPACK_IMPORTED_MODULE_5__.CommonModule],
  providers: [_event_emitter_service__WEBPACK_IMPORTED_MODULE_2__.EventEmitterService, _local_storage_service__WEBPACK_IMPORTED_MODULE_0__.LocalStorageService],
  declarations: [
  // FriendProfilePictureComponent,
  //ValidationMessagesComponent,
  _shared_common_pipes_localize_pipe__WEBPACK_IMPORTED_MODULE_1__.LocalizePipe],
  exports: [
  // EqualValidator,
  // FriendProfilePictureComponent,
  //ValidationMessagesComponent,
  _shared_common_pipes_localize_pipe__WEBPACK_IMPORTED_MODULE_1__.LocalizePipe]
})], UtilsModule);


/***/ }),

/***/ 14758:
/*!***************************************************************************!*\
  !*** ./src/app/visualizationComponents/PhylogeneticComponent/tidytree.js ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ TidyTree)
/* harmony export */ });
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! patristic */ 50826);
/* harmony import */ var patristic__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(patristic__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var d3__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! d3 */ 86164);


// import "patristic";
// import "d3";

/**
 * This class function creates a TidyTree object.
 * @param {String} newick A valid newick string
 * @param {Object} options A Javascript object containing options to set up the tree
 */
function TidyTree(data, options, events) {
  let defaults = {
    layout: "vertical",
    type: "tree",
    mode: "smooth",
    colorOptions: {
      nodeColorMode: "none"
    },
    leafNodes: true,
    leafLabels: false,
    equidistantLeaves: false,
    branchNodes: false,
    branchLabels: false,
    branchDistances: false,
    hStretch: 1,
    vStretch: 1,
    rotation: 0,
    ruler: true,
    animation: 500,
    margin: [50, 50, 50, 50] //CSS order: top, right, bottom, left
  };
  if (!options) options = {};
  Object.assign(this, defaults, options, {
    events: {
      draw: [],
      showtooltip: [],
      hidetooltip: [],
      contextmenu: [],
      search: [],
      select: []
    }
  });
  if (events) Object.keys(events).forEach(e => this.events[e].push(events[e]));
  if (this.parent) this.draw(this.parent);
  if (data instanceof patristic__WEBPACK_IMPORTED_MODULE_0__.Branch) {
    this.setData(data);
  } else {
    this.setTree(data);
  }
  if (this.parent) this.recenter();
}

/**
 * Update the TidyTree's underlying data structure
 * There are two contexts in which you should call this:
 * 	1. You wish to replace the tree with a completely different tree, given by a different newick string
 * 	2. Your underlying tree data has changed (e.g. the tree has been re-rooted)
 * @param  {Object} data A patristic.Branch object
 * @return {Object}        the TidyTree object
 */
TidyTree.prototype.setData = function (data) {
  if (!data) throw Error("Invalid Data");
  this.data = data;
  this.range = [Number.MAX_SAFE_INTEGER, Number.MIN_SAFE_INTEGER];
  this.hierarchy = d3__WEBPACK_IMPORTED_MODULE_1__.hierarchy(this.data, d => d.children).eachBefore(d => {
    d.value = (d.parent ? d.parent.value : 0) + (d.data.length ? Math.abs(d.data.length) : 0);
    if (d.value < this.range[0]) this.range[0] = d.value;
    if (d.value > this.range[1]) this.range[1] = d.value;
  }).each(d => d.value /= this.range[1]);
  if (this.parent) return this.redraw();
  return this;
};

/**
 * Update the TidyTree's underlying data structure
 * There are two contexts in which you should call this:
 * 	1. You wish to replace the tree with a completely different tree, given by a different newick string
 * 	2. Your underlying tree data has changed (e.g. the tree has been re-rooted)
 * @param  {String} newick A valid newick string
 * @return {Object}        the TidyTree object
 */
TidyTree.prototype.setTree = function (newick) {
  if (!newick) throw Error("Invalid Newick String");
  return this.setData(patristic__WEBPACK_IMPORTED_MODULE_0__.parseNewick(newick));
};

/**
 * The available layouts for rendering trees.
 * @type {Array}
 */
TidyTree.validLayouts = ["horizontal", "vertical", "circular"];

/**
 * The available types for rendering branches.
 * @type {Array}
 */
TidyTree.validTypes = ["tree", "weighted", "dendrogram"];

/**
 * The available modes for rendering branches.
 * @type {Array}
 */
TidyTree.validModes = ["smooth", "square", "straight"];

/**
 * The available color modes for rendering nodes.
 * @type {Array}
 */
TidyTree.validNodeColorModes = ["none", "list"]; // later, highlight on hover, or maybe color by annotation on a node/ search

/**
 * The available color modes for rendering branches.
 * @type {Array}
 */
TidyTree.validBranchColorModes = ["none", "monophyletic"]; // later, toRoot? 

/**
 * Draws a Phylogenetic on the element referred to by selector
 * @param  {String} selector A CSS selector
 * @return {TidyTree}           the TidyTree object
 */
TidyTree.prototype.draw = function (selector) {
  if (!selector && !this.parent) {
    throw Error("No valid target for drawing given! Where should the tree go?");
  }
  let parent = this.parent = d3__WEBPACK_IMPORTED_MODULE_1__.select(selector ? selector : this.parent);
  this.width = parseFloat(parent.style("width")) - this.margin[1] - this.margin[3];
  this.height = parseFloat(parent.style("height")) - this.margin[0] - this.margin[2] - 25;
  let tree = d3__WEBPACK_IMPORTED_MODULE_1__.tree();
  let svg = parent.html(null).append("svg").attr("width", "100%").attr("height", "100%");
  let g = svg.append("g");
  svg.append("g").attr("class", "tidytree-ruler").append("rect").attr("y", -5).attr("fill", "white");
  this.zoom = d3__WEBPACK_IMPORTED_MODULE_1__.zoom().on("zoom", () => {
    let transform = this.transform = d3__WEBPACK_IMPORTED_MODULE_1__.event.transform;
    g.attr("transform", `translate(${transform.x},${transform.y}) scale(${transform.k}) rotate(${this.rotation},${this.layout === "circular" ? 0 : this.width / 2},${this.layout === "circular" ? 0 : this.height / 2})`);
    updateRuler.call(this, transform);
  });
  svg.call(this.zoom);
  g.append("g").attr("class", "tidytree-links");
  g.append("g").attr("class", "tidytree-nodes");
  if (this.events.draw.length) this.events.draw.forEach(c => c());
  return this;
};
const getX = d => d.x,
  getY = d => d.y,
  getLength = d => d.weight;
let linkTransformers = {
  tree: {
    smooth: {
      horizontal: d3__WEBPACK_IMPORTED_MODULE_1__.linkHorizontal().x(getY).y(getX),
      vertical: d3__WEBPACK_IMPORTED_MODULE_1__.linkVertical().x(getX).y(getY),
      circular: d3__WEBPACK_IMPORTED_MODULE_1__.linkRadial().angle(getX).radius(getY)
    },
    straight: {
      horizontal: d => `M${d.source.y} ${d.source.x} L ${d.target.y} ${d.target.x}`,
      vertical: d => `M${d.source.x} ${d.source.y} L ${d.target.x} ${d.target.y}`,
      circular: d => {
        const startAngle = d.source.x - Math.PI / 2,
          startRadius = d.source.y,
          endAngle = d.target.x - Math.PI / 2,
          endRadius = d.target.y;
        const x0 = Math.cos(startAngle),
          y0 = Math.sin(startAngle),
          x1 = Math.cos(endAngle),
          y1 = Math.sin(endAngle);
        return "M" + startRadius * x0 + "," + startRadius * y0 + "L" + endRadius * x1 + "," + endRadius * y1;
      }
    },
    square: {
      horizontal: d => `M${d.source.y} ${d.source.x} V ${d.target.x} H ${d.target.y}`,
      vertical: d => `M${d.source.x} ${d.source.y} H ${d.target.x} V ${d.target.y}`,
      circular: d => {
        const startAngle = d.source.x - Math.PI / 2,
          startRadius = d.source.y,
          endAngle = d.target.x - Math.PI / 2,
          endRadius = d.target.y;
        const x0 = Math.cos(startAngle),
          y0 = Math.sin(startAngle),
          x1 = Math.cos(endAngle),
          y1 = Math.sin(endAngle);
        return "M" + startRadius * x0 + "," + startRadius * y0 + (endAngle === startAngle ? "" : "A" + startRadius + "," + startRadius + " 0 0 " + (endAngle > startAngle ? 1 : 0) + " " + startRadius * x1 + "," + startRadius * y1) + "L" + endRadius * x1 + "," + endRadius * y1;
      }
    }
  },
  weighted: {
    smooth: {
      horizontal: d3__WEBPACK_IMPORTED_MODULE_1__.linkHorizontal().x(getLength).y(getX),
      vertical: d3__WEBPACK_IMPORTED_MODULE_1__.linkVertical().x(getX).y(getLength),
      circular: d3__WEBPACK_IMPORTED_MODULE_1__.linkRadial().angle(getX).radius(getLength)
    },
    straight: {
      horizontal: d => `M${d.source.weight} ${d.source.x} L ${d.target.weight} ${d.target.x}`,
      vertical: d => `M${d.source.x} ${d.source.weight} L ${d.target.x} ${d.target.weight}`,
      circular: d => {
        const startAngle = d.source.x - Math.PI / 2,
          startRadius = d.source.weight,
          endAngle = d.target.x - Math.PI / 2,
          endRadius = d.target.weight;
        const x0 = Math.cos(startAngle),
          y0 = Math.sin(startAngle),
          x1 = Math.cos(endAngle),
          y1 = Math.sin(endAngle);
        return "M" + startRadius * x0 + "," + startRadius * y0 + "L" + endRadius * x1 + "," + endRadius * y1;
      }
    },
    square: {
      horizontal: d => `M${d.source.weight} ${d.source.x} V ${d.target.x} H ${d.target.weight}`,
      vertical: d => `M${d.source.x} ${d.source.weight} H ${d.target.x} V ${d.target.weight}`,
      circular: d => {
        const startAngle = d.source.x - Math.PI / 2,
          startRadius = d.source.weight,
          endAngle = d.target.x - Math.PI / 2,
          endRadius = d.target.weight;
        const x0 = Math.cos(startAngle),
          y0 = Math.sin(startAngle),
          x1 = Math.cos(endAngle),
          y1 = Math.sin(endAngle);
        return "M" + startRadius * x0 + "," + startRadius * y0 + (endAngle === startAngle ? "" : "A" + startRadius + "," + startRadius + " 0 0 " + (endAngle > startAngle ? 1 : 0) + " " + startRadius * x1 + "," + startRadius * y1) + "L" + endRadius * x1 + "," + endRadius * y1;
      }
    }
  }
};
linkTransformers.dendrogram = linkTransformers.tree;

/**
 * Calculate the coordinates of a point transformed onto a circle.
 *
 * @param {number} x - The x-coordinate of the center of the point.
 * @param {number} y - The y-coordinate of the center of the point.
 * @return {Array<number>} The new x and y coordinates of the point on the circle.
 */
function circularPoint(x, y) {
  return [(y = +y) * Math.cos(x -= Math.PI / 2), y * Math.sin(x)];
}
let nodeTransformers = {
  tree: {
    horizontal: d => `translate(${d.y}, ${d.x})`,
    vertical: d => `translate(${d.x}, ${d.y})`,
    circular: d => `translate(${circularPoint(d.x, d.y)})`
  },
  weighted: {
    horizontal: d => `translate(${d.weight}, ${d.x})`,
    vertical: d => `translate(${d.x}, ${d.weight})`,
    circular: d => `translate(${circularPoint(d.x, d.weight)})`
  }
};
nodeTransformers.dendrogram = nodeTransformers.tree;

/**
 * Finds the color of a given node based on the color options provided.
 *
 * @param {Object} node - The node for which to find the color.
 * @param {Object} colorOptions - The color options object containing the color mode, node list, default color, and highlight color.
 * @return {string} The color of the node.
 */
function findNodeColor(node, colorOptions) {
  if (colorOptions.nodeColorMode === "none") {
    // steelblue
    return colorOptions.defaultNodeColor ?? "#4682B4";
  }
  let nodeList = colorOptions.nodeList;
  if (nodeList && nodeList.includes(node.data._guid)) {
    // yellowish
    return colorOptions.highlightColor ?? "#feb640";
  } else {
    // charcoal
    return colorOptions.defaultNodeColor ?? "#243127";
  }
}

/**
 * Find the color of a given link based on the provided color options.
 *
 * @param {string} link - The link for which to find the color.
 * @param {object} colorOptions - The options for different link colors.
 * @return {string} The color of the link.
 */
function findBranchColor(link, colorOptions) {
  if (colorOptions.branchColorMode === "none") {
    // light gray
    return colorOptions.defaultBranchColor ?? "#cccccc";
  }
  let source = link.source;
  let childLeafNodes = getAllLeaves(source);
  let allChildLeafNodesInNodeList = childLeafNodes.every(child => colorOptions.nodeList?.includes(child.data._guid));
  if (allChildLeafNodesInNodeList) {
    // yellowish
    return colorOptions.highlightColor ?? "#feb640";
  }
  return colorOptions.defaultBranchColor ?? "#cccccc";
}

/**
 * Returns an array of all the child leaf nodes of the given node in a tree.
 *
 * @param {Object} node - A node of the tree.
 * @param {boolean} includeSelf - Whether to include the given node itself as a leaf node. Defaults to false.
 * @return {Array} An array of leaf nodes.
 */
function getAllLeaves(node, includeSelf) {
  includeSelf = includeSelf ?? false;
  let leaves = [];
  if (includeSelf && node.height === 0) {
    leaves.push(node);
  } else {
    node.children.forEach(child => {
      leaves.push(...getAllLeaves(child, true));
    });
  }
  return leaves;
}
const radToDeg = 180 / Math.PI;
let labelTransformers = {
  tree: {
    straight: {
      horizontal: l => `translate(${(l.source.y + l.target.y) / 2}, ${(l.source.x + l.target.x) / 2}) rotate(${Math.atan((l.target.x - l.source.x) / (l.target.y - l.source.y)) * radToDeg})`,
      vertical: l => `translate(${(l.source.x + l.target.x) / 2}, ${(l.source.y + l.target.y) / 2}) rotate(${Math.atan((l.source.y - l.target.y) / (l.source.x - l.target.x)) * radToDeg})`,
      circular: l => {
        let s = circularPoint(l.source.x, l.source.y),
          t = circularPoint(l.target.x, l.target.y);
        return `translate(${(s[0] + t[0]) / 2}, ${(s[1] + t[1]) / 2}) rotate(${Math.atan((s[1] - t[1]) / (s[0] - t[0])) * radToDeg})`;
      }
    },
    square: {
      horizontal: l => `translate(${(l.source.y + l.target.y) / 2}, ${l.target.x})`,
      vertical: l => `translate(${l.target.x}, ${(l.source.y + l.target.y) / 2}) rotate(90)`,
      circular: l => {
        let u = circularPoint(l.target.x, (l.source.y + l.target.y) / 2);
        return `translate(${u[0]}, ${u[1]}) rotate(${l.target.x * radToDeg % 180 - 90})`;
      }
    }
  },
  weighted: {
    straight: {
      horizontal: l => `translate(${(l.source.weight + l.target.weight) / 2}, ${(l.source.x + l.target.x) / 2}) rotate(${Math.atan((l.target.x - l.source.x) / (l.target.weight - l.source.weight)) * radToDeg})`,
      vertical: l => `translate(${(l.source.x + l.target.x) / 2}, ${(l.source.weight + l.target.weight) / 2}) rotate(${Math.atan((l.source.weight - l.target.weight) / (l.source.x - l.target.x)) * radToDeg})`,
      circular: l => {
        let s = circularPoint(l.source.x, l.source.weight),
          t = circularPoint(l.target.x, l.target.weight);
        return `translate(${(s[0] + t[0]) / 2}, ${(s[1] + t[1]) / 2}) rotate(${Math.atan((s[1] - t[1]) / (s[0] - t[0])) * radToDeg})`;
      }
    },
    square: {
      horizontal: l => `
        translate(${(l.source.weight + l.target.weight) / 2}, ${l.target.x})
      `,
      vertical: l => `
        translate(${l.target.x}, ${(l.source.weight + l.target.weight) / 2})
        rotate(90)
      `,
      circular: l => {
        let u = circularPoint(l.target.x, (l.source.weight + l.target.weight) / 2);
        return `
          translate(${u[0]}, ${u[1]})
          rotate(${l.target.x * radToDeg % 180 - 90})
        `;
      }
    }
  }
};
labelTransformers.tree.smooth = labelTransformers.tree.straight;
labelTransformers.weighted.smooth = labelTransformers.weighted.straight;
labelTransformers.dendrogram = labelTransformers.tree;
function labeler(d) {
  if (!d.target.data.length) return "0.000";
  return d.target.data.length.toFixed(3);
}

/**
 * Redraws the links and relocates the nodes accordingly
 * @return {TidyTree} The TidyTree Object
 */
TidyTree.prototype.redraw = function () {
  let parent = this.parent;
  this.width = (parseFloat(parent.style("width")) - this.margin[1] - this.margin[3]) * this.hStretch;
  this.height = (parseFloat(parent.style("height")) - this.margin[0] - this.margin[2] - 25) * this.vStretch;
  this.scalar = this.layout === "horizontal" ? this.width : this.layout === "vertical" ? this.height : Math.min(this.width, this.height) / 2;
  this.hierarchy.each(d => d.weight = this.scalar * d.value);
  let g = parent.select("svg g");
  let source = (this.type === "tree" ? d3__WEBPACK_IMPORTED_MODULE_1__.tree() : d3__WEBPACK_IMPORTED_MODULE_1__.cluster()).size(this.layout === "circular" ? [2 * Math.PI, Math.min(this.height, this.width) / 2] : this.layout === "horizontal" ? [this.height, this.width] : [this.width, this.height]);
  if (this.equidistantLeaves) {
    if (this.layout === "circular") {
      source.separation((a, b) => 1 / a.depth);
    } else {
      source.separation((a, b) => 1);
    }
  } else {
    if (this.layout === "circular") source.separation((a, b) => (a.parent == b.parent ? 1 : 2) / a.depth);
  }

  //Note: You must render links prior to nodes in order to get correct placement!
  let links = g.select("g.tidytree-links").selectAll("g.tidytree-link").data(source(this.hierarchy).links(), l => l.source.data._guid + ':' + l.target.data._guid);
  links.join(enter => {
    let newLinks = enter.append("g").attr("class", "tidytree-link");
    let linkTransformer = linkTransformers[this.type][this.mode][this.layout];
    console.log(linkTransformer);
    console.log(newLinks);
    newLinks.append("path").attr("fill", "none").attr("stroke", d => findBranchColor(d, this.colorOptions)).attr("d", linkTransformer).transition().duration(this.animation).attr("opacity", 1);
    let labelTransformer = labelTransformers[this.type][this.mode][this.layout];
    newLinks.append("text").attr("y", 2).attr("text-anchor", "middle").style("font-size", "12px").text(labeler).attr("transform", labelTransformer).transition().duration(this.animation).style("opacity", this.branchDistances ? 1 : 0);
  }, update => {
    let linkTransformer = linkTransformers[this.type][this.mode][this.layout];
    let paths = update.select("path");
    if (!this.animation > 0) {
      paths.attr("d", linkTransformer).attr("stroke", d => findBranchColor(d, this.colorOptions));
    } else {
      paths.transition().duration(this.animation / 2).attr("stroke", d => findBranchColor(d, this.colorOptions)).attr("opacity", 0).end().then(() => {
        paths.attr("d", linkTransformer).transition().duration(this.animation / 2).attr("opacity", 1);
      });
    }
    let labelTransformer = labelTransformers[this.type][this.mode][this.layout];
    let labels = update.select("text");
    if (this.animation) {
      labels.transition().duration(this.animation / 2).style("opacity", 0).end().then(() => {
        labels.text(labeler).attr("transform", labelTransformer);
        if (this.branchDistances) {
          labels.transition().duration(this.animation / 2).style("opacity", this.branchDistances ? 1 : 0);
        }
      });
    } else {
      labels.text(labeler).attr("transform", labelTransformer);
    }
  }, exit => exit.transition().duration(this.animation).attr("opacity", 0).remove());
  let nodes = g.select("g.tidytree-nodes").selectAll("g.tidytree-node").data(this.hierarchy.descendants(), d => d.data._guid);
  nodes.join(enter => {
    let nt = nodeTransformers[this.type][this.layout];
    let newNodes = enter.append("g").attr("class", "tidytree-node").classed("tidytree-node-internal", d => d.children).classed("tidytree-node-leaf", d => !d.children).attr("transform", nt);
    newNodes.append("circle").attr("title", d => d.data.id).style("opacity", d => d.children && this.branchNodes || !d.children && this.leafNodes ? 1 : 0).style("fill", d => findNodeColor(d, this.colorOptions)).on("mouseenter focusin", d => this.trigger("showtooltip", d)).on("mouseout focusout", d => this.trigger("hidetooltip", d)).on("contextmenu", d => this.trigger("contextmenu", d)).on("click", d => this.trigger("select", d)).attr("r", 2.5);
    let nodeLabels = newNodes.append("text").text(d => d.data.id).style("font-size", "12px").attr("y", 2).style("opacity", d => d.children && this.branchLabels || !d.children && this.leafLabels ? 1 : 0);
    if (this.layout === "vertical") {
      nodeLabels.attr("text-anchor", "start").attr("x", 5).transition().duration(this.animation).attr("transform", "rotate(90)");
    } else if (this.layout === "horizontal") {
      nodeLabels.attr("text-anchor", "start").attr("x", 5).transition().duration(this.animation).attr("transform", "rotate(0)");
    } else {
      nodeLabels.transition().duration(this.animation).attr("transform", l => `rotate(${l.x / Math.PI * 180 % 180 - 90})`).attr("text-anchor", l => l.x % (2 * Math.PI) > Math.PI ? "end" : "start").attr("x", l => l.x % (2 * Math.PI) > Math.PI ? -5 : 5);
    }
    newNodes.transition().duration(this.animation).attr("opacity", 1);
  }, update => {
    let nodeTransformer = nodeTransformers[this.type][this.layout];
    update.transition().duration(this.animation).attr("transform", nodeTransformer);
    let nodeGlyphs = update.select("circle");
    nodeGlyphs.style("fill", d => findNodeColor(d, this.colorOptions));
    let nodeLabels = update.select("text");
    if (this.layout === "vertical") {
      nodeLabels.attr("text-anchor", "start").attr("x", 5).transition().duration(this.animation).attr("transform", "rotate(90)");
    } else if (this.layout === "horizontal") {
      nodeLabels.attr("text-anchor", "start").attr("x", 5).transition().duration(this.animation).attr("transform", "rotate(0)");
    } else {
      nodeLabels.transition().duration(this.animation).attr("transform", l => `rotate(${l.x / Math.PI * 180 % 180 - 90})`).attr("text-anchor", l => l.x % (2 * Math.PI) > Math.PI ? "end" : "start").attr("x", l => l.x % (2 * Math.PI) > Math.PI ? -5 : 5);
    }
  }, exit => exit.transition().duration(this.animation).attr("opacity", 0).remove());
  updateRuler.call(this);
  return this;
};
function updateRuler(transform) {
  if (!transform) transform = {
    k: 1
  };
  let height = parseFloat(this.parent.style("height")) - this.margin[2] - 15;
  let ruler = this.parent.select("g.tidytree-ruler");
  let bg = ruler.select("rect");
  if (this.ruler) {
    if (this.layout == "horizontal") {
      ruler.attr("transform", `translate(${this.margin[3]}, ${height})`);
      bg.attr("width", `calc(100% - ${this.margin[1] + this.margin[3] - 15}px)`).attr("height", "25px").attr("x", -5);
    } else {
      ruler.attr("transform", `translate(${this.margin[3] - 10}, ${this.margin[0]})`);
      bg.attr("height", `calc(100% - ${this.margin[0] + this.margin[2] - 15}px)`).attr("width", "25px").attr("x", -25);
    }
    let axis = this.layout == "horizontal" ? d3__WEBPACK_IMPORTED_MODULE_1__.axisBottom() : d3__WEBPACK_IMPORTED_MODULE_1__.axisLeft();
    if (this.type === "tree" && this.layout !== "circular") {
      ruler.attr("opacity", 1).call(axis.scale(d3__WEBPACK_IMPORTED_MODULE_1__.scaleLinear([0, this.hierarchy.height / transform.k], [0, this.scalar])));
    } else if (this.type === "weighted" && this.layout !== "circular") {
      ruler.attr("opacity", 1).call(axis.scale(d3__WEBPACK_IMPORTED_MODULE_1__.scaleLinear([this.range[0], this.range[1] / transform.k], [0, this.scalar])));
    } else {
      ruler.transition().duration(this.animation).attr("opacity", 0);
    }
  } else {
    ruler.transition().duration(this.animation).attr("opacity", 0);
  }
}

/**
 * Recenters the tree in the center of the view
 * @return {TidyTree} The TidyTree object
 */
TidyTree.prototype.recenter = function () {
  let svg = this.parent.select("svg"),
    x = this.margin[0],
    y = this.margin[3];
  if (this.layout === "circular") {
    x += parseFloat(svg.style("width")) / 2;
    y += parseFloat(svg.style("height")) / 2;
  }
  svg.transition().duration(this.animation).call(this.zoom.transform, d3__WEBPACK_IMPORTED_MODULE_1__.zoomIdentity.translate(x, y));
  return this;
};

/**
 * Set the TidyTree's layout
 * @param {String} newLayout The new layout
 * @return {TidyTree} The TidyTree Object
 */
TidyTree.prototype.setLayout = function (newLayout) {
  if (!TidyTree.validLayouts.includes(newLayout)) {
    throw Error(`
      Cannot set TidyTree to layout: ${newLayout}\n
      Valid layouts are: ${TidyTree.validLayouts.join(', ')}
    `);
  }
  this.layout = newLayout;
  if (this.parent) return this.redraw();
  return this;
};

/**
 * Set the TidyTree's colorOptions
 * @param {Object} newColorOptions The new colorOptions
 * @return {TidyTree} The TidyTree Object
 */
TidyTree.prototype.setColorOptions = function (newColorOptions) {
  if (!TidyTree.validNodeColorModes.includes(newColorOptions.nodeColorMode)) {
    throw Error(`
      Cannot set TidyTree colorOptions: ${newColorOptions.nodeColorMode}\n
      Valid nodeColorModes are: ${TidyTree.validNodeColorModes.join(', ')}
    `);
  }
  if (!TidyTree.validBranchColorModes.includes(newColorOptions.branchColorMode)) {
    throw Error(`
      Cannot set TidyTree colorOptions: ${newColorOptions.branchColorMode}\n
      Valid branchColorModes are: ${TidyTree.validBranchColorModes.join(', ')}
    `);
  }
  if (newColorOptions.nodeColorMode === 'list') {
    if (!Array.isArray(newColorOptions.nodeList)) {
      throw Error('nodeList must be an array for nodeColorMode "list"');
    }
  } else {
    // nodeColorMode === 'none'
    if (newColorOptions.branchColorMode !== 'none') {
      throw Error('branchColorMode must be "none" for nodeColorMode "none"');
    }
  }
  this.colorOptions = newColorOptions;
  if (this.parent) return this.redraw();
  return this;
};

/**
 * Set the TidyTree's mode
 * @param {String} newMode The new mode
 * @return {TidyTree} The TidyTree object
 */
TidyTree.prototype.setMode = function (newMode) {
  if (!TidyTree.validModes.includes(newMode)) {
    throw Error(`
      Cannot set TidyTree to mode: ${newMode},\n
      Valid modes are: ${TidyTree.validModes.join(', ')}
    `);
  }
  this.mode = newMode;
  if (this.parent) return this.redraw();
  return this;
};

/**
 * Set the TidyTree's type
 * @param {Boolean} newType The new type
 * @return {TidyTree} the TidyTree object
 */
TidyTree.prototype.setType = function (newType) {
  if (!TidyTree.validTypes.includes(newType)) {
    throw Error(`
      Cannot set TidyTree to type: ${newType},\n
      Valid types are: ${TidyTree.validTypes.join(', ')}
    `);
  }
  this.type = newType;
  if (this.parent) return this.redraw();
  return this;
};

/**
 * Set the TidyTree's rotation
 * @param {Number} degrees The new number of degrees by which to rotate the tree
 * @return {TidyTree} the TidyTree object
 */
TidyTree.prototype.setRotation = function (degrees) {
  this.rotation = degrees;
  if (this.parent) this.parent.select("svg g").attr("transform", `
        translate(${this.transform.x},${this.transform.y})
        scale(${this.transform.k})
        rotate(${this.rotation},
          ${this.layout === "circular" ? 0 : this.width / 2},
          ${this.layout === "circular" ? 0 : this.height / 2}
        )
      `);
  return this;
};

/**
 * Set the TidyTree's Horizontal Stretch
 * @param {Number} proportion The new proportion by which to stretch the tree
 * @return {TidyTree} the TidyTree object
 */
TidyTree.prototype.setHStretch = function (proportion) {
  this.hStretch = parseFloat(proportion);
  if (this.parent) {
    let animCache = this.animation;
    this.setAnimation(0);
    this.redraw();
    this.setAnimation(animCache);
  }
  return this;
};

/**
 * Set the TidyTree's Vertical Stretch
 * @param {Number} proportion The new proportion by which to stretch the tree
 * @return {TidyTree} the TidyTree object
 */
TidyTree.prototype.setVStretch = function (proportion) {
  this.vStretch = parseFloat(proportion);
  if (this.parent) {
    let animCache = this.animation;
    this.setAnimation(0);
    this.redraw();
    this.setAnimation(animCache);
  }
  return this;
};

/**
 * Set the TidyTree's animation time. Note that this does not trigger a
 * redraw.
 * @param {number} time The desired duration of an animation, in ms. Set to 0
 * to turn animations off completely.
 * @return {TidyTree} The TidyTree object
 */
TidyTree.prototype.setAnimation = function (time) {
  this.animation = time;
  return this;
};

/**
 * Shows or hides the Branch Nodes
 * @param  {Boolean} show Should Branch nodes be shown?
 * @return {TidyTree} the TidyTree object
 */
TidyTree.prototype.setBranchNodes = function (show) {
  this.branchNodes = show ? true : false;
  if (this.parent) {
    //i.e. has already been drawn
    this.parent.select("svg").selectAll("g.tidytree-node-internal circle").transition().duration(this.animation).style("opacity", show ? 1 : 0);
  }
  return this;
};

/**
 * Restyles Leaf Nodes
 * @param  {Function} styler A function that restyles each node. `styler`
 * receives a reference to the DOM node to be styled, and an associated data
 * object.
 * @return {TidyTree} the TidyTree Object
 */
TidyTree.prototype.eachBranchNode = function (styler) {
  if (!this.parent) throw Error("Tree has not been rendered yet! Can't style Nodes that don't exist!");
  this.parent.select("svg").selectAll("g.tidytree-node-internal circle").each(function (d) {
    styler(this, d);
  });
  return this;
};

/**
 * Set the TidyTree's branchLabels
 * @param  {Boolean} show Should the TidyTree show branchLabels?
 * @return {TidyTree}     the TidyTree Object
 */
TidyTree.prototype.setBranchLabels = function (show) {
  this.branchLabels = show ? true : false;
  if (this.parent) {
    //i.e. has already been drawn
    this.parent.select("svg").selectAll("g.tidytree-node-internal text").transition().duration(this.animation).style("opacity", show ? 1 : 0);
  }
  return this;
};

/**
 * Restyles Branch Label
 * @param  {Function} styler A function that restyles each node. `styler`
 * receives a reference to the DOM node to be styled, and an associated data
 * object.
 * @return {TidyTree} the TidyTree Object
 */
TidyTree.prototype.eachBranchLabel = function (styler) {
  if (!this.parent) {
    throw Error("Tree has not been rendered yet! Can't style Nodes that don't exist!");
  }
  this.parent.select("svg").selectAll("g.tidytree-node-internal text").each(function (d, i, l) {
    styler(this, d);
  });
  return this;
};

/**
 * Shows or hides the TidyTree's branch labels
 * @param {Boolean} show Should the TidyTree show branch distances?
 * @return {TidyTree} The TidyTree Object
 */
TidyTree.prototype.setBranchDistances = function (show) {
  this.branchDistances = show ? true : false;
  if (this.parent) {
    //i.e. has already been drawn
    let links = this.parent.select("svg g.tidytree-links").selectAll("g.tidytree-link").selectAll("text");
    links.attr("transform", labelTransformers[this.type][this.mode][this.layout]);
    links.transition().duration(this.animation).style("opacity", show ? 1 : 0);
  }
  return this;
};

/**
 * Restyles Branch Distances
 * @param  {Function} styler A function that restyles each node. `styler`
 * receives a reference to the DOM node to be styled, and an associated data
 * object.
 * @return {TidyTree} the TidyTree Object
 */
TidyTree.prototype.eachBranchDistance = function (styler) {
  if (!this.parent) throw Error("Tree has not been rendered yet! Can't style Nodes that don't exist!");
  this.parent.select("svg g.tidytree-links").selectAll("g.tidytree-link").selectAll("text").each(function (d, i, l) {
    styler(this, d);
  });
  return this;
};

/**
 * Shows or Hides the Leaf Nodes
 * @param  {Boolean} show Should leaf nodes be visible?
 * @return {TidyTree} The TidyTree Object
 */
TidyTree.prototype.setLeafNodes = function (show) {
  this.leafNodes = show ? true : false;
  if (this.parent) {
    //i.e. has already been drawn
    this.parent.select("svg").selectAll("g.tidytree-node-leaf circle").transition().duration(this.animation).style("opacity", show ? 1 : 0);
  }
  return this;
};

/**
 * Restyles Leaf Nodes
 * @param  {Function} styler A function that restyles each node. `styler`
 * receives a reference to the DOM node to be styled, and an associated data
 * object.
 * @return {TidyTree} the TidyTree Object
 */
TidyTree.prototype.eachLeafNode = function (styler) {
  if (!this.parent) {
    throw Error("Tree has not been rendered yet! Can't style Nodes that don't exist!");
  }
  this.parent.select("svg").selectAll("g.tidytree-node-leaf circle").each(function (d) {
    styler(this, d);
  });
  return this;
};

/**
 * Set the TidyTree's leaves to be equidistant
 */
TidyTree.prototype.setEquidistantLeaves = function (isEquidistant) {
  this.equidistantLeaves = isEquidistant ? true : false;
  if (this.parent) return this.redraw();
  return this;
};

/**
 * Shows or Hides the TidyTree's Leaf Labels
 * @param  {Boolean} show Should the TidyTree show leafLabels?
 * @return {TidyTree}     the TidyTree Object
 */
TidyTree.prototype.setLeafLabels = function (show) {
  this.leafLabels = show ? true : false;
  if (this.parent) {
    //i.e. has already been drawn
    this.parent.select("svg").selectAll("g.tidytree-node-leaf text").transition().duration(this.animation).style("opacity", show ? 1 : 0);
  }
  return this;
};

/**
 * Restyles Leaf Labels
 * @param  {Function} styler A function that restyles each node. `styler`
 * receives a reference to the DOM node to be styled, and an associated data
 * object.
 * @return {TidyTree} the TidyTree Object
 */
TidyTree.prototype.eachLeafLabel = function (styler) {
  if (!this.parent) {
    throw Error("Tree has not been rendered yet! Can't style Nodes that don't exist!");
  }
  this.parent.select("svg").selectAll("g.tidytree-node-leaf text").each(function (d) {
    styler(this, d);
  });
  return this;
};

/**
 * Shows or hides the TidyTree's branch labels
 * @param {Boolean} show Should the TidyTree show branchLabels?
 * @return {TidyTree} The TidyTree Object
 */
TidyTree.prototype.setRuler = function (show) {
  this.ruler = show ? true : false;
  if (this.parent) {
    //i.e. has already been drawn
    if (show) {
      this.parent.select("g.tidytree-ruler").transition().duration(this.animation).attr("opacity", 1);
    } else {
      this.parent.select("g.tidytree-ruler").transition().duration(this.animation).attr("opacity", 0);
    }
  }
  return this;
};

/**
 * Retrieves the GUIDs of the nodes in the TidyTree instance.
 *
 * @param {boolean} leavesOnly - Whether to retrieve GUIDs only for leaf nodes.
 * @param {function} predicate - A function that returns true if the node should be included
 * @return {Array} An array of GUIDs of the nodes.
 */
TidyTree.prototype.getNodeGUIDs = function (leavesOnly, predicate) {
  let nodeList = this.parent.select("svg").selectAll("g.tidytree-node-leaf circle")._groups[0];
  if (!leavesOnly) {
    nodeList = this.parent.select("svg").selectAll("g.tidytree-node-leaf circle, g.tidytree-node-internal circle")._groups[0];
  }
  let nodeGUIDs = [];
  for (const node of nodeList.values()) {
    if (!predicate || predicate(node)) {
      nodeGUIDs.push(node.__data__.data._guid);
    }
  }
  return nodeGUIDs;
};

/**
 * Searches the tree, returns Search Results
 * @param  {Function} test A function which takes a Branch and returns a Truthy
 * or Falsy value.
 * @return {Array} The array of results
 */
TidyTree.prototype.search = function (test) {
  if (!test) return;
  let results = this.parent.select("svg g.tidytree-nodes").selectAll("g.tidytree-node").filter(test);
  if (this.events.search.length) this.events.search.forEach(c => c(results));
  return results;
};

/**
 * Attaches a new event listener
 * Please note that this is not yet functioning.
 * @param  {String}   events   A space-delimited list of event names
 * @param  {Function} callback The function to run when one of the `events` occurs.
 * @return {TidyTree} The TidyTree on which this method was called.
 */
TidyTree.prototype.on = function (events, callback) {
  events.split(" ").forEach(event => this.events[event].push(callback));
  return this;
};

/**
 * Removes all event listeners from the given events
 * @param  {String}   events   A space-delimited list of event names
 * @return {TidyTree} The TidyTree on which this method was called.
 */
TidyTree.prototype.off = function (events) {
  events.split(" ").forEach(event => this.events[event] = []);
  return this;
};

/**
 * Forces the tree to respond as though an `event` has occurred
 * @param  {String} events space-delimited list of names of events to trigger.
 * @param  {Spread} args Any arguments which should be passed to the event
 * handler(s).
 * @return The output of the callback run on `event`
 */
TidyTree.prototype.trigger = function (events, ...args) {
  return events.split(" ").map(event => {
    if (this.events[event].length) return this.events[event].map(handler => handler(args));
    return [];
  });
};

/**
 * Destroys the TidyTree
 * @return {undefined}
 */
TidyTree.prototype.destroy = function () {
  if (this.parent) {
    //i.e. has already been drawn
    this.parent.html(null);
  }
  delete this; //Go to work, GC!
};

/***/ }),

/***/ 34213:
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./src/app/golden-layout-host.component.ts.css?ngResource!=!./node_modules/@ngtools/webpack/src/loaders/inline-resource.js?data=CiAgICA6aG9zdCB7CiAgICAgIGhlaWdodDogMTAwJTsKICAgICAgd2lkdGg6IDEwMCU7CiAgICAgIHBhZGRpbmc6IDA7CiAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICB9CiAgICA%3D!./src/app/golden-layout-host.component.ts ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `
    :host {
      height: 100%;
      width: 100%;
      padding: 0;
      display: block;
      position: relative;
    }
    `, "",{"version":3,"sources":["webpack://./src/app/golden-layout-host.component.ts"],"names":[],"mappings":";IACI;MACE,YAAY;MACZ,WAAW;MACX,UAAU;MACV,cAAc;MACd,kBAAkB;IACpB","sourcesContent":["\n    :host {\n      height: 100%;\n      width: 100%;\n      padding: 0;\n      display: block;\n      position: relative;\n    }\n    "],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 11965:
/*!******************************************************************************************!*\
  !*** ./src/app/visualizationComponents/MapComponent/map-plugin.component.css?ngResource ***!
  \******************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `.mapStyle{
    height:100%;
    width:100%;
    /* height:calc(100vh - 350px); */
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1;
    /* position: sticky !important; */
}

:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
}

.map-container {
  height: 100%;
  width: 100%;
  position: relative;
}


#mapTooltip {
    color:#333333;
    background:#f5f5f5;
    border:1px solid #cccccc;
    border-radius:.25rem;
    padding:.25rem;
  }

  .bottom-table{
    font-size: calc((.5vmax));   
}

.OSM-credit {
  position: absolute;
  bottom: 7px;
  left: 50px;
  z-index: 2;
}

.OSM-credit a {
  color: #4e8bb7 !important;
  text-decoration: underline !important;
  cursor: pointer !important;
}

 /* Button appearance on hover */
 .btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
  background: white;
}

.flaticon-settings:before {
  font-weight: 800 !important;
}


.flaticon-download:before {
  font-weight: 800 !important;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/MapComponent/map-plugin.component.css"],"names":[],"mappings":"AAAA;IACI,WAAW;IACX,UAAU;IACV,gCAAgC;IAChC,kBAAkB;IAClB,MAAM;IACN,SAAS;IACT,OAAO;IACP,QAAQ;IACR,UAAU;IACV,iCAAiC;AACrC;;AAEA;EACE,kBAAkB;EAClB,gBAAgB;EAChB,qBAAqB;AACvB;;AAEA;EACE,YAAY;EACZ,WAAW;EACX,kBAAkB;AACpB;;;AAGA;IACI,aAAa;IACb,kBAAkB;IAClB,wBAAwB;IACxB,oBAAoB;IACpB,cAAc;EAChB;;EAEA;IACE,yBAAyB;AAC7B;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,UAAU;EACV,UAAU;AACZ;;AAEA;EACE,yBAAyB;EACzB,qCAAqC;EACrC,0BAA0B;AAC5B;;CAEC,+BAA+B;CAC/B;EACC,qBAAqB,EAAE,4BAA4B;EACnD,oCAAoC,EAAE,qCAAqC;AAC7E;;AAEA;EACE,kBAAkB;EAClB,0CAA0C;EAC1C,iBAAiB;AACnB;;AAEA;EACE,2BAA2B;AAC7B;;;AAGA;EACE,2BAA2B;AAC7B","sourcesContent":[".mapStyle{\n    height:100%;\n    width:100%;\n    /* height:calc(100vh - 350px); */\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 1;\n    /* position: sticky !important; */\n}\n\n:host {\n  position: absolute;\n  overflow: hidden;\n  z-index: 1 !important;\n}\n\n.map-container {\n  height: 100%;\n  width: 100%;\n  position: relative;\n}\n\n\n#mapTooltip {\n    color:#333333;\n    background:#f5f5f5;\n    border:1px solid #cccccc;\n    border-radius:.25rem;\n    padding:.25rem;\n  }\n\n  .bottom-table{\n    font-size: calc((.5vmax));   \n}\n\n.OSM-credit {\n  position: absolute;\n  bottom: 7px;\n  left: 50px;\n  z-index: 2;\n}\n\n.OSM-credit a {\n  color: #4e8bb7 !important;\n  text-decoration: underline !important;\n  cursor: pointer !important;\n}\n\n /* Button appearance on hover */\n .btn-icon:hover {\n  transform: scale(1.1); /* Slight enlarge on hover */\n  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n\n.btn-icon {\n  margin-right: 10px;\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n  background: white;\n}\n\n.flaticon-settings:before {\n  font-weight: 800 !important;\n}\n\n\n.flaticon-download:before {\n  font-weight: 800 !important;\n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 8274:
/*!***********************************************!*\
  !*** ./src/app/app.component.scss?ngResource ***!
  \***********************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `#main-tabset {
  height: 100%;
}

#phylocanvas {
  height: 100%;
}

body .ui-tabview {
  height: 100% !important;
}

body .ui-tabview .ui-tabview-panels {
  height: 100% !important;
}

body .ui-tabview .ui-tabview-panels .ui-tabview-panel {
  height: 100% !important;
}

:root {
  --vis-graph-node-label-background: black;
}`, "",{"version":3,"sources":["webpack://./src/app/app.component.scss"],"names":[],"mappings":"AAAA;EACI,YAAA;AACJ;;AACA;EACI,YAAA;AAEJ;;AAAA;EACI,uBAAA;AAGJ;;AADA;EACI,uBAAA;AAIJ;;AAFA;EACI,uBAAA;AAKJ;;AAFA;EACI,wCAAA;AAKJ","sourcesContent":["#main-tabset {\n    height: 100%;\n}\n#phylocanvas {\n    height: 100%;\n}\nbody .ui-tabview {\n    height: 100% !important;\n}\nbody .ui-tabview .ui-tabview-panels {\n    height: 100% !important;\n}\nbody .ui-tabview .ui-tabview-panels .ui-tabview-panel {\n    height: 100% !important;\n}\n\n:root {\n    --vis-graph-node-label-background: black;\n  }\n\n"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 11954:
/*!************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/AggregateComponent/aggregate.component.scss?ngResource ***!
  \************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
  padding: 1px;
}

:host ::ng-deep .p-accordion-tab:not(.p-accordion-tab-active) .p-toggleable-content {
  height: 0;
  overflow: hidden;
}
:host ::ng-deep .p-accordion-tab.p-accordion-tab-active .p-toggleable-content {
  height: auto !important;
  overflow: auto !important;
}

.aggregate-wrapper {
  padding: 50px 20px 5px 20px;
}

/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
}

.flaticon-settings:before {
  font-weight: 800 !important;
}

.flaticon-pin:before {
  font-weight: 800 !important;
}

.flaticon-download:before {
  font-weight: 800 !important;
}

#tablesContainer p-table {
  border: 2px solid #555555;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/AggregateComponent/aggregate.component.scss"],"names":[],"mappings":"AAAA;EACI,kBAAA;EACA,gBAAA;EACA,qBAAA;EACA,YAAA;AACJ;;AAII;EACE,SAAA;EACA,gBAAA;AADN;AAMI;EACE,uBAAA;EACA,yBAAA;AAJN;;AAQA;EACE,2BAAA;AALF;;AAQA,+BAAA;AACA;EACE,qBAAA,EAAA,4BAAA;EACA,oCAAA,EAAA,qCAAA;AALF;;AAQA;EACE,kBAAA;EACA,0CAAA;AALF;;AAQA;EACE,2BAAA;AALF;;AAQA;EACE,2BAAA;AALF;;AAQA;EACE,2BAAA;AALF;;AAQA;EACE,yBAAA;AALF","sourcesContent":[":host {\n    position: absolute;\n    overflow: hidden;\n    z-index: 1 !important;\n    padding: 1px; \n}\n\n:host ::ng-deep {\n  .p-accordion-tab:not(.p-accordion-tab-active) {\n    .p-toggleable-content {\n      height: 0;\n      overflow: hidden;\n    }\n  }\n\n  .p-accordion-tab.p-accordion-tab-active {\n    .p-toggleable-content {\n      height: auto !important;\n      overflow: auto !important;\n    }\n  }\n}\n.aggregate-wrapper {\n  padding: 50px 20px 5px 20px;\n}\n\n/* Button appearance on hover */\n.btn-icon:hover {\n  transform: scale(1.1); /* Slight enlarge on hover */\n  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n    \n.btn-icon {\n  margin-right: 10px;\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n}\n\n.flaticon-settings:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-pin:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-download:before {\n  font-weight: 800 !important;\n}\n\n#tablesContainer p-table {\n  border: 2px solid #555555;\n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 67368:
/*!****************************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/AlignmentViewComponent/alignment-view-plugin-component.scss?ngResource ***!
  \****************************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
  padding: 1px;
}

:host ::ng-deep .p-accordion-tab:not(.p-accordion-tab-active) .p-toggleable-content {
  height: 0;
  overflow: hidden;
}
:host ::ng-deep .p-accordion-tab.p-accordion-tab-active .p-toggleable-content {
  height: auto !important;
  overflow: auto !important;
}

/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
}

.flaticon-settings:before {
  font-weight: 800 !important;
}

.flaticon-pin:before {
  font-weight: 800 !important;
}

.flaticon-download:before {
  font-weight: 800 !important;
}

.msa-viewer-container {
  position: relative;
  top: 50px;
  left: 5px;
  padding-right: 5px;
}

#msa-viewer {
  overflow-y: hidden;
  overflow-x: hidden;
  display: flex;
  gap: 5px;
}

.title {
  font-size: 24px;
  text-align: right;
  padding-right: 20px;
}

.canvasLabels {
  overflow-y: auto;
  overflow-x: hidden;
  position: relative;
}

#searchHighlight {
  width: 1500px;
  position: absolute;
  height: 10px;
  top: 0px;
  left: 0px;
  border: red 2px dotted;
}

#searchHighlightHolder {
  width: 250px;
}

.searchHighlight2 {
  background-color: #E3F2FD;
}

.triangle {
  width: 10px;
  position: relative;
  left: 42px;
  border-left: 8px transparent solid;
  border-right: 8px transparent solid;
  border-bottom: 16px lightgray solid;
}

#tooltipHolder {
  display: none;
}

#tooltipAlign {
  background-color: lightgray;
  padding: 5px;
  display: block;
}

.canvasHolder {
  overflow-x: auto;
  overflow-y: scroll;
}

#alignmentTop {
  overflow-x: auto;
  height: 160px;
}

.alignRow {
  display: flex;
}

.alignName {
  width: 200px;
  margin-right: 5px;
  flex: none;
}

#miniMapHolder {
  padding: 5px 10px;
  border: 3px black solid;
  background-color: white;
  margin-bottom: 10px;
}

#miniMap {
  position: relative;
}

#miniMapTitle {
  margin-bottom: 10px;
}

#miniMapHighlight {
  display: none;
  background-color: rgba(128, 128, 128, 0.4);
  position: absolute;
}

.customColorSchemeSelection div {
  justify-content: space-around;
}

.customColorSchemeSelection label {
  display: flex;
  align-items: center;
  gap: 10px;
}

.customColorSchemeSelection input {
  width: 46.63px;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/AlignmentViewComponent/alignment-view-plugin-component.scss"],"names":[],"mappings":"AAAA;EACI,kBAAA;EACA,gBAAA;EACA,qBAAA;EACA,YAAA;AACJ;;AAKI;EACE,SAAA;EACA,gBAAA;AAFN;AAOI;EACE,uBAAA;EACA,yBAAA;AALN;;AAUI,+BAAA;AACJ;EACE,qBAAA,EAAA,4BAAA;EACA,oCAAA,EAAA,qCAAA;AAPF;;AAUA;EACE,kBAAA;EACA,0CAAA;AAPF;;AAUA;EACE,2BAAA;AAPF;;AAUA;EACE,2BAAA;AAPF;;AAUA;EACE,2BAAA;AAPF;;AAUA;EACE,kBAAA;EACA,SAAA;EACA,SAAA;EACA,kBAAA;AAPF;;AAUA;EACE,kBAAA;EACA,kBAAA;EACA,aAAA;EACA,QAAA;AAPF;;AAUA;EACE,eAAA;EACA,iBAAA;EACA,mBAAA;AAPF;;AAUA;EACE,gBAAA;EACA,kBAAA;EACA,kBAAA;AAPF;;AAUA;EACE,aAAA;EACA,kBAAA;EACA,YAAA;EACA,QAAA;EACA,SAAA;EACA,sBAAA;AAPF;;AAUA;EACE,YAAA;AAPF;;AAUA;EACE,yBAAA;AAPF;;AAUA;EACE,WAAA;EACA,kBAAA;EACA,UAAA;EACA,kCAAA;EACA,mCAAA;EACA,mCAAA;AAPF;;AAUA;EACE,aAAA;AAPF;;AAUA;EACE,2BAAA;EACA,YAAA;EACA,cAAA;AAPF;;AAUA;EACE,gBAAA;EACA,kBAAA;AAPF;;AAUA;EACE,gBAAA;EACA,aAAA;AAPF;;AAUA;EACE,aAAA;AAPF;;AAUA;EACE,YAAA;EACA,iBAAA;EACA,UAAA;AAPF;;AAUA;EACE,iBAAA;EACA,uBAAA;EACA,uBAAA;EACA,mBAAA;AAPF;;AAUA;EACE,kBAAA;AAPF;;AAUA;EACE,mBAAA;AAPF;;AAUA;EACE,aAAA;EACA,0CAAA;EACA,kBAAA;AAPF;;AAUA;EACE,6BAAA;AAPF;;AAUA;EACE,aAAA;EACA,mBAAA;EACA,SAAA;AAPF;;AAUA;EACE,cAAA;AAPF","sourcesContent":[":host {\n    position: absolute;\n    overflow: hidden;\n    z-index: 1 !important;\n    padding: 1px; \n    //background-color: rgb(168, 125, 211, .2);\n}\n\n:host ::ng-deep {\n  .p-accordion-tab:not(.p-accordion-tab-active) {\n    .p-toggleable-content {\n      height: 0;\n      overflow: hidden;\n    }\n  }\n\n  .p-accordion-tab.p-accordion-tab-active {\n    .p-toggleable-content {\n      height: auto !important;\n      overflow: auto !important;\n    }\n  }\n}\n\n    /* Button appearance on hover */\n.btn-icon:hover {\n  transform: scale(1.1); /* Slight enlarge on hover */\n  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n\n.btn-icon {\n  margin-right: 10px;\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n}\n\n.flaticon-settings:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-pin:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-download:before {\n  font-weight: 800 !important;\n}\n\n.msa-viewer-container {\n  position: relative;\n  top: 50px;\n  left: 5px;\n  padding-right: 5px;\n}\n\n#msa-viewer {\n  overflow-y: hidden;\n  overflow-x: hidden;\n  display: flex;\n  gap: 5px;\n}\n\n.title {\n  font-size: 24px;\n  text-align: right;\n  padding-right: 20px;\n}\n\n.canvasLabels {\n  overflow-y: auto;\n  overflow-x: hidden;\n  position: relative;\n}\n\n#searchHighlight {\n  width: 1500px;\n  position: absolute;\n  height: 10px;\n  top: 0px;\n  left: 0px;\n  border: red 2px dotted;\n}\n\n#searchHighlightHolder{\n  width: 250px;\n}\n\n.searchHighlight2 {\n  background-color: #E3F2FD;\n}\n\n.triangle {\n  width: 10px;\n  position: relative;\n  left: 42px;\n  border-left: 8px transparent solid;\n  border-right: 8px transparent solid;\n  border-bottom: 16px lightgray solid;\n}\n\n#tooltipHolder {\n  display: none;\n}\n\n#tooltipAlign {\n  background-color: lightgray; \n  padding: 5px;\n  display: block;\n}\n\n.canvasHolder {\n  overflow-x: auto;\n  overflow-y: scroll;\n}\n\n#alignmentTop {\n  overflow-x: auto;\n  height: 160px;\n}\n\n.alignRow {\n  display: flex;\n}\n\n.alignName {\n  width: 200px;\n  margin-right: 5px;\n  flex: none;\n}\n\n#miniMapHolder {\n  padding: 5px 10px;\n  border: 3px black solid;\n  background-color: white;\n  margin-bottom: 10px;\n}\n\n#miniMap {\n  position: relative;\n}\n\n#miniMapTitle{\n  margin-bottom: 10px;\n}\n\n#miniMapHighlight {\n  display: none;\n  background-color: rgb(gray, .4);\n  position: absolute;\n}\n\n.customColorSchemeSelection div {\n  justify-content: space-around;\n}\n\n.customColorSchemeSelection label {\n  display: flex; \n  align-items: center;\n  gap:10px;\n}\n\n.customColorSchemeSelection input {\n  width: 46.63px\n}\n"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 5820:
/*!******************************************************************************************!*\
  !*** ./src/app/visualizationComponents/BubbleComponent/bubble.component.scss?ngResource ***!
  \******************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
  padding: 1px;
}

:host ::ng-deep .p-accordion-tab:not(.p-accordion-tab-active) .p-toggleable-content {
  height: 0;
  overflow: hidden;
}
:host ::ng-deep .p-accordion-tab.p-accordion-tab-active .p-toggleable-content {
  height: auto !important;
  overflow: auto !important;
}

.bubble-wrapper {
  padding: 50px 20px 5px 20px;
}

/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
}

.flaticon-settings:before {
  font-weight: 800 !important;
}

.flaticon-pin:before {
  font-weight: 800 !important;
}

.flaticon-download:before {
  font-weight: 800 !important;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/BubbleComponent/bubble.component.scss"],"names":[],"mappings":"AAAA;EACI,kBAAA;EACA,gBAAA;EACA,qBAAA;EACA,YAAA;AACJ;;AAII;EACE,SAAA;EACA,gBAAA;AADN;AAMI;EACE,uBAAA;EACA,yBAAA;AAJN;;AAQA;EACE,2BAAA;AALF;;AAQA,+BAAA;AACA;EACE,qBAAA,EAAA,4BAAA;EACA,oCAAA,EAAA,qCAAA;AALF;;AAQA;EACE,kBAAA;EACA,0CAAA;AALF;;AAQA;EACE,2BAAA;AALF;;AAQA;EACE,2BAAA;AALF;;AAQA;EACE,2BAAA;AALF","sourcesContent":[":host {\n    position: absolute;\n    overflow: hidden;\n    z-index: 1 !important;\n    padding: 1px; \n}\n\n:host ::ng-deep {\n  .p-accordion-tab:not(.p-accordion-tab-active) {\n    .p-toggleable-content {\n      height: 0;\n      overflow: hidden;\n    }\n  }\n\n  .p-accordion-tab.p-accordion-tab-active {\n    .p-toggleable-content {\n      height: auto !important;\n      overflow: auto !important;\n    }\n  }\n}\n.bubble-wrapper {\n  padding: 50px 20px 5px 20px;\n}\n\n/* Button appearance on hover */\n.btn-icon:hover {\n  transform: scale(1.1); /* Slight enlarge on hover */\n  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n    \n.btn-icon {\n  margin-right: 10px;\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n}\n\n.flaticon-settings:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-pin:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-download:before {\n  font-weight: 800 !important;\n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 70926:
/*!*****************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/CrosstabComponent/crosstab-plugin.component.scss?ngResource ***!
  \*****************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
  padding: 1px;
}

:host ::ng-deep .p-accordion-tab:not(.p-accordion-tab-active) .p-toggleable-content {
  height: 0;
  overflow: hidden;
}
:host ::ng-deep .p-accordion-tab.p-accordion-tab-active .p-toggleable-content {
  height: auto !important;
  overflow: auto !important;
}

.crosstab-wrapper {
  padding: 70px 20px 10px 20px;
}

/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
}

.flaticon-settings:before {
  font-weight: 800 !important;
}

.flaticon-pin:before {
  font-weight: 800 !important;
}

.flaticon-download:before {
  font-weight: 800 !important;
}

p-table {
  border: 2px solid #555555;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/CrosstabComponent/crosstab-plugin.component.scss"],"names":[],"mappings":"AAAA;EACI,kBAAA;EACA,gBAAA;EACA,qBAAA;EACA,YAAA;AACJ;;AAII;EACE,SAAA;EACA,gBAAA;AADN;AAMI;EACE,uBAAA;EACA,yBAAA;AAJN;;AAQA;EACE,4BAAA;AALF;;AAQA,+BAAA;AACA;EACE,qBAAA,EAAA,4BAAA;EACA,oCAAA,EAAA,qCAAA;AALF;;AAQA;EACE,kBAAA;EACA,0CAAA;AALF;;AAQA;EACE,2BAAA;AALF;;AAQA;EACE,2BAAA;AALF;;AAQA;EACE,2BAAA;AALF;;AAQA;EACE,yBAAA;AALF","sourcesContent":[":host {\n    position: absolute;\n    overflow: hidden;\n    z-index: 1 !important;\n    padding: 1px; \n}\n\n:host ::ng-deep {\n  .p-accordion-tab:not(.p-accordion-tab-active) {\n    .p-toggleable-content {\n      height: 0;\n      overflow: hidden;\n    }\n  }\n\n  .p-accordion-tab.p-accordion-tab-active {\n    .p-toggleable-content {\n      height: auto !important;\n      overflow: auto !important;\n    }\n  }\n}\n.crosstab-wrapper {\n  padding: 70px 20px 10px 20px;\n}\n\n/* Button appearance on hover */\n.btn-icon:hover {\n  transform: scale(1.1); /* Slight enlarge on hover */\n  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n    \n.btn-icon {\n  margin-right: 10px;\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n}\n\n.flaticon-settings:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-pin:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-download:before {\n  font-weight: 800 !important;\n}\n\np-table {\n  border: 2px solid #555555;\n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 17339:
/*!**********************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/GanttComponent/gantt-chart/gantt-chart.component.scss?ngResource ***!
  \**********************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `.gantt-entry {
  opacity: 0.8;
}
.gantt-entry:hover {
  opacity: 1;
}

#component .tooltip {
  visibility: hidden;
}

#component:hover .tooltip {
  visibility: visible;
  position: absolute;
}

#component:hover:after .tooltip {
  position: relative;
  left: 0;
  top: 100%;
  white-space: nowrap;
}

.tooltip text {
  fill: #eeeeee;
  font-size: 12px;
  font-family: sans-serif;
}

.tooltip rect {
  fill: #222222;
  stroke: #111111;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/GanttComponent/gantt-chart/gantt-chart.component.scss"],"names":[],"mappings":"AAAA;EACI,YAAA;AACJ;AAAI;EACI,UAAA;AAER;;AACA;EACI,kBAAA;AAEJ;;AACC;EACE,mBAAA;EACA,kBAAA;AAEH;;AACC;EACC,kBAAA;EACA,OAAA;EACA,SAAA;EACA,mBAAA;AAEF;;AAEA;EACI,aAAA;EACA,eAAA;EACA,uBAAA;AACJ;;AAEG;EACC,aAAA;EACA,eAAA;AACJ","sourcesContent":[".gantt-entry {\r\n    opacity: 0.8;\r\n    &:hover {\r\n        opacity: 1;\r\n    }\r\n}\r\n#component .tooltip {\r\n    visibility: hidden\r\n }\r\n \r\n #component:hover .tooltip {\r\n   visibility: visible;\r\n   position: absolute;\r\n  }\r\n \r\n #component:hover:after .tooltip{\r\n  position: relative;\r\n  left: 0;\r\n  top: 100%;\r\n  white-space: nowrap;\r\n }\r\n \r\n \r\n.tooltip text {\r\n    fill: #eeeeee;\r\n    font-size: 12px;\r\n    font-family: sans-serif; \r\n   }\r\n   \r\n   .tooltip rect {\r\n    fill: #222222;\r\n    stroke: #111111;\r\n   }"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 39930:
/*!***********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/GanttComponent/gantt-plugin.component.scss?ngResource ***!
  \***********************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
}

#gantt {
  background-color: #fff;
}

:host ::ng-deep .p-accordion-tab.p-accordion-tab-active .p-toggleable-content {
  height: auto !important;
  overflow: auto !important;
}

p-dropdown {
  overflow: visible !important;
}

.btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
}

.flaticon-settings:before {
  font-weight: 800 !important;
}

.flaticon-pin:before {
  font-weight: 800 !important;
}

.flaticon-download:before {
  font-weight: 800 !important;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/GanttComponent/gantt-plugin.component.scss"],"names":[],"mappings":"AAAA;EACI,kBAAA;EACA,gBAAA;EACA,qBAAA;AACJ;;AAEA;EACE,sBAAA;AACF;;AAII;EACE,uBAAA;EACA,yBAAA;AADN;;AAMA;EACI,4BAAA;AAHJ;;AAMA;EACE,qBAAA,EAAA,4BAAA;EACA,oCAAA,EAAA,qCAAA;AAHF;;AAMA;EACE,kBAAA;EACA,0CAAA;AAHF;;AAMA;EACE,2BAAA;AAHF;;AAMA;EACE,2BAAA;AAHF;;AAMA;EACE,2BAAA;AAHF","sourcesContent":[":host {\n    position: absolute;\n    overflow: hidden;\n    z-index: 1 !important;\n  }\n\n#gantt {\n  background-color: #fff;\n}\n\n:host ::ng-deep {\n  .p-accordion-tab.p-accordion-tab-active {\n    .p-toggleable-content {\n      height: auto !important;\n      overflow: auto !important;\n    }\n  }\n}\n\np-dropdown {\n    overflow: visible !important;\n}\n\n.btn-icon:hover {\n  transform: scale(1.1); /* Slight enlarge on hover */\n  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n    \n.btn-icon {\n  margin-right: 10px;\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n}\n\n.flaticon-settings:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-pin:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-download:before {\n  font-weight: 800 !important;\n}\n"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 72188:
/*!********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/HeatmapComponent/heatmap.component.scss?ngResource ***!
  \********************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `.dialogSize {
  width: 30vw;
  height: 150px;
  min-width: 150px;
}

:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
  padding: 1px;
  /*top: 37px !important;
  left: 1px !important; 
  width: 99% !important; */
}

.p-component p-dropdown {
  overflow: visible !important;
}

.network {
  margin-top: 0 !important;
  cursor: grab;
}

.ui-dropdown {
  width: 100% !important;
}

.display-none {
  display: none;
}

.bottom-table {
  font-size: 0.5vmax;
}

#node-max-radius-row, #node-min-radius-row {
  display: none;
}

.clusters path {
  cursor: grab;
}

:host ::ng-deep .p-accordion-tab:not(.p-accordion-tab-active) .p-toggleable-content {
  height: 0;
  overflow: hidden;
}
:host ::ng-deep .p-accordion-tab.p-accordion-tab-active .p-toggleable-content {
  height: auto !important;
  overflow: auto !important;
}

/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
}

.flaticon-settings:before {
  font-weight: 800 !important;
}

.flaticon-pin:before {
  font-weight: 800 !important;
}

.flaticon-download:before {
  font-weight: 800 !important;
}

#network-export-filetype {
  overflow: visible !important;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/HeatmapComponent/heatmap.component.scss"],"names":[],"mappings":"AAAA;EACI,WAAA;EACA,aAAA;EACA,gBAAA;AACJ;;AAEA;EACE,kBAAA;EACA,gBAAA;EACA,qBAAA;EACA,YAAA;EACA;;0BAAA;AAGF;;AAEA;EACI,4BAAA;AACJ;;AAEA;EACE,wBAAA;EACA,YAAA;AACF;;AAEA;EACI,sBAAA;AACJ;;AAEA;EACE,aAAA;AACF;;AAEA;EACI,kBAAA;AACJ;;AAEA;EACE,aAAA;AACF;;AAEA;EAEI,YAAA;AACJ;;AAII;EACE,SAAA;EACA,gBAAA;AADN;AAMI;EACE,uBAAA;EACA,yBAAA;AAJN;;AASE,+BAAA;AACF;EACE,qBAAA,EAAA,4BAAA;EACA,oCAAA,EAAA,qCAAA;AANF;;AASA;EACE,kBAAA;EACA,0CAAA;AANF;;AASA;EACE,2BAAA;AANF;;AASA;EACE,2BAAA;AANF;;AASA;EACE,2BAAA;AANF;;AASA;EACE,4BAAA;AANF","sourcesContent":[".dialogSize{\n    width: 30vw;\n    height: 150px;\n    min-width: 150px;\n}\n\n:host {\n  position: absolute;\n  overflow: hidden;\n  z-index: 1 !important;\n  padding: 1px;\n  /*top: 37px !important;\n  left: 1px !important; \n  width: 99% !important; */ \n}\n\n.p-component p-dropdown {\n    overflow: visible !important;\n}\n\n.network {\n  margin-top: 0 !important;\n  cursor: grab;\n}\n\n.ui-dropdown {\n    width: 100% !important;\n}\n\n.display-none {\n  display: none;\n}\n\n.bottom-table{\n    font-size: calc((.5vmax));   \n}\n\n#node-max-radius-row, #node-min-radius-row {\n  display: none;\n}\n\n.clusters path {\n    cursor: -webkit-grab;\n    cursor: grab;\n  }\n\n:host ::ng-deep {\n  .p-accordion-tab:not(.p-accordion-tab-active) {\n    .p-toggleable-content {\n      height: 0;\n      overflow: hidden;\n    }\n  }\n\n  .p-accordion-tab.p-accordion-tab-active {\n    .p-toggleable-content {\n      height: auto !important;\n      overflow: auto !important;\n    }\n  }\n}\n\n  /* Button appearance on hover */\n.btn-icon:hover {\n  transform: scale(1.1); /* Slight enlarge on hover */\n  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n\n.btn-icon {\n  margin-right: 10px;\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n}\n\n.flaticon-settings:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-pin:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-download:before {\n  font-weight: 800 !important;\n}\n\n#network-export-filetype {\n  overflow: visible !important;\n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 81398:
/*!*************************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/PhylogeneticComponent/phylogenetic-plugin.component.scss?ngResource ***!
  \*************************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `/*
 * phylogenetic-plugin.component.css
 * Copyright (C) 2022 ylb9
 *
 * Distributed under terms of the MIT license.
 */
#phylocanavas {
  height: 100%;
}

:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
}

#phyloTooltip {
  border-radius: 0.25rem;
  padding: 0.25rem;
}

:host ::ng-deep .p-accordion-tab:not(.p-accordion-tab-active) .p-toggleable-content {
  height: 0;
  overflow: hidden;
}
:host ::ng-deep .p-accordion-tab.p-accordion-tab-active .p-toggleable-content {
  height: auto !important;
  overflow: auto !important;
}

/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
  background: white;
}

.flaticon-settings:before {
  font-weight: 800 !important;
}

.flaticon-download:before {
  font-weight: 800 !important;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/PhylogeneticComponent/phylogenetic-plugin.component.scss"],"names":[],"mappings":"AAAA;;;;;EAAA;AAOA;EACI,YAAA;AAAJ;;AAGA;EACE,kBAAA;EACA,gBAAA;EACA,qBAAA;AAAF;;AAGA;EACI,sBAAA;EACA,gBAAA;AAAJ;;AAKI;EACE,SAAA;EACA,gBAAA;AAFN;AAOI;EACE,uBAAA;EACA,yBAAA;AALN;;AAUC,+BAAA;AACA;EACC,qBAAA,EAAA,4BAAA;EACA,oCAAA,EAAA,qCAAA;AAPF;;AAUA;EACE,kBAAA;EACA,0CAAA;EACA,iBAAA;AAPF;;AAUA;EACE,2BAAA;AAPF;;AAWA;EACE,2BAAA;AARF","sourcesContent":["/*\n * phylogenetic-plugin.component.css\n * Copyright (C) 2022 ylb9\n *\n * Distributed under terms of the MIT license.\n */\n\n#phylocanavas {\n    height: 100%;\n}\n\n:host {\n  position: absolute;\n  overflow: hidden;\n  z-index: 1 !important;\n}\n\n#phyloTooltip {\n    border-radius: 0.25rem;\n    padding: 0.25rem;\n}\n\n:host ::ng-deep {\n  .p-accordion-tab:not(.p-accordion-tab-active) {\n    .p-toggleable-content {\n      height: 0;\n      overflow: hidden;\n    }\n  }\n\n  .p-accordion-tab.p-accordion-tab-active {\n    .p-toggleable-content {\n      height: auto !important;\n      overflow: auto !important;\n    }\n  }\n}\n\n /* Button appearance on hover */\n .btn-icon:hover {\n  transform: scale(1.1); /* Slight enlarge on hover */\n  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n\n.btn-icon {\n  margin-right: 10px;\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n  background: white;\n}\n\n.flaticon-settings:before {\n  font-weight: 800 !important;\n}\n\n\n.flaticon-download:before {\n  font-weight: 800 !important;\n}\n  \n"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 97110:
/*!********************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/TimelineComponent/timeline-component.component.scss?ngResource ***!
  \********************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
}

#epiCurve {
  padding-top: 50px;
}

#epiCurve .axis--grid .domain {
  fill: #ddd;
  stroke: none;
}

#epiCurve .axis--x .domain,
#epiCurve .axis--grid .tick line {
  stroke: #fff;
}

#epiCurve .axis--grid .tick--minor line {
  stroke-opacity: 0.5;
}

#epiCurve-date-field {
  width: auto;
}

/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
  background: white;
}

.flaticon-settings:before {
  font-weight: 800 !important;
}

.flaticon-download:before {
  font-weight: 800 !important;
}

#tool-btn-container {
  display: flex !important;
}

.tool-btn {
  height: 30px;
  width: 30px !important;
  display: block !important;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/TimelineComponent/timeline-component.component.scss"],"names":[],"mappings":"AAAA;EACI,kBAAA;EACA,gBAAA;EACA,qBAAA;AACJ;;AAEE;EACE,iBAAA;AACJ;;AACE;EACE,UAAA;EACA,YAAA;AAEJ;;AACE;;EAEE,YAAA;AAEJ;;AACE;EACE,mBAAA;AAEJ;;AAAE;EACE,WAAA;AAGJ;;AACG,+BAAA;AACF;EACG,qBAAA,EAAA,4BAAA;EACA,oCAAA,EAAA,qCAAA;AAEJ;;AACE;EACE,kBAAA;EACA,0CAAA;EACA,iBAAA;AAEJ;;AACE;EACE,2BAAA;AAEJ;;AACE;EACE,2BAAA;AAEJ;;AACE;EACE,wBAAA;AAEJ;;AACE;EACE,YAAA;EACA,sBAAA;EACA,yBAAA;AAEJ","sourcesContent":[":host {\n    position: absolute;\n    overflow: hidden;\n    z-index: 1 !important;\n  }\n\n  #epiCurve {\n    padding-top: 50px;\n  }\n  #epiCurve .axis--grid .domain {\n    fill: #ddd;\n    stroke: none;\n  }\n  \n  #epiCurve .axis--x .domain,\n  #epiCurve .axis--grid .tick line {\n    stroke: #fff;\n  }\n  \n  #epiCurve .axis--grid .tick--minor line {\n    stroke-opacity: 0.5;\n  }\n  #epiCurve-date-field {\n    width: auto;\n  }\n\n\n   /* Button appearance on hover */\n .btn-icon:hover {\n    transform: scale(1.1); /* Slight enlarge on hover */\n    background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n  }\n  \n  .btn-icon {\n    margin-right: 10px;\n    box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n    background: white;\n  }\n  \n  .flaticon-settings:before {\n    font-weight: 800 !important;\n  }\n  \n  .flaticon-download:before {\n    font-weight: 800 !important;\n  }\n\n  #tool-btn-container {\n    display: flex !important;\n  }\n\n  .tool-btn {\n    height: 30px;\n    width: 30px !important;\n    display: block !important;\n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 68550:
/*!*********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/TwoDComponent/twoD-plugin.component.scss?ngResource ***!
  \*********************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `.dialogSize {
  width: 30vw;
  height: 150px;
  min-width: 150px;
}

:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
  padding: 1px;
  /*top: 37px !important;
  left: 1px !important; 
  width: 99% !important; */
}

::ng-deep .css-1vv8bkf-link-arrow {
  fill: #4e5f99;
}
::ng-deep .css-uryleg-label-background {
  fill: transparent !important;
}
::ng-deep .css-14dxyvq-background {
  fill: transparent !important;
}

/* Ensure the container is positioned relatively to position the grid overlay correctly */
.cytoscape-container {
  position: relative;
  width: 100%;
  height: 100%;
}

/* Grid Overlay Styling */
.grid-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: linear-gradient(to right, lightgray 1px, transparent 1px), linear-gradient(to bottom, lightgray 1px, transparent 1px);
  background-size: 100px 100px; /* Adjust grid spacing here */
  pointer-events: none; /* Make sure grid doesn't capture mouse events */
  z-index: 1; /* Position grid above Cytoscape's canvas */
  transition: opacity 0.3s ease;
  opacity: 1;
}

.grid-overlay.hidden {
  opacity: 0;
}

#cy {
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
}

.network {
  margin-top: 0 !important;
  cursor: grab;
}

.ui-dropdown {
  width: 100% !important;
}

.display-none {
  display: none;
}

.bottom-table {
  font-size: 0.5vmax;
}

#node-max-radius-row, #node-min-radius-row {
  display: none;
}

.clusters path {
  cursor: grab;
}

:host ::ng-deep .p-accordion-tab:not(.p-accordion-tab-active) .p-toggleable-content {
  height: 0;
  overflow: hidden;
}
:host ::ng-deep .p-accordion-tab.p-accordion-tab-active .p-toggleable-content {
  height: auto !important;
  overflow: auto !important;
}

/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1); /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */
}

.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
}

.flaticon-settings:before {
  font-weight: 800 !important;
}

.flaticon-pin:before {
  font-weight: 800 !important;
}

.flaticon-download:before {
  font-weight: 800 !important;
}

#network-export-filename {
  height: 42px;
}

#network-attribute-table {
  border-spacing: 0;
  width: 100%;
  border: 1px solid #ddd;
}

#network-attribute-table td, #network-attribute-table th {
  text-align: left;
  padding: 2px;
  border: 1px solid #ddd;
}

#network-attribute-table tr:nth-child(even) {
  background-color: #f2f2f2;
}

#network-attribute-table tr:nth-child(odd) {
  background-color: #fff;
}

:root {
  --vis-graph-link-label-background: black;
  --vis-dark-graph-link-label-background: black;
}

#nodeShapeCounts, #nodeShapeFrequencies, #polygonColorCounts, #polygonColorFrequencies {
  width: 100%;
  border-radius: 0;
  display: flex;
  justify-content: space-between;
  gap: 15px;
}

.rhombus {
  color: black;
  transform: rotate(80deg);
  display: inline-block;
}

.tag {
  transform: rotate(90deg);
  display: inline-block;
}

.barrel {
  width: 12px;
  height: 12px;
  display: inline-block;
  background-color: black;
  border: 1px black solid;
  border-radius: 4px;
}

.shapeDropdown {
  --p-select-padding-y: 4px;
  --p-select-padding-x: 10px;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/TwoDComponent/twoD-plugin.component.scss"],"names":[],"mappings":"AAAA;EACI,WAAA;EACA,aAAA;EACA,gBAAA;AACJ;;AAEA;EACE,kBAAA;EACA,gBAAA;EACA,qBAAA;EACA,YAAA;EACA;;0BAAA;AAGF;;AAUE;EACE,aAAA;AAPJ;AASE;EACE,4BAAA;AAPJ;AAUE;EACE,4BAAA;AARJ;;AAaA,yFAAA;AACA;EACE,kBAAA;EACA,WAAA;EACA,YAAA;AAVF;;AAaA,yBAAA;AACA;EACE,kBAAA;EACA,MAAA;EACA,OAAA;EACA,WAAA;EACA,YAAA;EACA,uIACI;EAEJ,4BAAA,EAAA,6BAAA;EACA,oBAAA,EAAA,gDAAA;EACA,UAAA,EAAA,2CAAA;EACA,6BAAA;EACA,UAAA;AAZF;;AAeA;EACE,UAAA;AAZF;;AAeA;EAEE,WAAA;EACA,YAAA;EACA,MAAA;EACA,OAAA;AAbF;;AAkBA;EACE,wBAAA;EACA,YAAA;AAfF;;AAkBA;EACI,sBAAA;AAfJ;;AAkBA;EACE,aAAA;AAfF;;AAkBA;EACI,kBAAA;AAfJ;;AAkBA;EACE,aAAA;AAfF;;AAkBA;EAEI,YAAA;AAfJ;;AAoBI;EACE,SAAA;EACA,gBAAA;AAjBN;AAsBI;EACE,uBAAA;EACA,yBAAA;AApBN;;AAyBE,+BAAA;AACF;EACE,qBAAA,EAAA,4BAAA;EACA,oCAAA,EAAA,qCAAA;AAtBF;;AAyBA;EACE,kBAAA;EACA,0CAAA;AAtBF;;AAyBA;EACE,2BAAA;AAtBF;;AAyBA;EACE,2BAAA;AAtBF;;AAyBA;EACE,2BAAA;AAtBF;;AAyBA;EACE,YAAA;AAtBF;;AAyBA;EACE,iBAAA;EACA,WAAA;EACA,sBAAA;AAtBF;;AAyBA;EACE,gBAAA;EACA,YAAA;EACA,sBAAA;AAtBF;;AAyBA;EACE,yBAAA;AAtBF;;AAyBA;EACE,sBAAA;AAtBF;;AAyBA;EACE,wCAAA;EACA,6CAAA;AAtBF;;AAyBA;EACE,WAAA;EACA,gBAAA;EACA,aAAA;EACA,8BAAA;EACA,SAAA;AAtBF;;AAyBA;EACE,YAAA;EACA,wBAAA;EACA,qBAAA;AAtBF;;AAyBA;EACE,wBAAA;EACA,qBAAA;AAtBF;;AAyBA;EACE,WAAA;EACA,YAAA;EACA,qBAAA;EACA,uBAAA;EACA,uBAAA;EACA,kBAAA;AAtBF;;AAyBA;EACE,yBAAA;EACA,0BAAA;AAtBF","sourcesContent":[".dialogSize{\n    width: 30vw;\n    height: 150px;\n    min-width: 150px;\n}\n\n:host {\n  position: absolute;\n  overflow: hidden;\n  z-index: 1 !important;\n  padding: 1px;\n  /*top: 37px !important;\n  left: 1px !important; \n  width: 99% !important; */ \n}\n\n// :root {\n//   --vis-graph-brush-selection-opacity: 0.5; // Adjust the opacity value as needed\n//   --vis-graph-brushed-node-stroke-color: #ff0000; // Adjust the color as needed\n//   --vis-graph-brushed-node-label-text-color: #00ff00; // Adjust the color as needed\n//   --vis-graph-brushed-node-icon-fill-color: #0000ff; // Adjust the color as needed\n// }\n\n::ng-deep {\n  .css-1vv8bkf-link-arrow {\n    fill: #4e5f99;\n  }\n  .css-uryleg-label-background {\n    fill: transparent !important;\n  }\n\n  .css-14dxyvq-background {\n    fill: transparent !important;\n}\n\n}\n\n/* Ensure the container is positioned relatively to position the grid overlay correctly */\n.cytoscape-container {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n/* Grid Overlay Styling */\n.grid-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-image: \n      linear-gradient(to right, lightgray 1px, transparent 1px),\n      linear-gradient(to bottom, lightgray 1px, transparent 1px);\n  background-size: 100px 100px; /* Adjust grid spacing here */\n  pointer-events: none; /* Make sure grid doesn't capture mouse events */\n  z-index: 1; /* Position grid above Cytoscape's canvas */\n  transition: opacity 0.3s ease;\n  opacity: 1;\n}\n\n.grid-overlay.hidden {\n  opacity: 0;\n}\n\n#cy {\n  // position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n}\n\n\n\n.network {\n  margin-top: 0 !important;\n  cursor: grab;\n}\n\n.ui-dropdown {\n    width: 100% !important;\n}\n\n.display-none {\n  display: none;\n}\n\n.bottom-table{\n    font-size: calc((.5vmax));   \n}\n\n#node-max-radius-row, #node-min-radius-row {\n  display: none;\n}\n\n.clusters path {\n    cursor: -webkit-grab;\n    cursor: grab;\n  }\n\n:host ::ng-deep {\n  .p-accordion-tab:not(.p-accordion-tab-active) {\n    .p-toggleable-content {\n      height: 0;\n      overflow: hidden;\n    }\n  }\n\n  .p-accordion-tab.p-accordion-tab-active {\n    .p-toggleable-content {\n      height: auto !important;\n      overflow: auto !important;\n    }\n  }\n}\n\n  /* Button appearance on hover */\n.btn-icon:hover {\n  transform: scale(1.1); /* Slight enlarge on hover */\n  background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n\n.btn-icon {\n  margin-right: 10px;\n  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n}\n\n.flaticon-settings:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-pin:before {\n  font-weight: 800 !important;\n}\n\n.flaticon-download:before {\n  font-weight: 800 !important;\n}\n\n#network-export-filename{\n  height: 42px;  \n}\n\n#network-attribute-table {\n  border-spacing: 0;\n  width: 100%;\n  border: 1px solid #ddd;\n}\n\n#network-attribute-table td, #network-attribute-table th {\n  text-align: left;\n  padding: 2px;\n  border: 1px solid #ddd;\n}\n\n#network-attribute-table tr:nth-child(even) {\n  background-color: #f2f2f2;\n}\n\n#network-attribute-table tr:nth-child(odd) {\n  background-color: #fff;\n}\n\n:root {\n  --vis-graph-link-label-background: black;\n  --vis-dark-graph-link-label-background: black;\n}\n\n#nodeShapeCounts, #nodeShapeFrequencies, #polygonColorCounts, #polygonColorFrequencies {\n  width: 100%; \n  border-radius: 0; \n  display: flex; \n  justify-content: space-between;\n  gap: 15px;\n}\n\n.rhombus {\n  color: black;\n  transform: rotate(80deg);\n  display: inline-block;\n}\n\n.tag {\n  transform: rotate(90deg);\n  display: inline-block;\n}\n\n.barrel {\n  width: 12px;\n  height: 12px;\n  display: inline-block;\n  background-color: black;\n  border: 1px black solid;\n  border-radius: 4px;\n}\n\n.shapeDropdown { \n  --p-select-padding-y: 4px;\n  --p-select-padding-x: 10px;\n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 16436:
/*!************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/WaterfallComponent/waterfall.component.scss?ngResource ***!
  \************************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
}

.waterfall-wrapper {
  padding: 40px 20px 10px 20px;
}

.rowExpansionContent {
  background-color: #E3F2FD;
  padding: 0px 0px 16px 16px;
}

.rowExpansionContent div {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  display: block;
}`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/WaterfallComponent/waterfall.component.scss"],"names":[],"mappings":"AAAA;EACI,kBAAA;EACA,gBAAA;EACA,qBAAA;AACJ;;AAEA;EACI,4BAAA;AACJ;;AAEA;EACI,yBAAA;EACA,0BAAA;AACJ;;AAEA;EACI,gBAAA;EACA,mBAAA;EACA,uBAAA;EACA,cAAA;AACJ","sourcesContent":[":host {\n    position: absolute;\n    overflow: hidden;\n    z-index: 1 !important;\n}\n\n.waterfall-wrapper {\n    padding: 40px 20px 10px 20px;\n}\n\n.rowExpansionContent {\n    background-color: #E3F2FD;\n    padding: 0px 0px 16px 16px;\n}\n\n.rowExpansionContent div {\n    overflow: hidden;\n    white-space: nowrap; \n    text-overflow: ellipsis; \n    display: block;\n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 94908:
/*!***********************************************************************!*\
  !*** ./src/app/filesComponent/files-plugin.component.less?ngResource ***!
  \***********************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `.example-container {
  width: 400px;
  height: 200px;
  margin: 12px;
  border: 1px solid #555;
}
:host {
  position: absolute;
  overflow: hidden;
}
mat-drawer-content {
  padding: 12px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}
.spinner-wrapper {
  position: fixed;
  /* Absolute positioning relative to the viewport */
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(255, 255, 255, 0.8);
  /* Optional background overlay */
  z-index: 9999;
  /* Ensures it appears above all content */
  display: flex;
  /* Utilizes Flexbox */
  align-items: center;
  /* Center vertically */
  justify-content: center;
  /* Center horizontally */
}
#file-footer {
  z-index: 1;
  position: absolute;
  bottom: 15px;
  width: 100%;
}
#file-prompt {
  z-index: 1;
  position: relative;
}
#alignment-preview {
  margin: 0 15px;
  padding: 0;
  min-height: 115px;
  max-height: 200px;
  overflow-x: scroll;
  overflow-y: auto;
}
#distance-metrics_chosen .chosen-choices {
  border: 1px solid #ced4da;
  border-radius: 0.25rem;
}
.dna {
  margin: 40px auto;
  width: 360px;
  height: 70px;
  perspective: 466px;
  transform-style: preserve-3d;
}
.ele {
  width: 1px;
  height: 70px;
  float: left;
  margin: 0 8px;
  border-left: 1px #b0b0b0 dashed;
  position: relative;
  transform: rotateX(-360deg);
  animation: run 2s linear infinite;
}
.ele:before,
.ele:after {
  content: "";
  width: 10px;
  height: 10px;
  background: deepskyblue;
  border-radius: 50%;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
}
.ele:before {
  top: -2px;
  background: #000000;
}
.ele:after {
  bottom: -2px;
}
.ele:nth-of-type(1) {
  animation-delay: -0.15s;
}
.ele:nth-of-type(2) {
  animation-delay: -0.3s;
}
.ele:nth-of-type(3) {
  animation-delay: -0.45s;
}
.ele:nth-of-type(4) {
  animation-delay: -0.6s;
}
.ele:nth-of-type(5) {
  animation-delay: -0.75s;
}
.ele:nth-of-type(6) {
  animation-delay: -0.9s;
}
.ele:nth-of-type(7) {
  animation-delay: -1.05s;
}
.ele:nth-of-type(8) {
  animation-delay: -1.2s;
}
.ele:nth-of-type(9) {
  animation-delay: -1.35s;
}
.ele:nth-of-type(10) {
  animation-delay: -1.5s;
}
.ele:nth-of-type(11) {
  animation-delay: -1.65s;
}
.ele:nth-of-type(12) {
  animation-delay: -1.8s;
}
.ele:nth-of-type(13) {
  animation-delay: -1.95s;
}
.ele:nth-of-type(14) {
  animation-delay: -2.1s;
}
.ele:nth-of-type(15) {
  animation-delay: -2.25s;
}
.ele:nth-of-type(16) {
  animation-delay: -2.4s;
}
.ele:nth-of-type(17) {
  animation-delay: -2.55s;
}
.ele:nth-of-type(18) {
  animation-delay: -2.7s;
}
.ele:nth-of-type(19) {
  animation-delay: -2.85s;
}
.ele:nth-of-type(20) {
  animation-delay: -3s;
}
.flaticon-settings:before {
  font-weight: 800 !important;
}
/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1);
  /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1);
  /* Subtle background color on hover */
}
.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
}
`, "",{"version":3,"sources":["webpack://./src/app/filesComponent/files-plugin.component.less"],"names":[],"mappings":"AAAA;EACI,YAAA;EACA,aAAA;EACA,YAAA;EACA,sBAAA;AACJ;AAEA;EACI,kBAAA;EACA,gBAAA;AAAJ;AAGA;EACI,aAAA;EACA,aAAA;EACA,sBAAA;EACA,uBAAA;AADJ;AAIA;EACI,eAAA;EAFF,kDAAkD;EAGhD,MAAA;EACA,OAAA;EACA,QAAA;EACA,SAAA;EACA,0CAAA;EADF,gCAAgC;EAE9B,aAAA;EAAF,yCAAyC;EACvC,aAAA;EACF,qBAAqB;EAAnB,mBAAA;EAEF,sBAAsB;EADpB,uBAAA;EAGF,wBAAwB;AAC1B;AADA;EACI,UAAA;EACA,kBAAA;EACA,YAAA;EACA,WAAA;AAGJ;AAAA;EACI,UAAA;EACA,kBAAA;AAEJ;AAEA;EACI,cAAA;EACA,UAAA;EACA,iBAAA;EACA,iBAAA;EACA,kBAAA;EACA,gBAAA;AAAJ;AAGA;EACI,yBAAA;EACA,sBAAA;AADJ;AAMA;EACI,iBAAA;EACA,YAAA;EACA,YAAA;EACA,kBAAA;EACA,4BAAA;AAJJ;AAOA;EACI,UAAA;EACA,YAAA;EACA,WAAA;EACA,aAAA;EACA,+BAAA;EACA,kBAAA;EACA,2BAAA;EACA,iCAAA;AALJ;AAQA;;EAEI,WAAA;EACA,WAAA;EACA,YAAA;EACA,uBAAA;EACA,kBAAA;EACA,kBAAA;EACA,SAAA;EACA,2BAAA;AANJ;AASA;EACI,SAAA;EACA,mBAAA;AAPJ;AAUA;EACI,YAAA;AARJ;AAWA;EACI,uBAAA;AATJ;AAYA;EACI,sBAAA;AAVJ;AAaA;EACI,uBAAA;AAXJ;AAcA;EACI,sBAAA;AAZJ;AAeA;EACI,uBAAA;AAbJ;AAgBA;EACI,sBAAA;AAdJ;AAiBA;EACI,uBAAA;AAfJ;AAkBA;EACI,sBAAA;AAhBJ;AAmBA;EACI,uBAAA;AAjBJ;AAoBA;EACI,sBAAA;AAlBJ;AAqBA;EACI,uBAAA;AAnBJ;AAsBA;EACI,sBAAA;AApBJ;AAuBA;EACI,uBAAA;AArBJ;AAwBA;EACI,sBAAA;AAtBJ;AAyBA;EACI,uBAAA;AAvBJ;AA0BA;EACI,sBAAA;AAxBJ;AA2BA;EACI,uBAAA;AAzBJ;AA4BA;EACI,sBAAA;AA1BJ;AA6BA;EACI,uBAAA;AA3BJ;AA8BA;EACI,oBAAA;AA5BJ;AA+BA;EACI,2BAAA;AA7BJ;AACA,+BAA+B;AAgC/B;EACI,qBAAA;EA9BF,4BAA4B;EA+B1B,oCAAA;EA7BF,qCAAqC;AACvC;AA+BA;EACI,kBAAA;EACA,0CAAA;AA7BJ","sourcesContent":[".example-container {\n    width: 400px;\n    height: 200px;\n    margin: 12px;\n    border: 1px solid #555;\n}\n\n:host {\n    position: absolute;\n    overflow: hidden;\n}\n\nmat-drawer-content {\n    padding: 12px;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n}\n\n.spinner-wrapper {\n    position: fixed; /* Absolute positioning relative to the viewport */\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: rgba(255, 255, 255, 0.8); /* Optional background overlay */\n    z-index: 9999; /* Ensures it appears above all content */\n    display: flex; /* Utilizes Flexbox */\n    align-items: center; /* Center vertically */\n    justify-content: center; /* Center horizontally */\n  }\n\n#file-footer {\n    z-index: 1;\n    position: absolute;\n    bottom: 15px;\n    width: 100%;\n}\n\n#file-prompt {\n    z-index: 1;\n    position: relative;\n}\n\n\n#alignment-preview {\n    margin: 0 15px;\n    padding: 0;\n    min-height: 115px;\n    max-height: 200px;\n    overflow-x: scroll;\n    overflow-y: auto;\n}\n\n#distance-metrics_chosen .chosen-choices {\n    border: 1px solid #ced4da;\n    border-radius: 0.25rem;\n}\n\n\n\n.dna {\n    margin: 40px auto;\n    width: 360px;\n    height: 70px;\n    perspective: 466px;\n    transform-style: preserve-3d;\n}\n\n.ele {\n    width: 1px;\n    height: 70px;\n    float: left;\n    margin: 0 8px;\n    border-left: 1px #b0b0b0 dashed;\n    position: relative;\n    transform: rotateX(-360deg);\n    animation: run 2s linear infinite;\n}\n\n.ele:before,\n.ele:after {\n    content: \"\";\n    width: 10px;\n    height: 10px;\n    background: deepskyblue;\n    border-radius: 50%;\n    position: absolute;\n    left: 50%;\n    transform: translateX(-50%);\n}\n\n.ele:before {\n    top: -2px;\n    background: #000000;\n}\n\n.ele:after {\n    bottom: -2px;\n}\n\n.ele:nth-of-type(1) {\n    animation-delay: -0.15s;\n}\n\n.ele:nth-of-type(2) {\n    animation-delay: -0.3s;\n}\n\n.ele:nth-of-type(3) {\n    animation-delay: -0.45s;\n}\n\n.ele:nth-of-type(4) {\n    animation-delay: -0.6s;\n}\n\n.ele:nth-of-type(5) {\n    animation-delay: -0.75s;\n}\n\n.ele:nth-of-type(6) {\n    animation-delay: -0.9s;\n}\n\n.ele:nth-of-type(7) {\n    animation-delay: -1.05s;\n}\n\n.ele:nth-of-type(8) {\n    animation-delay: -1.2s;\n}\n\n.ele:nth-of-type(9) {\n    animation-delay: -1.35s;\n}\n\n.ele:nth-of-type(10) {\n    animation-delay: -1.5s;\n}\n\n.ele:nth-of-type(11) {\n    animation-delay: -1.65s;\n}\n\n.ele:nth-of-type(12) {\n    animation-delay: -1.8s;\n}\n\n.ele:nth-of-type(13) {\n    animation-delay: -1.95s;\n}\n\n.ele:nth-of-type(14) {\n    animation-delay: -2.1s;\n}\n\n.ele:nth-of-type(15) {\n    animation-delay: -2.25s;\n}\n\n.ele:nth-of-type(16) {\n    animation-delay: -2.4s;\n}\n\n.ele:nth-of-type(17) {\n    animation-delay: -2.55s;\n}\n\n.ele:nth-of-type(18) {\n    animation-delay: -2.7s;\n}\n\n.ele:nth-of-type(19) {\n    animation-delay: -2.85s;\n}\n\n.ele:nth-of-type(20) {\n    animation-delay: -3s;\n}\n\n.flaticon-settings:before {\n    font-weight: 800 !important;\n}\n\n/* Button appearance on hover */\n.btn-icon:hover {\n    transform: scale(1.1); /* Slight enlarge on hover */\n    background-color: rgba(0, 0, 0, 0.1); /* Subtle background color on hover */\n}\n  \n.btn-icon {\n    margin-right: 10px;\n    box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n}\n"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 57087:
/*!*********************************************************************!*\
  !*** ./src/app/microbe-trace-next-plugin.component.less?ngResource ***!
  \*********************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:host ::ng-deep .ui-multiselected-item-token,
:host ::ng-deep .ui-multiselected-empty-token {
  padding: 2px 4px;
  margin: 0 0.286em 0 0;
  display: inline-block;
  vertical-align: middle;
  height: 1.857em;
}
.color-display {
  width: 20px;
  height: 20px;
  border: 1px solid #ccc;
  display: inline-block;
  cursor: default;
}
#loading-information {
  font-family: "Courier New", Courier, "Lucida Sans Typewriter", "Lucida Typewriter", monospace;
  font-size: 11px;
  font-style: normal;
  font-variant: normal;
  font-weight: 400;
  line-height: 23px;
  padding: 10px;
  white-space: pre-line;
}
/* Search */
.autocomplete-wrapper {
  position: relative;
  /*border: solid 1px #EEE;*/
  padding: 1px 2px;
  font-family: 'Verdana', sans-serif;
}
.autocomplete-wrapper #search {
  padding: 0px 0px 0px 5px;
  margin: 0;
  width: 100%;
  font-size: 13px;
}
.autocomplete-wrapper #search:focus {
  outline: 0;
}
.autocomplete-wrapper #search-results {
  display: none;
  position: absolute;
  z-index: 5;
  top: 36px;
  left: -1px;
  right: -1px;
  border: solid 1px #CCC;
  min-height: 50px;
  max-height: 200px;
  overflow-y: scroll;
  list-style: none;
  padding: 2px;
  background: white;
}
.autocomplete-wrapper #search-results li {
  padding: 5px;
  margin: 0;
  font-size: 13px;
}
.autocomplete-wrapper #search-results li:hover {
  background: #EEE;
  cursor: pointer;
}
#url-warning-div {
  bottom: 0;
  position: absolute;
  width: 100%;
  z-index: 10;
  background-color: #f00;
  color: #fff;
  font-weight: 600;
  font-size: 14px;
  text-align: center;
}
#url-warning-div a {
  color: #fff;
}
#search-form {
  display: none;
  float: right;
  z-index: 2;
  position: relative;
  margin-left: auto;
}
label[for="search"] {
  color: white;
  margin-right: 10px;
}
#search {
  border-radius: 0.25rem 0 0 0.25rem;
}
#search-field {
  border-radius: 0 0.25rem 0.25rem 0;
  border-left: 0;
  margin-left: 2px;
}
#casesensitivebutton,
#wholewordbutton {
  margin: 2px;
  border-radius: 0.25rem;
}
:host ::ng-deep .ui-multiselected-item-token {
  background: #007ad9;
  color: #ffffff;
}
:host ::ng-deep .ui-multiselected-empty-token {
  background: #d95f00;
  color: #ffffff;
}
.tab-content {
  padding-top: 15px;
}
.loader {
  position: absolute;
  left: calc(50% - 20px);
  top: 40%;
}
.pointer {
  cursor: pointer;
}
.about-links {
  padding: 10px 0 10px 0;
}
.tabulator {
  font-size: 12px;
  border: none;
}
.tabulator .tabulator-header {
  font-weight: normal;
  border-bottom: 1px solid;
  border-bottom-color: rgba(0, 0, 0, 0.12);
  color: rgba(0, 0, 0, 0.54);
}
.tabulator .tabulator-header .tabulator-col {
  height: 48px;
  background-color: #ffffff;
  border: none;
  padding: 0 7px;
}
.tabulator-row {
  border-bottom: 1px solid;
  border-bottom-color: rgba(0, 0, 0, 0.12);
  min-height: 48px;
  vertical-align: middle;
}
.tabulator-row .tabulator-cell {
  padding: 16px 7px;
  border-right: none;
  vertical-align: middle;
}
.tabulator-row .tabulator-cell:first-of-type,
.tabulator .tabulator-header .tabulator-col:first-of-type {
  padding-left: 24px;
}
.tabulator-row.tabulator-row-even {
  background-color: #ffffff;
}
/* Tooltip container */
.tooltip {
  position: relative;
  display: inline-block;
  border-bottom: 1px dotted black;
  /* If you want dots under the hoverable text */
}
/* Tooltip text */
.tooltip .tooltiptext {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  padding: 5px 0;
  border-radius: 6px;
  /* Position the tooltip text - see examples below! */
  position: absolute;
  z-index: 1;
}
/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
  visibility: visible;
}
.floater {
  border: 1px solid #cccccc;
  border-radius: 0.25rem;
}
#color-transparency-wrapper {
  display: none;
  position: absolute;
  z-index: 1100;
  border-radius: 0.25rem;
  color: #303030;
  background-color: #f8f9fa !important;
  padding: 4px 8px;
  transform: rotate(270deg);
  transform-origin: top left;
}
.mt-icon-toolbar {
  width: 26px;
  height: 26px;
  margin-left: 5px;
}
.transparency-symbol {
  cursor: pointer;
}
#network-statistics-wrapper {
  display: none;
  position: absolute;
  bottom: 10px;
  right: 20px;
  z-index: 1;
  color: #303030;
  background-color: #f8f9fa !important;
  border: 1px solid #c0c0c0;
  border-radius: 0.25rem;
}
#network-statistics-draghandle {
  display: none;
  width: 100%;
  text-align: center;
}
#network-statistics-table td {
  border: none;
  padding: 0.125rem 0.25rem;
}
mat-slider {
  width: 300px;
}
#reveal-all {
  background-color: #dadada;
}
.custom-file-label {
  margin-left: 15px;
  margin-right: 15px;
}
#timeline {
  padding-top: 50px;
}
#timeline .axis--grid .domain {
  fill: #ddd;
  stroke: none;
}
#timeline .axis--x .domain,
#timeline .axis--grid .tick line {
  stroke: #fff;
}
#timeline .axis--grid .tick--minor line {
  stroke-opacity: 0.5;
}
#timeline-date-field {
  width: auto;
}
#global-timeline-wrapper {
  /* background: #f8f9fa; */
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  position: absolute;
  left: 0px;
  bottom: 0px;
  right: 15px;
  z-index: 1001;
}
#timeline-play-button {
  position: absolute;
  top: 10px;
  left: 10px;
  background: #f08080;
  padding-right: 10px;
  border-radius: 3px;
  border: none;
  color: white;
  margin: 0;
  padding: 0 12px;
  width: 60px;
  cursor: pointer;
  height: 30px;
}
#global-timeline-field {
  padding: 4px;
  font-size: 1.25em;
}
#timeline-play:hover {
  background-color: #696969;
}
.track,
.track-inset,
.track-overlay {
  stroke-linecap: round;
}
.track {
  stroke: #000;
  stroke-opacity: 0.3;
  stroke-width: 10px;
}
.track-inset {
  stroke: #dcdcdc;
  stroke-width: 8px;
}
.track-overlay {
  pointer-events: stroke;
  stroke-width: 50px;
  stroke: transparent;
}
.handle {
  fill: #fff;
  stroke: #000;
  cursor: grab;
  stroke-opacity: 0.5;
  stroke-width: 1.25px;
}
.p-dialog .p-dialog-header button {
  color: #495057;
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
}
.p-dialog .p-dialog-header button:enabled:hover {
  border-color: transparent;
  background: #e9ecef;
}
#nodeColorCounts,
#nodeColorFrequencies,
#linkColorCounts,
#linkColorFrequencies {
  width: 100%;
  border-radius: 0;
  display: flex;
  justify-content: space-between;
  gap: 15px;
}
input[type="checkbox"] + label {
  margin-left: 8px;
}
label.disabled {
  color: gray;
}
`, "",{"version":3,"sources":["webpack://./src/app/microbe-trace-next-plugin.component.less"],"names":[],"mappings":"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","sourcesContent":[":host ::ng-deep .ui-multiselected-item-token,\n:host ::ng-deep .ui-multiselected-empty-token {\n    padding: 2px 4px;\n    margin: 0 0.286em 0 0;\n    display: inline-block;\n    vertical-align: middle;\n    height: 1.857em;\n}\n\n.color-display {\n  width: 20px;\n  height: 20px;\n  border: 1px solid #ccc;\n  display: inline-block;\n  cursor: default;\n}\n\n#loading-information {\n  font-family: \"Courier New\", Courier, \"Lucida Sans Typewriter\", \"Lucida Typewriter\", monospace;\n  font-size: 11px;\n  font-style: normal;\n  font-variant: normal;\n  font-weight: 400;\n  line-height: 23px;\n  padding: 10px;\n  white-space: pre-line;\n}\n\n\n/* Search */\n.autocomplete-wrapper {\n  position: relative;\n  /*border: solid 1px #EEE;*/\n  padding: 1px 2px;\n  font-family: 'Verdana', sans-serif;\n}\n.autocomplete-wrapper #search {\n  padding: 0px 0px 0px 5px;\n  margin: 0;\n  width: 100%;\n  font-size: 13px;\n}\n.autocomplete-wrapper #search:focus {\n  outline: 0;\n}\n.autocomplete-wrapper #search-results {\n  display: none;\n  position: absolute;\n  z-index: 5;\n  top: 36px;\n  left: -1px;\n  right: -1px;\n  border: solid 1px #CCC;\n  min-height: 50px;\n  max-height: 200px;\n  overflow-y: scroll;\n  list-style: none;\n  padding: 2px;\n  background: white;\n}\n.autocomplete-wrapper #search-results li {\n  padding: 5px;\n  margin: 0;\n  font-size: 13px;\n}\n.autocomplete-wrapper #search-results li:hover {\n  background: #EEE;\n  cursor: pointer;\n}\n\n#url-warning-div {\n  bottom: 0;\n  position: absolute;\n  width: 100%;\n  z-index: 10;\n  background-color: #f00;\n  color: #fff;\n  font-weight: 600;\n  font-size: 14px;\n  text-align: center;\n  a {\n    color: #fff;\n  }\n}\n\n#search-form {\n  display: none;\n  float: right;\n  z-index: 2;\n  position: relative;\n  margin-left: auto;\n}\nlabel[for=\"search\"] {\n  color: white;\n  margin-right: 10px;\n}\n#search {\n  border-radius: 0.25rem 0 0 0.25rem;\n}\n#search-field {\n  border-radius: 0 0.25rem 0.25rem 0;\n  border-left: 0;\n  margin-left: 2px;\n}\n\n#casesensitivebutton, #wholewordbutton {\n  margin: 2px;\n  border-radius: 0.25rem;\n}\n\n:host ::ng-deep .ui-multiselected-item-token {\n  background: #007ad9;\n  color: #ffffff;\n}\n\n:host ::ng-deep .ui-multiselected-empty-token {\n  background: #d95f00;\n  color: #ffffff;\n}\n\n.tab-content {\n  padding-top: 15px;\n}\n\n.loader {\n    position: absolute;\n    left: calc(50% - 20px);\n    top: 40%;\n}\n\n.pointer {\n    cursor: pointer;\n}\n\n.about-links {\n  padding: 10px 0 10px 0;\n}\n\n//Tabulator styles override\n\n.tabulator {\n  font-size: 12px;\n  border: none;\n}\n\n.tabulator .tabulator-header {\n  font-weight: normal;\n  border-bottom: 1px solid;\n  border-bottom-color: rgba(0, 0, 0, 0.12);\n  color: rgba(0, 0, 0, 0.54);\n}\n\n.tabulator .tabulator-header .tabulator-col {\n  height: 48px;\n  background-color: #ffffff;\n  border: none;\n  padding: 0 7px;\n}\n\n.tabulator-row {\n  border-bottom: 1px solid;\n  border-bottom-color: rgba(0, 0, 0, 0.12);\n  min-height: 48px;\n  vertical-align: middle;\n}\n\n.tabulator-row .tabulator-cell {\n  padding: 16px 7px;\n  border-right: none;\n  vertical-align: middle;\n}\n\n.tabulator-row .tabulator-cell:first-of-type,\n.tabulator .tabulator-header .tabulator-col:first-of-type {\n  padding-left: 24px;\n}\n\n.tabulator-row.tabulator-row-even {\n  background-color: #ffffff;\n}\n\n/* Tooltip container */\n.tooltip {\n    position: relative;\n    display: inline-block;\n    border-bottom: 1px dotted black; /* If you want dots under the hoverable text */\n}\n\n/* Tooltip text */\n.tooltip .tooltiptext {\n    visibility: hidden;\n    width: 120px;\n    background-color: black;\n    color: #fff;\n    text-align: center;\n    padding: 5px 0;\n    border-radius: 6px;\n    /* Position the tooltip text - see examples below! */\n    position: absolute;\n    z-index: 1;\n}\n\n/* Show the tooltip text when you mouse over the tooltip container */\n.tooltip:hover .tooltiptext {\n    visibility: visible;\n}\n\n// color table\n.floater {\n    border: 1px solid #cccccc;\n    border-radius: 0.25rem;\n}\n\n#color-transparency-wrapper {\n    display: none;\n    position: absolute;\n    z-index: 1100;\n    border-radius: 0.25rem;\n    color: #303030;\n    background-color: #f8f9fa !important;\n    padding: 4px 8px;\n    transform: rotate(270deg);\n    transform-origin: top left;\n}\n\n.mt-icon-toolbar {\n  width: 26px;\n  height: 26px;\n  margin-left: 5px;\n}\n\n.transparency-symbol {\n    cursor: pointer;\n}\n\n#network-statistics-wrapper {\n    display: none;\n    position: absolute;\n    bottom: 10px;\n    right: 20px;\n    z-index: 1;\n    color: #303030;\n    background-color: #f8f9fa !important;\n    border: 1px solid #c0c0c0;\n    border-radius: 0.25rem;\n  }\n  #network-statistics-draghandle {\n    display: none;\n    width: 100%;\n    text-align: center;\n  }\n  #network-statistics-table td {\n    border: none;\n    padding: 0.125rem 0.25rem;\n  }\n\n  mat-slider {\n    width: 300px;\n  }\n\n  #reveal-all {\n    background-color: #dadada;\n  }\n\n  .custom-file-label {\n    margin-left: 15px;\n    margin-right: 15px;\n  }\n\n  #timeline {\n    padding-top: 50px;\n  }\n  #timeline .axis--grid .domain {\n    fill: #ddd;\n    stroke: none;\n  }\n  \n  #timeline .axis--x .domain,\n  #timeline .axis--grid .tick line {\n    stroke: #fff;\n  }\n  \n  #timeline .axis--grid .tick--minor line {\n    stroke-opacity: 0.5;\n  }\n  #timeline-date-field {\n    width: auto;\n  }\n  \n\n  #global-timeline-wrapper {\n    /* background: #f8f9fa; */\n    border-top: 1px solid rgba(0, 0, 0, 0.1);\n    position: absolute;\n    left: 0px;\n    bottom: 0px;\n    right: 15px;\n    z-index: 1001;\n  }\n  \n  #timeline-play-button {\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    background: #f08080;\n    padding-right: 10px;\n    border-radius: 3px;\n    border: none;\n    color: white;\n    margin: 0;\n    padding: 0 12px;\n    width: 60px;\n    cursor: pointer;\n    height: 30px;\n  }\n  #global-timeline-field {\n    padding: 4px;\n    font-size: 1.25em;\n  }\n  #timeline-play:hover {\n    background-color: #696969;\n  }    \n  .track,\n  .track-inset,\n  .track-overlay {\n    stroke-linecap: round;\n  }\n  .track {\n    stroke: #000;\n    stroke-opacity: 0.3;\n    stroke-width: 10px;\n  }\n  .track-inset {\n    stroke: #dcdcdc;\n    stroke-width: 8px;\n  }\n  .track-overlay {\n    pointer-events: stroke;\n    stroke-width: 50px;\n    stroke: transparent;\n    // cursor: crosshair;\n  }\n  .handle {\n    fill: #fff;\n    stroke: #000;\n    cursor:grab;\n    stroke-opacity: 0.5;\n    stroke-width: 1.25px;\n  }\n\n  .p-dialog .p-dialog-header button {\n    color: #495057;\n    width: 2rem;\n    height: 2rem;\n    border-radius: 50%;\n  }\n  .p-dialog .p-dialog-header button:enabled:hover {\n    border-color: transparent;\n    background: #e9ecef;\n  }\n\n#nodeColorCounts, #nodeColorFrequencies, #linkColorCounts, #linkColorFrequencies {\n  width: 100%; \n  border-radius: 0; \n  display: flex; \n  justify-content: space-between;\n  gap: 15px;\n}\n  \ninput[type=\"checkbox\"] + label {\n  margin-left: 8px;\n}\nlabel.disabled {\n  color: gray;\n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 52082:
/*!***********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/TableComponent/table-plugin-component.less?ngResource ***!
  \***********************************************************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

// Imports
var ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/sourceMaps.js */ 53142);
var ___CSS_LOADER_API_IMPORT___ = __webpack_require__(/*! ../../../../node_modules/css-loader/dist/runtime/api.js */ 35950);
var ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);
// Module
___CSS_LOADER_EXPORT___.push([module.id, `:host {
  position: absolute;
  overflow: hidden;
  z-index: 1 !important;
}
#tool-btn-container {
  display: flex !important;
}
.tool-btn {
  height: 30px;
}
:host ::ng-deep .ui-table-customers {
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.2), 0 1px 1px 0 rgba(0, 0, 0, 0.14), 0 2px 1px -1px rgba(0, 0, 0, 0.12);
}
:host ::ng-deep .ui-table-customers .customer-badge {
  border-radius: 2px;
  padding: 0.25em 0.5em;
  text-transform: uppercase;
  font-weight: 700;
  font-size: 12px;
  letter-spacing: 0.3px;
}
:host ::ng-deep .ui-table-customers .customer-badge.status-qualified {
  background-color: #C8E6C9;
  color: #256029;
}
:host ::ng-deep .ui-table-customers .customer-badge.status-unqualified {
  background-color: #FFCDD2;
  color: #C63737;
}
:host ::ng-deep .ui-table-customers .customer-badge.status-negotiation {
  background-color: #FEEDAF;
  color: #8A5340;
}
:host ::ng-deep .ui-table-customers .customer-badge.status-new {
  background-color: #B3E5FC;
  color: #23547B;
}
:host ::ng-deep .ui-table-customers .customer-badge.status-renewal {
  background-color: #ECCFFF;
  color: #694382;
}
:host ::ng-deep .ui-table-customers .customer-badge.status-proposal {
  background-color: #FFD8B2;
  color: #805B36;
}
:host ::ng-deep .ui-table-customers .flag {
  vertical-align: middle;
  width: 30px;
  height: 20px;
}
:host ::ng-deep .ui-table-customers .ui-multiselect-representative-option {
  display: inline-block;
  vertical-align: middle;
}
:host ::ng-deep .ui-table-customers .ui-multiselect-representative-option img {
  vertical-align: middle;
  width: 24px;
}
:host ::ng-deep .ui-table-customers .ui-multiselect-representative-option span {
  margin-top: 0.125em;
  vertical-align: middle;
  margin-left: 0.5em;
}
:host ::ng-deep .ui-table-customers .ui-paginator .ui-dropdown {
  float: left;
}
:host ::ng-deep .ui-table-customers .ui-paginator .ui-paginator-current {
  float: right;
}
:host ::ng-deep .ui-table-customers .ui-progressbar {
  height: 8px;
  background-color: #D8DADC;
}
:host ::ng-deep .ui-table-customers .ui-progressbar .ui-progressbar-value {
  background-color: #00ACAD;
}
:host ::ng-deep .ui-table-customers .ui-column-filter {
  display: block;
}
:host ::ng-deep .ui-table-customers .ui-column-filter input {
  width: 100%;
}
:host ::ng-deep .ui-table-customers .ui-table-globalfilter-container {
  float: right;
}
:host ::ng-deep .ui-table-customers .ui-table-globalfilter-container input {
  width: 200px;
}
:host ::ng-deep .ui-table-customers .ui-datepicker {
  min-width: 25em;
}
:host ::ng-deep .ui-table-customers .ui-datepicker td {
  font-weight: 400;
}
:host ::ng-deep .ui-table-customers .ui-table-caption {
  border: 0 none;
  padding: 12px;
  text-align: left;
  font-size: 20px;
}
:host ::ng-deep .ui-table-customers .ui-paginator {
  border: 0 none;
  padding: 1em;
}
:host ::ng-deep .ui-table-customers .ui-table-thead > tr > th {
  border: 0 none;
  text-align: left;
}
:host ::ng-deep .ui-table-customers .ui-table-thead > tr > th.ui-filter-column {
  border-top: 1px solid #c8c8c8;
}
:host ::ng-deep .ui-table-customers .ui-table-thead > tr > th:first-child {
  width: 5em;
  text-align: center;
}
:host ::ng-deep .ui-table-customers .ui-table-thead > tr > th:last-child {
  width: 8em;
  text-align: center;
}
:host ::ng-deep .ui-table-customers .ui-table-tbody > tr > td {
  border: 0 none;
  cursor: auto;
}
:host ::ng-deep .ui-table-customers .ui-table-tbody > tr > td:first-child {
  width: 3em;
  text-align: center;
}
:host ::ng-deep .ui-table-customers .ui-table-tbody > tr > td:last-child {
  width: 8em;
  text-align: center;
}
:host ::ng-deep .ui-table-customers .ui-dropdown-label:not(.ui-placeholder) {
  text-transform: uppercase;
}
:host ::ng-deep .ui-table-customers .ui-table-tbody > tr > td .ui-column-title {
  display: none;
}
.item {
  display: inline-block;
  background: blue;
}
.filterType {
  background: transparent;
  border-color: transparent;
  border-width: 0px;
  border: 0px solid transparent;
  border-style: inset;
  outline-style: dashed;
  outline-color: transparent;
}
/* Responsive */
@media screen and (max-width: 64em) {
  :host ::ng-deep .ui-table.ui-table-customers .ui-table-thead > tr > th,
  :host ::ng-deep .ui-table.ui-table-customers .ui-table-tfoot > tr > td {
    display: none !important;
  }
  :host ::ng-deep .ui-table.ui-table-customers .ui-table-tbody > tr > td {
    text-align: left;
    display: block;
    border: 0 none !important;
    width: 100% !important;
    float: left;
    clear: left;
    border: 0 none;
  }
  :host ::ng-deep .ui-table.ui-table-customers .ui-table-tbody > tr > td .ui-column-title {
    padding: 0.4em;
    min-width: 30%;
    display: inline-block;
    margin: -0.4em 1em -0.4em -0.4em;
    font-weight: bold;
  }
}
.table-wrapper {
  padding: 70px 20px 10px 20px;
}
/* Button appearance on hover */
.btn-icon:hover {
  transform: scale(1.1);
  /* Slight enlarge on hover */
  background-color: rgba(0, 0, 0, 0.1);
  /* Subtle background color on hover */
}
.btn-icon {
  margin-right: 10px;
  box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);
  background: white;
}
.flaticon-settings:before {
  font-weight: 800 !important;
}
.flaticon-download:before {
  font-weight: 800 !important;
}
::ng-deep .p-datatable-scrollable-table > .p-datatable-thead {
  z-index: 1 !important;
}
`, "",{"version":3,"sources":["webpack://./src/app/visualizationComponents/TableComponent/table-plugin-component.less"],"names":[],"mappings":"AAAA;EACI,kBAAA;EACA,gBAAA;EACA,qBAAA;AACJ;AAEA;EACI,wBAAA;AAAJ;AAGA;EACI,YAAA;AADJ;AAKA;EACI,+GAAA;AAHJ;AAEA;EAIQ,kBAAA;EACA,qBAAA;EACA,yBAAA;EACA,gBAAA;EACA,eAAA;EACA,qBAAA;AAHR;AAKQ;EACI,yBAAA;EACA,cAAA;AAHZ;AAMQ;EACI,yBAAA;EACA,cAAA;AAJZ;AAOQ;EACI,yBAAA;EACA,cAAA;AALZ;AAQQ;EACI,yBAAA;EACA,cAAA;AANZ;AASQ;EACI,yBAAA;EACA,cAAA;AAPZ;AAUQ;EACI,yBAAA;EACA,cAAA;AARZ;AA9BA;EA2CQ,sBAAA;EACA,WAAA;EACA,YAAA;AAVR;AAnCA;EAiDQ,qBAAA;EACA,sBAAA;AAXR;AAvCA;EAqDY,sBAAA;EACA,WAAA;AAXZ;AA3CA;EA0DY,mBAAA;EACA,sBAAA;EACA,kBAAA;AAZZ;AAhDA;EAkEY,WAAA;AAfZ;AAnDA;EAsEY,YAAA;AAhBZ;AAtDA;EA2EQ,WAAA;EACA,yBAAA;AAlBR;AA1DA;EA+EY,yBAAA;AAlBZ;AA7DA;EAoFQ,cAAA;AApBR;AAhEA;EAuFY,WAAA;AApBZ;AAnEA;EA4FQ,YAAA;AAtBR;AAtEA;EA+FY,YAAA;AAtBZ;AAzEA;EAoGQ,eAAA;AAxBR;AA5EA;EAuGY,gBAAA;AAxBZ;AA/EA;EA4GQ,cAAA;EACA,aAAA;EACA,gBAAA;EACA,eAAA;AA1BR;AArFA;EAmHQ,cAAA;EACA,YAAA;AA3BR;AAzFA;EAwHQ,cAAA;EACA,gBAAA;AA5BR;AA8BQ;EACI,6BAAA;AA5BZ;AA+BQ;EACI,UAAA;EACA,kBAAA;AA7BZ;AAgCQ;EACI,UAAA;EACA,kBAAA;AA9BZ;AAxGA;EA2IQ,cAAA;EACA,YAAA;AAhCR;AAkCQ;EACI,UAAA;EACA,kBAAA;AAhCZ;AAmCQ;EACI,UAAA;EACA,kBAAA;AAjCZ;AApHA;EA0JQ,yBAAA;AAnCR;AAvHA;EA8JQ,aAAA;AApCR;AA0CA;EACI,qBAAA;EACA,gBAAA;AAxCJ;AA2CA;EACI,uBAAA;EACA,yBAAA;EACA,iBAAA;EACA,6BAAA;EAEA,mBAAA;EACA,qBAAA;EACA,0BAAA;AA1CJ;AACA,eAAe;AA6Cf;EAEQ;;IAIQ,wBAAA;EA9Cd;EA0CM;IAQQ,gBAAA;IACA,cAAA;IACA,yBAAA;IACA,sBAAA;IACA,WAAA;IACA,WAAA;IACA,cAAA;EA/Cd;EAiCM;IAiBY,cAAA;IACA,cAAA;IACA,qBAAA;IACA,gCAAA;IACA,iBAAA;EA/ClB;AACF;AAqDA;EACI,4BAAA;AAnDJ;AACA,+BAA+B;AAuD/B;EACI,qBAAA;EArDF,4BAA4B;EAuD1B,oCAAA;EArDF,qCAAqC;AACvC;AAwDA;EACI,kBAAA;EACA,0CAAA;EACA,iBAAA;AAtDJ;AAyDA;EACI,2BAAA;AAvDJ;AA0DA;EACI,2BAAA;AAxDJ;AA2DA;EACI,qBAAA;AAzDJ","sourcesContent":[":host {\n    position: absolute;\n    overflow: hidden;\n    z-index: 1 !important;\n}\n\n#tool-btn-container {\n    display: flex !important;\n}\n\n.tool-btn {\n    height: 30px;\n}\n\n\n:host ::ng-deep .ui-table-customers {\n    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.2), 0 1px 1px 0 rgba(0, 0, 0, 0.14), 0 2px 1px -1px rgba(0, 0, 0, 0.12);\n\n    .customer-badge {\n        border-radius: 2px;\n        padding: .25em .5em;\n        text-transform: uppercase;\n        font-weight: 700;\n        font-size: 12px;\n        letter-spacing: .3px;\n\n        &.status-qualified {\n            background-color: #C8E6C9;\n            color: #256029;\n        }\n\n        &.status-unqualified {\n            background-color: #FFCDD2;\n            color: #C63737;\n        }\n\n        &.status-negotiation {\n            background-color: #FEEDAF;\n            color: #8A5340;\n        }\n\n        &.status-new {\n            background-color: #B3E5FC;\n            color: #23547B;\n        }\n\n        &.status-renewal {\n            background-color: #ECCFFF;\n            color: #694382;\n        }\n\n        &.status-proposal {\n            background-color: #FFD8B2;\n            color: #805B36;\n        }\n    }\n\n    .flag {\n        vertical-align: middle;\n        width: 30px;\n        height: 20px;\n    }\n\n    .ui-multiselect-representative-option {\n        display: inline-block;\n        vertical-align: middle;\n\n        img {\n            vertical-align: middle;\n            width: 24px;\n        }\n\n        span {\n            margin-top: .125em;\n            vertical-align: middle;\n            margin-left: .5em\n        }\n    }\n\n    .ui-paginator {\n        .ui-dropdown {\n            float: left;\n        }\n\n        .ui-paginator-current {\n            float: right;\n        }\n    }\n\n    .ui-progressbar {\n        height: 8px;\n        background-color: #D8DADC;\n\n        .ui-progressbar-value {\n            background-color: #00ACAD;\n        }\n    }\n\n    .ui-column-filter {\n        display: block;\n\n        input {\n            width: 100%;\n        }\n    }\n\n    .ui-table-globalfilter-container {\n        float: right;\n\n        input {\n            width: 200px;\n        }\n    }\n\n    .ui-datepicker {\n        min-width: 25em;\n\n        td {\n            font-weight: 400;\n        }\n    }\n\n    .ui-table-caption {\n        border: 0 none;\n        padding: 12px;\n        text-align: left;\n        font-size: 20px;\n    }\n\n    .ui-paginator {\n        border: 0 none;\n        padding: 1em;\n    }\n\n    .ui-table-thead>tr>th {\n        border: 0 none;\n        text-align: left;\n\n        &.ui-filter-column {\n            border-top: 1px solid #c8c8c8;\n        }\n\n        &:first-child {\n            width: 5em;\n            text-align: center;\n        }\n\n        &:last-child {\n            width: 8em;\n            text-align: center;\n        }\n    }\n\n    .ui-table-tbody>tr>td {\n        border: 0 none;\n        cursor: auto;\n\n        &:first-child {\n            width: 3em;\n            text-align: center;\n        }\n\n        &:last-child {\n            width: 8em;\n            text-align: center;\n        }\n    }\n\n    .ui-dropdown-label:not(.ui-placeholder) {\n        text-transform: uppercase;\n    }\n\n    .ui-table-tbody>tr>td .ui-column-title {\n        display: none;\n    }\n}\n\n.wrapper {}\n\n.item {\n    display: inline-block;\n    background: blue;\n}\n\n.filterType {\n    background: transparent;\n    border-color: transparent;\n    border-width: 0px;\n    border: 0px solid transparent;\n\n    border-style: inset;\n    outline-style: dashed;\n    outline-color: transparent;\n}\n\n/* Responsive */\n@media screen and (max-width: 64em) {\n    :host ::ng-deep .ui-table {\n        &.ui-table-customers {\n\n            .ui-table-thead>tr>th,\n            .ui-table-tfoot>tr>td {\n                display: none !important;\n            }\n\n            .ui-table-tbody>tr>td {\n                text-align: left;\n                display: block;\n                border: 0 none !important;\n                width: 100% !important;\n                float: left;\n                clear: left;\n                border: 0 none;\n\n                .ui-column-title {\n                    padding: .4em;\n                    min-width: 30%;\n                    display: inline-block;\n                    margin: -.4em 1em -.4em -.4em;\n                    font-weight: bold;\n                }\n            }\n        }\n    }\n}\n\n.table-wrapper {\n    padding: 70px 20px 10px 20px;\n}\n\n\n/* Button appearance on hover */\n.btn-icon:hover {\n    transform: scale(1.1);\n    /* Slight enlarge on hover */\n    background-color: rgba(0, 0, 0, 0.1);\n    /* Subtle background color on hover */\n}\n\n.btn-icon {\n    margin-right: 10px;\n    box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.2);\n    background: white;\n}\n\n.flaticon-settings:before {\n    font-weight: 800 !important;\n}\n\n.flaticon-download:before {\n    font-weight: 800 !important;\n}\n\n::ng-deep .p-datatable-scrollable-table > .p-datatable-thead { \n    z-index: 1 !important; \n}"],"sourceRoot":""}]);
// Exports
module.exports = ___CSS_LOADER_EXPORT___.toString();


/***/ }),

/***/ 35358:
/*!***************************************************!*\
  !*** ./node_modules/moment/locale/ sync ^\.\/.*$ ***!
  \***************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var map = {
	"./af": 85637,
	"./af.js": 85637,
	"./ar": 6777,
	"./ar-dz": 74508,
	"./ar-dz.js": 74508,
	"./ar-kw": 67504,
	"./ar-kw.js": 67504,
	"./ar-ly": 95373,
	"./ar-ly.js": 95373,
	"./ar-ma": 92412,
	"./ar-ma.js": 92412,
	"./ar-ps": 78823,
	"./ar-ps.js": 78823,
	"./ar-sa": 36670,
	"./ar-sa.js": 36670,
	"./ar-tn": 36448,
	"./ar-tn.js": 36448,
	"./ar.js": 6777,
	"./az": 23009,
	"./az.js": 23009,
	"./be": 28299,
	"./be.js": 28299,
	"./bg": 4685,
	"./bg.js": 4685,
	"./bm": 11171,
	"./bm.js": 11171,
	"./bn": 23590,
	"./bn-bd": 5841,
	"./bn-bd.js": 5841,
	"./bn.js": 23590,
	"./bo": 54309,
	"./bo.js": 54309,
	"./br": 54130,
	"./br.js": 54130,
	"./bs": 8033,
	"./bs.js": 8033,
	"./ca": 55294,
	"./ca.js": 55294,
	"./cs": 53028,
	"./cs.js": 53028,
	"./cv": 5807,
	"./cv.js": 5807,
	"./cy": 70342,
	"./cy.js": 70342,
	"./da": 38269,
	"./da.js": 38269,
	"./de": 11489,
	"./de-at": 42123,
	"./de-at.js": 42123,
	"./de-ch": 17757,
	"./de-ch.js": 17757,
	"./de.js": 11489,
	"./dv": 28152,
	"./dv.js": 28152,
	"./el": 7687,
	"./el.js": 7687,
	"./en-au": 46668,
	"./en-au.js": 46668,
	"./en-ca": 76798,
	"./en-ca.js": 76798,
	"./en-gb": 53615,
	"./en-gb.js": 53615,
	"./en-ie": 91364,
	"./en-ie.js": 91364,
	"./en-il": 79907,
	"./en-il.js": 79907,
	"./en-in": 70533,
	"./en-in.js": 70533,
	"./en-nz": 33190,
	"./en-nz.js": 33190,
	"./en-sg": 51096,
	"./en-sg.js": 51096,
	"./eo": 3962,
	"./eo.js": 3962,
	"./es": 37726,
	"./es-do": 65010,
	"./es-do.js": 65010,
	"./es-mx": 63654,
	"./es-mx.js": 63654,
	"./es-us": 59043,
	"./es-us.js": 59043,
	"./es.js": 37726,
	"./et": 25343,
	"./et.js": 25343,
	"./eu": 90728,
	"./eu.js": 90728,
	"./fa": 60787,
	"./fa.js": 60787,
	"./fi": 71771,
	"./fi.js": 71771,
	"./fil": 45335,
	"./fil.js": 45335,
	"./fo": 69761,
	"./fo.js": 69761,
	"./fr": 1670,
	"./fr-ca": 28991,
	"./fr-ca.js": 28991,
	"./fr-ch": 97280,
	"./fr-ch.js": 97280,
	"./fr.js": 1670,
	"./fy": 24203,
	"./fy.js": 24203,
	"./ga": 69858,
	"./ga.js": 69858,
	"./gd": 38605,
	"./gd.js": 38605,
	"./gl": 27365,
	"./gl.js": 27365,
	"./gom-deva": 33896,
	"./gom-deva.js": 33896,
	"./gom-latn": 95587,
	"./gom-latn.js": 95587,
	"./gu": 97950,
	"./gu.js": 97950,
	"./he": 92029,
	"./he.js": 92029,
	"./hi": 51897,
	"./hi.js": 51897,
	"./hr": 29816,
	"./hr.js": 29816,
	"./hu": 22253,
	"./hu.js": 22253,
	"./hy-am": 28196,
	"./hy-am.js": 28196,
	"./id": 51307,
	"./id.js": 51307,
	"./is": 95474,
	"./is.js": 95474,
	"./it": 23099,
	"./it-ch": 45807,
	"./it-ch.js": 45807,
	"./it.js": 23099,
	"./ja": 19127,
	"./ja.js": 19127,
	"./jv": 30182,
	"./jv.js": 30182,
	"./ka": 10758,
	"./ka.js": 10758,
	"./kk": 93444,
	"./kk.js": 93444,
	"./km": 72034,
	"./km.js": 72034,
	"./kn": 46223,
	"./kn.js": 46223,
	"./ko": 83064,
	"./ko.js": 83064,
	"./ku": 8714,
	"./ku-kmr": 10961,
	"./ku-kmr.js": 10961,
	"./ku.js": 8714,
	"./ky": 12062,
	"./ky.js": 12062,
	"./lb": 84796,
	"./lb.js": 84796,
	"./lo": 19279,
	"./lo.js": 19279,
	"./lt": 106,
	"./lt.js": 106,
	"./lv": 11840,
	"./lv.js": 11840,
	"./me": 42240,
	"./me.js": 42240,
	"./mi": 13588,
	"./mi.js": 13588,
	"./mk": 15518,
	"./mk.js": 15518,
	"./ml": 37823,
	"./ml.js": 37823,
	"./mn": 98657,
	"./mn.js": 98657,
	"./mr": 61285,
	"./mr.js": 61285,
	"./ms": 43014,
	"./ms-my": 86253,
	"./ms-my.js": 86253,
	"./ms.js": 43014,
	"./mt": 20167,
	"./mt.js": 20167,
	"./my": 47940,
	"./my.js": 47940,
	"./nb": 50014,
	"./nb.js": 50014,
	"./ne": 49023,
	"./ne.js": 49023,
	"./nl": 34208,
	"./nl-be": 71412,
	"./nl-be.js": 71412,
	"./nl.js": 34208,
	"./nn": 81354,
	"./nn.js": 81354,
	"./oc-lnc": 40870,
	"./oc-lnc.js": 40870,
	"./pa-in": 80389,
	"./pa-in.js": 80389,
	"./pl": 7342,
	"./pl.js": 7342,
	"./pt": 34774,
	"./pt-br": 73003,
	"./pt-br.js": 73003,
	"./pt.js": 34774,
	"./ro": 85333,
	"./ro.js": 85333,
	"./ru": 73451,
	"./ru.js": 73451,
	"./sd": 66302,
	"./sd.js": 66302,
	"./se": 59682,
	"./se.js": 59682,
	"./si": 80582,
	"./si.js": 80582,
	"./sk": 4348,
	"./sk.js": 4348,
	"./sl": 95337,
	"./sl.js": 95337,
	"./sq": 39358,
	"./sq.js": 39358,
	"./sr": 50683,
	"./sr-cyrl": 69382,
	"./sr-cyrl.js": 69382,
	"./sr.js": 50683,
	"./ss": 51156,
	"./ss.js": 51156,
	"./sv": 29855,
	"./sv.js": 29855,
	"./sw": 18536,
	"./sw.js": 18536,
	"./ta": 15373,
	"./ta.js": 15373,
	"./te": 37809,
	"./te.js": 37809,
	"./tet": 61297,
	"./tet.js": 61297,
	"./tg": 92527,
	"./tg.js": 92527,
	"./th": 85862,
	"./th.js": 85862,
	"./tk": 79331,
	"./tk.js": 79331,
	"./tl-ph": 44387,
	"./tl-ph.js": 44387,
	"./tlh": 3592,
	"./tlh.js": 3592,
	"./tr": 79732,
	"./tr.js": 79732,
	"./tzl": 99570,
	"./tzl.js": 99570,
	"./tzm": 83553,
	"./tzm-latn": 7699,
	"./tzm-latn.js": 7699,
	"./tzm.js": 83553,
	"./ug-cn": 25674,
	"./ug-cn.js": 25674,
	"./uk": 69974,
	"./uk.js": 69974,
	"./ur": 45773,
	"./ur.js": 45773,
	"./uz": 357,
	"./uz-latn": 77135,
	"./uz-latn.js": 77135,
	"./uz.js": 357,
	"./vi": 20043,
	"./vi.js": 20043,
	"./x-pseudo": 40767,
	"./x-pseudo.js": 40767,
	"./yo": 80150,
	"./yo.js": 80150,
	"./zh-cn": 21828,
	"./zh-cn.js": 21828,
	"./zh-hk": 86644,
	"./zh-hk.js": 86644,
	"./zh-mo": 79305,
	"./zh-mo.js": 79305,
	"./zh-tw": 31860,
	"./zh-tw.js": 31860
};


function webpackContext(req) {
	var id = webpackContextResolve(req);
	return __webpack_require__(id);
}
function webpackContextResolve(req) {
	if(!__webpack_require__.o(map, req)) {
		var e = new Error("Cannot find module '" + req + "'");
		e.code = 'MODULE_NOT_FOUND';
		throw e;
	}
	return map[req];
}
webpackContext.keys = function webpackContextKeys() {
	return Object.keys(map);
};
webpackContext.resolve = webpackContextResolve;
module.exports = webpackContext;
webpackContext.id = 35358;

/***/ }),

/***/ 61584:
/*!***********************************************!*\
  !*** ./src/app/app.component.html?ngResource ***!
  \***********************************************/
/***/ ((module) => {

"use strict";
module.exports = "\n<router-outlet></router-outlet>\n";

/***/ }),

/***/ 96303:
/*!***********************************************************************!*\
  !*** ./src/app/filesComponent/files-plugin.component.html?ngResource ***!
  \***********************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"m-content\">\n\n    <div id=\"file-panel\" class=\"container-fluid\" style=\"padding-top: 60px;\">\n        <div id=\"file-table\" [style.display]=\"isLoadingFiles ? 'none' : 'block'\" class=\"container\">\n        </div>\n        <div id=\"file-prompt\" *ngIf=\"this.commonService?.session?.files === (undefined || [])\" class=\"d-flex justify-content-center\">\n            <h1><b>Please add data files to load...</b></h1>\n        </div>\n        <div class=\"spinner-wrapper\" *ngIf=\"isLoadingFiles\">\n            <mat-progress-spinner mode=\"indeterminate\"></mat-progress-spinner>\n        </div>\n    \n    </div>\n\n    <div id=\"tool-btn-container\" class=\"m-portlet\">\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n            <a title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n        </span>\n    </div>\n    \n   \n\n    <div class=\"view-controls\">\n        <p-dialog id=\"file-settings-pane\" [(visible)]=\"displayFileSettings\" header=\"File Settings\">\n            <div class=\"modal-dialog modal-lg\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-body\">\n                        <tabset class=\"tab-container tabbable-line\" style='width: 100%;'>\n                            <tab heading=\"{{'Files' | localize}}\" [active]=\"true\" customClass=\"m-tabs__item\">\n                                <div id=\"file-settings\" class=\"tab-pane fade active show\" role=\"tabpanel\">\n                                    <div class=\"form-group row\">\n                                        <div class=\"col-5\">\n                                            <label style=\"padding-left: 10px;\" for=\"default-distance-metric\" class=\"mr-2\" title=\"Which Genetic Distance Metric should Microbe use to first construct the network?\">\n                                                {{\"Distance Metric\" | localize}}\n                                            </label>\n                                        </div>\n                                        <div class=\"col-7\">\n                                            <select id=\"default-distance-metric\" class=\"form-control form-control-sm mr-5\" [(ngModel)]=\"SelectedDefaultDistanceMetricVariable\" (ngModelChange)=\"onDistanceMetricChange($event)\">\n                                                <option value=\"tn93\" selected>TN93</option>\n                                                <option value=\"snps\">SNPs</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                    <div id=\"ambiguities-row\" *ngIf=\"SelectedDefaultDistanceMetricVariable=='tn93'\" class=\"form-group row\">\n                                        <div class=\"col-5\">\n                                            <label style=\"padding-left: 10px;\" for=\"ambiguity-resolution-strategy\" class=\"mr-2\" title=\"What Strategy should MicrobeTrace use to handle ambiguities?\">\n                                                {{\"Ambiguities\" | localize}}\n                                            </label>\n                                        </div>\n                                        <div class=\"col-7\">\n                                            <select id=\"ambiguity-resolution-strategy\" class=\"form-control form-control-sm mr-5\" [(ngModel)]=\"SelectedAmbiguityResolutionStrategyVariable\" (ngModelChange)=\"onAmbiguityStrategyChanged()\">\n                                                <option value=\"AVERAGE\">Average</option>\n                                                <option value=\"RESOLVE\">Resolve</option>\n                                                <option value=\"SKIP\">Skip</option>\n                                                <option value=\"GAPMM\">GapMM</option>\n                                                <option value=\"HIVTRACE-G\">HIV-TRACE -g</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                    <div id=\"ambiguity-threshold-row\" class=\"form-group row\" *ngIf=\"(SelectedAmbiguityResolutionStrategyVariable=='HIVTRACE-G' || SelectedAmbiguityResolutionStrategyVariable=='RESOLVE') && SelectedDefaultDistanceMetricVariable=='tn93'\">\n                                        <div class=\"col-5\">\n                                            <label style=\"padding-left: 10px;\" for=\"ambiguity-threshold\" class=\"mr-2\" title=\"What's the maximum proportion of ambiguities that should be resolved? (Ambiguities will be averaged rather than resolved in sequences with > this threshold.) Please note that this can be changed later.\">\n                                                {{\"Ambiguity Threshold\" | localize}}\n                                            </label>\n                                        </div>\n                                        <div class=\"col-7\">\n                                            <input type=\"number\" id=\"ambiguity-threshold\" class=\"form-control form-control-sm\" min=\"0\" value=\"0.015\" step=\"0.001\" [(ngModel)]=\"SelectedAmbiguityThresholdVariable\" (ngModelChange)=\"onAmbiguityThresholdChanged()\">\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\">\n                                        <div class=\"col-5\">\n                                            <label style=\"padding-left: 10px;\" for=\"default-distance-threshold\" class=\"mr-2\" title=\"What's the maximum genetic distance you wish to consider linked? Please note that this can be changed later.\">\n                                                {{\"Link Threshold\" | localize}}\n                                            </label>\n                                        </div>\n                                        <div class=\"col-7\">\n                                            <input type=\"number\" id=\"default-distance-threshold\" class=\"form-control form-control-sm\" min=\"0\" value=\"0.015\" step=\"0.001\" [(ngModel)]=\"SelectedDefaultDistanceThresholdVariable\" (ngModelChange)=\"onLinkThresholdChange($event)\">\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\">\n                                        <div class=\"col-5\">\n                                            <label style=\"padding-left: 10px;\" for=\"default-view\">{{\"View to Launch\" | localize}}</label>\n                                        </div>\n                                        <div class=\"col-7\">\n                                            <select id=\"default-view\" class=\"form-control form-control-sm\" (change)=\"changeDefaultView($event)\" title=\"Which view should MicrobeTrace render first, once it has successfully processed the data?\" [(ngModel)]=\"SelectedDefaultViewVariable\">\n                                                <option value=\"2D Network\" selected>2D Network</option>\n                                                <option value=\"Table\">Table</option>\n                                                <option value=\"Map\">Map</option>\n                                                <option value=\"Phylogenetic Tree\">Phylogenetic Tree</option>\n                                                <option value=\"Alignment View\">Alignment View</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                </div>\n                            </tab>\n                            <tab heading=\"{{'Experimental' | localize}}\" customClass=\"m-tabs__item\">\n                                <div id=\"experimental-settings\" class=\"tab-pane fade active show\" role=\"tabpanel\">\n                                    <div class=\"form-group row\">\n                                        <div class=\"col-12\">\n                                            <div class=\"alert alert-warning alert-dismissible\" role=\"alert\">\n                                                <p>The following settings are experimental! Use at your own risk!</p>\n                                                <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n                                                    <span aria-hidden=\"true\">&times;</span>\n                                                </button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\" title=\"Would you like to generate a network based on random data?\">\n                                        <div class=\"col-4\">\n                                            <label style=\"padding-left: 10px;\" class=\"mr-2\">{{\"Generate\" | localize}}</label>\n                                        </div>\n                                        <div class=\"col\">\n                                            <input id=\"generate-number\" type=\"number\" class=\"form-control form-control-sm\" min=\"1\" max=\"2000\" step=\"1\" value=\"100\" [(ngModel)]=\"SelectedGenerateNumberVariable\">\n                                        </div>\n                                        <div class=\"col\">\n                                            <button id=\"generate-sequences\" class=\"btn btn-light btn-sm col\"  (click)=\"generateSequences()\">Sequences</button>\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\" title=\"Would you like to attempt to infer the direction of your links?\">\n                                        <div class=\"col-4\">\n                                            <label style=\"padding-left: 10px;\" class=\"mr-2\">{{\"Directionality\" | localize}}</label>\n                                        </div>\n                                        <div class=\"col-8\">\n                                            <p-selectButton [options]=\"DirectionalityTypes\" [(ngModel)]=\"SelectedDirectionalityTypeVariable\"></p-selectButton>                                           \n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\" title=\"Would you like to attempt to triangulate missing values in your distance matrices?\">\n                                        <div class=\"col-4\">\n                                            <label style=\"padding-left: 10px;\" class=\"mr-2\">{{\"Triangulation\" | localize}}</label>\n                                        </div>\n                                        <div class=\"col-8\">\n                                            <p-selectButton [options]=\"TriangulationTypes\" [(ngModel)]=\"SelectedTriangulationTypeVariable\"></p-selectButton>                                            \n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\"\n                                         title=\"Should MicrobeTrace automatically stash your session so if your computer crashes you can recover your session?\n                                Please note that this causes MicrobeTrace to store data on your computer's hard drive, which may have implications for PII.\">\n                                        <div class=\"col-4\">\n                                            <label style=\"padding-left: 10px;\" class=\"mr-2\">{{\"Autostashing\" | localize}}</label>\n                                        </div>\n                                        <div class=\"col-8\">\n                                            <p-selectButton [options]=\"AutostashingTypes\" [(ngModel)]=\"SelectedAutostashingTypeVariable\"></p-selectButton>                                          \n                                        </div>\n                                    </div>\n                                </div>\n                            </tab>\n                        </tabset>\n                    </div>\n                </div>\n            </div>\n        </p-dialog>\n\n\n\n\n        <p-dialog id=\"sequence-controls-modal\" [(visible)]=\"displaySequenceSettings\" header=\"Sequence Settings\">\n            <div class=\"modal-dialog modal-lg\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-body\">\n                        <tabset class=\"tab-container tabbable-line\" style='width: 100%;'>\n                            <tab heading=\"{{'Alignment' | localize}}\" [active]=\"true\" customClass=\"m-tabs__item\">\n                                <div id=\"sequence-alignment\" class=\"tab-pane fade show active\" role=\"tabpanel\">\n                                    <div class=\"form-group row\">\n                                        <div class=\"col-12\">\n                                            <div class=\"alert alert-warning alert-dismissible\" role=\"alert\">\n                                                <p>\n                                                    <span>{{\"MicrobeTrace \" | localize}}</span>\n                                                    is not intended to be an alignment program (although it can be used in that way).\n                                                    For best results, please align your sequences using\n                                                    <a href=\"https://en.wikipedia.org/wiki/List_of_sequence_alignment_software\" target=\"_blank\" rel=\"noreferrer noopener\">an external tool</a>\n                                                    before loading them into MicrobeTrace.\n                                                    <a href=\"https://github.com/CDCgov/MicrobeTrace/wiki/Alignment\" class=\"ifOnline\" target=\"_blank\" rel=\"noreferrer noopener\">Click here for additional information.</a>\n                                                </p>\n                                                <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n                                                    <span aria-hidden=\"true\">&times;</span>\n                                                </button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\">\n                                        <div class=\"col-2\" title=\"Should MicrobeTrace align your sequences?\">Align</div>\n                                        <div class=\"col-10\">\n                                            <p-selectButton [options]=\"AlignTypes\" [(ngModel)]=\"SelectedAlignTypeVariable\" (onChange)=\"IsReferenceSourceSelected=(SelectedAlignTypeVariable=='None' ? false : true)\"></p-selectButton>\n                                        </div>\n                                    </div>\n\n                                    <p-accordion *ngIf=\"IsReferenceSourceSelected == true\">\n                                        <p-accordionTab style=\"color:#495057\" header=\"Reference Source Options\" [(selected)]=\"IsReferenceSourceSelected\">\n\n                                            <div class=\"form-group row alignConfigRow\">\n                                                <div class=\"col-2\" title=\"What should MicrobeTrace use as a reference to align your sequences?\">Reference Source</div>\n                                                <div class=\"col-10\">\n                                                    <p-selectButton [options]=\"ReferenceTypes\" [(ngModel)]=\"SelectedReferenceTypeVariable\" (onChange)=\"IsReferenceOptionsSelected=(SelectedReferenceTypeVariable=='LoadFrom FASTA' ? true : false)\"></p-selectButton>\n                                                </div>\n                                            </div>\n\n                                            <p-accordionTab style=\"color:#495057\" header=\"Reference Options\" *ngIf=\"IsReferenceOptionsSelected == true\" [(selected)]=\"IsReferenceOptionsSelected\">\n                                                <div class=\"form-group row\" id=\"reference-file-row\">\n                                                    <div class=\"col-2\" title=\"Against what sequence should MicrobeTrace align your sequences?\">Reference</div>\n                                                    <div class=\"col-5\">\n                                                        <div class=\"custom-file\">\n                                                            <input type=\"file\" class=\"custom-file-input\" id=\"refSeqFileLoad\" [(ngModel)]=\"SelectedRefSeqFileLoadVariable\">\n                                                            <label class=\"custom-file-label\" for=\"refSeqFileLoad\" style=\"overflow:hidden\">HXB2</label>\n                                                        </div>\n                                                    </div>\n                                                    <div class=\"col-5\">\n                                                        <p-dropdown id=\"refSeqID\" [options]=\"RefSeqIDTypes\" [(ngModel)]=\"SelectedRefSeqIDVariable\"></p-dropdown>\n\n                                                       \n                                                    </div>\n                                                </div>\n                                            </p-accordionTab>\n\n                                                    <div class=\"row alignConfigRow\">\n                                                        <div class=\"form-group col offset-2\" title=\"How much should MicrobeTrace reward matching bases?\">\n                                                            <label for=\"alignerMatch\">Match Reward</label>\n                                                            <input type=\"number\" id=\"alignerMatch\" class=\"form-control\" value=\"1\" min=\"0\" [(ngModel)]=\"SelectedAlignerMatchVariable\">\n                                                        </div>\n                                                        <div class=\"form-group col\" title=\"How much should MicrobeTrace penalize non-matching bases?\">\n                                                            <label for=\"alignerMismatch\">Mismatch Cost</label>\n                                                            <input type=\"number\" id=\"alignerMismatch\" class=\"form-control\" value=\"1\" min=\"0\" [(ngModel)]=\"SelectedAlignerMismatchVariable\">\n                                                        </div>\n                                                    </div>\n                                                    <div class=\"row alignConfigRow\">\n                                                        <div class=\"form-group col offset-2\" title=\"How much should MicrobeTrace Penalize opening a gap?\">\n                                                            <label for=\"alignerGapO\">Gap Opening Cost</label>\n                                                            <input type=\"number\" id=\"alignerGapO\" class=\"form-control\" value=\"5\" min=\"0\" [(ngModel)]=\"SelectedAlignerGapOVariable\">\n                                                        </div>\n                                                        <div class=\"form-group col\" title=\"How much should MicrobeTrace Penalize extending a gap?\">\n                                                            <label for=\"alignerGapE\">Gap Extension Cost</label>\n                                                            <input type=\"number\" id=\"alignerGapE\" class=\"form-control\" value=\"2\" min=\"0\" [(ngModel)]=\"SelectedAlignerGapEVariable\">\n                                                        </div>\n                                                    </div>\n                                        </p-accordionTab>\n                                    </p-accordion>\n\n\n\n                                    <div class=\"row alignPreviewRow\">\n                                        <div class=\"w-100 text-center\" id=\"alignment-preview\"></div>\n                                    </div>\n                                </div>\n                            </tab>\n                            <tab heading=\"{{'Audit' | localize}}\" [active]=\"true\" customClass=\"m-tabs__item\">\n                                <div id=\"sequence-auditor\" class=\"tab-pane fade show\" role=\"tabpanel\">\n                                    <div class=\"row mb-3\" style=\"padding-left:15px;\">\n                                        <div class=\"form-check col\" title=\"Checks to see if a Sequence is empty.\">\n                                            <input class=\"form-check-input\" style=\"padding-left:5px;\" type=\"checkbox\" id=\"audit-empty\" checked [(ngModel)]=\"SelectedAuditEmptyVariable\">\n                                            <label class=\"form-check-label\" style=\"padding-left:5px;\" for=\"audit-empty\">\n                                                Empty\n                                            </label>\n                                        </div>\n                                        <div class=\"form-check col\" title=\"Checks to see if a Sequence is all gaps.\">\n                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"audit-gaps\" checked [(ngModel)]=\"SelectedAuditGapsVariable\">\n                                            <label class=\"form-check-label\" style=\"padding-left:5px;\" for=\"audit-gaps\">\n                                                Gaps\n                                            </label>\n                                        </div>\n                                        <div class=\"form-check col\" title=\"Check to see if sequence contains any characters that are RNA instead of DNA.\">\n                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"audit-RNA\" checked [(ngModel)]=\"SelectedAuditRNAVariable\">\n                                            <label class=\"form-check-label\" style=\"padding-left:5px;\" for=\"audit-RNA\">\n                                                RNA\n                                            </label>\n                                        </div>\n                                        <div class=\"form-check col\" title=\"Check to see if Sequence contains any characters that represent Amino Acids.\">\n                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"audit-amino-acids\" checked [(ngModel)]=\"SelectedAuditAminoAcidsVariable\">\n                                            <label class=\"form-check-label\" style=\"padding-left:5px;\" for=\"audit-amino-acids\">\n                                                Amino Acids\n                                            </label>\n                                        </div>\n                                        <div class=\"form-check col\" title=\"Check to see if Sequence contains any characters describing an alignment.\">\n                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"audit-CIGAR\" checked [(ngModel)]=\"SelectedAuditCIGARVariable\">\n                                            <label class=\"form-check-label\" style=\"padding-left:5px;\" for=\"audit-CIGAR\">\n                                                CIGAR\n                                            </label>\n                                        </div>\n                                        <div class=\"form-check col\" title=\"Check to see if Sequence contains any characters that are illegal in any genomic or proteomic alphabet.\">\n                                            <input class=\"form-check-input\" type=\"checkbox\" id=\"audit-malformed\" checked [(ngModel)]=\"SelectedAuditMalformedVariable\">\n                                            <label class=\"form-check-label\" style=\"padding-left:5px;\" for=\"audit-malformed\">\n                                                Malformed\n                                            </label>\n                                        </div>\n                                        <div class=\"col\">\n                                            <button type=\"button\" class=\"btn btn-primary btn-sm w-100\" id=\"audit-launcher\" (click)=\"run()\">Run</button>\n                                        </div>\n                                    </div>\n                                    <div class=\"row\" id=\"audited-sequences\"></div>\n                                    <div class=\"row flex-row-reverse\" style=\"padding-right: 21px\">\n                                        <button class=\"btn btn-danger btn-sm\" id=\"audit-toggle-all\" (click)=\"toglleAll()\">Toggle All</button>\n                                    </div>\n                                </div>\n                            </tab>\n                        </tabset>\n                    </div>\n                    <div class=\"modal-footer clearfix\">\n                        <button (click)=\"updatePreview()\" class=\"btn btn-success\">View Preview</button>\n                        <button type=\"submit\" class=\"btn btn-success pull-right\" data-dismiss=\"modal\"\n                                title=\"Confirm Load Settings are All Properly Set\" (click)=\"displaySequenceSettings = !displaySequenceSettings\">\n                            Confirm\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </p-dialog>\n\n    </div><!-- Files Settings & Sequence Settings/.modal -->\n\n\n    <div id=\"file-footer\">\n        <!-- <p-accordion (onOpen)=\"accordianToggle(1)\" (onClose)=\"accordianToggle(0)\" >\n            <p-accordionTab *ngIf=\"uniqueNodes.length > 0\" header=\"{{uniqueNodes.length}} node(s) missing in edge list\">\n                <table>\n                    <tr>\n                        <th>Node</th>\n                    </tr>\n                    <tr *ngFor=\"let node of uniqueNodes\">\n                        <td>\n                            {{node}}\n                        </td>\n                    </tr>\n                </table>\n            </p-accordionTab>\n            <p-accordionTab *ngIf=\"uniqueEdgeNodes.length > 0\" header=\"{{uniqueEdgeNodes.length}} edge node(s) missing in node list\">\n                <table>\n                    <tr>\n                        <th>Node</th>\n                    </tr>\n                    <tr *ngFor=\"let node of uniqueEdgeNodes\">\n                        <td>\n                            {{node}}\n                        </td>\n                    </tr>\n                </table>\n            </p-accordionTab>\n\n        </p-accordion> -->\n\n        <br/>\n\n        <div class=\"m-portlet\" style=\"padding: 1px\">\n            <div class=\"d-flex justify-content-center\">\n                <span>\n                    <input type=\"file\" id=\"data-files1\" class=\"d-none\" multiple=\"true\" onclick=\"this.value=null;\" (change)=\"processFiles($event.target.files)\">\n                    <label for=\"data-files1\" class=\"btn btn-primary btn-nr floater mb-0\">Add File(s)</label>\n                </span>\n                <span>\n                    <button type=\"button\" class=\"btn btn-default btn-nr floater\" (click)=\"showSequenceSettings()\">Sequence Controls</button>\n                </span>\n                <span>\n                    <button id=\"launch\" class=\"btn btn-success\" (click)=\"launchClick()\" title=\"Please select a Network CSV or FASTA File\" disabled>Launch</button>\n                </span>\n            </div>\n        </div>\n    </div>\n\n\n</div>\n";

/***/ }),

/***/ 99768:
/*!*********************************************************************!*\
  !*** ./src/app/microbe-trace-next-plugin.component.html?ngResource ***!
  \*********************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"m-content\">   \n    <div class=\"m-portlet m-portlet--mobile\" style=\"height:100%;\">\n\n        <div *ngIf=\"!officialInstance()\" id=\"url-warning-div\">This is not an official MicrobeTrace instance, please visit our production instance at <a href=\"https://microbetrace.cdc.gov/MicrobeTrace\">https://microbetrace.cdc.gov/MicrobeTrace</a> or our development instance at <a href=\"https://cdcgov.github.io/MicrobeTrace\">https://cdcgov.github.io/MicrobeTrace</a></div>\n        <mat-toolbar id=\"top-toolbar\" class=\"nav-bar\">\n                <div class=\"navbar-logo\">\n                    <span class=\"microbe-font\">Microbe</span>\n                    <span class=\"trace-font\">Trace</span>\n                    <span><img alt=\"microbetrace\" class=\"mt-icon-toolbar\" [src]=\"appRootUrl() + 'assets/images/Logo.png'\"></span>\n                  </div>\n                  <div class=\"menu-items\">\n                    <button class=\"navbar-item\" mat-button [matMenuTriggerFor]=\"fileMenu\"><i class=\"far nav-icon flaticon-file-1\"></i>File<span class=\"dropdown-symbol\">&#9660;</span></button>\n                    <mat-menu #fileMenu=\"matMenu\" overlapTrigger=\"false\">\n                      <!-- <button mat-menu-item (click)=\"FileClick('Stash Session')\">Stash</button> -->\n                      <!-- <button mat-menu-item (click)=\"FileClick('Recall Session')\">Recall</button> -->\n                      <button mat-menu-item (click)=\"FileClick('Save Session')\">Save</button>\n                      <button mat-menu-item (click)=\"OpenExportDashboard()\">Export Dashboard</button>\n                      <button mat-menu-item (click)=\"OpenExportTables()\">Export Tables</button>\n                      <!-- <button mat-menu-item (click)=\"FileClick('Open Session')\">Open</button> -->\n                      <button mat-menu-item (click)=\"FileClick('Open URL')\">Open URL</button>\n                      <button mat-menu-item (click)=\"FileClick('Add Data')\">Add Data</button>\n                      <!-- <button mat-menu-item (click)=\"FileClick('New Session')\">New</button> -->\n                    </mat-menu>\n                    <button class=\"navbar-item\" (click)=\"DisplayGlobalSettingsDialog()\" mat-button><i class=\"far nav-icon flaticon-cogwheel-2\"></i>Settings</button>\n                    <button class=\"navbar-item\" mat-button [matMenuTriggerFor]=\"viewMenu\"><i class=\"far nav-icon flaticon-web\"></i>View<span class=\"dropdown-symbol\">&#9660;</span></button>\n                    <mat-menu #viewMenu=\"matMenu\" overlapTrigger=\"false\">\n                      <button mat-menu-item (click)=\"Viewclick('2D Network')\">2D Network</button>\n                      <button mat-menu-item (click)=\"Viewclick('Table')\">Table</button>\n                      <button mat-menu-item (click)=\"Viewclick('Map')\">Map</button>\n                      <button mat-menu-item (click)=\"Viewclick('Epi Curve')\">Epi Curve</button>\n                      <button mat-menu-item (click)=\"Viewclick('Phylogenetic Tree')\">Phylogenetic Tree</button>\n                      <button mat-menu-item (click)=\"Viewclick('Alignment View')\">Alignment View</button>\n                      <button mat-menu-item (click)=\"Viewclick('Crosstab')\">CrossTab</button>\n                      <button mat-menu-item (click)=\"Viewclick('Aggregate')\">Aggregate</button>\n                      <button mat-menu-item (click)=\"Viewclick('Gantt Chart')\">Gantt Chart</button>\n                      <button mat-menu-item (click)=\"Viewclick('Heatmap')\">Heatmap</button>\n                      <button mat-menu-item (click)=\"Viewclick('Bubble')\">Bubble</button>\n                      <button mat-menu-item (click)=\"Viewclick('Waterfall')\">Waterfall</button>\n                    </mat-menu>\n                    <button class=\"navbar-item\" mat-button [matMenuTriggerFor]=\"windowMenu\"><i class=\"far nav-icon flaticon-web\"></i>Window<span class=\"dropdown-symbol\">&#9660;</span></button>\n                    <mat-menu #windowMenu=\"matMenu\" overlapTrigger=\"false\">\n                      <button mat-menu-item (click)=\"WindowClick('Reload Screen')\">Reload</button>\n                      <button mat-menu-item (click)=\"WindowClick('Fullscreen')\">Fullscreen</button>\n                    </mat-menu>\n                    <button class=\"navbar-item\" mat-button [matMenuTriggerFor]=\"helpMenu\"><i class=\"far nav-icon flaticon-questions-circular-button\"></i>Help<span class=\"dropdown-symbol\">&#9660;</span></button>\n                    <mat-menu #helpMenu=\"matMenu\" overlapTrigger=\"false\">\n                      <a href=\"https://github.com/CDCgov/MicrobeTrace/wiki\" class=\"dropdown-item ifOnline\" target=\"_blank\" rel=\"noreferrer noopener\" mat-menu-item>Help</a>\n                      <a href=\"https://github.com/CDCgov/MicrobeTrace/issues/new\" class=\"dropdown-item ifOnline\" target=\"_blank\" rel=\"noreferrer noopener\" mat-menu-item>Report Bug</a>\n                      <button (click)=\"HelpClick('About')\" mat-menu-item>About</button>\n                    </mat-menu>\n                    <!-- <button class=\"navbar-item\" mat-button [matMenuTriggerFor]=\"langMenu\"><i class=\"far nav-icon flaticon-earth-globe\"></i>Language<span class=\"dropdown-symbol\">&#9660;</span></button>\n                    <mat-menu #langMenu=\"matMenu\" overlapTrigger=\"false\">\n                      <button mat-menu-item >English</button>\n                      <button mat-menu-item >Spanish</button>\n                    </mat-menu> -->\n                  </div>\n            <div id=\"search-form\" class=\"form-inline navbar-form\">\n                <label for=\"search\">Search</label>\n                <div class=\"autocomplete-wrapper\">\n                    <input type=\"search\" id=\"search\" class=\"form-control form-control-sm\" (input)=\"onSearch()\" [(ngModel)]=\"searchText\" placeholder=\"Nodes\">\n                    <ul id=\"search-results\"></ul>\n                </div>\n            <button id=\"casesensitivebutton\" (click)=\"onCaseSensitiveChange()\" type=\"button\" class=\"btn btn-light btn-sm\" data-toggle=\"button\" aria-pressed=\"false\" autocomplete=\"off\" title=\"Match Case\">\n                <span>C</span>\n            </button>     \n            <button id=\"wholewordbutton\" type=\"button\" (click)=\"onWholeWordChange()\" class=\"btn btn-light btn-sm\" data-toggle=\"button\" aria-pressed=\"false\" autocomplete=\"off\" title=\"Match Whole Word\">\n                <span>W</span>\n            </button>      \n        \n            <select [(ngModel)]=\"searchField\" (ngModelChange)=\"onSearchFieldChange($event)\" id=\"search-field\"  class=\"form-control form-control-sm nodeValues\">\n                <option val=\"id\">ID</option>\n            </select>\n            </div> \n          </mat-toolbar>\n\n        <div #visualwrapper id=\"visualwrapper\" class=\"kt-container  kt-grid__item kt-grid__item--fluid \" style=\"margin: 6px 6px 0 6px;\" [style.height.px]=\"getHeight()\">\n            <div class=\"kt-portlet kt-portlet--mobile\" style=\"height:100%\">\n                <div class=\"kt-portlet__head kt-portlet__head--lg\" style=\"height:100%\">\n                    <div class=\"m-portlet__body\" style=\"flex: 1 100%; max-width:100%; height:100%\">\n                        <!-- TODO: Add back or replace-->\n                        <!-- <golden-layout-root #goldenLayout></golden-layout-root> -->\n                        <app-golden-layout-host #goldenLayoutHost></app-golden-layout-host>             \n                    </div>\n                </div>\n            </div>\n\n        <p-dialog class=\"table-z-index\" id=\"global-settings-link-color-table\" \n            position=\"right\" \n            [(visible)]=\"GlobalSettingsLinkColorDialogSettings.isVisible\"  \n            [style]=\"{'z-index': '1'}\"\n            (onShow)=\"showLinkColorTable()\"\n            (onHide)=\"hideLinkColorTable()\"\n            >\n            <ng-template pTemplate=\"header\">\n                <div style=\"display: flex; justify-content: space-between; width: 100%;\">\n                    <span>Link Color Table</span>\n                    <span style=\"overflow: visible; position: relative;\">\n                        <button title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"toggleColorTableSettings('link-color')\"><i class=\"pi pi-cog\"></i></button>\n                        <div id=\"linkColorTableSettings\" class=\"dropdown-menu\" style=\"display: none;\">\n                            <button id=\"linkColorCounts\" class=\"dropdown-item\" (click)=\"toggleColorTableColumns('link-color', 'tableCounts')\">\n                                <span>Show Counts</span>\n                                <i [className]=\"this.widgets['link-color-table-counts'] ? 'pi pi-check' : 'pi pi-times'\" style=\"line-height: 1.5\"></i>\n                            </button>\n                            <button id=\"linkColorFrequencies\" class=\"dropdown-item\" (click)=\"toggleColorTableColumns('link-color', 'tableFreq')\">\n                                <span>Show Frequencies</span>\n                                <i [className]=\"this.widgets['link-color-table-frequencies'] ? 'pi pi-check' : 'pi pi-times'\" style=\"line-height: 1.5\"></i>\n                            </button>\n                        </div>\n                    </span>\n                </div>\n            </ng-template>\n            <div style=\"max-height: 50vh\">\n                <table #linkColorTable id=\"link-color-table\" style=\"width:100%;height:100%;\"></table>\n            </div>\n        </p-dialog>\n\n\n        <p-dialog id=\"global-settings-node-color-table\" \n            position=\"left\" \n            [(visible)]=\"GlobalSettingsNodeColorDialogSettings.isVisible\"  \n            (onShow)=\"showNodeColorTable()\"\n            (onHide)=\"hideNodeColorTable()\"      \n                    >       \n            <ng-template pTemplate=\"header\">\n                <div style=\"display: flex; justify-content: space-between; width: 100%;\">\n                    <span>Node Color Table</span>\n                    <span style=\"overflow: visible; position: relative;\">\n                        <button title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"toggleColorTableSettings('node-color')\"><i class=\"pi pi-cog\"></i></button>\n                        <div id=\"nodeColorTableSettings\" class=\"dropdown-menu\" style=\"display: none;\">\n                            <button id=\"nodeColorCounts\" class=\"dropdown-item\" (click)=\"toggleColorTableColumns('node-color', 'tableCounts')\">\n                                <span>Show Counts</span>\n                                <i [className]=\"this.widgets['node-color-table-counts'] ? 'pi pi-check' : 'pi pi-times'\" style=\"line-height: 1.5\"></i>\n                            </button>\n                            <button id=\"nodeColorFrequencies\" class=\"dropdown-item\" (click)=\"toggleColorTableColumns('node-color', 'tableFreq')\">\n                                <span>Show Frequencies</span>\n                                <i [className]=\"this.widgets['node-color-table-frequencies'] ? 'pi pi-check' : 'pi pi-times'\" style=\"line-height: 1.5\"></i>\n                            </button>\n                        </div>\n                    </span>\n                </div>\n            </ng-template>\n            <div style=\"max-height: 50vh\">\n                <table #nodeColorTable id=\"node-color-table\" style=\"width:100%;height:100%;\"></table>\n            </div>\n        </p-dialog>\n        </div>\n    \n        <div id=\"overlay\" appDnd (fileDropped)=\"prepareFilesLists($event)\">\n            <input class=\"dnd-input\" type=\"file\" #fileDropRef id=\"fileDropRef\" multiple (change)=\"prepareFilesLists($event.target.files)\" />\n            <div class=\"welcome-msg\">\n                <div id=\"welcome-title\" class=\"top\">\n                    <span class=\"primary\">Welcome to </span>\n                    <span class=\"microbe primary\">Microbe</span>\n                    <span class=\"primary\">Trace&#8482;</span>\n                    <!-- <span><img class=\"mt-icon\" src=\"../../assets/images/Logo.png\"></span> -->\n                    <!-- Swap/Uncomment when building productions -->\n                    <span><img alt=\"microbetrace\" class=\"mt-icon\" [src]=\"appRootUrl() + 'assets/images/Logo.png'\"></span>\n                </div>\n                <div id=\"welcome-description\" class=\"bottom primary\">The Visualization Multitool for Molecular Epidemiology and Bioinformatics</div>\n            </div>\n            <div id=\"add-data-container\" class=\"add-data-container\">\n                <div class=\"files-msg\">\n                    <span class=\"primary\">Click </span>\n                    <a class=\"here-link primary\" for=\"fileDropRef\">here</a>\n                    <span class=\"primary\"> or Drag & Drop files to load data</span>\n                </div>\n                <div class=\"add-btns primary\">\n                    <!-- TODO: add back in when recall is ready-->\n                    <!-- <button mat-raised-button color=\"primary\" class=\"recall\" (click)=\"recallClicked()\">Recall Previous Session</button> -->\n                    <button mat-raised-button color=\"primary\" (click)=\"continueClicked()\">Continue with Sample Dataset</button>\n                </div>\n            </div>\n            <!-- <div id=\"onload-container\" class=\"launch-options-container primary\">\n                <span class=\"onload-bold\">Onload Settings:</span>\n                <span>Distance Metric: <span class=\"option-value\" [matMenuTriggerFor]=\"metricMenu\">{{metric}} <span class=\"onload-dropdown-symbol\">&#9660;</span></span></span>\n                <span id=\"ambiguities-menu\">Ambiguities: <span class=\"option-value\" [matMenuTriggerFor]=\"ambiMenu\">{{ambiguity}} <span class=\"onload-dropdown-symbol\">&#9660;</span></span></span>\n                <span>View to Launch: <span class=\"option-value\" [matMenuTriggerFor]=\"viewMenuBottom\">{{launchView}} <span class=\"onload-dropdown-symbol\">&#9660;</span></span></span>\n                <span class=\"threshold-option\">Link Threshold: \n                    <form class=\"threshold-input\">\n                    <mat-form-field class=\"threshold-input-length\">\n                        <mat-label></mat-label>\n                      <input matInput (input)=\"updateThreshold($event)\" [value]=\"threshold\">\n                    </mat-form-field>\n                  </form>\n                </span>\n            </div>\n            <mat-menu #metricMenu=\"matMenu\"overlapTrigger=\"false\">\n                <button mat-menu-item (click)=\"updateMetric('TN93')\">TN93</button>\n                <button mat-menu-item (click)=\"updateMetric('SNPs')\">SNPs</button>\n            </mat-menu>\n            <mat-menu #ambiMenu=\"matMenu\" overlapTrigger=\"false\">\n                <button mat-menu-item (click)=\"updateAmbiguity('Average')\">Average</button>\n                <button mat-menu-item (click)=\"updateAmbiguity('Resolve')\">Resolve</button>\n                <button mat-menu-item (click)=\"updateAmbiguity('Skip')\">Skip</button>\n                <button mat-menu-item (click)=\"updateAmbiguity('GapMM')\">GapMM</button>\n                <button mat-menu-item (click)=\"updateAmbiguity('HIV-Trace -g')\">HIV-Trace -g</button>\n            </mat-menu>\n            <mat-menu #viewMenuBottom=\"matMenu\" overlapTrigger=\"false\">\n                <button mat-menu-item (click)=\"updateLaunchView('2D Network')\">2D Network</button>\n                <button mat-menu-item (click)=\"updateLaunchView('Table')\">Table</button>\n                <button mat-menu-item (click)=\"updateLaunchView('Map')\">Bubbles</button>\n                <button mat-menu-item (click)=\"updateLaunchView('Phylogenetic Tree')\">Phylogenetic Tree</button>\n            </mat-menu> -->\n        </div>\n\n        <p-dialog id=\"global-settings-modal\" \n                    [(visible)]=\"GlobalSettingsDialogSettings.isVisible\"  \n                    header=\"Global Settings\" >\n            <div class=\"modal-dialog\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-body\">\n                        <tabset #globalSettingsTab class=\"tab-container tabbable-line\" style='width: 100%; height: 100%;'>\n                            <tab heading=\"{{'Filtering' | localize}}\" customClass=\"m-tabs__item\" style='width: 400px; height: 100%;'>\n\n                                <div id=\"filtering-config\" role=\"tabpanel\" aria-labelledby=\"filtering-tab\">\n                                    <div class=\"form-group row\" title=\"By what metric would you like to measure distance?\">\n                                        <div class=\"col-4\">Distance Metric</div>\n                                        <div class=\"col-8\">\n                                            <select id=\"default-distance-metric\" class=\"form-control form-control-sm mr-5\" [(ngModel)]=\"SelectedDistanceMetricVariable\" (ngModelChange)=\"onDistanceMetricChanged()\">\n                                                <option value=\"tn93\">TN93</option>\n                                                <option value=\"snps\">SNPs</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\" title=\"By what algorithm would you like to prune links from the network?\">\n                                        <div class=\"col-4\">Prune With</div>\n                                        <div class=\"col-8\">\n                                            <p-selectButton [options]=\"PruneWityTypes\" [(ngModel)]=\"SelectedPruneWityTypesVariable\" (ngModelChange)=\"onPruneWithTypesChanged(SelectedPruneWityTypesVariable)\"></p-selectButton>\n                                        </div>\n                                    </div>\n                                    <div id=\"filtering-epsilon-row\" class=\"form-group row\" style=\"display: none;\" title=\"Select a value for epislon to add links back to minimum spanning network. See 'A Novel Network Representation of SARS-CoV-2 Sequencing Data' for algorithm details.\">\n                                        <div class=\"col-4\">\n                                            <label for=\"filtering-epsilon\">Epsilon: {{ SelectedEpsilonValue }}</label>\n                                        </div>\n                                        <div class=\"col-8\">\n                                            <input type=\"range\" class=\"form-control form-control-sm\" min=\"-8\" max=\"2\" step=\".01\" [(ngModel)]=\"widgets['filtering-epsilon']\" (ngModelChange)=\"onEpsilonValueChange()\">\n                                        </div>\n                                    </div>                                    \n                                    <div class=\"form-group row\" title=\"What's the minimum number of nodes a cluster must have in order to be visible?\">\n                                        <div class=\"col-4\">\n                                            <label for=\"cluster-minimum-size\">Minimum Cluster Size</label>\n                                        </div>\n                                        <div class=\"col-8\">\n                                            <input type=\"number\" class=\"form-control form-control-sm\" min=\"1\" value=\"1\" step=\"1\" [(ngModel)]=\"SelectedClusterMinimumSizeVariable\" (ngModelChange)=\"onMinimumClusterSizeChanged()\">\n                                        </div>\n                                    </div>\n                                    <div id=\"filtering-wrapper\">\n                                        <div class=\"form-group row\" title=\"By what variable would you like to prune links from the network?\">\n                                            <div class=\"col-4\"><label for=\"link-sort-variable\">Filter Links on</label></div>\n                                            <div class=\"col-8\">\n                                                <p-dropdown id=\"link-sort-variable\" [options]=\"ToolTipFieldList\" appendTo=\"body\" [(ngModel)]=\"SelectedLinkSortVariable\" (onChange)=\"onLinkSortChanged()\"></p-dropdown>\n                                            </div>\n                                        </div>\n                                        <div class=\"form-group row\" id=\"filtering-threshold\" title=\"What's the maximum genetic distance you're willing to call a link?\">\n                                            <div class=\"col-4\"><label for=\"link-threshold\">Filtering Threshold</label></div>\n                                            <div><svg id=\"link-threshold-sparkline\" #linkThresholdSparkline style=\"width: 280px; height: 48px;\"></svg></div>\n                                            <div class=\"col-8  offset-4\">\n                                                <input type=\"number\" class=\"form-control form-control-sm\" id=\"link-threshold\" min=\"-1\" value=\"1\" [step]=\"getCurrentThresholdStepSize()\" [(ngModel)]=\"SelectedLinkThresholdVariable\" (ngModelChange)=\"updateThreshold($event)\">\n                                            </div>\n                                        </div>\n                                        <div class=\"form-group row\" title=\"Click to reveal all hidden elements of the network.\">\n                                            <div class=\"col-4\"><label for=\"reveal-all\">Reveal</label></div>\n                                            <div class=\"col-8\">\n                                              <button type=\"button\" id=\"reveal-all\" (click)=\"revealClicked()\" class=\"btn btn-light btn-sm w-100\">Everything</button>\n                                            </div>\n                                          </div>\n                                    </div>\n                                    <div class=\"form-group row\" hidden title=\"Click to reveal all hidden elements of the network.\">\n                                        <div class=\"col-4\"><label for=\"RevealAllTab\">Reveal</label></div>\n                                        <div class=\"col-8\">\n                                            <p-selectButton [options]=\"RevealTypes\" [(ngModel)]=\"SelectedRevealTypesVariable\" (onChange)=\"updateGlobalSettingsModel()\"></p-selectButton>\n                                        </div>\n                                    </div>\n                                    <hr>\n                                    <div class=\"form-group row\" title=\"Display a table of overview statistics for the network\">\n                                        <div class=\"col-4\">Statistics</div>\n                                        <div class=\"col-8\">\n                                            <p-selectButton [options]=\"StatisticsTypes\" [(ngModel)]=\"SelectedStatisticsTypesVariable\" (onChange)=\"onShowStatisticsChanged()\"></p-selectButton>\n                                        </div>\n                                    </div>\n                                </div>\n                            </tab>\n                            <tab heading=\"{{'Styling' | localize}}\" customClass=\"m-tabs__item\" style='width: 400px; height: 100%;'>\n\n                                <div id=\"style-config\" role=\"tabpanel\" aria-labelledby=\"style-tab\">\n                                    <div class=\"form-group row\" title=\"By what variable nodes be colored?\">\n                                        <div class=\"col-4\"><label for=\"node-color-variable\">Color Nodes By</label></div>\n                                        <div class=\"col-8\">\n                                            <p-dropdown id=\"node-color-variable\" [options]=\"FieldList\" appendTo=\"body\" [(ngModel)]=\"SelectedColorNodesByVariable\" (onChange)=\"onColorNodesByChanged()\"></p-dropdown>\n                                        </div>\n                                    </div>\n                                    <div id=\"node-color-table-row\" [hidden]=\"!ShowGlobalSettingsNodeColorTable\" class=\"form-group row\" title=\"Should MicrobeTrace display the table of colors?\">\n                                        <div class=\"col-4\"><label>Nodes Color Table</label></div>\n                                        <div class=\"col-8\">\n                                            <p-selectButton [options]=\"NodeColorTableTypes\" [(ngModel)]=\"SelectedNodeColorTableTypesVariable\" (onChange)=\"onNodeColorTableChanged()\"></p-selectButton>\n                                        </div>\n                                    </div>\n\n\n                                    <div *ngIf=\"SelectedColorNodesByVariable === 'None'\" id=\"node-color-value-row\" class=\"form-group row\" title=\"What color should the nodes be?\">\n                                        <div class=\"col-4\"><label for=\"node-color\">Nodes</label></div>\n                                        <div class=\"col-8\">\n                                            <input type=\"color\" id=\"node-color\" class=\"form-control form-control-sm\" value=\"#1f77b4\" [(ngModel)]=\"SelectedNodeColorVariable\" (ngModelChange)=\"onNodeColorChanged()\">\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\" title=\"By what variable should links be colored?\">\n                                        <div class=\"col-4\"><label for=\"link-color-variable\">Color Links By</label></div>\n                                        <div class=\"col-8\">\n                                            <p-dropdown id=\"link-tooltip-variable\" [options]=\"ToolTipFieldList\" appendTo=\"body\" [(ngModel)]=\"SelectedColorLinksByVariable\" (onChange)=\"onColorLinksByChanged()\"></p-dropdown>\n                                        </div>\n                                    </div>\n                                    <div id=\"link-color-table-row\" [hidden]=\"!ShowGlobalSettingsLinkColorTable\"  class=\"form-group row\" title=\"Should MicrobeTrace display the table of colors?\">\n                                        <div class=\"col-4\"><label>Link Color Table</label></div>\n                                        <div class=\"col-8\">\n                                            <p-selectButton [options]=\"LinkColorTableTypes\" [(ngModel)]=\"SelectedLinkColorTableTypesVariable\" (onChange)=\"onLinkColorTableChanged()\"></p-selectButton>\n                                        </div>\n                                    </div>\n\n                                    <div *ngIf=\"SelectedColorLinksByVariable === 'None'\" id=\"link-color-value-row\" class=\"form-group row\" title=\"What color should the links be?\">\n                                        <div class=\"col-4\"><label for=\"link-color\">Links</label></div>\n                                        <div class=\"col-8\">\n                                            <input type=\"color\" id=\"link-color\" class=\"form-control form-control-sm\" [(ngModel)]=\"SelectedLinkColorVariable\" (ngModelChange)=\"onLinkColorChanged()\">\n                                        </div>\n                                    </div>\n\n                                    <div class=\"form-group row\" title=\"What color should denote selection?\">\n                                        <div class=\"col-4\"><label for=\"selected-color\">Selected</label></div>\n                                        <div class=\"col-8\">\n                                            <input type=\"color\" id=\"selected-color\" class=\"form-control form-control-sm\" value=\"#ff8300\" [(ngModel)]=\"SelectedColorVariable\" (ngModelChange)=\"updateGlobalSettingsModel()\">\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\" title=\"What color should the background be?\">\n                                        <div class=\"col-4\"><label for=\"background-color\">Background</label></div>\n                                        <div class=\"col-8\">\n                                            <input type=\"color\" id=\"background-color\" class=\"form-control form-control-sm\" value=\"#ffffff\" [(ngModel)]=\"SelectedBackgroundColorVariable\" (ngModelChange)=\"onBackgroundChanged()\">\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row\" title=\"Load an existing MicrobeTrace style file\">\n                                        <div class=\"col-4\">Apply Style</div>\n                                        <div class=\"col-8\">\n                                            <input type=\"file\" id=\"apply-style\" class=\"d-none\" accept=\".style\" [(ngModel)]=\"SelectedApplyStyleVariable\" (change)=\"onApplyStyle($event)\">\n                                            <label class=\"custom-file-label\" for=\"apply-style\">Choose MicrobeTrace Style File</label>\n                                        </div>\n                                    </div>\n                                </div>\n                            </tab>\n\n                            <tab heading=\"{{'Timeline' | localize}}\" customClass=\"m-tabs__item\" style='width: 400px; height: 100%;'>\n                                <div id=\"timeline-config\" role=\"tabpanel\" aria-labelledby=\"timeline-tab\">\n                                    <div class=\"form-group row\" title=\"By what variable timeline applied?\">\n                                        <div class=\"col-4\"><label for=\"node-timeline-variable\">Timeline By</label></div>\n                                        <div class=\"col-8\">\n                                            <p-dropdown id=\"node-timeline-variable\" [options]=\"FieldList\" appendTo=\"body\" [(ngModel)]=\"SelectedTimelineVariable\" (onChange)=\"onTimelineChanged($event.value)\"></p-dropdown>\n                                        </div>\n                                    </div>\n                                    <div class=\"form-group row \" title=\"How much time between ticks of the timeline (ms)?\">\n                                        <div class=\"col-4\"><label>Timeline Speed: {{ timelineSpeed }} ms</label></div>\n                                        <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" min=\"200\" step=\"100\" max=\"1000\" [(ngModel)]=\"timelineSpeed\"></div>\n                                    </div>\n                                    <div>Timeline works on 2D Network, Map, and Bubble Views.</div>\n                                </div> \n                            </tab>\n                        </tabset>\n                    </div>\n                </div>\n            </div>\n\n            <div class=\"modal-footer\">\n                <div class=\"btn-group\" data-toggle=\"buttons\">\n                    <button type=\"button\" class=\"btn btn-primary\" (click)=\"GlobalSettingsDialogSettings.setVisibility(false)\">Done</button>\n                </div>\n            </div>\n        </p-dialog><!-- /.modal -->\n\n       \n\n        <p-dialog id=\"open-auspice-url\" [(visible)]=\"displayUrlDialog\" header=\"Open Auspice JSON via URL\">\n            <div class=\"modal-dialog\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-body\">\n                        <input type=\"text\" id=\"auspice-url\" class=\"form-control form-control-sm\" [(ngModel)]=\"auspiceUrlVal\" placeholder=\"URL of Auspice JSON to open\" />\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn\" (click)=\"DisplayUrlDialog('Cancel')\">Cancel</button>\n                        <button type=\"button\" class=\"btn btn-success\" id=\"url-open-button\" (click)=\"DisplayUrlDialog('Open')\">Open</button>\n                    </div>\n                </div><!-- /.modal-content -->\n            </div><!-- /.modal-dialog -->\n        </p-dialog><!-- /.modal -->\n\n        <p-dialog id=\"open-old-mt\" [(visible)]=\"displayMTDialog\" header=\"Open Auspice JSON in classic MicrobeTrace\">\n            <div class=\"modal-dialog\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-body\">\n                        Welcome to the newest version of MicrobeTrace! If you'd like to open your auspice JSON file in the previous version of MicrobeTrace, please click this link: <br />\n                        <a href=\"https://microbetrace.cdc.gov/MicrobeTrace/?url={{auspiceUrlVal}}\">https://microbetrace.cdc.gov/MicrobeTrace/?url={{auspiceUrlVal}}</a>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn\" (click)=\"DisplayMTDialog('Cancel')\">Close</button>\n                    </div>\n                </div><!-- /.modal-content -->\n            </div><!-- /.modal-dialog -->\n        </p-dialog><!-- /.modal -->\n\n        <p-dialog [(visible)]=\"showExportDashboardMenu\"  header=\"Export Dashboard\"  class=\"dialogSize\"  (onHide)=\"showExportDashboardMenu=false\"  appendTo=\"body\">\n        <div class=\"modal-dialog\" role=\"document\">\n            <div class=\"modal-content\">\n            <div class=\"modal-body\" style=\"min-width: 400px; height: 100%;\">\n                <div class=\"form-group row\">\n                    <div class=\"col-9\">\n                        <input type=\"text\" class=\"form-control form-control-sm\" placeholder=\"Filename\" [(ngModel)]=\"ExportDashboardFilename\" />\n                    </div>\n                    <div class=\"col-3\">\n                        <select class=\"form-control form-control-sm\">\n                            <option selected>png</option>\n                        </select>\n                    </div>\n            </div>\n            <div>  <!-- Toggle Advanced Export Options -->\n                <p-accordion>\n                    <p-accordionTab style=\"color:#495057\" header=\"Advanced\">\n                        <div>\n                            <div class=\"form-group row\">\n                                <div class=\"col-3\">\n                                    <label for=\"network-export-scale\">Scale</label>\n                                </div>\n                                <div class=\"col-9\">\n                                    <input type=\"number\" class=\"form-control form-control-sm\" min=\"1\" max=\"5\" step=\"0.1\" [(ngModel)]=\"ExportDashboardScale\" (ngModelChange)=\"updateExportResolution()\">\n                                </div>\n                            </div>\n                            <div class=\"form-group row\">\n                                <div class=\"col-3\">Resolution</div>\n                                <div id=\"network-export-dimensions\" class=\"col-9 text-right\">{{ ExportDashboardResolution.summary }}</div>\n                            </div>\n                        </div>\n                    </p-accordionTab>\n                </p-accordion>\n              </div>\n            </div>\n            <div class=\"modal-footer\">\n                <button type=\"button\" class=\"btn btn-error\" (click)=\"showExportDashboardMenu = false\">Cancel</button>\n                <button type=\"button\" id=\"network-export\"  class=\"btn btn-primary\" (click)=\"ExportDashboard()\">Export</button>\n            </div>\n            </div>\n            <!-- /.modal-content -->\n        </div>\n        <!-- /.modal-dialog -->\n        </p-dialog>\n\n        <p-dialog [(visible)]=\"showExportTablesMenu\"  header=\"Export Tables\"  class=\"dialogSize\"  (onHide)=\"showExportTablesMenu=false\"  appendTo=\"body\">\n            <div class=\"modal-dialog\" role=\"document\">\n                <div class=\"modal-content\">\n                <div class=\"modal-body\" style=\"min-width: 400px; height: 100%;\">\n                    <div class=\"form-group row\">\n                        <div class=\"col-9\">\n                            <input type=\"text\" class=\"form-control form-control-sm\" placeholder=\"Filename\" [(ngModel)]=\"ExportTablesFilename\" />\n                        </div>\n                        <div class=\"col-3\">\n                            <select class=\"form-control form-control-sm\" [(ngModel)]=\"ExportTablesFileType\">\n                                <option >png</option>\n                                <option >svg</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class=\"flex align-items-center row\">\n                        <div class=\"col-5\">\n                            <input type=\"checkbox\" id=\"checkbox1\" [(ngModel)]=\"exportTables['node-color']\" [disabled]=\"SelectedColorNodesByVariable=='None'\" style=\"margin-left: 10px;\"/>\n                            <label for=\"checkbox1\" [class.disabled]=\"SelectedColorNodesByVariable=='None'\">Node Color Table</label>\n                        </div>\n                        <div class=\"col-5\">\n                            <input type=\"checkbox\" id=\"checkbox2\" [(ngModel)]=\"exportTables['link-color']\" [disabled]=\"SelectedColorLinksByVariable=='None'\" style=\"margin-left: 10px;\"/>\n                            <label for=\"checkbox2\" [class.disabled]=\"SelectedColorLinksByVariable=='None'\">Link Color Table</label>\n                        </div>\n                        <div class=\"col-5\">\n                            <input type=\"checkbox\" id=\"checkbox3\" [(ngModel)]=\"exportTables['node-symbol']\" [disabled]=\"commonService.session.style.widgets['node-symbol-variable']=='None'\" style=\"margin-left: 10px;\"/>\n                            <label for=\"checkbox3\" [class.disabled]=\"commonService.session.style.widgets['node-symbol-variable']=='None'\">Node Shape Table</label>\n                        </div>\n                        <div class=\"col-5\">\n                            <input type=\"checkbox\" id=\"checkbox4\" [(ngModel)]=\"exportTables['polygon-color']\" [disabled]=\"commonService.session.style.widgets['polygons-color-show']==false\" style=\"margin-left: 10px;\"/>\n                            <label for=\"checkbox4\" [class.disabled]=\"commonService.session.style.widgets['polygons-color-show']==false\">Polygon Table</label>\n                        </div>\n                        <br />\n                        \n                    </div>\n                    <div>  <!-- Toggle Advanced Export Options -->\n                        <p-accordion *ngIf=\"ExportTablesFileType === 'png'\">\n                            <p-accordionTab style=\"color:#495057\" header=\"Advanced\">\n                                <div>\n                                    <div class=\"form-group row\">\n                                        <div class=\"col-3\">\n                                            <label for=\"network-export-scale\">Scale</label>\n                                        </div>\n                                        <div class=\"col-9\">\n                                            <input type=\"number\" class=\"form-control form-control-sm\" min=\"1\" max=\"5\" step=\"0.1\" [(ngModel)]=\"ExportTablesScale\">\n                                        </div>\n                                    </div>\n                                </div>\n                            </p-accordionTab>\n                        </p-accordion>\n                    </div>\n                </div>\n                <div class=\"modal-footer\">\n                    <button type=\"button\" class=\"btn btn-error\" (click)=\"showExportTablesMenu = false\">Cancel</button>\n                    <button type=\"button\" id=\"network-export\"  class=\"btn btn-primary\" (click)=\"ExportTables()\">Export</button>\n                </div>\n                </div>\n                <!-- /.modal-content -->\n            </div>\n            <!-- /.modal-dialog -->\n            </p-dialog>\n\n        <p-dialog id=\"session-stash-modal\" [(visible)]=\"displayStashDialog\" header=\"Save Session\">\n            <div class=\"modal-dialog\" role=\"document\">\n                <div class=\"modal-content\">\n\n                    <div class=\"modal-body\">\n                        <div class=\"form-group row\" title=\"What would you like to call this session?\">\n                            <div class=\"col-7\">\n                                <input style=\"height:42px\" type=\"text\" id=\"stash-name\" class=\"form-control form-control-sm\" [(ngModel)]=\"saveFileName\" placeholder=\"Name your session!\">\n                            </div>\n                            <div class=\"col-5\">\n                                <p-dropdown [options]=\"saveFileTypeOptions\" [(ngModel)]=\"selectedSaveFileType\" appendTo=\"body\"></p-dropdown>\n                            </div>\n                        </div>\n                        <div *ngIf=\"selectedSaveFileType=='session'\" class=\"form-group row\" title=\"Should MicrobeTrace compress this save file?\">\n                            <div class=\"col\">\n                                <div class=\"form-check form-check-inline\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"save-file-compress\" checked>\n                                    <label class=\"form-check-label\" for=\"save-file-compress\">Compress?</label>\n                                  </div>\n                              <div id=\"cluster-checkbox-container\" class=\"form-check form-check-inline\">\n                                <input class=\"form-check-input\" [(ngModel)]=\"saveByCluster\" type=\"checkbox\" id=\"save-file-cluster\">\n                                <label class=\"form-check-label\" for=\"save-file-cluster\">By Cluster</label>\n                              </div>\n                            </div>\n                         </div>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-error\" (click)=\"DisplayStashDialog('Cancel')\">Cancel</button>\n                        <button type=\"button\" id=\"stash-data\" class=\"btn btn-primary\" (click)=\"DisplayStashDialog('Save')\" [disabled]=\"saveFileName === undefined || saveFileName === ''\">Save</button>\n                    </div>\n                </div><!-- /.modal-content -->\n            </div><!-- /.modal-dialog -->\n        </p-dialog><!-- /.modal -->\n\n        <div class=\"view-controls\">\n            <p-dialog id=\"loading-information-modal\" [(visible)]=\"displayloadingInformationModal\" header=\"Processing Files...\">\n                <div class=\"modal-dialog\" role=\"document\">\n                    <div class=\"modal-content\">\n                       \n    \n                            <img class=\"img-responsive\" [src]=\"commonService.appRootUrl() + 'assets/common/images/giphy.gif'\" alt=\"logo\" height=\"300\" />\n    \n                            <div id=\"loading-information-collapse\" class=\"collapse show\">\n                                <div id=\"loading-information\" class=\"card card-body\">\n    \n                                    <div *ngFor=\"let message of messages\">\n                                        {{ message }}\n                                      </div> \n                                    <br>\n    \n                                </div>\n                            </div>\n                        \n                        <p-footer>\n                            <button type=\"button\" class=\"btn btn-success\" data-dismiss=\"modal\" (click)=\"displayloadingInformationModal=false\">Close</button>\n                        </p-footer>\n                    </div><!-- /.modal-content -->\n                </div><!-- /.modal-dialog -->\n            </p-dialog>\n        </div><!-- Loading Files/.modal -->\n\n\n        <p-dialog id=\"about-dialog\" [(visible)]=\"displayAbout\" header=\"About Microbetrace\">\n            <div class=\"modal-dialog modal-lg\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-body\">\n                        <h3>\n                            <span>{{\"MicrobeTrace\" | localize}} </span>\n                            <small>v<span id=\"version\">{{version}}</span></small>\n                        </h3>\n                        <p>\n                            MicrobeTrace is an interactive web application that renders existing data from high-risk contact networks\n                            in an easy-to-use Graphical User Interface (GUI). The network visualization can be customized according to\n                            supplemental data sources and mathematical inferences like the most probable transmission pathways.\n                            MicrobeTrace is a highly responsive, visual sequence analytics tool which can reduce the gap between data\n                            production and analytics and help you to discover, understand, and display relationships (links) between\n                            patients (nodes). MicrobeTrace can be deployed on laptops to locations without any Internet access, thereby\n                            reducing both the startup cost and analysis time and effort.\n                          </p>\n                          <p class=\"about-links\">\n                            <a href=\"https://github.com/CDCgov/MicrobeTrace/wiki\" target=\"_blank\" rel=\"noreferrer noopener\">\n                              Click Here to Learn More\n                            </a>\n                          </p>\n                          <p>\n                            MicrobeTrace was built by the Molecular Epidemiology and Bionformatics Team at the CDC in Atlanta.</p>\n                            <a class=\"about-links\" href=\"https://cdcgov.github.io/MEBT\" target=\"_blank\" rel=\"noreferrer noopener\" style=\"display: block;\">\n                              Click Here to See MEBT's Other Tools\n                            </a>\n                          \n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-success\" (click)=\"DisplayAbout()\">Close</button>\n                    </div>\n                </div>\n            </div>\n        </p-dialog>\n\n        <div id=\"main-panel\" class=\"pane-container pane-horizontal\">\n            <noscript class=\"container-fluid\">\n              <div class=\"jumbotron\">\n                <h1>Sorry!</h1>\n                <p class=\"lead\">MicrobeTrace requires Javascript to run. Please <a href=\"https://www.enable-javascript.com/\">enable Javascript</a> and refresh MicrobeTrace.</p>\n              </div>\n            </noscript>\n            <div id=\"global-timeline-wrapper\" style=\"display: none;\">\n              <div id=\"global-timeline\" align=\"center\">\n                <div><button type=\"button\" id=\"timeline-play-button\" class=\"btn btn-light btn-sm\" (click)=\"playTimeline()\">{{playBtnText}}</button>\n                <span id=\"global-timeline-field\" contenteditable></span></div>\n                <!-- <svg></svg>\n                <mat-slider></mat-slider> -->\n              </div>  \n            </div>\n          </div>\n\n          <p-dialog \n            header=\"License Agreement\"\n            [(visible)]=\"display_eula_modal\"\n            [modal]=\"true\"\n            [dismissableMask]=\"false\"\n            [style]=\"{ width: '850px' }\"            \n            appendTo=\"body\"\n            >\n            <div style=\"margin: 16px;\">\n                <p>\n                    The material embodied in this software is provided to you As-is and without warranty of any kind, express, implied or otherwise, including without limitation, any warranty of fitness for a particular purpose. In no event shall the Centers for Disease Control and Prevention (CDC) or the United States (U.S.) government be liable to you or anyone else for any direct, special, incidental, indirect or consequential damages of any kind, or any damages whatsoever, including without limitation, loss of profit, loss of use, savings or revenue, or the claims of third parties, whether or not CDC or the U.S. Government has been advised of the possibility of such loss, however caused and on any theory of liability, arising out of or in connection with the possession, use or performance of this software.\n                </p>\n                <p>Please Click \"Accept\" to accept this agreement, or \"Reject\" to close this application.</p>\n            </div>\n\n            <ng-template pTemplate=\"footer\">\n                <div class=\"p-dialog-footer\" style=\"padding-top: 35px;\">\n                  <button class=\"btn btn-danger\" (click)=\"on_eula_reject()\">Reject</button>\n                  <button class=\"btn btn-primary\" (click)=\"on_eula_accept()\">Accept</button>\n                </div>\n              </ng-template>\n            </p-dialog>\n\n\n       \n        <!-- <p-dialog class=\"table-z-index\" id=\"global-settings-link-color-table\" \n                    [position]=\"GlobalSettingsLinkColorDialogSettings.linkLeft\" \n                    [(visible)]=\"GlobalSettingsLinkColorDialogSettings.isVisible\"  \n                    header=\"Link Color Table\" [style]=\"{'z-index': '1'}\"\n                    (onShow)=\"SelectedLinkColorTableTypesVariable='Show'\"\n                    (onHide)=\"SelectedLinkColorTableTypesVariable='Hide'\"\n                    >\n            <div class=\"col-12\" style=\"max-height: 50vh\">\n                <table id=\"link-color-table\" style=\"width:100%;height:100%;\"></table>\n            </div>\n        </p-dialog> -->\n\n        <div id=\"color-transparency-wrapper\">\n            <input type=\"range\" class=\"custom-range\" id=\"color-transparency\" min=\"0\" max=\"1\" step=\"0.05\" value=\"1\" >\n        </div>\n\n\n    </div>\n</div>\n";

/***/ }),

/***/ 23870:
/*!************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/AggregateComponent/aggregate.component.html?ngResource ***!
  \************************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"aggregate-wrapper\">\n    <div id=\"tool-btn-container\" class=\"m-portlet\">\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n          <a title=\"Open Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n        </span>\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n          <a title=\"Export Crosstab Data\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n        </span>\n    </div>\n    <div style=\"overflow-y: auto; padding: 0px 20px;\" [style.height.px]=\"viewHeight\" id=\"tablesContainer\">\n      <div class=\"row align-items-center\" *ngFor=\"let table of SelectedDataTables; let i = index\" style=\"margin: 20px 0px; justify-content: center;\">\n        <p-table\n          [value]=\"table.data\"\n          [columns]=\"table.tableColumns\"\n          styleClass=\"p-datatable-sm p-datatable-gridlines\"\n          [tableStyle]=\"tableStyle\">\n          <ng-template pTemplate=\"caption\">\n            <div style=\"display: flex; justify-content: center; font-weight: bold; font-size: large;\">{{ formatTableTitle(SelectedDataFields[i])}} </div>\n          </ng-template>\n          <ng-template pTemplate=\"header\" let-columns>\n            <tr>\n              <th *ngFor=\"let col of table.tableColumns\" pSortableColumn=\"{{col.field}}\">\n                {{ col.header}} <p-sortIcon field=\"{{col.field}}\"></p-sortIcon>\n              </th>\n            </tr>\n          </ng-template>\n          <ng-template pTemplate=\"body\" let-rowData let-column=\"table.tableColumns\">\n            <tr>\n              <td *ngFor=\"let col of table.tableColumns\">\n                {{ col.field=='percent' ? rowData['percent'].toFixed(2)+'%' : rowData[col.field] }}\n              </td>\n            </tr>\n          </ng-template>\n        </p-table>\n      </div>\n    </div>\n\n    <p-dialog *ngIf=\"viewActive\" [(visible)]=\"settingsOpen\" header=\"Aggregate Settings\" [contentStyle]=\"{'max-height': '70vh', 'width': '600px'}\" appendTo=\"body\">\n      <p-orderList id=\"aggregate-orderList\" #orderList [value]=\"SelectedDataFields\" [dragdrop]=\"true\" (onReorder)=\"reordered($event)\">\n        <ng-template let-i=\"index\" let-field pTemplate=\"item\">\n        <div style=\"display: flex;\">\n          <span class=\"col-3\">Table {{i+1}}</span>\n          <span class=\"col-7\">\n            <p-dropdown [options]=\"fieldOptions\"  [ngModel]=\"SelectedDataFields[i]\" (onChange)=\"updateDataField(i, $event)\" appendTo=\"body\" [group]=\"true\">\n              <ng-template let-group pTemplate=\"group\">\n                <span style=\"font-size: large; font-weight: bold;\">{{ group.label }}</span>\n              </ng-template>\n              <ng-template let-item pTemplate=\"item\">\n                <span>{{ item.short_label }}</span>\n              </ng-template>\n            </p-dropdown>\n          </span>\n          <span class=\"col-2\" *ngIf=\"SelectedDataFields.length > 1\">\n            <p-button icon=\"pi pi-times\" class=\"deleteButton\" (onClick)=\"deleteTable(i)\"/>\n          </span>\n        </div>\n      </ng-template>\n      </p-orderList>\n      <div class=\"form-group row\" style=\"justify-content: center;\">\n        <p-button icon=\"pi pi-plus\" label=\"Add Table\" (onClick)=\"addTable()\"/>\n      </div>\n  </p-dialog>\n\n  <p-dialog *ngIf=\"viewActive\" [(visible)]=\"exportOpen\" header=\"Aggregate Export\" [contentStyle]=\"{'max-height': '70vh', 'width': '600px'}\" appendTo=\"body\">\n    <div class=\"modal-dialog\" role=\"document\">\n      <div class=\"modal-content\">\n          <div class=\"modal-body\" style='width: 100%; height: 100%;'>\n              <div class=\"form-group row\">\n                  <div class=\"col-9\">\n                    <input type=\"text\" style=\"height:42px\" class=\"form-control form-control-sm\"\n                        placeholder=\"Filename\" [(ngModel)]=\"SelectedAggregateExportFilename\">\n                  </div>\n                  <div class=\"col-3\">\n                    <p-dropdown [options]=\"AggregateExportFileTypeList\"\n                        [(ngModel)]=\"SelectedAggregateExportFileType\" appendTo=\"body\"></p-dropdown>\n                  </div>\n              </div>\n          </div>\n          <div class=\"modal-footer\">\n              <button type=\"button\" class=\"btn btn-error\" (click)=\"exportOpen = !exportOpen\">Cancel</button>\n              <button type=\"button\" class=\"btn btn-primary\" (click)=\"exportVisualization()\">Export</button>\n          </div>\n      </div><!-- /.modal-content -->\n  </div>\n</p-dialog>\n</div>\n";

/***/ }),

/***/ 36460:
/*!****************************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/AlignmentViewComponent/alignment-view-plugin-component.html?ngResource ***!
  \****************************************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"msa-viewer-container\">\n    <div id=\"msa-viewer\" [style.height.px]=\"alignmentViewHeight\">\n        <div class=\"left\">  \n            <div style=\"text-align: center;\" [style.width.px]=\"leftWidth\">\n                <div id='miniMapTitle' class=\"title\" title=\"Mini Map of entire length for all the sequences. Click to move to an area of the viewer.\">Mini Map</div>\n                <div id='alignmnetTopTitle' class=\"title\" style=\"height: 100px; line-height: 100px;\"></div>\n                <div class=\"title\" style=\"height: 43px; line-height: 43px;\" title=\"Number of Nucleotides from the start of the sequence\">Ruler</div>\n                <div style=\"height: 17px;\"></div>\n            </div>\n            <div class=\"canvasLabels\" [style.height.px]=\"canvasViewHeight-17\" [style.width.px]=\"leftWidth\" #canvasLabels (scroll)=\"canvasHolder.scrollTop=canvasLabels.scrollTop\">\n                <div *ngFor=\"let label of labelArray\" [attr.data-index]=\"label['index']\" [ngStyle]=\"{'font-size.px': fontSize, 'height.px': spanHeight}\">{{ label[ this.widgets['alignView-labelField'] ] }}</div>\n            </div>\n        </div>\n        <div class=\"right\" [style.height.px]=\"rightViewHeight\">\n            <div id=\"miniMapHolder\">\n                <div id=\"miniMap\" (mouseenter)=\"showMiniMapHighlight($event, miniMap)\" (mousemove)=\"updateMiniMapHighlight($event, miniMap)\" (mouseleave)=\"hideMiniMapHighlight()\" (click)=\"miniMapClick($event, miniMap, canvasHolder, canvasLabels, alignmentTop)\" #miniMap>\n                    <div id=\"miniMapHighlight\"></div>\n                    <!--<canvas> for miniMap here-->\n                </div>\n            </div>\n            <div id=\"alignmentTop\" (scroll)=\"canvasHolder.scrollLeft=alignmentTop.scrollLeft\" [style.width.px]=\"rightWidth\" #alignmentTop>\n                <svg [attr.width]=\"getSVGWidth()\" height=\"140\" style=\"background-color: white;\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n                    <g *ngIf=\"selectedSeqType != 'aa'\">\n                        <g *ngFor=\"let nt of proportionMatrix; index as i\">\n                            <g *ngIf=\"this.widgets['alignView-topDisplay'] === 'barplot' && i >=startPos-1\">\n                                <g *ngFor=\"let prop of nt; index as j\">\n                                    <rect *ngIf=\"prop>0\" [attr.y]=\"positionMatrix[i][j]\" [attr.x]=\"xPos(i)\" [attr.height]=\"100*prop\" [attr.width]=\"spanWidth\" [attr.fill]=\"fillColor(j)\"/>\n                                </g>\n                            </g>\n                            <g *ngIf=\"this.widgets['alignView-topDisplay'] === 'logo' && i >=startPos-1\">\n                                <g class=\"A\" *ngIf=\"nt[0]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrix[i][0] + ') scale(' + spanWidth/100 + ', ' + nt[0] + ')'\" \n                                    [attr.fill]=\"fillColor(0)\">\n                                    <path d=\"M 0 100 L 33 0 L 66 0 L 100 100 L 75 100 L 66 75 L 33 75 L 25 100 L 0 100\"/>\n                                    <path fill=\"#ffffff\" d=\"M 41 55 L 50 25 L 58 55 L 41 55\"/>\n                                </g>\n                                <path class=\"C\" *ngIf=\"nt[1]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrix[i][1] + ') scale(' + spanWidth/100 + ', ' + nt[1] + ')'\" \n                                    [attr.fill]=\"fillColor(1)\"\n                                    d=\"M 100 28 C 100 -13 0 -13 0 50 C 0 113 100 113 100 72 L 75 72 C 75 90 30 90 30 50 C 30 10 75 10 75 28 L 100 28\"/>\n                                <path class=\"G\" *ngIf=\"nt[2]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' +  positionMatrix[i][2] + ') scale(' + spanWidth/100 + ', ' + nt[2] + ')'\" \n                                    [attr.fill]=\"fillColor(2)\"\n                                    d=\"M 100 28 C 100 -13 0 -13 0 50 C 0 113 100 113 100 72 L 100 48 L 55 48 L 55 72 L 75 72 C 75 90 30 90 30 50 C 30 10 75 5 75 28 L 100 28\"/>\n                                <path class=\"T\" *ngIf=\"nt[3]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrix[i][3] + ') scale(' + spanWidth/100 + ', ' + nt[3] + ')'\" \n                                    [attr.fill]=\"fillColor(3)\"\n                                    d=\"M 0 0 L 0 20 L 35 20 L 35 100 L 65 100 L 65 20 L 100 20 L 100 0 L 0 0\"/>\n                            </g>\n                            <g *ngIf=\"((i+1) %100 == 0 && i > startPos+1 )|| i==startPos-1\">\n                                <text y=\"120\" [attr.x]=\"(i >= 100 && i!=startPos-1) ? xPos(i)-10 : xPos(i)\">{{ i + 1 }}</text>\n                                <text y=\"140\" [attr.x]=\"xPos(i)\">|</text>\n                            </g>\n                            <g *ngIf=\"(i+1) % this.widgets['alignView-rulerMinorInterval'] == 0 && (i+1)%100 != 0 && i >startPos+1\">\n                                <text y=\"120\" [attr.x]=\"i >= 100 ? xPos(i)-10 : xPos(i)-5\">{{ i + 1 }}</text>\n                                <text y=\"140\" [attr.x]=\"xPos(i)\">:</text>\n                            </g>\n                            <rect [attr.width]=\"spanWidth\" [attr.x]=\"xPos(i)\" height=\"100\" y=\"0\" style=\"fill: transparent\" (mouseenter)=\"showTooltip($event, i)\" (mouseleave)=\"hideTooltip()\"/>\n                        </g>\n\n                    </g>\n                    <g *ngIf=\"selectedSeqType=='aa'\">\n                        <g *ngFor=\"let aa of proportionMatrixAA; index as i\">\n                            <g *ngIf=\"this.widgets['alignView-topDisplay'] === 'barplot'\">\n                                <g *ngFor=\"let prop of aa; index as j\">\n                                    <rect *ngIf=\"prop>0\" [attr.y]=\"positionMatrixAA[i][j]\" [attr.x]=\"xPos(i)\" [attr.height]=\"100*prop\" [attr.width]=\"spanWidth\" [attr.fill]=\"fillColor(j)\"/>\n                                </g>\n                            </g>\n                            <g *ngIf=\"this.widgets['alignView-topDisplay'] === 'logo'\"> <!-- SVG for letters from: https://github.com/weng-lab/logojs-package/tree/master/src/components/glyphs -->\n                                <g class=\"A\" *ngIf=\"aa[0]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][0] + ') scale(' + spanWidth/100 + ', ' + aa[0] + ')'\" \n                                    [attr.fill]=\"fillColor(0)\">\n                                    <path d=\"M 0 100 L 33 0 L 66 0 L 100 100 L 75 100 L 66 75 L 33 75 L 25 100 L 0 100\"/>\n                                    <path fill=\"#ffffff\" d=\"M 41 55 L 50 25 L 58 55 L 41 55\"/>\n                                </g>\n                                <g class=\"R\" *ngIf=\"aa[1]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][1] + ') scale(' + spanWidth/100 + ', ' + aa[1] + ')'\" \n                                    [attr.fill]=\"fillColor(1)\">\n                                    <path d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 C 100 50 100 70 100 70 L 100 100 L 80 100 L 80 80 C 80 80 80 60 50 60 L 20 60 L 20 100 L 0 100 L 0 0\" />\n                                    <path fill=\"#ffffff\" d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\" />\n                                </g>\n                                <path class=\"N\" *ngIf=\"aa[2]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][2] + ') scale(' + spanWidth/100 + ', ' + aa[2] + ')'\" \n                                    [attr.fill]=\"fillColor(2)\"\n                                    d=\"M 0 100 L 0 0 L 20 0 L 80 75 L 80 0 L 100 0 L 100 100 L 80 100 L 20 25 L 20 100 L 0 100\"/>\n                                <g class=\"D\" *ngIf=\"aa[3]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][3] + ') scale(' + spanWidth/100 + ', ' + aa[3] + ')'\" \n                                    [attr.fill]=\"fillColor(3)\">\n                                    <path d=\"M 0 0 L 60 0 C 110 0 110 100 60 100 L 0 100 L 0 0\"/>\n                                    <path fill=\"#ffffff\" d=\"M 20 15 L 40 15 C 85 15 85 85 40 85 L 20 85 L 20 15\"/>\n                                </g>\n                                <path class=\"C\" *ngIf=\"aa[4]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][4] + ') scale(' + spanWidth/100 + ', ' + aa[4] + ')'\" \n                                    [attr.fill]=\"fillColor(4)\"\n                                    d=\"M 100 28 C 100 -13 0 -13 0 50 C 0 113 100 113 100 72 L 75 72 C 75 90 30 90 30 50 C 30 10 75 10 75 28 L 100 28\"/>\n                                <path class=\"E\" *ngIf=\"aa[5]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][5] + ') scale(' + spanWidth/100 + ', ' + aa[5] + ')'\" \n                                    [attr.fill]=\"fillColor(5)\"\n                                    d=\"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 90 40 L 90 60 L 20 60 L 20 80 L 100 80 L 100 100 L 0 100 L 0 0\"/>\n                                <g class=\"Q\" *ngIf=\"aa[6]>0 \" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][6] + ') scale(' + spanWidth/100 + ', ' + aa[6] + ')'\" \n                                    [attr.fill]=\"fillColor(6)\">\n                                    <circle cx=\"50\" cy=\"50\" r=\"50\"/>\n                                    <circle cx=\"50\" cy=\"50\" r=\"32\" fill=\"#ffffff\" />\n                                    <path d=\"M 85 100 L 55 70 L 70 55 L 100 85 L 85 100\"/>\n                                </g>\n                                <path class=\"G\" *ngIf=\"aa[7]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' +  positionMatrixAA[i][7] + ') scale(' + spanWidth/100 + ', ' + aa[7] + ')'\" \n                                    [attr.fill]=\"fillColor(7)\"\n                                    d=\"M 100 28 C 100 -13 0 -13 0 50 C 0 113 100 113 100 72 L 100 48 L 55 48 L 55 72 L 75 72 C 75 90 30 90 30 50 C 30 10 75 5 75 28 L 100 28\"/>\n                                <path class=\"H\" *ngIf=\"aa[8]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' +  positionMatrixAA[i][8] + ') scale(' + spanWidth/100 + ', ' + aa[8] + ')'\" \n                                    [attr.fill]=\"fillColor(8)\"\n                                    d=\"M 0 0 L 20 0 L 20 40 L 80 40 L 80 0 L 100 0 L 100 100 L 80 100 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0\"/>\n                                <path class=\"I\" *ngIf=\"aa[9]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' +  positionMatrixAA[i][9] + ') scale(' + spanWidth/100 + ', ' + aa[9] + ')'\" \n                                    [attr.fill]=\"fillColor(9)\"\n                                    d=\"M 40 0 L 60 0 L 60 100 L 40 100 L 40 0\"/> \n                                <path class=\"L\" *ngIf=\"aa[10]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' +  positionMatrixAA[i][10] + ') scale(' + spanWidth/100 + ', ' + aa[10] + ')'\" \n                                    [attr.fill]=\"fillColor(10)\"\n                                    d=\"M 0 0 L 0 100 L 100 100 L 100 80 L 20 80 L 20 0 L 0 0\"/>    \n                                <path class=\"K\" *ngIf=\"aa[11]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' +  positionMatrixAA[i][11] + ') scale(' + spanWidth/100 + ', ' + aa[11] + ')'\" \n                                    [attr.fill]=\"fillColor(11)\"\n                                    d=\"M 0 0 L 20 0 L 20 40 L 75 0 L 100 0 L 50 50 L 100 100 L 75 100 L 30 65 L 20 75 L 20 100 L 0 100 L 0 0\"/>\n                                <path class=\"M\" *ngIf=\"aa[12]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' +  positionMatrixAA[i][12] + ') scale(' + spanWidth/100 + ', ' + aa[12] + ')'\" \n                                    [attr.fill]=\"fillColor(12)\"\n                                    d=\"M 0 0 L 20 0 L 50 35 L 80 0 L 100 0 L 100 100 L 80 100 L 80 30 L 50 65 L 20 30 L 20 100 L 0 100 L 0 0\"/>\n                                <path class=\"F\" *ngIf=\"aa[13]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' +  positionMatrixAA[i][13] + ') scale(' + spanWidth/100 + ', ' + aa[13] + ')'\" \n                                    [attr.fill]=\"fillColor(13)\"\n                                    d=\"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 80 40 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0\"/> \n                                <g class=\"P\" *ngIf=\"aa[14]>0 \" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][14] + ') scale(' + spanWidth/100 + ', ' + aa[14] + ')'\" \n                                    [attr.fill]=\"fillColor(14)\">\n                                    <path d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 L 20 50 L 20 100 L 0 100 L 0 0\"/>\n                                    <path fill=\"#ffffff\" d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\" />\n                                </g>\n                                <path class=\"S\" *ngIf=\"aa[15]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][15] + ') scale(' + spanWidth/100 + ', ' + aa[15] + ')'\" \n                                    fill=\"#ffffff\" [attr.stroke]=\"fillColor(15)\" stroke-width=\"16\"\n                                    d=\"M92 26 A43 20 0 1 0 43 46 A42 23 0 1 1 9 68\"/>\n                                <path class=\"T\" *ngIf=\"aa[16]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][16] + ') scale(' + spanWidth/100 + ', ' + aa[16] + ')'\" \n                                    [attr.fill]=\"fillColor(16)\"\n                                    d=\"M 0 0 L 0 20 L 35 20 L 35 100 L 65 100 L 65 20 L 100 20 L 100 0 L 0 0\"/>\n                                <path class=\"W\" *ngIf=\"aa[17]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][17] + ') scale(' + spanWidth/100 + ', ' + aa[17] + ')'\" \n                                    [attr.fill]=\"fillColor(17)\"\n                                    d=\"M 0 0 L 20 0 L 30 70 L 50 30 L 70 70 L 80 0 L 100 0 L 90 100 L 70 100 L 50 65 L 30 100 L 10 100 L 0 0\"/>\n                                <path class=\"Y\" *ngIf=\"aa[18]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][18] + ') scale(' + spanWidth/100 + ', ' + aa[18] + ')'\" \n                                    [attr.fill]=\"fillColor(18)\"\n                                    d=\"M 0 0 L 20 0 L 50 45 L 80 0 L 100 0 L 60 60 L 60 100 L 40 100 L 40 60 L 0 0\"/>\n                                <path class=\"V\" *ngIf=\"aa[19]>0\" [attr.transform]=\"'translate(' + xPos(i) + ', ' + positionMatrixAA[i][19] + ') scale(' + spanWidth/100 + ', ' + aa[19] + ')'\" \n                                    [attr.fill]=\"fillColor(19)\"\n                                    d=\"M 0 0 L 20 0 L 50 80 L 80 0 L 100 0 L 60 100 L 40 100 L 0 0\"/>\n                            </g>\n                            <g *ngIf=\"(i+1) %100 == 0 || i==0\">\n                                <text y=\"120\" [attr.x]=\"i >= 100 ? xPos(i)-10 : xPos(i)\">{{ i + 1 }}</text>\n                                <text y=\"140\" [attr.x]=\"xPos(i)\">|</text>\n                            </g>\n                            <g *ngIf=\"(i+1) % this.widgets['alignView-rulerMinorInterval'] == 0 && (i+1)%100 != 0\">\n                                <text y=\"120\" [attr.x]=\"i >= 100 ? xPos(i)-10 : xPos(i)-5\">{{ i + 1 }}</text>\n                                <text y=\"140\" [attr.x]=\"xPos(i)\">:</text>\n                            </g>\n                            <rect [attr.width]=\"spanWidth\" [attr.x]=\"xPos(i)\" height=\"100\" y=\"0\" style=\"fill: transparent\" (mouseenter)=\"showTooltip($event, i)\" (mouseleave)=\"hideTooltip()\"/>\n                        </g>\n                    </g>\n\n\n                </svg>\n            </div>\n            <div class=\"canvasHolder\" [style.height.px]=\"canvasViewHeight\" [style.width.px]=\"rightWidth\" (scroll)=\"canvasScroll(canvasHolder, canvasLabels, alignmentTop)\" #canvasHolder></div>\n        </div>\n    </div>\n</div>\n\n<div id=\"tooltipHolder\">\n    <div class=\"triangle\"></div>\n    <span id=\"tooltipAlign\"></span>\n</div>\n\n<div id=\"tool-btn-container\" class=\"m-portlet\">\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n        <a title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n    </span>\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n        <a title=\"Export Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n    </span>\n</div>\n\n<div class=\"view-controls\">\n    <p-dialog *ngIf=\"viewActive\" id=\"alignment-settings-pane\" [(visible)]=\"alignmentDialogSettings.isVisible\" appendTo=\"body\" header=\"Alignment View Settings\" >\n        <p-accordion>\n            <p-accordionTab style=\"color:#495057\" header=\"Data\">\n                <div #dataControls>\n                    <div class=\"form-group row\" title=\"Set a predefined size\">\n                        <div class=\"col-2\"><label>Sequence</label></div>\n                        <div class=\"col-10\">\n                            <p-selectButton [options]=\"seqTypeOptions\" [(ngModel)]=\"selectedSeqType\" (onChange)=\"onSeqTypeChange()\"></p-selectButton>\n                        </div>\n                    </div>\n                    <div class=\"form-group row node-label-row\" title=\"Set start position.\" *ngIf=\"selectedSeqType != 'nt'\">\n                        <div class=\"col-5\"><label>Start Position</label></div>\n                        <div class=\"col-7\">\n                            <input type=\"number\" class=\"form-control form-control-sm\" min='1' step=\"1\" [(ngModel)]=\"startPos\" (ngModelChange)=\"onSeqTypeChange()\">\n                        </div>\n                    </div>\n                    <div class=\"form-group row\" *ngIf=\"selectedSeqType == 'aa'\" title=\"Maintain Reading Frame will ignore NT gaps when converting NTs to AAs, but will try to guess where AA gaps are. \nMaintain Codon doesn't ignore gaps when converting NTs into AAs.\nGiven sequence ('CT-T...'), Maintain Reading Frame will convert codon CCT to L. \nMaintain Codon will convert codon CT- to X (Unknown).\">\n                        <div class=\"col-5\"><label>Translation Settings</label></div>\n                        <div class=\"col-7\">\n                            <p-dropdown [options]=\"['Maintain Codons', 'Maintain Reading Frame']\" appendTo=\"body\" [(ngModel)]=\"translationSetting\" (ngModelChange)=\"onSeqTypeChange()\"></p-dropdown>\n                        </div>\n                    </div>\n                </div>\n            </p-accordionTab>\n            <p-accordionTab style=\"color:#495057\" header=\"Layout\">\n                <div #layoutControls>\n                    <div class=\"form-group row\" title=\"Show or Hide the Mini Map\">\n                        <div class=\"col-4\"><label>Show Mini-Map</label></div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"showHideOptions\" [(ngModel)]=\"this.widgets['alignView-showMiniMap']\" (onChange)=\"updateMiniMapVisibility()\"></p-selectButton>\n                        </div>\n                    </div>\n                    <div class=\"form-group row\" title=\"Switch between a Bar Plot representation or a Logo representation of the nucleotides present at each position\">\n                        <div class=\"col-4\"><label>Show Logo/Bar Plot</label></div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"alignmentTopDisplayOptions\"\n                                [(ngModel)]=\"this.widgets['alignView-topDisplay']\" (onChange)=\"onAlignmentTopChange()\"></p-selectButton>\n                        </div>\n                    </div>\n                    <div class=\"form-group row\" title=\"Set the minor interval for the ruler. Set to 0 to remove minor interval.\">\n                        <div class=\"col-4\"><label>Ruler Minor Interval</label></div>\n                        <div class=\"col-8\">\n                            <p-dropdown [options]=\"rulerIntervalOptions\" appendTo=\"body\" [(ngModel)]=\"this.widgets['alignView-rulerMinorInterval']\"></p-dropdown>\n                        </div>\n                    </div>\n                    <div class=\"form-group row\" \n                    title=\"Select how you want NTs/AAs to be shown in the viewer. Show: Shows both the color and letter for each character. Minimum: Shows the color for each character and the letter for any that are different than the top sequence. Hide: Only shows the color for each character.\">\n                        <div class=\"col-4\"><label>Show Characters</label></div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"charSettingOptions\"\n                                [(ngModel)]=\"this.widgets['alignView-charSetting']\" (onChange)=\"updateAlignment()\"></p-selectButton>\n                        </div>\n                    </div>\n                </div>\n            </p-accordionTab>\n            <p-accordionTab style=\"color:#495057\" header=\"Labels and Order\">\n                <div #labelingControls>\n                    <div class=\"form-group row\" title=\"\">\n                        <div class=\"col-4\"><label>Labels</label></div>\n                        <div class=\"col-8\">\n                            <p-dropdown appendTo=\"body\" [options]=\"labelFieldList\" [(ngModel)]=\"this.widgets['alignView-labelField']\" (onChange)=\"onLabelFieldChange()\"></p-dropdown>\n                        </div>\n                    </div>\n                    <div class=\"form-group row\" title=\"\">\n                        <div class=\"col-4\"><label>Sort By</label></div>\n                        <div class=\"col-8\">\n                            <p-dropdown appendTo=\"body\" [options]=\"labelFieldList\" [(ngModel)]=\"this.widgets['alignView-sortField']\" (onChange)=\"onSortFieldChange()\"></p-dropdown>\n                        </div>\n                    </div>\n                </div>\n            </p-accordionTab>\n            <p-accordionTab  style=\"color:#495057\" header=\"Sizing\">\n                <div #sizingControls>\n                    <div class=\"form-group row\" title=\"Set a predefined size\">\n                        <div class=\"col-2\"><label>Size</label></div>\n                        <div class=\"col-10\">\n                            <p-selectButton [options]=\"sizes\" [(ngModel)]=\"this.widgets['alignView-selectedSize']\" (onChange)=\"onSelectedSizeChanged()\"></p-selectButton>\n                        </div>\n                    </div>\n                    <div class=\"form-group row node-label-row\" title=\"Set a custom height. Updating sets size to custom\">\n                        <div class=\"col-3\"><label>Height</label></div>\n                        <div class=\"col-8\">\n                            <input type=\"number\" class=\"form-control form-control-sm\" min=\"10\" step=\"1\" max=\"20\" [(ngModel)]=\"spanHeight\" (ngModelChange)=\"onSpanHeightChange($event)\">\n                        </div>\n                    </div>\n                    <div class=\"form-group row node-label-row\" title=\"Set a custom width. Updating sets size to custom\">\n                        <div class=\"col-3\"><label>Width</label></div>\n                        <div class=\"col-8\">\n                            <input type=\"number\" class=\"form-control form-control-sm\" min=\"1\" step=\"1\" max=\"15\" [(ngModel)]=\"spanWidth\" (ngModelChange)=\"onSpanWidthChange($event)\">\n                        </div>\n                    </div>\n                </div>\n            </p-accordionTab>\n            <p-accordionTab style=\"color:#495057\" header=\"Colors\">\n                <div #colorControls>\n                    <div class=\"form-group row\" title=\"Select a color scheme\">\n                        <div class=\"col-3\"><label>Color Scheme</label></div>\n                        <div class=\"col-9\">\n                            <p-selectButton [disabled]=\"selectedSeqType=='aa'\" [options]=\"colorSchemeOptions\" [(ngModel)]=\"this.widgets['alignView-colorSchemeName']\"\n                                (onChange)=\"onSelectedColorChanged()\"></p-selectButton>\n                        </div>\n                    </div>\n                    <div *ngIf=\"useCustomColorScheme && selectedSeqType!='aa'\" class=\"customColorSchemeSelection\">\n                        <div class=\"form-group row node-label-row\" title=\"Select a custom color for each NT\">\n                            <label>A:\n                                <input type=\"color\" class=\"form-control form-control-sm\" [ngModel]=\"this.widgets['alignView-customColorScheme']['A']\" (change)=\"updateColorScheme('A', $event)\">\n                            </label>\n                            <label>C: \n                                <input type=\"color\" class=\"form-control form-control-sm\" [ngModel]=\"this.widgets['alignView-customColorScheme']['C']\" (change)=\"updateColorScheme('C', $event)\">\n                            </label>\n                            <label>G: \n                                <input type=\"color\" class=\"form-control form-control-sm\" [ngModel]=\"this.widgets['alignView-customColorScheme']['G']\" (change)=\"updateColorScheme('G', $event)\">\n                            </label>\n                            <label>T: \n                                <input type=\"color\" class=\"form-control form-control-sm\" [ngModel]=\"this.widgets['alignView-customColorScheme']['T']\" (change)=\"updateColorScheme('T', $event)\">\n                            </label>\n                        </div>\n                        <div class=\"form-group row node-label-row\" title=\"Select a custom color for each NT\"> \n                            <label style=\"display: flex; align-items: center; gap:10px;\">Ambiguities/Other: \n                                <input type=\"color\" [ngModel]=\"this.widgets['alignView-customColorScheme']['ambig']\" (change)=\"updateColorScheme('ambig', $event)\">\n                            </label>\n                        </div>\n                    </div>\n                </div>\n            </p-accordionTab>\n        </p-accordion>\n    </p-dialog>\n</div>\n\n<p-dialog *ngIf=\"viewActive\" id=\"alignment-export-modal\" [(visible)]=\"ShowAlignExportPane\" appendTo=\"body\" header=\"Export Alignment View\">\n    <tabset class=\"tab-container tabbable-line\">\n        <tab heading=\"{{'Images' | localize}}\" [active]=\"true\" customClass=\"m-tabs__item\">\n            <div class=\"modal-dialog\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-body\" style='min-width: 400px; height: 100%;'>\n                        <div class=\"form-group row\">\n                            <div class=\"col-9\">\n                                <input type=\"text\" class=\"form-control form-control-sm\"\n                                    placeholder=\"Filename\" [(ngModel)]=\"AlignmentExportFileName\">\n                            </div>\n                            <div class=\"col-3\">\n                                <select [(ngModel)]=\"AlignmentExportFileTypeVis\" class=\"form-control form-control-sm\">\n                                    <option>svg</option>\n                                    <option>png</option>\n                                </select>\n                            </div>\n                        </div>\n                        <div *ngIf=\"AlignmentExportFileTypeVis=='png'\" class=\"form-group row\">\n                            <div class=\"col-4\" style=\"text-align: center;\">Resolution</div>\n                            <div class=\"col-8\" style=\"text-align: center;\">\n                                {{ spanWidth * longestSeqLength }} x {{ spanHeight * nodesWithSeq.length +140 }} px\n                            </div>\n                                <div style=\"width: 100%; text-align: center; margin-top: 5px;\"> Adjust Height and Width in settings to change export dimensions </div>\n                        </div>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-error\"\n                            (click)=\"ShowAlignExportPane = false\">Cancel</button>\n                        <button type=\"button\" class=\"btn btn-primary\" (click)=\"exportVisualization()\">Export</button>\n                    </div>\n                </div><!-- /.modal-content -->\n            </div><!-- /.modal-dialog -->\n        </tab>\n        <tab heading=\"{{'Data' | localize}}\" customClass=\"m-tabs__item\">\n            <div class=\"modal-dialog\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-body\" style='min-width: 400px; height: 100%;'>\n                        <div class=\"form-group row\">\n                            <div class=\"col-9\">\n                                <input type=\"text\" class=\"form-control form-control-sm\"\n                                    placeholder=\"Filename\" [(ngModel)]=\"AlignmentExportFileName\">\n                            </div>\n                            <div class=\"col-3\">\n                                <select [(ngModel)]=\"AlignmentExportFileTypeData\" class=\"form-control form-control-sm\">\n                                    <option>fasta</option>\n                                    <option>mega</option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class=\"form-group row\">\n                            <div class=\"col\">\n                                <div class=\"form-check form-check-inline\" title=\"Include consensus sequence based on most common NT at each position including gaps. Excludes ambiguous NTs\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"include-consensus\" #includeConsensus>\n                                    <label class=\"form-check-label\" for=\"include-consensus\">Include Consensus?</label>\n                                  </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-error\"\n                            (click)=\"ShowAlignExportPane = false\">Cancel</button>\n                        <button type=\"button\" class=\"btn btn-primary\" (click)=\"exportData(includeConsensus.checked)\">Export</button>\n                    </div>\n                </div><!-- /.modal-content -->\n            </div><!-- /.modal-dialog -->\n        </tab>\n        <tab heading=\"{{'DataTable' | localize}}\" customClass=\"m-tabs__item\">\n            <div class=\"modal-dialog\" role=\"document\">\n                <div class=\"modal-content\">\n                    <div class=\"modal-body\" style='min-width: 400px; height: 100%;'>\n                        <div class=\"form-group row\">\n                            <div class=\"col-9\">\n                                <input type=\"text\" class=\"form-control form-control-sm\"\n                                    placeholder=\"Filename\" [(ngModel)]=\"AlignmentExportFileName\">\n                            </div>\n                        </div>\n                        <div class=\"form-group row\">\n                            <div class=\"col\">\n                                <div class=\"form-check form-check-inline\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"include-consensus\" #includeConsensus2 title=\"Include consensus sequence based on most common NT at each position including gaps. Excludes ambiguous NTs\">\n                                    <label class=\"form-check-label\" for=\"include-consensus\">Include Consensus?</label>\n                                  </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"modal-footer\">\n                        <button type=\"button\" class=\"btn btn-error\"\n                            (click)=\"ShowAlignExportPane = false\">Cancel</button>\n                        <button type=\"button\" class=\"btn btn-primary\" (click)=\"exportDataTable('advanced', includeConsensus2.checked)\">Export</button>\n                    </div>\n                </div><!-- /.modal-content -->\n            </div><!-- /.modal-dialog -->\n        </tab>\n    </tabset>\n</p-dialog><!-- /.modal -->\n\n<p-dialog *ngIf=\"viewActive\" header=\"Excluded Nodes\" [(visible)]=\"showPopupMessage\" [style]=\"{ width: '35rem' }\">\n    <span class=\"text-surface-500 dark:text-surface-400 block mb-8\">The following nodes didn't contain a sequence and were omitted from Alignment View.</span>\n    <ol>\n        <li *ngFor=\"let node of nodesWithoutSeq\">Node index: {{ node.index }}, ID: {{ node.ID }} </li>\n    </ol>\n</p-dialog>\n";

/***/ }),

/***/ 34220:
/*!******************************************************************************************!*\
  !*** ./src/app/visualizationComponents/BubbleComponent/bubble.component.html?ngResource ***!
  \******************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"bubble-wrapper\">\n    <span #bubbleTooltip id=\"bubbleTooltip\" style=\"background-color: white;\"></span>\n    <div id=\"tool-btn-container\" class=\"m-portlet\">\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n          <a title=\"Open Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n        </span>\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n          <a title=\"Export Bubble Data\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n        </span>\n    </div>\n\n    <div #cyBubble id=\"cyBubble\" [style.width.px]=\"viewWidth\" [style.height.px]=\"viewHeight\"></div>\n\n    <p-dialog *ngIf=\"viewActive\" [(visible)]=\"settingsOpen\" header=\"Bubble Settings\" [contentStyle]=\"{'max-height': '70vh', 'width': '400px'}\" appendTo=\"body\">\n        <div class=\"form-group row\" title=\"\">\n            <div class=\"col-4\"><a>X</a></div>\n            <div class=\"col-8\">\n              <p-dropdown [options]=\"selectedFieldList\" [(ngModel)]=\"xVariable\" (ngModelChange)=\"onDataChange('X')\" appendTo=\"body\"></p-dropdown>\n            </div>\n        </div>\n        <div class=\"form-group row\" title=\"\">\n          <div class=\"col-4\"><a>Y</a></div>\n          <div class=\"col-8\">\n            <p-dropdown [options]=\"selectedFieldList\" [(ngModel)]=\"yVariable\" (ngModelChange)=\"onDataChange('Y')\" appendTo=\"body\"></p-dropdown>\n          </div>\n        </div>\n        <div class=\"form-group row node-label-row\" title=\"How big should the nodes be?\">\n          <div class=\"col-4\"><label>Size</label></div>\n          <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" min=\"10\" step=\"1\" max=\"40\" [(ngModel)]=\"nodeSize\" (change)=\"onNodeSizeChange()\"></div>\n        </div>\n        <div class=\"form-group row node-label-row\" title=\"How much space between nodes? This has no effect when nodes are collapsed.\">\n          <div class=\"col-4\"><label>Spacing</label></div>\n          <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" min=\".01\" step=\".01\" max=\".15\" [(ngModel)]=\"nodeSpacing\" (change)=\"onNodeSpacingChange()\"></div>\n        </div>\n        <div class=\"form-group row\">\n          <div class=\"col-4\">Collapse</div>\n          <div class=\"col-8\">\n              <p-selectButton [options]=\"NodeCollapsingTypes\" [(ngModel)]=\"SelectedNodeCollapsingTypeVariable\"\n                  (ngModelChange)=\"onNodeCollapsingChange()\"></p-selectButton>\n          </div>\n        </div>\n        <div class=\"form-group row\" title=\"\">\n            <div class=\"col-4\"><label>Node Color</label></div>\n            <button pButton type=\"button\" label=\"Show Colors\" class=\"ui-button-raised\" (click)=\"showGlobalSettings()\" [style]=\"{'margin-left': '15px', 'background-color': '#2196f3', 'border': '1px solid #2196f3'}\"></button>\n        </div>\n    </p-dialog>\n  \n    <p-dialog *ngIf=\"viewActive\" [(visible)]=\"exportOpen\" appendTo=\"body\" header=\"Export Bubble View\">\n      <div class=\"modal-dialog\" role=\"document\">\n          <div class=\"modal-content\">\n              <div class=\"modal-body\" style='min-width: 400px; height: 100%;'>\n                  <div class=\"form-group row\">\n                      <div class=\"col-9\">\n                          <input type=\"text\" class=\"form-control form-control-sm\" placeholder=\"Filename\" [(ngModel)]=\"BubbleExportFileName\">\n                      </div>\n                      <div class=\"col-3\">\n                          <select [(ngModel)]=\"BubbleExportFileType\" class=\"form-control form-control-sm\">\n                              <option>svg</option>\n                              <option>png</option>\n                          </select>\n                      </div>\n                  </div>\n                  <div [hidden]=\"BubbleExportFileType=='svg'\">\n                    <p-accordion>\n                        <p-accordionTab style=\"color:#495057\" header=\"Advanced\">\n                            <div id=\"network-export-advanced\">\n                                <div class=\"form-group row\">\n                                    <div class=\"col-3\">\n                                        <label for=\"network-export-scale\">Scale</label>\n                                    </div>\n                                    <div class=\"col-9\">\n                                        <input type=\"number\" class=\"form-control form-control-sm\" min=\"0\" max=\"2\" step=\"0.1\" [(ngModel)]=\"SelectedBubbleExportScaleVariable\" (ngModelChange)=\"updateCalculatedResolution()\">\n                                    </div>\n                                </div>\n                                <div class=\"form-group row\">\n                                    <div class=\"col-3\">Resolution</div>\n                                    <div id=\"network-export-dimensions\" class=\"col-9 text-right\">{{CalculatedResolution}}</div>\n                                </div>\n                            </div>\n                        </p-accordionTab>\n                    </p-accordion>\n                </div>\n              </div>\n              <div class=\"modal-footer\">\n                  <button type=\"button\" class=\"btn btn-error\" (click)=\"exportOpen = false\">Cancel</button>\n                  <button type=\"button\" class=\"btn btn-primary\" (click)=\"exportVisualization()\">Export</button>\n              </div>\n          </div><!-- /.modal-content -->\n      </div><!-- /.modal-dialog -->\n    </p-dialog><!-- /.modal -->\n\n</div>";

/***/ }),

/***/ 99800:
/*!*****************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/CrosstabComponent/crosstab-plugin.component.html?ngResource ***!
  \*****************************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"crosstab-wrapper\">\n  <div id=\"tool-btn-container\" class=\"m-portlet\">\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n      <a title=\"Open Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n    </span>\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n      <a title=\"Export Crosstab Data\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n    </span>\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n      <a title=\"Pivot Crosstab\" class=\"btn btn-clean btn-icon btn-icon-md\" style=\"float:left; padding: 2px 5px 3px 5px\" (click)=\"pivotCrosstab()\">\n        <svg fill=\"none\" width=\"20px\" height=\"20px\" viewBox=\"0 0 48 48\" xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n          <path d=\"M35.5 20 H20 V35.5\" stroke=\"#005DAA\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n          <path d=\"M15.5 31.5 L20 36 L24.5 31.5\" stroke=\"#005DAA\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n          <path d=\"M31.5 15.5 L36 20 L31.5 24.5\" stroke=\"#005DAA\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n          <path d=\"M10 4L10 44\" stroke=\"#005DAA\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\n          <path d=\"M4 10.0378L44 10\" stroke=\"#005DAA\" stroke-width=\"2\" stroke-linecap=\"round\"></path>\n        </svg>\n      </a>\n    </span>\n    <!--span style=\"overflow: visible; position: relative; width: 110px;\">\n      <a title=\"Pivot Crosstab\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"pivotCrosstab()\">\n        <svg width=\"14px\" height=\"14px\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path stroke=\"#005DAA\" d=\"M20.92,6.62a1,1,0,0,0-.21-.33l-3-3a1,1,0,0,0-1.42,1.42L17.59,6H9A3,3,0,0,0,6,9v8.59l-1.29-1.3a1,1,0,0,0-1.42,1.42l3,3a1,1,0,0,0,.33.21.94.94,0,0,0,.76,0,1,1,0,0,0,.33-.21l3-3a1,1,0,0,0-1.42-1.42L8,17.59V9A1,1,0,0,1,9,8h8.59l-1.3,1.29a1,1,0,0,0,0,1.42,1,1,0,0,0,1.42,0l3-3a1,1,0,0,0,.21-.33A1,1,0,0,0,20.92,6.62Z\"/>\n        </svg></a>\n    </span>\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n      <a title=\"Pivot Crosstab\" class=\"btn btn-clean btn-icon btn-icon-md\" style=\"float:left; padding: 2px 5px 3px 5px\" (click)=\"pivotCrosstab()\">\n        <svg fill=\"none\" width=\"20px\" height=\"20px\" viewBox=\"0 0 48 48\" xmlns=\"http://www.w3.org/2000/svg\">\n          <path d=\"M18.0088 34.0083H33.5005V18.0083\" stroke=\"#005DAA\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          <path d=\"M22.5 38.5L21 37L18 34L21 31L22.5 29.5\" stroke=\"#005DAA\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          <path d=\"M29 22.5L30.5 21L33.5 18L36.5 21L38 22.5\" stroke=\"#005DAA\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n          <path d=\"M10 4L10 44\" stroke=\"#005DAA\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n          <path d=\"M4 10.0378L44 10\" stroke=\"#005DAA\" stroke-width=\"2\" stroke-linecap=\"round\"/>\n        </svg>\n      </a>\n    </span-->\n  </div>\n\n  <div class=\"align-items-center\">\n    <div class=\"primeng-datatable-container\" style=\"justify-content: center; display: flex;\">\n      <p-table #dt *ngIf=\"SelectedTableData\" \n        [value]=\"SelectedTableData.data\"\n        [columns]=\"SelectedTableData.tableColumns\"\n        [resizableColumns]=\"true\"\n        [styleClass]=\"selectedSize\"\n        [scrollable]=\"true\"\n        [scrollHeight]=\"scrollHeight\"\n        [tableStyle]=\"tableStyleCrosstab\"\n        ScrollWidth=\"100%\">\n        <ng-template pTemplate=\"caption\">\n          <div style=\"display: flex; justify-content: center; font-weight: bold; font-size:large;\">{{ formatTableTitle() }}</div>\n        </ng-template>\n        <ng-template pTemplate=\"header\" let-columns>\n          <tr>\n            <th *ngFor=\"let col of SelectedTableData.tableColumns\" pSortableColumn=\"{{col.field}}\" pReorderableColumn>\n              {{ col.header}} <p-sortIcon field=\"{{col.field}}\"></p-sortIcon>\n            </th>\n          </tr>\n        </ng-template>\n        <ng-template pTemplate=\"body\" let-rowData let-column=\"SelectedTableData.tableColumns\">\n          <tr>\n            <td *ngFor=\"let col of SelectedTableData.tableColumns\">\n              {{ rowData[col.field] }}\n            </td>\n          </tr>\n        </ng-template>\n        <ng-template pTemplate=\"footer\">\n          <tr>\n            <td *ngFor=\"let col of SelectedTableData.tableColumns\">\n              {{ totalRow[col.field] }}\n            </td>\n          </tr>\n        </ng-template>\n      </p-table>\n    </div>\n  </div>\n\n  <p-dialog *ngIf=\"viewActive\" id=\"crosstab-settings-pane\" [(visible)]=\"settingsOpen\"\n    header=\"Crosstab Settings\" [contentStyle]=\"{'max-height': '70vh', 'width': '400px'}\" appendTo=\"body\">\n    <div class=\"form-group row\" title=\"\">\n      <div class=\"col-3\"><a>X</a></div>\n      <div class=\"col-9\">\n        <p-dropdown [options]=\"fieldList\" [(ngModel)]=\"xVariable\" (ngModelChange)=\"onDataChange()\" appendTo=\"body\"></p-dropdown>\n      </div>\n    </div>\n    <div class=\"form-group row\" title=\"\">\n      <div class=\"col-3\"><a>Y</a></div>\n      <div class=\"col-9\">\n        <p-dropdown [options]=\"fieldList\" [(ngModel)]=\"yVariable\" (ngModelChange)=\"onDataChange()\" appendTo=\"body\"></p-dropdown>\n      </div>\n    </div>\n    <div class=\"form-group row\" title=\"Show raw counts or proportion of total?\">\n      <div class=\"col-3\"><label>Show</label></div>\n      <div class=\"col-9\">\n        <p-selectButton [options]=\"showOptions\" [(ngModel)]=\"widgets['crosstab-useProportion']\" [multiple]=\"false\" (onChange)=\"useProportionChanged()\"></p-selectButton>\n      </div>\n    </div>\n    <div class=\"form-group row\" title=\"What size would you like the Table's font to be?\">\n      <div class=\"col-3\"><label for=\"table-font-size\">Size</label></div>\n      <div class=\"col-9\">\n        <p-selectButton [options]=\"sizes\" [(ngModel)]=\"selectedSize\" [multiple]=\"false\" optionLabel=\"name\" optionValue=\"class\" (onChange)=\"onTableSizeChange()\"></p-selectButton>\n      </div>\n    </div>\n  </p-dialog>\n\n  <p-dialog *ngIf=\"viewActive\" [(visible)]=\"exportOpen\" header=\"Export Crosstab\" appendTo=\"body\">\n    <div class=\"modal-dialog\" role=\"document\">\n      <div class=\"modal-content\">\n        <div class=\"modal-body\" style='width: 400px; height: 100%;'>\n          <div class=\"form-group row\">\n            <div class=\"col-8\">\n              <input type=\"text\" style=\"height:42px\" class=\"form-control form-control-sm\" placeholder=\"Filename\" [(ngModel)]=\"SelectedCrossTabExportFilename\">\n            </div>\n            <div class=\"col-4\">\n              <p-dropdown [options]=\"CrossTabExportFileTypeList\" [(ngModel)]=\"SelectedCrossTabExportFileType\" appendTo=\"body\"></p-dropdown>\n            </div>\n          </div>\n        </div>\n        <div class=\"modal-footer\">\n            <button type=\"button\" class=\"btn btn-error\" (click)=\"exportOpen = !exportOpen\">Cancel</button>\n            <button type=\"button\" class=\"btn btn-primary\" (click)=\"exportVisualization()\">Export</button>\n        </div>\n      </div><!-- /.modal-dialog -->\n    </div>\n  </p-dialog><!-- /.modal -->\n</div>";

/***/ }),

/***/ 33215:
/*!**********************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/GanttComponent/gantt-chart/gantt-chart.component.html?ngResource ***!
  \**********************************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<svg [attr.width]=\"width\" [attr.height]=\"height\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" >\n<pattern [attr.id]=\"gridID\" \n[attr.x]=\"ganttChartService.xPadding + 150\" [attr.y]=\"ganttChartService.yPadding\" \n[attr.width]=\"gridWidthX\" [attr.height]=\"gridWidthY\" \npatternUnits=\"userSpaceOnUse\">\n    <path [attr.d]=\"gridPath\" fill=\"none\" stroke=\"#444444\" stroke-width=\"0.5\" />\n</pattern>\n\n<rect [attr.x]=\"ganttChartService.xPadding + 150\" \n[attr.y]=\"ganttChartService.yPadding\" \n[attr.width]=\"ganttChartService.rectWidth\" \n[attr.height]=\"ganttChartService.rectHeight\" \nstroke=\"#444444\" [attr.fill]=\"'url(#' + gridID + ')'\" stroke-width=\"1\"/>\n\n<g *ngFor=\"let x of xAxis\" [ngStyle]=\"{'transform': x.transform}\">\n<text class=\"x-axis-text small\" text-anchor=\"end\" dominant-baseline=\"middle\" [textContent]=\"x.value\">{{x.value}}</text>\n</g>\n\n<text\n*ngFor=\"let y of yAxis\" class=\"y-axis-text small\" text-anchor=\"end\"\n[attr.y]=\"y.yPos\" [attr.x]=\"150+ganttChartService.xPadding-30\" [textContent]=\"y.value\">{{y.value}}</text>\n\n\n<!-- Legion -->\n<rect [attr.x]=\"ganttChartService.xPadding + 150\" \n[attr.y]=\"ganttChartService.yPadding * 2 + 100 + ganttChartService.rectHeight\" \n[attr.width]=\"ganttChartService.legionWidth\" \n[attr.height]=\"ganttChartService.legionHeight\" \nfill=\"#f1f1f1\" />\n\n\n<g *ngFor=\"let legionLine of ganttChartService.legion; index as i\">\n  <g *ngFor=\"let legionEntry of legionLine; index as j\">\n      <rect *ngIf=\"ganttChartService.legionWidth\" \n      [attr.x]=\"ganttChartService.xPadding + 150 + ganttChartService.legionWidth / 3 * 0.1 + ganttChartService.legionWidth / 3 * j\" \n      [attr.y]=\"ganttChartService.yPadding * 2 + 100 + ganttChartService.rectHeight + 20 + 40*i + 10\" \n      [attr.width]=\"ganttChartService.legionWidth / 3 * 0.2\" \n      [attr.height]=\"20\" \n      rx=\"6\" ry=\"6\"\n      [attr.fill]=\"legionEntry.color\" />\n\n      <!-- <path class=\"legion-line\" [attr.d]=\"computeLegionPath(i)\" fill=\"none\" [attr.stroke]=\"x.color\" /> -->\n      <text class=\"axis-text\" dominant-baseline=\"middle\"\n      [attr.x]=\"ganttChartService.xPadding + 150 + ganttChartService.legionWidth / 3 * j + ganttChartService.legionWidth / 3 * 0.4\" \n      [attr.y]=\"ganttChartService.yPadding * 2 + 100 + ganttChartService.rectHeight + 20 + 40*i + 20\" class=\"small\"> {{ legionEntry.name }} </text>\n  </g>\n</g>\n  <g *ngFor=\"let phase of ganttChartService.ganttPhases; index as i\">\n    <g id=\"component\" *ngFor=\"let ganttEntry of phaseTimelines[phase]; index as j\">\n        <rect class=\"gantt-entry\"\n        [attr.x]=\"xPadding + 150 + ganttChartService.transformGanttDate(ganttEntry.from)\" \n        [attr.y]=\"i * 60 + yPadding + 20\" \n        [attr.width]=\"getWidth(ganttEntry)\"\n        [attr.height]=\"20\" \n        rx=\"6\" ry=\"6\"\n        [attr.fill]=\"ganttEntry.color\"\n        opacity=\"{{ganttEntry.opacity}}\" />\n\n        <!-- [attr.x]=\"x + 150 + ganttChartService.transformGanttDate(ganttEntry.from)\" \n        [attr.y]=\"i * 60 + y + 20\"  -->\n        <g class=\"tooltip\" [ngStyle]=\"{\n          'transform': 'translate(' + (xPadding + 150 + ganttChartService.transformGanttDate(ganttEntry.to) - ((ganttChartService.transformGanttDate(ganttEntry.to) - ganttChartService.transformGanttDate(ganttEntry.from)) / 2)) + 'px, ' + (i * 60 + yPadding - 5) + 'px)',\n          'display': ganttEntry.toolTip}\" \n        opacity=\"0.9\">\n          <rect rx=\"5\" width=\"200\" height=\"25\"></rect>\n          <text x=\"15\" y=\"16\">{{ ganttEntry.info }}</text>\n          </g>\n    </g>\n  </g>\n</svg>";

/***/ }),

/***/ 90020:
/*!***********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/GanttComponent/gantt-plugin.component.html?ngResource ***!
  \***********************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"m-content\">\n    <div id=\"tool-btn-container\" class=\"m-portlet\">\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n            <a title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\"\n                (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n        </span>\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n            <a title=\"Export Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\"\n                (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n        </span>\n    </div>\n    <div class=\"m-portlet__body\" style=\"height: 100%; overflow: scroll\">\n        <br />\n        <div className=\"gantt-plugin\" id=\"gantt\" ngShow=\"dataAvail()\" style=\"cursor: grab;\">\n            <ngx-gantt-chart [data]=\"ganttChartData\"></ngx-gantt-chart>\n        </div>\n    </div>\n</div>\n<div class=\"view-controls\">\n\n    <p-dialog *ngIf=\"viewActive\" id=\"gantt-settings-pane\" [positionLeft]=\"GanttSettingsDialogSettings.left\"\n        [positionTop]=\"GanttSettingsDialogSettings.top\" [(visible)]=\"GanttSettingsDialogSettings.isVisible\"\n        [contentStyle]=\"{'overflow': 'visible'}\" header=\"Gantt Settings\" appendTo=\"body\">\n        <tabset class=\"tab-container tabbable-line\">\n            <tab heading=\"{{'Gantt Entry' | localize}}\" [active]=\"true\" customClass=\"m-tabs__item\">\n                <p-accordion [multiple]=\"true\" [activeIndex]=\"[0]\">\n                    <p-accordionTab style=\"color:#495057\" header=\"New Entry\" [active]=\"true\">\n                        <div #entrycontrols>\n                            <div class=\"form-group row entry-name-row\" title=\"What is the name of the entry?\"\n                                style=\"overflow:visible\">\n                                <div class=\"col-4\"><label for=\"entry-name\">Gantt Entry Name</label></div>\n                                <div class=\"col-8\">\n                                    <input type=\"text\" id=\"entry-name\" class=\"form-control form-control-sm\"\n                                        placeholder=\"Entry Name\" [(ngModel)]=\"GanttEntryName\">\n                                </div>\n                            </div>\n                            <div class=\"form-group row gantt-start-row\" title=\"What field is the start date?\"\n                                style=\"overflow:visible\">\n                                <div class=\"col-4\"><label for=\"gantt-start\">Start Date</label></div>\n                                <div class=\"col-8\">\n                                    <p-dropdown id=\"gantt-start\" appendTo=\"body\" [options]=\"FieldList\"\n                                        [(ngModel)]=\"GanttStartVariable\"> </p-dropdown>\n                                </div>\n                            </div>\n                            <div class=\"form-group row gantt-end-row\" title=\"What field is the end date?\"\n                                style=\"overflow:visible\">\n                                <div class=\"col-4\"><label for=\"gantt-end\">End Date</label></div>\n                                <div class=\"col-8\">\n                                    <p-dropdown id=\"gantt-end\" appendTo=\"body\" [options]=\"FieldList\"\n                                        [(ngModel)]=\"GanttEndVariable\"> </p-dropdown>\n                                </div>\n                            </div>\n                            <div class=\"form-group row gantt-color-row\" title=\"What color should the entry be?\"\n                                style=\"overflow:visible\">\n                                <div class=\"col-4\"><label for=\"gantt-color\">Color</label></div>\n                                <div class=\"col-8\">\n                                    <input type=\"color\" id=\"gantt-color\" [(ngModel)]=\"GanttEntryColor\">\n                                </div>\n                            </div>\n                            <div class=\"form-group row gantt-submit-row\" style=\"overflow:visible\">\n                                <div class=\"col-4\"></div>\n                                <div class=\"col-8\">\n                                    <button type=\"button\" class=\"btn btn-primary\" (click)=\"createGanttEntry()\">Create\n                                        Entry</button>\n                                </div>\n                            </div>\n                        </div>\n                        <p-table [value]=\"ganttEntries\" styleClass=\"p-datatable-striped\" *ngIf=\"ganttEntries.length > 0\">\n                            <ng-template pTemplate=\"header\">\n                                <tr>\n                                    <th class='p-1 table-header-row'>Name</th>\n                                    <th class='p-1 table-header-row'>Start</th>\n                                    <th class='p-1 table-header-row'>End</th>\n                                    <th class='p-1 table-header-row'>Color</th>\n                                </tr>\n                            </ng-template>\n                            <ng-template pTemplate=\"body\" let-rowData>\n                                <tr>\n                                    <td>{{ rowData.entryName }}</td>\n                                    <td>{{ rowData.startDate }}</td>\n                                    <td>{{ rowData.endDate }}</td>\n                                    <td><input type=\"color\" value=\"{{ rowData.color }}\" (change)=\"updateEntryColor(rowData.entryName, $event)\"></td>\n                                    <td>\n                                        <a title=\"Remove\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"removeGanttEntry(rowData.entryName)\">\n                                            <span class=\"material-icons\"> delete_outline </span>\n                                        </a>\n                                    </td>\n                                </tr>\n                            </ng-template>\n\n                        </p-table>\n                    </p-accordionTab>\n                </p-accordion>\n            </tab>\n        </tabset>\n    </p-dialog>\n</div>\n\n<p-dialog *ngIf=\"viewActive\" id=\"network-export-modal\" [(visible)]=\"ShowGanttExportPane\"\n    header=\"Export Gantt Chart\" class=\"dialogSize\" (onHide)=\"onCloseExport()\" appendTo=\"body\">\n    <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-body\" style='min-width: 500px; height: 100%;'>\n                <div class=\"form-group row\">\n                    <div class=\"col-8\">\n                        <input type=\"text\" id=\"gantt-image-filename\" class=\"form-control form-control-sm\"\n                            placeholder=\"Image Filename\" [(ngModel)]=\"SelectedGanttChartImageFilenameVariable\">\n                    </div>\n                    <div class=\"col-3\">\n                        <p-dropdown id=\"network-export-filetype\" [options]=\"NetworkExportFileTypeList\"\n                            [(ngModel)]=\"SelectedNetworkExportFileTypeListVariable\"></p-dropdown>\n                    </div>\n                    <div class=\"col-8\">\n                        <button type=\"button\" id=\"export-tree\" class=\"btn btn-primary\"\n                            (click)=\"saveImage($event)\">Save Image</button>\n                    </div>\n                </div>\n            </div>\n            <div class=\"modal-footer\">\n            </div>\n        </div><!-- /.modal-content -->\n    </div><!-- /.modal-dialog -->\n</p-dialog><!-- /.modal -->";

/***/ }),

/***/ 2124:
/*!********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/HeatmapComponent/heatmap.component.html?ngResource ***!
  \********************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"m-content\">\n    <div id=\"tool-btn-container\" class=\"m-portlet\">\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n            <a title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\"\n                (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n        </span>\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n            <a title=\"Export Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\"\n                (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n        </span>\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n            <a title=\"Center Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\"\n                (click)=\"openCenter()\"><i class=\"flaticon-eye primary\"></i></a>\n        </span>\n        <span atyle=\"font-size: 1.25rem; padding-left: 15px; padding-top: 10px;\">Current Distance Metric: {{this.heatmapMetric}}</span>\n    </div>\n    <div class=\"m-portlet__body\" style=\"height: 100%; overflow: scroll\">\n        <br />\n        <div #heatmapContainer id=\"heatmap\">\n        </div>\n    </div>\n</div>\n\n<div class=\"view-controls\">\n    <p-dialog *ngIf=\"viewActive\" id=\"heatmap-settings-pane\" \n              [positionLeft]=\"HeatmapSettingsDialogSettings.left\" \n              [positionTop]=\"HeatmapSettingsDialogSettings.top\" \n              [(visible)]=\"HeatmapSettingsDialogSettings.isVisible\"  \n              [contentStyle]=\"{'overflow': 'visible'}\"\n              [style]=\"{'width': '20vw'}\"\n              header=\"Heatmap Settings\" appendTo=\"body\"\n              >\n              <tabset class=\"tab-container tabbable-line\">\n              <tab heading=\"{{'Heatmap' | localize}}\" [active]=\"true\" customClass=\"m-tabs__item\">\n              <p-accordion [multiple]='true'>\n                  <p-accordionTab style=\"color:#495057\" header=\"Invert\" [selected]=\"true\">\n                      <div>\n                          <div class=\"form-group row invert-x-axis-row\" title=\"Should X Axis be Inverted?\" style=\"overflow:visible\">\n                              <div class=\"col-6\"><label for=\"x-invert\">Invert X Axis</label></div>\n                              <div class=\"col-6\">\n                                  <p-selectButton id=\"x-invert\" [options]=\"invertOptions\" [(ngModel)]=\"invertX\" (ngModelChange)=\"updateInvertX($event)\"></p-selectButton>\n                              </div>\n                          </div>\n                          <div class=\"form-group row invert-y-axis-row\" title=\"Should Y Axis be Inverted?\" style=\"overflow:visible\">\n                              <div class=\"col-6\"><label for=\"y-invert\">Invert Y Axis</label></div>\n                              <div class=\"col-6\">\n                                  <p-selectButton id=\"y-invert\" [options]=\"invertOptions\" [(ngModel)]=\"invertY\" (ngModelChange)=\"updateInvertY($event)\"></p-selectButton>\n                              </div>\n                          </div>\n                      </div>\n                  </p-accordionTab>\n                  <p-accordionTab style=\"color:#495057\" header=\"Color\" [selected]=\"true\">\n                      <div>\n                        <div class=\"form-group row gantt-color-row\" title=\"What Should be the low color?\" style=\"overflow:visible\">\n                            <div class=\"col-6\"><label for=\"low-color\">Low Color</label></div>\n                            <div class=\"col-6\">\n                                <input type=\"color\" id=\"low-color\" [(ngModel)]=\"loColor\" (ngModelChange)=\"updateLoColor($event)\">\n                            </div>\n                        </div>\n                        <div class=\"form-group row gantt-color-row\" title=\"What Should be the medium color?\" style=\"overflow:visible\">\n                            <div class=\"col-6\"><label for=\"med-color\">Medium Color</label></div>\n                            <div class=\"col-6\">\n                                <input type=\"color\" id=\"med-color\" [(ngModel)]=\"medColor\" (ngModelChange)=\"updateMedColor($event)\">\n                            </div>\n                        </div>\n                        <div class=\"form-group row gantt-color-row\" title=\"What Should be the high color?\" style=\"overflow:visible\">\n                            <div class=\"col-6\"><label for=\"hi-color\">High Color</label></div>\n                            <div class=\"col-6\">\n                                <input type=\"color\" id=\"hi-color\" [(ngModel)]=\"hiColor\" (ngModelChange)=\"updateHiColor($event)\">\n                            </div>\n                        </div>\n                      </div>\n                  </p-accordionTab>\n                  <p-accordionTab style=\"color:#495057\" header=\"Labels\" [selected]=\"true\">\n                      <div>\n                          <div class=\"form-group row label-visible-row\" title=\"Should Labels be Displayed?\" style=\"overflow:visible\">\n                              <div class=\"col-6\"><label for=\"show-labels\">Show Labels</label></div>\n                              <div class=\"col-6\">\n                                  <p-selectButton id=\"show-labels\" [options]=\"invertOptions\" [(ngModel)]=\"heatmapShowLabels\" (ngModelChange)=\"redrawHeatmap()\"></p-selectButton>\n                              </div>\n                          </div>\n                      </div>\n                  </p-accordionTab>\n              </p-accordion>\n              </tab>\n\n              </tabset>\n    </p-dialog>\n</div>\n\n<p-dialog *ngIf=\"viewActive\" id=\"network-export-modal\" [(visible)]=\"ShowHeatmapExportPane\"\n    header=\"Export Heatmap\" class=\"dialogSize\" appendTo=\"body\">\n    <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-body\" style='min-width: 500px; height: 100%;'>\n                <div class=\"form-group row\">\n                    <div class=\"col-8\">\n                        <input type=\"text\" id=\"tree-image-filename\" class=\"form-control form-control-sm\"\n                            placeholder=\"Image Filename\" [(ngModel)]=\"SelectedImageFilenameVariable\">\n                    </div>\n                    <div class=\"col-3\">\n                        <p-dropdown id=\"network-export-filetype\" [options]=\"NetworkExportFileTypeList\"\n                            [(ngModel)]=\"SelectedNetworkExportFileTypeVariable\"></p-dropdown>\n                    </div>\n                    <div class=\"col-8\">\n                        <button type=\"button\" id=\"export-tree\" class=\"btn btn-primary\"\n                            (click)=\"saveImage()\">Save Image</button>\n                    </div>\n                </div>\n                <div class=\"form-group row\">\n                    <div class=\"col-8\">\n                        <input type=\"text\" id=\"distance-matrix-filename\" class=\"form-control form-control-sm\"\n                            placeholder=\"Distance Matrix Filename\" [(ngModel)]=\"SelectedDistanceMatrixFilenameVariable\">\n                    </div>\n                    <div class=\"col-8\">\n                        <button type=\"button\" id=\"export-distance-matrix\" class=\"btn btn-primary\"\n                            (click)=\"saveDistanceMatrix()\">Save Distance Matrix</button>\n                    </div>\n                </div>\n            </div>\n            <div class=\"modal-footer\">\n            </div>\n        </div><!-- /.modal-content -->\n    </div><!-- /.modal-dialog -->\n</p-dialog><!-- /.modal -->";

/***/ }),

/***/ 17652:
/*!*******************************************************************************************!*\
  !*** ./src/app/visualizationComponents/MapComponent/map-plugin.component.html?ngResource ***!
  \*******************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<!--<div id=\"map\" [ngStyle]=\"svgStyle\"></div>-->\n<!--<p-gmap #gmap [options]=\"options\" [overlays]=\"overlays\"  [style]=\"{'width':'100%','height':'600px'}\" (onMapReady)=\"setMap($event)\"></p-gmap>-->\n\n<!-- <ng-container *ngIf=\"SelectedGeospatialTypeVariable === 'On'\">\n    <br/> -->\n    <!-- <h4>Range <p-calendar [(ngModel)]=\"dateFilterRangeDates\" selectionMode=\"range\" [readonlyInput]=\"true\"></p-calendar></h4> -->\n    <!--<h4>Range: {{dateFilterRangeDates[0] | date: 'shortDate'}} - {{dateFilterRangeDates[1] | date: 'shortDate'}}</h4> -->\n    <!-- <h4>Range: {{dateFilterRangeValues[0] + ' - ' + dateFilterRangeValues[1]}}</h4> -->\n    <!--<p-slider [(ngModel)]=\"dateFilterRangeValues\" [style]=\"{'width':'100%'}\" [range]=\"true\" [min]=\"0\" [max]=\"dateFilterRangeMax\" (onSlideEnd)=\"onDateFilterChange($event)\"></p-slider>\n</ng-container> -->\n\n\n<div class=\"OSM-credit\">Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, under <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a>. Data by <a href=\"http://openstreetmap.org\">OpenStreetMap</a>, under <a href=\"http://www.openstreetmap.org/copyright\">ODbL</a>.</div>\n\n<div id=\"tool-btn-container\" class=\"m-portlet\">\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n        <a title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n    </span>\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n        <a title=\"Export Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n    </span>\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n        <a title=\"Center Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openCenter()\"><i class=\"flaticon-eye primary\"></i></a>\n    </span>\n</div>\n<div #mapContainer class=\"map-container\">\n    <!-- <div #gmap style=\"width:100%;height:600px\"></div> -->\n    <ng-container *ngIf=\"leafletInitialOptions\">\n        <div class=\"mapStyle\" leaflet [leafletOptions]=\"leafletInitialOptions\" (leafletMapReady)=\"onMapReady($event)\"\n            [leafletMarkerCluster]=\"leafletMarkers\" [leafletMarkerClusterOptions]=\"leafletMarkerClusterOptions\"\n            (leafletMarkerClusterReady)=\"onMarkerClusterReady($event)\">\n        </div>\n    </ng-container>\n</div>\n\n<div class=\"row\">\n    <div class=\"col-md-4\">\n        <h2 *ngIf=\"isExporting && commonService.session.style.widgets['node-color-variable'] != 'None'\"\n            class=\"bottom-table\">\n            Node Colors\n        </h2>\n        <table id=\"node-color-table-bottom-map\" class=\"bottom-table\"></table>\n    </div>\n    <div class=\"col-md-4\">\n        <h2 *ngIf=\"isExporting && commonService.session.style.widgets['link-color-variable'] != 'None'\"\n            class=\"bottom-table\">\n            Link Colors\n        </h2>\n        <table id=\"link-color-table-bottom-map\" class=\"bottom-table\"></table>\n    </div>\n</div>\n\n<div class=\"m-content\" *ngIf=\"IsDataAvailable == false\">\n    <div id=\"file-panel\" class=\"container-fluid\" style=\"height:500px;\">\n        <div id=\"file-prompt\" class=\"d-flex justify-content-center\">\n            <h1><b>Please add data files to load...</b></h1>\n            <br />\n        </div>\n    </div>\n</div>\n\n\n<p-dialog *ngIf=\"viewActive\" id=\"map-settings-pane\" [position]=\"NodeMapSettingsExportDialogSettings.mapRight\" [(visible)]=\"NodeMapSettingsExportDialogSettings.isVisible\"\n    header=\"Geospatial Settings\" [contentStyle]=\"{'max-height': '70vh'}\" appendTo=\"body\">\n    <tabset class=\"tab-container tabbable-line\">\n        <tab heading=\"{{'Data' | localize}}\" customClass=\"m-tabs__item\">\n            <!-- <div class=\"form-group row\">\n                <div class=\"col-4\">Geospatial</div>\n                <div class=\"col-8\">\n                    <p-selectButton [options]=\"GeospatialTypes\" [(ngModel)]=\"SelectedGeospatialTypeVariable\"\n                        (ngModelChange)=\"onGeospatialTypeChange($event)\"></p-selectButton>\n                </div>\n            </div> -->\n\n            <ng-container *ngIf=\"SelectedGeospatialTypeVariable === 'Off'\">\n\n                <div class=\"row\">\n                    <div class=\"col-12\">\n                        <div class=\"alert alert-info alert-dismissible\" role=\"alert\">\n                            Please select the most precise geographic data your inputs have.\n                            <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n                                <span aria-hidden=\"true\">&times;</span>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"form-group row\" title=\"If your data have a latitude variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>Latitude</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-lat\" [options]=\"FieldList\" [(ngModel)]=\"SelectedLatitude\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>\n                <div class=\"form-group row\" title=\"If your data have a longitude variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>Longitude</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-lon\" [options]=\"FieldList\" [(ngModel)]=\"SelectedLongitude\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>\n                <div class=\"form-group row\" title=\"If your data have a Census Tract variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>Census Tract</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-tract\" [options]=\"FieldList\" [(ngModel)]=\"SelectedCensusTract\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>\n                <div class=\"form-group row\" title=\"If your data have a zipcode variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>Zipcode</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-zipcode\" [options]=\"FieldList\" [(ngModel)]=\"SelectedZipCode\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>\n                <div class=\"form-group row\" title=\"If your data have a County variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>County</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-county\" [options]=\"FieldList\" [(ngModel)]=\"SelectedCounty\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>\n                <div class=\"form-group row\" title=\"If your data have a (US) State variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>State</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-state\" [options]=\"FieldList\" [(ngModel)]=\"SelectedState\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>\n                <div class=\"form-group row\" title=\"If your data have a Country variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>Country</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-country\" [options]=\"FieldList\" [(ngModel)]=\"SelectedCountry\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>\n            </ng-container>\n            <ng-container *ngIf=\"SelectedGeospatialTypeVariable === 'On'\">\n                <p>&#11044;  -  Residence Address</p>\n                <p>&#9650;  -  Venue Address</p>\n                <p>&#9632;  -  Exposure Address</p>\n                <!-- <div class=\"form-group row\" title=\"If your data have a Residence Address variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>Residence Address &#11044;</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-country\" [options]=\"FieldList\" [(ngModel)]=\"SelectedResidenceAddress\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div> \n\n                <div class=\"form-group row\" title=\"If your data have a Venue Address variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>Venue Address &#9650;</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-country\" [options]=\"FieldList\" [(ngModel)]=\"SelectedVenueAddress\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>\n\n                <div class=\"form-group row\" title=\"If your data have a Exposure Address variable, select that here.\">\n                    <div class=\"col-4\">\n                        <a>Exposure Address &#9632;</a>\n                    </div>\n                    <div class=\"col-8\">\n                        <p-dropdown id=\"map-field-country\" [options]=\"FieldList\" [(ngModel)]=\"SelectedExposureAddress\"\n                            (ngModelChange)=\"onDataChange($event)\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>-->\n            </ng-container>\n\n        </tab>\n        <tab heading=\"{{'Components' | localize}}\" customClass=\"m-tabs__item\">\n\n            <p-accordion>\n                <p-accordionTab style=\"color:#495057\" header=\"Network\">\n                    <div class=\"form-group row\" title=\"Would you like to see Nodes on the map?\">\n                        <div class=\"col-4\">Nodes</div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"NodesTypes\" id=\"map-node-show-hide\"\n                                [(ngModel)]=\"SelectedNodesTypeVariable\"\n                                (ngModelChange)=\"onMapNodeShowHideChange($event)\"></p-selectButton>\n                        </div>\n                    </div>\n                    <div class=\"form-group row\" title=\"Would you like to see links on the map?\">\n                        <div class=\"col-4\">Links</div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"LinksTypes\" id=\"map-link-show-hide\"\n                                [(ngModel)]=\"SelectedLinksTypeVariable\"\n                                (ngModelChange)=\"onMapLinksShowHideChange($event)\"></p-selectButton>\n                        </div>\n                    </div>\n                </p-accordionTab>\n                <p-accordionTab style=\"color:#495057\" header=\"Offline\">\n                    <div class=\"form-group row\" title=\"Would you like to see Countries on the map?\">\n                        <div class=\"col-4\">Countries</div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"CountriesTypes\" id=\"map-countries-show-hide\"\n                                [(ngModel)]=\"SelectedCountriesTypeVariable\"\n                                (ngModelChange)=\"onCountriesShowHidChange($event)\"></p-selectButton>\n                        </div>\n                    </div>\n                    <div class=\"form-group row\" title=\"Would you like to see (US) States on the map?\">\n                        <div class=\"col-4\">States</div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"StatesTypes\" id=\"map-states-show-hide\"\n                                [(ngModel)]=\"SelectedStatesTypeVariable\"\n                                (ngModelChange)=\"onStatesShowHideChange($event)\"></p-selectButton>\n                        </div>\n                    </div>\n                    <div class=\"form-group row\" title=\"Would you like to see (US) Counties on the map?\">\n                        <div class=\"col-4\">Counties</div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"CountiesTypes\" id=\"map-counties-show-hide\"\n                                [(ngModel)]=\"SelectedCountiesTypeVariable\"\n                                (ngModelChange)=\"onCountiesShowHideChange($event)\"></p-selectButton>\n                        </div>\n                    </div>\n                </p-accordionTab>\n                <p-accordionTab style=\"color:#495057\" header=\"Online\">\n                    <div class=\"row\">\n                        <div class=\"col-12\">\n                            <div class=\"alert alert-warning alert-dismissible\" role=\"alert\">\n                                Enabling any of the layers below will download tiles from the Internet. <!--a\n                                    href=\"https://github.com/CDCgov/MicrobeTrace/wiki/Tile-Maps\" target=\"_blank\">Read More.</a-->\n                                <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\">\n                                    <span aria-hidden=\"true\">&times;</span>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                    <div id=\"baseRow\" class=\"form-group row ifOnline\" title=\"Would you like to use a Tile Basemap?\">\n                        <div class=\"col-4\">Basemap</div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"BasemapTypes\" id=\"map-basemap-show-hide\"\n                                [(ngModel)]=\"SelectedBasemapTypeVariable\" (ngModelChange)=\"onBasemapChange($event)\">\n                            </p-selectButton>\n                        </div>\n                    </div>\n                    <div class=\"form-group row ifOnline\" title=\"Would you like to use a Satellite layer?\">\n                        <div class=\"col-4\">Satellite</div>\n                        <div class=\"col-8\">\n                            <p-selectButton [options]=\"SatelliteTypes\" id=\"map-satellite-show-hide\"\n                                [(ngModel)]=\"SelectedSatelliteTypeVariable\" (ngModelChange)=\"onSatelliteChange($event)\">\n                            </p-selectButton>\n                        </div>\n                    </div>\n                </p-accordionTab>\n            </p-accordion>\n\n        </tab>\n        <tab heading=\"{{'Nodes' | localize}}\" customClass=\"m-tabs__item\">\n\n            <div class=\"form-group row\">\n                <div class=\"col-4\">Color</div>\n                <div class=\"col-8\"><button class=\"btn btn-sm btn-light w-100 launch-color-options\"\n                        (click)=\"displayColorOptions()\">Color Options</button></div>\n            </div>\n            <div class=\"form-group row\">\n                <div class=\"col-4\">Collapsing</div>\n                <div class=\"col-8\">\n                    <p-selectButton [options]=\"NodeCollapsingTypes\" [(ngModel)]=\"SelectedNodeCollapsingTypeVariable\"\n                        (ngModelChange)=\"onNodeCollapsingChange($event)\"></p-selectButton>\n                </div>\n            </div>\n            <div class=\"form-group row\" title=\"How transparent would you like the nodes to be?\">\n                <div class=\"col-4\"><label for=\"map-node-transparency\">Transparency</label></div>\n                <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"map-node-transparency\" min=\"0.00\"\n                        max=\"1.00\" step=\"0.01\" value=\"0.00\" [(ngModel)]=\"SelectedNodeTransparencyVariable\"\n                        (ngModelChange)=\"onNodeTransparencyChange($event)\"></div>\n            </div>\n            <div class=\"form-group row\" title=\"How much randomness do you want to add to node locations?\">\n                <div class=\"col-4\">\n                    <label for=\"map-node-jitter\">Jitter</label>\n                    <button id=\"map-node-jitter-reroll\" class=\"btn btn-light btn-sm\" (click)=\"onNodeJitterChange()\">Reroll</button>\n                </div>\n                <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"map-node-jitter\" min=\"-2\" max=\"2\"\n                        step=\"0.01\" value=\"-2\" [(ngModel)]=\"SelectedNodeJitterVariable\"\n                        (ngModelChange)=\"onNodeJitterChange($event)\"></div>\n            </div>\n            <div class=\"form-group row\" title=\"What node data should be displayed as a tooltip for the node?\">\n                <div class=\"col-4\"><label for=\"map-node-tooltip-variable\">Tooltip</label></div>\n                <div class=\"col-8\">\n                    <p-dropdown id=\"map-node-tooltip-variable\" [options]=\"FieldList\" appendTo=\"body\"\n                        [(ngModel)]=\"SelectedNodeTooltipVariable\" (ngModelChange)=\"onNodeToolTipChange($event)\">\n                    </p-dropdown>\n                </div>\n            </div>\n\n        </tab>\n        <tab heading=\"{{'Links' | localize}}\" customClass=\"m-tabs__item\">\n\n            <div class=\"form-group row\">\n                <div class=\"col-4\">Color</div>\n                <div class=\"col-8\"><button class=\"btn btn-sm btn-light w-100 launch-color-options\"\n                        (click)=\"displayColorOptions()\">Color Options</button></div>\n            </div>\n            <div class=\"form-group row\" title=\"How transparent would you like links to be?\">\n                <div class=\"col-4\"><label for=\"map-link-transparency\">Transparency</label></div>\n                <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"map-link-transparency\" min=\"0.00\"\n                        max=\"1.00\" step=\"0.01\" value=\"0.00\" [(ngModel)]=\"SelectedLinkTransparencyVariable\"\n                        (ngModelChange)=\"onLinkTransparencyChange($event)\"></div>\n            </div>\n            <div class=\"form-group row\" title=\"What link data would you like displayed as a tooltip for the link?\">\n                <div class=\"col-4\"><label for=\"map-link-tooltip-variable\">Tooltip</label></div>\n                <div class=\"col-8\">\n                    <p-dropdown id=\"map-link-tooltip-variable\" [options]=\"FieldList\" appendTo=\"body\"\n                        [(ngModel)]=\"SelectedLinkTooltipVariable\" (ngModelChange)=\"onLinkToolTipChange($event)\">\n                    </p-dropdown>\n                </div>\n            </div>\n\n        </tab>\n    </tabset>\n</p-dialog>\n\n\n<p-dialog *ngIf=\"viewActive\" id=\"network-export-modal\" [(visible)]=\"ShowGEOMapExportPane\" header=\"Export Geospatial Data\"\n    (onHide)=\"onCloseExport()\" appendTo=\"body\">\n    <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-body\" style='min-width: 400px; height: 100%;'>\n                <div class=\"form-group row\">\n                    <div class=\"col-9\">\n                        <input type=\"text\" id=\"network-export-filename\" class=\"form-control form-control-sm\"\n                            placeholder=\"Filename\" [(ngModel)]=\"SelectedNetworkExportFilenameVariable\">\n                    </div>\n                    <div class=\"col-3\">\n                        <p-dropdown id=\"network-export-filetype\" [options]=\"NetworkExportFileTypeList\" appendTo=\"body\"\n                            [(ngModel)]=\"SelectedNetworkExportFileTypeListVariable\"></p-dropdown>\n                    </div>\n                </div>\n                <!-- <div>\n                    <p-accordion>\n                        <p-accordionTab style=\"color:#495057\" header=\"Advanced\">\n                            <div id=\"network-export-advanced\">\n\n                                <div class=\"form-group row\">\n                                    <div class=\"col-3\">\n                                        <label for=\"network-export-scale\">Scale</label>\n                                    </div>\n                                    <div class=\"col-9\">\n                                        <input type=\"number\" id=\"network-export-scale\"\n                                            class=\"form-control form-control-sm\" min=\"0\" step=\"0.1\" value=\"1\"\n                                            [(ngModel)]=\"SelectedNetworkExportScaleVariable\"\n                                            (ngModelChange)=\"updateCalculatedResolution($event)\">\n                                    </div>\n                                </div>\n                                <div class=\"form-group row\">\n                                    <div class=\"col-3\">Resolution</div>\n                                    <div id=\"network-export-dimensions\" class=\"col-9 text-right\">\n                                        {{CalculatedResolution}}</div>\n                                </div>\n                                <div class=\"row\">\n                                    <div class=\"col-3\">\n                                        <label for=\"network-export-quality\">Quality</label>\n                                    </div>\n                                    <div class=\"col-9\">\n                                        <input type=\"range\" class=\"custom-range\" id=\"network-export-quality\" min=\"0\"\n                                            max=\"1.0\" value=\"0.92\" step=\"0.01\"\n                                            [(ngModel)]=\"SelectedNetworkExportQualityVariable\">\n                                    </div>\n                                </div>\n                            </div>\n                        </p-accordionTab>\n                    </p-accordion>\n                </div> -->\n            </div>\n            <div class=\"modal-footer\">\n                <button type=\"button\" class=\"btn btn-error\"\n                    (click)=\"ShowGEOMapExportPane = !ShowGEOMapExportPane\">Cancel</button>\n                <button type=\"button\" id=\"network-export\" class=\"btn btn-primary\"\n                    (click)=\"exportVisualization($event)\">Export</button>\n            </div>\n        </div><!-- /.modal-content -->\n    </div><!-- /.modal-dialog -->\n</p-dialog><!-- /.modal -->\n\n<div id=\"mapTooltip\"></div>";

/***/ }),

/***/ 93824:
/*!*************************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/PhylogeneticComponent/phylogenetic-plugin.component.html?ngResource ***!
  \*************************************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"m-content\">\n    <div id=\"tool-btn-container\" class=\"m-portlet\">\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n            <a title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n        </span>\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n            <a title=\"Export Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n        </span>\n        <span style=\"overflow: visible; position: relative; width: 110px;\">\n            <a title=\"Center Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openCenter()\"><i class=\"flaticon-eye primary\"></i></a>\n        </span>\n    </div>\n    <div class=\"m-portlet__body\" style=\"height: 100%;\">\n        <br />\n        <div className=\"phylocanvas\" id=\"phylocanvas\" style=\"cursor: grab;\"></div>\n        <div id=\"phyloTooltip\"></div>\n    </div>\n</div>\n<div class=\"view-controls\">\n\n    <p-dialog *ngIf=\"viewActive\" id=\"phylotree-settings-pane\" \n              [positionLeft]=\"PhylogeneticTreeExportDialogSettings.left\" \n              [positionTop]=\"PhylogeneticTreeExportDialogSettings.top\" \n              [(visible)]=\"PhylogeneticTreeExportDialogSettings.isVisible\"  \n              [contentStyle]=\"{'overflow': 'visible'}\"\n              header=\"Phylogenetic Tree Settings\" appendTo=\"body\"\n              >\n              <tabset class=\"tab-container tabbable-line\">\n              <tab heading=\"{{'Tree' | localize}}\" [active]=\"true\" customClass=\"m-tabs__item\">\n              <p-accordion [multiple]='true'>\n                  <p-accordionTab style=\"color:#495057\" header=\"Layout\">\n                      <div #treecontrolslabels>\n                          <div class=\"form-group row tree-type-row\" title=\"What kind of tree should be displayed?\" style=\"overflow:visible\">\n                              <div class=\"col-4\"><label for=\"tree-layout\">Layout</label></div>\n                              <div class=\"col-8\">\n                                  <p-dropdown id=\"tree-layout\" appendTo=\"body\" [options]=\"TreeLayouts\" [(ngModel)]=\"SelectedTreeLayoutVariable\" (ngModelChange)=\"onTreeLayoutChange($event)\"> </p-dropdown>\n                              </div>\n                          </div>\n                      </div>\n                  </p-accordionTab>\n                  <p-accordionTab style=\"color:#495057\" header=\"Mode\">\n                      <div #treecontrolslabels>\n                          <div class=\"form-group row tree-type-row\" title=\"What kind of tree should be displayed?\" style=\"overflow:visible\">\n                              <div class=\"col-4\"><label for=\"tree-mode\">Mode</label></div>\n                              <div class=\"col-8\">\n                                  <p-dropdown id=\"tree-mode\" appendTo=\"body\" [options]=\"TreeModes\" [(ngModel)]=\"SelectedTreeModeVariable\" (ngModelChange)=\"onTreeModeChange($event)\"> </p-dropdown>\n                              </div>\n                          </div>\n                      </div>\n                  </p-accordionTab>\n                  <p-accordionTab style=\"color:#495057\" header=\"Type\">\n                      <div #treecontrolslabels>\n                          <div class=\"form-group row tree-type-row\" title=\"What kind of tree should be displayed?\" style=\"overflow:visible\">\n                              <div class=\"col-4\"><label for=\"tree-type\">Type</label></div>\n                              <div class=\"col-8\">\n                                  <p-dropdown id=\"tree-type\" appendTo=\"body\" [options]=\"TreeTypes\" [(ngModel)]=\"SelectedTreeTypeVariable\" (ngModelChange)=\"onTreeTypeChange($event)\"> </p-dropdown>\n                              </div>\n                          </div>\n                      </div>\n                  </p-accordionTab>\n                  <p-accordionTab style=\"color:#495057\" header=\"Stretch\">\n                      <div #treecontrolslabels>\n                          <div class=\"form-group row tree-type-row\" title=\"What kind of tree should be displayed?\" style=\"overflow:visible\">\n                              <div class=\"col-4\"><label for=\"horizontal-stretch\">Horizontal Stretch</label></div>\n                                <input type=\"range\" class=\"custom-range\" id=\"horizontal-stretch\" min=\"0\" value=\"1\" step=\"0.2\" max=\"10\" [(ngModel)]=\"SelectedHorizontalStretchVariable\" (change)=\"onHorizontalStretchChange($event)\">\n                              <div class=\"col-4\"><label for=\"vertical-stretch\">Vertical Stretch</label></div>\n                                <input type=\"range\" class=\"custom-range\" id=\"vertical-stretch\" min=\"0\" value=\"1\" step=\"0.2\" max=\"10\" [(ngModel)]=\"SelectedVerticalStretchVariable\" (change)=\"onVerticalStretchChange($event)\">\n                          </div>\n                      </div>\n                  </p-accordionTab>\n              </p-accordion>\n              </tab>\n\n              <tab heading=\"{{'Leaves' | localize}}\" customClass=\"m-tabs__item\">\n              <p-accordion>\n                  <p-accordionTab style=\"color:#495057\" header=\"Labels and Tooltips\">\n                      <div #leafcontrolslabels>\n                          <div class=\"form-group row leaf-label-visibility-row\" title=\"Show leaf labels?\">\n                              <div class=\"col-4\">Show Leaf Labels</div>\n                              <div class=\"col-8\">\n                                  <p-selectButton id=\"leaf-label-visibility\" [options]=\"hideShowOptions\" [(ngModel)]=\"SelectedLeafLabelShowVariable\" (ngModelChange)=\"onLeafLabelShowChange($event)\"></p-selectButton>\n                              </div>\n                          </div>\n                          <div class=\"form-group row leaf-label-variable-row\" title=\"What vasriable should be used as the leaf label?\" style=\"overflow:visible\">\n                              <div class=\"col-4\"><label for=\"leaf-label-variable\">Label Variable</label></div>\n                              <div class=\"col-8\">\n                                  <p-dropdown id=\"leaf-label-variable\" appendTo=\"body\" [options]=\"LeafLabelFieldList\" [(ngModel)]=\"SelectedLeafLabelVariable\" (ngModelChange)=\"onLeafLabelVariableChange($event)\"> </p-dropdown>\n                              </div>\n                          </div>\n                          <div class=\"form-group row leaf-label-size-row\" title=\"How big should leaf labels be?\">\n                              <div class=\"col-4\"><label for=\"leaf-label-size\">Label Size</label></div>\n                              <input type=\"range\" class=\"custom-range\" id=\"leaf-label-size\" min=\"1\" value=\"{{ SelectedLeafLabelSizeVariable }}\" step=\"1\" max=\"32\" [(ngModel)]=\"SelectedLeafLabelSizeVariable\" (ngModelChange)=\"onLeafLabelSizeChange($event)\">\n                          </div>\n                          <div class=\"form-group row leaf-tooltip-visibility-row\" title=\"Show leaf tooltips?\">\n                              <div class=\"col-4\">Show Leaf Tooltips</div>\n                              <div class=\"col-8\">\n                                  <p-selectButton id=\"leaf-tooltip-visibility\" [options]=\"hideShowOptions\" [(ngModel)]=\"SelectedLeafTooltipShowVariable\" (ngModelChange)=\"onLeafLabelTooltipShowChange($event)\"></p-selectButton>\n                              </div>\n                          </div>\n                          <div class=\"form-group row leaf-tooltip-variable-row\" title=\"What vasriable should be used as the leaf tooltip?\" style=\"overflow:visible\">\n                              <div class=\"col-4\"><label for=\"leaf-tooltip-variable\">Tooltip Variable</label></div>\n                              <div class=\"col-8\">\n                                  <p-dropdown id=\"leaf-tooltip-variable\" appendTo=\"body\" [options]=\"LeafLabelFieldList\" [(ngModel)]=\"SelectedLeafTooltipVariable\" (ngModelChange)=\"onLeafTooltipVariableChange($event)\"> </p-dropdown>\n                              </div>\n                          </div>\n                      </div>\n                  </p-accordionTab>\n                  <p-accordionTab style=\"color:#495057\" header=\"Leaf Size\">\n                      <div #leafcontrolslabels>\n                          <!--<div class=\"form-group row leaf-shape-row\" title=\"What shape should leaves be?\">\n                              <div class=\"col-4\"><label for=\"leaf-shape-variable\">Leaf Shape</label></div>\n                              <p-dropdown id=\"leaf-shape-variable\" [options]=\"LeafShapes\" appendTo=\"body\" [(ngModel)]=\"SelectedLeafShapeVariable\" (ngModelChange)=\"onLeafShapeVariableChange($event)\"></p-dropdown>\n                          </div>-->\n                          <div class=\"form-group row leaf-size-var-row\" title=\"What variable should be used to size the nodes?\">\n                              <div class=\"col-4\"><label for=\"leaf-size-var\">Leaf Size Variable</label></div>\n                              <div class=\"col-8\">\n                                <p-dropdown id=\"leaf-size-var\" appendTo=\"body\" [options]=\"LeafLabelFieldList\" [(ngModel)]=\"SelectedLeafNodeSizeVariable\" (ngModelChange)=\"onLeafNodeSizeVariableChange($event)\"> </p-dropdown>\n                              </div>\n                          </div>\n                          <div class=\"form-group row leaf-size-row\" title=\"How big should leaves be?\">\n                              <div class=\"col-4\"><label for=\"leaf-size\">Leaf Size</label></div>\n                              <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"leaf-size\" min=\"1\" value=\"{{ SelectedLeafNodeSize }}\" step=\"0.5\" max=\"50\" [(ngModel)]=\"SelectedLeafNodeSize\" (ngModelChange)=\"onLeafNodeSizeChange($event)\"></div>\n                          </div>\n                      </div>\n                  </p-accordionTab>\n                  <p-accordionTab style=\"color:#495057\" header=\"Colors\">\n                      <button pButton type=\"button\" label=\"Show Colors\" class=\"ui-button-raised\" (click)=\"showGlobalSettings()\" [style]=\"{'background-color': '#2196f3', 'border': '1px solid #2196f3'}\"></button>\n                  </p-accordionTab>\n              </p-accordion>\n              </tab>\n\n              <tab heading=\"{{'Branches' | localize}}\" customClass=\"m-tabs__item\">\n              <p-accordion>\n                  <p-accordionTab style=\"color:#495057\" header=\"Labels\">\n                      <div #branchcontrolslabels>\n                          <div class=\"form-group row branch-distance-visibility-row\" title=\"Show distance labels?\">\n                              <div class=\"col-4\"><label for=\"branch-distance-visibility\">Distance Labels</label></div>\n                              <div class=\"col-8\">\n                                  <p-selectButton id=\"branch-distance-visibility\" [options]=\"hideShowOptions\" [(ngModel)]=\"SelectedBranchDistanceShowVariable\" (ngModelChange)=\"onBranchDistanceShowChange($event)\"></p-selectButton>\n                              </div>\n                          </div>\n                          <div class=\"form-group row link-size-row\" title=\"How big should branch labels be?\">\n                              <div class=\"col-4\"><label for=\"link-size\">Branch Label Size</label></div>\n                              <input type=\"range\" class=\"custom-range\" id=\"link-size\" min=\"1\" value=\"1\" step=\"1\" max=\"25\" [(ngModel)]=\"SelectedBranchDistanceSizeVariable\" (ngModelChange)=\"onBranchDistanceSizeChange($event)\">\n                          </div>\n                      </div>\n                  </p-accordionTab>\n                  <p-accordionTab style=\"color:#495057\" header=\"Branch Size\">\n                      <div #branchcontrollables>\n                        <div class=\"form-group row branch-node-visibility-row\" title=\"Show branch Nodes?\">\n                              <div class=\"col-4\"><label for=\"branch-node-visibility\">Branch Nodes</label></div>\n                              <div class=\"col-8\">\n                                  <p-selectButton id=\"branch-node-visibility\" [options]=\"hideShowOptions\" [(ngModel)]=\"SelectedBranchNodeShowVariable\" (ngModelChange)=\"onBranchNodeShowChange($event)\"></p-selectButton>\n                              </div>\n                          </div>\n                          <div class=\"form-group row branch-node-size-row\" title=\"How big should branch nodes be?\">\n                              <div class=\"col-4\"><label for=\"link-size\">Branch Node Size</label></div>\n                              <input type=\"range\" class=\"custom-range\" id=\"branch-node-size\" min=\"1\" value=\"{{ SelectedBranchNodeSizeVariable }}\" step=\"0.5\" max=\"10\" [(ngModel)]=\"SelectedBranchNodeSizeVariable\" (ngModelChange)=\"onBranchNodeSizeChange($event)\">\n                          </div>\n                          <div class=\"form-group row link-size-row\" title=\"How big should branches be?\">\n                              <div class=\"col-4\"><label for=\"link-size\">Branch Size</label></div>\n                              <input type=\"range\" class=\"custom-range\" id=\"link-size\" min=\"1\" value=\"{{ SelectedBranchSizeVariable }}\" step=\"1\" max=\"10\" [(ngModel)]=\"SelectedBranchSizeVariable\" (ngModelChange)=\"onBranchSizeChange($event)\">\n                          </div>\n                      </div>\n                  </p-accordionTab>\n              </p-accordion>\n              </tab>\n              </tabset>\n    </p-dialog>\n</div>\n<div id=\"phylo-context-menu\" class=\"dropdown-menu\">\n    <div id=\"reroot\" class=\"dropdown-item\">Set As Root</div>\n    <div id=\"rotate\" class=\"dropdown-item\">Rotate</div>\n    <div id=\"flip\" class=\"dropdown-item\">Flip</div>\n</div>\n<p-dialog *ngIf=\"viewActive\" id=\"network-export-modal\" [(visible)]=\"ShowPhylogeneticExportPane\" header=\"Export Phylogenetic Tree\" class=\"dialogSize\" (onHide)=\"onCloseExport()\" appendTo=\"body\">\n    <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-body\" style='min-width: 500px; height: 100%;'>\n                <p-accordion [multiple]=\"true\">\n                    <p-accordionTab header=\"Export Image of Tree\" style=\"color:#495057\" [selected]=\"true\">\n                        <div class=\"form-group row\">\n                            <div class=\"col-8\">\n                                <input type=\"text\" id=\"tree-image-filename\" class=\"form-control form-control-sm\" placeholder=\"Image Filename\" [(ngModel)]=\"SelectedTreeImageFilenameVariable\" >\n                            </div>\n                            <div class=\"col-3\">\n                                <p-dropdown id=\"network-export-filetype\" [options]=\"NetworkExportFileTypeList\" [(ngModel)]=\"SelectedNetworkExportFileTypeListVariable\" ></p-dropdown>\n                            </div>\n                            <div class=\"col-8\">\n                                <button type=\"button\" id=\"export-tree\" class=\"btn btn-primary\" (click)=\"saveImage($event)\">Save Image</button>\n                            </div>\n                        </div>\n                    </p-accordionTab>\n                    <p-accordionTab header=\"Export Newick String\" style=\"color:#495057\" [selected]=\"true\">\n                        <div class=\"form-group row\">\n                            <div class=\"col-8\">\n                                <input type=\"text\" id=\"newick-string-filename\" class=\"form-control form-control-sm\" placeholder=\"Newick Filename\" [(ngModel)]=\"SelectedNewickStringFilenameVariable\" >\n                            </div>\n                            <div class=\"col-3\"></div>\n                            <div class=\"col-8\">\n                                <button type=\"button\" id=\"export-newick\" class=\"btn btn-primary\" (click)=\"saveNewickString($event)\">Save Newick String</button>\n                            </div>\n                        </div>\n                    </p-accordionTab>\n                </p-accordion>\n            </div>\n                <div class=\"modal-footer\">\n                </div>\n        </div><!-- /.modal-content -->\n    </div><!-- /.modal-dialog -->\n</p-dialog><!-- /.modal -->\n";

/***/ }),

/***/ 72557:
/*!***********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/TableComponent/table-plugin-component.html?ngResource ***!
  \***********************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"table-wrapper\">\n    <div id=\"tool-btn-container\" class=\"m-portlet\" style=\"width: calc(100% - 20px); gap: 15px;\">\n        <span style=\"flex-grow: 0; min-width: 84px\">\n            <span class=\"tool-btn\" style=\"overflow: visible; position: relative; display: inline;\">\n                <a title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n            </span>\n            <span  class=\"tool-btn\" style=\"overflow: visible; position: relative; width: 80px; display: inline;\">\n                <a title=\"Export Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n            </span>\n        </span>\n        <span style=\"display: inline-block; flex-grow: 0; line-height: 44px;\">Dataset:</span>\n        <span class=\"data-types\" id=\"dataType\" style=\"overflow: visible; position: relative; width: 150px; display: inline; flex-grow: 0;\">\n            <p-dropdown #dataSet [options]=\"dataSetView\" [(ngModel)]=\"dataSetViewSelected\" (onChange)=\"openSelectDataSetScreen($event)\" [style]=\"{'width': '110px'}\"></p-dropdown>\n        </span>\n        <span style=\"flex-grow: 1; width: calc(100% - 295px)\">\n            <p-multiSelect [options]=\"SelectedTableData.availableColumns\" [(ngModel)]=\"SelectedTableData.tableColumns\" [showToggleAll]=false [style]=\"{'max-width': '100%'}\"></p-multiSelect>\n        </span>\n    </div>\n\n<div class=\"row align-items-center\">\n    <!-- [busyIf]=\"primengTableHelper.isLoading\" -->\n    <div class=\"primeng-datatable-container\">\n        <p-table #dt *ngIf=\"IsDataAvailable == true && SelectedTableData\" \n            [value]=\"SelectedTableData.data\" \n            [rowHover]=\"true\"\n            [rows]=\"selectedRows\" \n            [showCurrentPageReport]=\"true\"\n            [rowsPerPageOptions]=\"[10,25,50,75,100, { showAll: 'All' }]\" \n            [loading]=\"loading\" \n            [paginator]=\"true\" \n            [filterDelay]=\"1000\"\n            (onFilter)=\"onFilter($event)\" \n            selectionMode=\"{{TableType === 'node' ? 'multiple' : null}}\"\n            [(selection)]=\"SelectedTableData.dataSelection\" \n            (onRowSelect)=\"onRowSelect($event)\"\n            (onRowUnselect)=\"onRowUnselect($event)\" \n            [scrollable]=\"true\"\n            [scrollHeight]=\"scrollHeight\"\n            [tableStyle]=\"tableStyle\"\n            [styleClass]=\"selectedSize\"\n            ScrollWidth=\"100%\"\n            [resizableColumns]=\"true\" \n            columnResizeMode=\"expand\"     \n            [columns]=\"SelectedTableData.tableColumns\"\n            [reorderableColumns]=\"true\">\n            <!-- [responsive]=\"true\"  -->\n            <!-- [autoLayout]=\"true\" \n            styleClass=\"ui-table-responsive\"  -->\n            <ng-template pTemplate=\"colgroup\" let-columns>\n                <colgroup>\n                    <col *ngFor=\"let col of SelectedTableData.tableColumns\">\n                </colgroup>\n            </ng-template>\n            <ng-template pTemplate=\"header\">\n                <tr [pSelectableRow]=\"datarow\">\n                    <th style=\"width: 150px; border: none\" pSortableColumn=\"{{col.field}}\" pReorderableColumn *ngFor=\"let col of SelectedTableData.tableColumns\">\n                        {{col.header}}<p-sortIcon field=\"{{col.field}}\"></p-sortIcon>\n                    </th>\n                </tr>\n                <tr>\n                    <th style=\"width: 150px; border: none\"  *ngFor=\"let col of SelectedTableData.tableColumns\">\n                        <div class=\"wrapper\">\n                            <select class=\"filterType\" [(ngModel)]=\"col.filterType\" (change)=\"onTableFilter(col)\">\n                                <option *ngFor=\"let filterType of filterTypes\" [ngValue]=\"filterType.value\">{{filterType.label}}\n                                </option>\n                            </select>\n                            <input class=\"item\" pInputText type=\"text\" (input)=\"onTableFilter(col)\"\n                                [(ngModel)]=\"col.filterValue\" class=\"p-column-filter\" style=\"width:100%;\">\n                        </div>\n                    </th>\n                </tr>\n\n            </ng-template>\n            <ng-template pTemplate=\"body\" let-datarow>\n                <tr class=\"ui-selectable-row\" [pSelectableRow]=\"datarow\">\n                    <td style=\"width: 150px\"  *ngFor=\"let col of SelectedTableData.tableColumns\">\n                        {{datarow[col.field]}}\n                    </td>\n                </tr>\n            </ng-template>\n        </p-table>\n    </div>\n</div>\n\n<div class=\"m-content\" *ngIf=\"IsDataAvailable == false\">\n    <div id=\"file-panel\" class=\"container-fluid\" style=\"height:500px;\">\n        <div id=\"file-prompt\" class=\"d-flex justify-content-center\">\n            <h1><b>Please add data files to load...</b></h1>\n            <br />\n        </div>\n    </div>\n</div>\n\n\n<p-dialog *ngIf=\"viewActive\" id=\"table-settings-pane\" [(visible)]=\"ShowTableSettingsPane\" header=\"Table Settings\" [style]=\"{width: '400px', height:'250px'}\" appendTo=\"body\">\n    <tabset class=\"tab-container tabbable-line\" style='width: 100%;'>\n        <tab heading=\"{{'Table' | localize}}\" [active]=\"true\" customClass=\"m-tabs__item\">\n            <div class=\"tab-pane fade show active\" id=\"table-node-settings\" role=\"tabpanel\"aria-labelledby=\"nodes-tab\">\n                <div class=\"tab-content\">\n                    <div class=\"tab-pane fade show active\" role=\"tabpanel\" aria-labelledby=\"table-tab\">\n                        <div class=\"form-group row\"\n                            title=\"What size would you like the Table's font to be?\">\n                            <div class=\"col-4\"><label for=\"table-font-size\">Size</label></div>\n                            <div class=\"col-8\">\n                                <p-selectButton [options]=\"sizes\" [(ngModel)]=\"selectedSize\" [multiple]=\"false\" optionLabel=\"name\" optionValue=\"class\"></p-selectButton>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </tab>\n    </tabset>\n</p-dialog>\n\n\n<p-dialog *ngIf=\"viewActive\" [(visible)]=\"ShowTableExportPane\" header=\"Export Table\" appendTo=\"body\">\n    <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-body\" style='width: 400px; height: 100%;'>\n                <div class=\"form-group row\">\n                    <div class=\"col-8\">\n                        <input type=\"text\" style=\"height:42px\" class=\"form-control form-control-sm\"\n                            placeholder=\"Filename\" [(ngModel)]=\"SelectedTableExportFilenameVariable\">\n                    </div>\n                    <div class=\"col-4\">\n                        <p-dropdown [options]=\"TableExportFileTypeList\"\n                            [(ngModel)]=\"SelectedTableExportFileTypeListVariable\" appendTo=\"body\"></p-dropdown>\n                    </div>\n                </div>\n                <div class=\"form-group row\" style=\"margin-top: 10px;\" title=\"Do you want to export all the columns in the data or just the currently selected columns?\">\n                    <div class=\"col-6\"><label>Columns to Export</label></div>\n                    <div class=\"col-6\">\n                        <p-selectButton [style]=\"{'float': 'right'}\" [options]=\"exportColumnOptions\" [(ngModel)]=\"exportAllColumns\"></p-selectButton>\n                    </div>\n                </div>\n            </div>\n            <div class=\"modal-footer\">\n                <button type=\"button\" class=\"btn btn-error\"\n                    (click)=\"ShowTableExportPane = !ShowTableExportPane\">Cancel</button>\n                <button type=\"button\" class=\"btn btn-primary\"\n                    (click)=\"exportVisualization()\">Export</button>\n            </div>\n        </div><!-- /.modal-content -->\n    </div><!-- /.modal-dialog -->\n</p-dialog><!-- /.modal -->\n</div>";

/***/ }),

/***/ 26498:
/*!********************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/TimelineComponent/timeline-component.component.html?ngResource ***!
  \********************************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div #epiCurve id=\"epiCurve\">\n  <svg #epiCurveSVG id=\"epiCurveSVG\"></svg>\n</div>\n\n<div id=\"tool-btn-container\" class=\"m-portlet\">\n    <span style=\"overflow: visible; position: relative;\">\n        <a title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n    </span>\n    <span style=\"overflow: visible; position: relative;\">\n      <a title=\"Export Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n  </span>\n</div>\n\n<p-dialog *ngIf=\"viewActive\" id=\"epiCurve-settings-pane\" [(visible)]=\"ShowEpiSettingsPane\" header=\"Epi Curve Settings\"\n  [style]=\"{width: '500px', height:'490px'}\" appendTo=\"body\">\n  <div class=\"tab-pane fade show active\" id=\"table-node-settings\" role=\"tabpanel\" aria-labelledby=\"nodes-tab\">\n    <div class=\"tab-content\">\n      <div class=\"tab-pane fade show active\" role=\"tabpanel\">\n        <div class=\"form-group row\" title=\"Select the type of graph based on the number of date field you wish to display.\">\n          <div class=\"col-4\">\n            <label>Graph Type</label>\n          </div>\n          <div class=\"col-8\">\n            <p-dropdown [options]=\"graphTypes\" appendTo=\"body\"  [(ngModel)]=\"selectedGraphType\" (ngModelChange)=\"onGraphTypeChange()\"></p-dropdown>\n          </div>\n        </div>\n        <div class=\"form-group row\" title=\"Select a date field from your data. One is required to generate graph.\">\n          <div class=\"col-4\">\n            <label>Date Field</label>\n          </div>  \n          <div class=\"col-6\" style=\"padding-right: 5px\">\n            <p-dropdown id=\"epiCurve-date-field\" [options]=\"FieldList\" appendTo=\"body\"  [(ngModel)]=\"SelectedDateFieldVariable\" (ngModelChange)=\"onDateFieldChange(0)\"></p-dropdown>\n          </div>\n          <div class=\"col-2\" style=\"padding: 0px 15px 0px 10px\" *ngIf=\"selectedGraphType!='Single Date Field' || widgets['epiCurve-stackColorBy'] == 'None'\" title=\"Select a color for this date field.\">\n            <input type=\"color\" id=\"epi-color-select\" class=\"form-control\" style=\"padding: 5px 8px;\" [(ngModel)]=\"widgets['epiCurve-colors'][0]\" (change)=\"onNodeColorChanged()\">\n          </div>  \n        </div>\n        <div class=\"form-group row additionalDateField\" *ngIf=\"selectedGraphType!='Single Date Field'\" title=\"Select an additional date field.\">\n          <div class=\"col-4\">\n            <label>Date Field 2</label>\n          </div>\n          <div class=\"col-6\" style=\"padding-right: 5px\">\n            <p-dropdown id=\"epiCurve-date-field\" [options]=\"FieldList\" appendTo=\"body\"  [(ngModel)]=\"SelectedDateFieldVariable2\" (ngModelChange)=\"onDateFieldChange(1)\"></p-dropdown>\n          </div>\n          <div class=\"col-2\" style=\"padding: 0px 15px 0px 10px\" title=\"Select a color for this date field.\">\n            <input type=\"color\" id=\"node-color\" class=\"form-control\" style=\"padding: 5px 8px;\" [(ngModel)]=\"widgets['epiCurve-colors'][1]\" (change)=\"onNodeColorChanged()\">\n          </div>\n        </div>\n        <div class=\"form-group row additionalDateField\" *ngIf=\"selectedGraphType!='Single Date Field'\" title=\"Select an additional date field.\">\n          <div class=\"col-4\">\n            <label>Date Field 3</label>\n          </div>\n          <div class=\"col-6\" style=\"padding-right: 5px\">\n            <p-dropdown id=\"epiCurve-date-field\" [options]=\"FieldList\" appendTo=\"body\"  [(ngModel)]=\"SelectedDateFieldVariable3\" (ngModelChange)=\"onDateFieldChange(2)\"></p-dropdown>\n          </div>\n          <div class=\"col-2\" style=\"padding: 0px 15px 0px 10px\" title=\"Select a color for this date field.\">\n            <input type=\"color\" id=\"node-color\" class=\"form-control\" style=\"padding: 5px 8px;\" [(ngModel)]=\"widgets['epiCurve-colors'][2]\" (change)=\"onNodeColorChanged()\">\n          </div>\n        </div>\n        <div class=\"form-group row\" id=\"useNodeColorRow\" *ngIf=\"selectedGraphType=='Single Date Field'\" title=\"Select a field to use to color the graph. Optional\">\n          <div class=\"col-4\">\n            <label>Color By</label>\n          </div>\n          <div class=\"col-6\" style=\"padding-right: 5px\">\n            <p-dropdown id=\"epiCurve-date-field\" [options]=\"FieldListStack\" appendTo=\"body\"  [(ngModel)]=\"this.widgets['epiCurve-stackColorBy']\" (ngModelChange)=\"onUseNodeColorChange()\"></p-dropdown>\n          </div>\n        </div>\n        <div class=\"form-group row\" title=\"Select the size to bin the data by.\">\n          <div class=\"col-4\">\n            <label>Bin Size</label>\n          </div>\n          <div class=\"col-8\">\n            <p-dropdown id=\"epiCurve-date-field\" [options]=\"binSizes\" appendTo=\"body\"  [(ngModel)]=\"widgets['epiCurve-binSize']\" (ngModelChange)=\"onBinSizeChange()\"></p-dropdown>\n          </div>\n        </div>\n        <div class=\"form-group row\" title=\"What interval to display ticks on x axis\" id=\"epi-tick-size\">\n          <div class=\"col-4\">\n              <label for=\"cluster-minimum-size\">X-axis Interval</label>\n          </div>\n          <div class=\"col-8\">\n              <input type=\"number\" class=\"form-control form-control-sm\" min=\"1\" max=\"4\" step=\"1\" [(ngModel)]=\"tickInterval\" (ngModelChange)=\"onTickIntevalChange()\">\n          </div>\n      </div>\n        <div class=\"form-group row\" title=\"Show data noncumulatively or cumulatively.\">\n          <div class=\"col-4\">Epi Curve</div>\n          <div class=\"col-8\">\n            <div class=\"btn-group btn-group-toggle w-100\">\n              <label class=\"btn btn-light btn-sm col\" [class.active]=\"!widgets['epiCurve-cumulative']\">\n                <input type=\"radio\" name=\"epiCurve-cumulation\" (click)=\"setCumulative(false)\">\n                Noncumulative\n              </label>\n              <label class=\"btn btn-light btn-sm col\" [class.active]=\"widgets['epiCurve-cumulative']\">\n                <input type=\"radio\" name=\"epiCurve-cumulation\" (click)=\"setCumulative(true)\">\n                Cumulative\n              </label>\n            </div>\n          </div>\n        </div>\n        <div class=\"form-group row\" id=\"useNodeColorRow\" title=\"Select where to display the legend.\">\n          <div class=\"col-4\">\n            <label>Legend Position</label>\n          </div>\n          <div class=\"col-8\">\n            <p-selectButton [options]=\"legendPositionOptions\" [(ngModel)]=\"widgets['epiCurve-legendPosition']\" (ngModelChange)=\"onLegendPositionChange()\"></p-selectButton>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</p-dialog>\n\n<p-dialog *ngIf=\"viewActive\" id=\"epi-export-modal\" [(visible)]=\"ShowEpiExportPane\" appendTo=\"body\" header=\"Export Epi Curve\">\n  <div class=\"modal-dialog\" role=\"document\">\n      <div class=\"modal-content\">\n          <div class=\"modal-body\" style='min-width: 400px; height: 100%;'>\n              <div class=\"form-group row\">\n                  <div class=\"col-9\">\n                      <input type=\"text\" class=\"form-control form-control-sm\" placeholder=\"Filename\" [(ngModel)]=\"EpiExportFileName\">\n                  </div>\n                  <div class=\"col-3\">\n                      <select [(ngModel)]=\"EpiExportFileType\" class=\"form-control form-control-sm\">\n                          <option>svg</option>\n                          <option>png</option>\n                      </select>\n                  </div>\n              </div>\n              <div [hidden]=\"EpiExportFileType=='svg'\">\n                <p-accordion>\n                    <p-accordionTab style=\"color:#495057\" header=\"Advanced\">\n                        <div id=\"network-export-advanced\">\n                            <div class=\"form-group row\">\n                                <div class=\"col-3\">\n                                    <label for=\"network-export-scale\">Scale</label>\n                                </div>\n                                <div class=\"col-9\">\n                                    <input type=\"number\" id=\"network-export-scale\" class=\"form-control form-control-sm\" min=\"0\" max=\"2\" step=\"0.1\" value=\"1\" [(ngModel)]=\"SelectedNetworkExportScaleVariable\" (ngModelChange)=\"updateCalculatedResolution()\">\n                                </div>\n                            </div>\n                            <div class=\"form-group row\">\n                                <div class=\"col-3\">Resolution</div>\n                                <div id=\"network-export-dimensions\" class=\"col-9 text-right\">{{CalculatedResolution}}</div>\n                            </div>\n                            <div class=\"row\">\n                                <div class=\"col-3\">\n                                    <label for=\"network-export-quality\">Quality</label>\n                                </div>\n                                <div class=\"col-9\">\n                                    <input type=\"range\" class=\"custom-range\" id=\"network-export-quality\" min=\"0\" max=\"1.0\" value=\"0.92\" step=\"0.01\" [(ngModel)]=\"SelectedNetworkExportQualityVariable\">\n                                </div>\n                            </div>\n                        </div>\n                    </p-accordionTab>\n                </p-accordion>\n            </div>\n          </div>\n          <div class=\"modal-footer\">\n              <button type=\"button\" class=\"btn btn-error\" (click)=\"ShowEpiExportPane = false\">Cancel</button>\n              <button type=\"button\" class=\"btn btn-primary\" (click)=\"exportVisualization()\">Export</button>\n          </div>\n      </div><!-- /.modal-content -->\n  </div><!-- /.modal-dialog -->\n</p-dialog><!-- /.modal -->\n\n";

/***/ }),

/***/ 13336:
/*!*********************************************************************************************!*\
  !*** ./src/app/visualizationComponents/TwoDComponent/twoD-plugin.component.html?ngResource ***!
  \*********************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "\n\n<span id=\"tooltip\" style=\"background-color: white;\"></span>\n\n<div id=\"tool-btn-container\" class=\"m-portlet\">\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n        <a title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openSettings()\"><i class=\"flaticon-settings primary\"></i></a>\n    </span>\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n        <a title=\"Export Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openExport()\"><i class=\"flaticon-download primary\"></i></a>\n    </span>\n    <span style=\"overflow: visible; position: relative; width: 110px;\">\n        <a title=\"Center Screen\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openCenter()\"><i class=\"flaticon-eye primary\"></i></a>\n    </span>\n    <!-- Add this back in if we decide to use forces again to allow pinning nodes\n     <span style=\"overflow: visible; position: relative; width: 110px;\">\n        <a #pinbutton title=\"Pin All Nodes\" id=\"pinbutton\" class=\"btn btn-sm btn-clean btn-icon btn-icon-md\" style=\"float:left\" (click)=\"openPinAllNodes()\"\n            [style.background]=\"commonService.session.network.allPinned ? 'lightblue': 'transparent'\"\n        ><i class=\"flaticon-pin primary\"></i></a>\n    </span> -->\n</div>\n\n<!-- <div #cy id=\"cy\" style=\"width: 100%; height: 100%;\"></div> -->\n\n<div #exportContainer class=\"cytoscape-container\" style=\"position: relative;\">\n    <div #cy id=\"cy\" style=\"width: 100%; height: 100%; position: relative;\"></div>\n    <div class=\"grid-overlay\" [class.hidden]=\"!widgets['network-gridlines-show']\"></div>\n    \n    <!-- Static Watermark (Optional) -->\n    <div id=\"watermark\" class=\"watermark\"></div>\n    <div id=\"network-statistics-wrapper\">\n      <div id=\"network-statistics-draghandle\"><span class=\"oi oi-move\"></span></div>\n      <table #networkStats id=\"network-statistics-table\">\n          <tr>\n              <td class=\"text-right\">\n                  <span id=\"numberOfNodes\"></span>\n                  (<span id=\"numberOfSelectedNodes\"></span>)\n              </td>\n              <td>Nodes (Selected)</td>\n          </tr>\n          <tr>\n              <td id=\"numberOfVisibleLinks\" class=\"text-right\"></td>\n              <td>Links</td>\n          </tr>\n          <tr>\n              <td id=\"numberOfDisjointComponents\" class=\"text-right\"></td>\n              <td>Clusters</td>\n          </tr>\n          <tr>\n              <td id=\"numberOfSingletonNodes\" class=\"text-right\"></td>\n              <td>Singletons</td>\n          </tr>\n      </table>\n  </div>\n</div>\n\n\n<div class=\"m-content\" *ngIf=\"IsDataAvailable == false\">\n    <div id=\"file-panel\" class=\"container-fluid\" style=\"height:500px;\">\n        <div id=\"file-prompt\" class=\"d-flex justify-content-center\">\n            <h1><b>Please add data files to load...</b></h1>\n            <br />\n        </div>\n    </div>\n</div>\n\n\n<div class=\"view-controls\">\n    <p-dialog *ngIf=\"viewActive\" id=\"network-settings-pane\" \n                [(visible)]=\"Node2DNetworkExportDialogSettings.isVisible\"  \n                header=\"2D Network Settings\" appendTo=\"body\"\n                >\n        <tabset class=\"tab-container tabbable-line\">\n            <tab heading=\"{{'Nodes' | localize}}\" [active]=\"true\" customClass=\"m-tabs__item\">\n                <p-accordion>\n                    <p-accordionTab [selected]=\"false\" style=\"color:#495057\" header=\"Labels and Tooltips\">\n                        <div #nodecontrolslabels>\n                            <div class=\"form-group row\" title=\"What field should be displayed as a label for the node?\">\n                                <div class=\"col-4\"><label for=\"node-label-variable\">Label</label></div>\n                                <div class=\"col-8\">\n                                    <p-dropdown id=\"node-label-variable\" [options]=\"FieldList\" appendTo=\"body\" [(ngModel)]=\"SelectedNodeLabelVariable\" (ngModelChange)=\"onNodeLabelVaribleChange($event)\"></p-dropdown>\n                                </div>\n                            </div>\n                            <div class=\"form-group row node-label-row\" title=\"How big should node labels be?\">\n                                <div class=\"col-4\"><label for=\"node-label-size\">Label Size</label></div>\n                                <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"node-label-size\" min=\"6\" value=\"16\" max=\"72\" [(ngModel)]=\"SelectedNodeLabelSizeVariable\" (change)=\"onNodeLabelSizeChange($event)\"></div>\n                            </div>\n                            <div class=\"form-group row\" title=\"What node data should be displayed as a tooltip for the node?\">\n                                <div class=\"col-4\">\n                                    <label for=\"node-tooltip-variable\">Tooltip</label>\n                                </div>\n                                <div class=\"col-8\">\n                                    <p-multiSelect [options]=\"commonService.session.data['nodeFields']\" appendTo=\"body\" [showToggleAll]=false [showHeader]=false [style]=\"{'max-width': '100%'}\"\n                                    [(ngModel)]=\"commonService.session.style.widgets['node-tooltip-variable']\" (onChange)=\"onNodeTooltipVariableChange($event.value)\"\n                                    ></p-multiSelect>\n                                </div>\n                            </div>\n                        </div>\n                    </p-accordionTab>\n\n                    <p-accordionTab style=\"color:#495057\" header=\"Shapes and Sizes\">\n                        <div #nodecontrolsshapes>\n                            <div class=\"form-group row\" title=\"Which variable should determine the shape of the node?\">\n                                <div class=\"col-4\">\n                                    <label for=\"node-symbol-variable\">Shape By</label>\n                                </div>\n                                <div class=\"col-8\">\n                                    <p-dropdown id=\"node-symbol-variable\" [options]=\"FieldList\" appendTo=\"body\" [(ngModel)]=\"SelectedNodeSymbolVariable\" (ngModelChange)=\"onNodeSymbolVariableChange($event)\"></p-dropdown>\n                                </div>\n                            </div>\n                            <div id=\"node-symbol-table-row\" [hidden]=\"!ShowNodeSymbolTable\" class=\"form-group row\" title=\"What shape should the nodes be?\">\n                                <div class=\"col-4\">Table</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton [options]=\"TableTypes\" [(ngModel)]=\"SelectedNetworkTableTypeVariable\" (ngModelChange)=\"onNodeSymbolTableChange($event)\"></p-selectButton>\n                                </div>\n                            </div>\n\n                            <div id=\"node-symbol-row\" [hidden]=\"ShowNodeSymbolWrapper\" class=\"form-group row\" title=\"What shape should the nodes be?\">\n                                <div class=\"col-4\"><label for=\"node-symbol\">Shape</label></div>\n                                <div class=\"col-8\">\n                                  <p-dropdown [options]=\"symbolMapping\" optionValue=\"key\" [(ngModel)]=\"selectedNodeShape\" (ngModelChange)=\"onNodeShapeChange($event)\">\n                                    <ng-template let-symbol pTemplate=\"selectedItem\">\n                                      <div>\n                                        <a [ngClass]=\"{'rhombus': symbol.key === 'rhomboid', 'tag': symbol.key === 'tag', 'barrel': symbol.key === 'barrel'}\" [ngStyle]=\"{'font-weight': symbol.key==='vee' ? 'bold': 'normal'}\" style=\"color: black;\">{{ symbol.value}}</a>\n                                        {{ symbol.name}}\n                                      </div>\n                                    </ng-template>\n                                    <ng-template pTemplate=\"item\" let-symbol>\n                                      <div *ngIf=\"symbol\">\n                                        <a [ngClass]=\"{'rhombus': symbol.key === 'rhomboid', 'tag': symbol.key === 'tag', 'barrel': symbol.key === 'barrel'}\" [ngStyle]=\"{'font-weight': symbol.key==='vee' ? 'bold': 'normal'}\" style=\"color: black;\">{{ symbol.value}}</a>\n                                        {{ symbol.name}}\n                                      </div>\n                                    </ng-template>\n                                  </p-dropdown>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row\" title=\"Which variable should determine the size of the node?\">\n                                <div class=\"col-4\"><label for=\"node-radius-variable\">Size By</label></div>\n                                <div class=\"col-8\">\n                                    <p-dropdown id=\"node-radius-variable\" [options]=\"FieldList\" appendTo=\"body\" [(ngModel)]=\"SelectedNodeRadiusVariable\" (ngModelChange)=\"onNodeRadiusVariableChange($event)\"></p-dropdown>\n                                </div>\n                            </div>\n                            <div id=\"node-max-radius-row\" class=\"form-group row\" title=\"Should node max radius to this variable?\">\n                                <div class=\"col-4\"><label for=\"node-radius-max\">Max Size</label></div>\n                                <div class=\"col-8\">\n                                    <input type=\"range\" class=\"custom-range\" id=\"node-radius-max\" min=\"20\" value=\"25\" step=\"1\" max=\"100\" [(ngModel)]=\"widgets['node-radius-max']\" (ngModelChange)=\"onNodeRadiusMaxChange($event)\">\n                                </div>\n                              </div>\n                              <div id=\"node-min-radius-row\" class=\"form-group row\" title=\"Should node min radius to this variable?\">\n                                <div class=\"col-4\"><label for=\"node-radius-min\">Min Size</label></div>\n                                <div class=\"col-8\">\n                                    <input type=\"range\" class=\"custom-range\" id=\"node-radius-min\" min=\"5\" value=\"10\" step=\"1\" max=\"55\" [(ngModel)]=\"widgets['node-radius-min']\" (ngModelChange)=\"onNodeRadiusMinChange($event)\">\n                                </div>\n                            </div>\n                            <div id=\"node-radius-row\" class=\"form-group row\" title=\"How big should the nodes be?\">\n                                <div class=\"col-4\"><label for=\"node-radius\">Size</label></div>\n                                <div class=\"col-8\">\n                                    <input type=\"range\" class=\"custom-range\" id=\"node-radius\" min=\"0\" value=\"50\" step=\"1\" max=\"100\" [(ngModel)]=\"SelectedNodeRadiusSizeVariable\" (ngModelChange)=\"onNodeRadiusChange($event)\">\n                                </div>\n                            </div>\n\n                            <div class=\"form-group row\" title=\"What should the width of the node border be?\">\n                                <div class=\"col-4\"><label for=\"node-radius-variable\">Border Width</label></div>\n                                <div class=\"col-8\">\n                                    <input type=\"number\" class=\"form-control form-control-sm\" id=\"node-border-width\" min=\"0.5\" step=\"0.5\" value=\"2\" [(ngModel)]=\"nodeBorderWidth\" (ngModelChange)=\"onNodeBorderWidthChange($event)\">\n                                </div>\n                            </div>\n\n                        </div>\n                    </p-accordionTab>\n\n                    <p-accordionTab style=\"color:#495057\" [selected]=\"false\" header=\"Colors\">\n                        <button pButton type=\"button\" label=\"Show Colors\" class=\"ui-button-raised\" (click)=\"showGlobalSettings()\" [style]=\"{'background-color': '#2196f3', 'border': '1px solid #2196f3'}\"></button>\n                    </p-accordionTab>\n\n                </p-accordion>\n            </tab>\n\n            <tab heading=\"{{'Links' | localize}}\" customClass=\"m-tabs__item\">\n                <p-accordion>\n                    <p-accordionTab style=\"color:#495057\" header=\"Labels and Tooltips\">\n                        <div #linkcontrolslabels>\n                            <div class=\"form-group row\" title=\"What data should be displayed when you hover over a link?\">\n                                <div class=\"col-4\"><label for=\"link-tooltip-variable\">Tooltip</label></div>\n                                <div class=\"col-8\">\n                                    <p-multiSelect [options]=\"LinkToolTipList\" appendTo=\"body\" [showToggleAll]=false [showHeader]=false [style]=\"{'max-width': '100%'}\"\n                                    [(ngModel)]=\"commonService.session.style.widgets['link-tooltip-variable']\" (onChange)=\"onLinkTooltipVariableChange($event.value)\"\n                                    ></p-multiSelect>\n                                    <!--mat-select multiple [(value)]=\"commonService.session.style.widgets['link-tooltip-variable']\" (valueChange)=\"onLinkTooltipVariableChange($event)\">\n                                        <mat-option *ngFor=\"let option of LinkToolTipList\" [value]=\"option.value\">\n                                          {{option.label}}\n                                        </mat-option>\n                                      </mat-select-->\n                                </div>\n                            </div>\n                            <div class=\"form-group row\" title=\"What data should be displayed when you hover over a link?\">\n                                <div class=\"col-4\"><label for=\"link-label-variable\">Label</label></div>\n                                <div class=\"col-8\">\n                                    <p-dropdown id=\"link-label-variable\" [options]=\"ToolTipFieldList\" appendTo=\"body\" [(ngModel)]=\"SelectedLinkLabelVariable\" (ngModelChange)=\"onLinkLabelVariableChange($event)\"></p-dropdown>\n                                </div>\n                            </div>\n                            <div class=\"form-group row\" title=\"How many decimals should the number labels have?\">\n                                <div class=\"col-4\"><label for=\"link-label-decimal-length\">Decimal Length</label></div>\n                                <div class=\"col-8\"><input type=\"number\" class=\"form-control form-control-sm\" id=\"link-label-decimal-length\" min=\"0\" step=\"1\" max=\"6\" value=\"3\"  [(ngModel)]=\"SelectedLinkDecimalVariable\"  (ngModelChange)=\"onLinkDecimalVariableChange($event)\">\n                                </div>\n                              </div>  \n                        </div>\n                    </p-accordionTab>\n\n                    <p-accordionTab style=\"color:#495057\" header=\"Shapes and Sizes\">\n                        <div #linkcontrolsshapes>\n                            <div id=\"link-transparency-row\" class=\"form-group row\" title=\"How transparent should the links be?\">\n                                <div class=\"col-4\"><label for=\"link-opacity\">Transparency</label></div>\n                                <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"link-opacity\" min=\"0\" max=\"1\" value=\"0\" step=\"0.01\" [(ngModel)]=\"SelectedLinkTransparencyVariable\" (ngModelChange)=\"onLinkOpacityChange($event)\"></div>\n                            </div>\n                            <div class=\"form-group row\" title=\"Which variable should determine the width of a link?\">\n                                <div class=\"col-4\"><label for=\"link-width-variable\">Width By</label></div>\n                                <div class=\"col-8\">\n                                    <p-dropdown id=\"link-width-variable\" [options]=\"ToolTipFieldList\" appendTo=\"body\" [(ngModel)]=\"SelectedLinkWidthByVariable\" (ngModelChange)=\"onLinkWidthVariableChange($event)\"></p-dropdown>\n                                </div>\n                            </div>\n                            <div id=\"link-max-width-row\" class=\"form-group row display-none\" title=\"Should link max widths to this variable?\">\n                                <div class=\"col-4\"><label for=\"link-width-max\">Max Width</label></div>\n                                <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"link-width-max\" min=\"0.3\" max=\"20\" step=\".3\" value=\"8\" [(ngModel)]=\"SelectedLinkWidthMax\" (ngModelChange)=\"onLinkWidthMaxChange($event)\"></div>\n                              </div>\n                              <div id=\"link-min-width-row\" class=\"form-group row display-none\" title=\"Should link min widths to this variable?\">\n                                <div class=\"col-4\"><label for=\"link-width-min\">Min Width</label></div>\n                                <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"link-width-min\" min=\"0.3\" max=\"20\" step=\".3\" value=\"3\" [(ngModel)]=\"SelectedLinkWidthMin\" (ngModelChange)=\"onLinkWidthMinChange($event)\"></div>\n                              </div>\n                            <div id=\"link-reciprocalthickness-row\" class=\"form-group row display-none\" title=\"Should link widths be proportioned to the reciprocal of this variable?\">\n                                <div class=\"col-4\">Reciprocal</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton id=\"link-width-reciprocal-non-reciprocal\" appendTo=\"body\"  [options]=\"ReciprocalTypes\" [(ngModel)]=\"SelectedLinkReciprocalTypeVariable\" (ngModelChange)=\"onLinkWidthReciprocalNonReciprocalChange($event)\"></p-selectButton>\n                                </div>\n                            </div>\n                            <div class=\"form-group row\" id=\"link-width-row\" title=\"How thick should the links be?\">\n                                <div class=\"col-4\"><label for=\"link-width\">Width</label></div>\n                                <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"link-width\" min=\"0.3\" max=\"30\" step=\".3\" value=\"3\" [(ngModel)]=\"SelectedLinkWidthVariable\" (ngModelChange)=\"onLinkWidthChange($event)\"></div>\n                            </div>\n                            <!-- TODO Add back in if we figure out link length \n                            <div class=\"form-group row\" title=\"How long should links be?\">\n                                <div class=\"col-4\"><label for=\"link-length\">Length</label></div>\n                                <div class=\"col-8\"><input type=\"range\" class=\"custom-range\" id=\"link-length\" min=\"0\" max=\"200\" value=\"50\" [(ngModel)]=\"SelectedLinkLengthVariable\" (ngModelChange)=\"onLinkLengthChange($event)\"></div>\n                            </div> -->\n                            <div class=\"form-group row hideForHIVTrace\" title=\"Shoul arrowheads pointing to the\">\n                                <div class=\"col-4\">Arrows</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton id=\"link-directed-undirected\" [options]=\"ArrowTypes\" [(ngModel)]=\"SelectedLinkArrowTypeVariable\" (ngModelChange)=\"onLinkDirectedUndirectedChange($event)\"></p-selectButton>\n                                </div>\n                            </div>\n                            <div id=\"link-bidirectional-row\" class=\"form-group row display-none\" title=\"Should links be bidirectional?\">\n                                <div class=\"col-4\">Bidirectional</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton id=\"link-bidirectional\" [options]=\"bidirectionalOptions\" [(ngModel)]=\"SelectedLinkBidirectionalTypeVariable\" (ngModelChange)=\"onLinkBidirectionalChange($event)\"></p-selectButton>\n                                </div>\n                            </div>\n                        </div>\n                    </p-accordionTab>\n\n\n                    <p-accordionTab style=\"color:#495057\" header=\"Colors\">\n                        <button pButton type=\"button\" label=\"Show Colors\" class=\"ui-button-raised\" (click)=\"showGlobalSettings()\" [style]=\"{'background-color': '#2196f3', 'border': '1px solid #2196f3'}\"></button>\n                    </p-accordionTab>\n\n                </p-accordion>\n            </tab>\n\n            <tab heading=\"{{'Network' | localize}}\" customClass=\"m-tabs__item\">\n                <p-accordion>\n                    <p-accordionTab style=\"color:#495057\" header=\"Display\">\n                        <div #networkcontrolslabels>\n                            <div class=\"form-group row\" title=\"Should MicrobeTrace Highlight a node's neighbors when you hover on it?\">\n                                <div class=\"col-4\">Neighbors</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton id=\"dont-highlight-neighbors-highlight-neighbors\" [options]=\"NeighborTypes\" [(ngModel)]=\"SelectedNetworkNeighborTypeVariable\" (ngModelChange)=\"onDontHighlightNeighborsHighlightNeighborsChange($event)\"></p-selectButton>\n                                </div>\n                            </div>\n                            <div class=\"form-group row\" title=\"Should MicrobeTrace Highlight a node's neighbors when you hover on it?\">\n                                <div class=\"col-4\">Gridlines</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton id=\"network-gridlines-show-hide\" [options]=\"GridLineTypes\" [(ngModel)]=\"SelectedNetworkGridLineTypeVariable\" (ngModelChange)=\"onNetworkGridlinesShowHideChange($event)\"></p-selectButton>\n                                </div>\n                            </div>\n                        </div>\n                    </p-accordionTab>                 \n                </p-accordion>\n            </tab>\n            <tab heading=\"{{'Grouping' | localize}}\" customClass=\"m-tabs__item\">\n                <p-accordion>\n                    <p-accordionTab style=\"color:#495057\" header=\"Controls\" id=\"polygons-controls-accordion\">\n                          <div id=\"polygons-controls\" class=\"show\" data-parent=\"#polygons-controls-accordion\">\n                            <div class=\"card-body\">\n                              <div class=\"form-group row\" title=\"Show groups?\">\n                                <div class=\"col-4\">Groups</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton id=\"colorPolygonsTable\" [options]=\"hideShowOptions\" [(ngModel)]=\"commonService.session.style.widgets['polygons-show']\" (ngModelChange)=\"polygonsToggle($event)\"></p-selectButton>\n                                </div>\n                              </div>\n                              <div *ngIf=\"commonService.session.style.widgets['polygons-show']\" class=\"form-group row polygons-settings-row\" title=\"What node variable to group by?\">\n                                <div class=\"col-4\"><label for=\"polygons-foci\">Group By</label></div>\n                                <div class=\"col-8\">\n                                    <p-dropdown id=\"polygons-foci\" [options]=\"FieldList\" appendTo=\"body\" [(ngModel)]=\"commonService.session.style.widgets['polygons-foci']\" (ngModelChange)=\"centerPolygons($event)\"></p-dropdown>\n                                </div>\n                              </div>\n                              <div class=\"form-group row\" title=\"Reapply forces to shrink groups and separate them from others. May lead to a better layout\">\n                                <button pButton type=\"button\" label=\"Recalculate Layout\" class=\"ui-button-raised\" (click)=\"updateLayout()\" [style]=\"{'background-color': '#2196f3', 'border': '1px solid #2196f3'}\"></button>\n                              </div>\n                            </div>\n                          </div>\n                    </p-accordionTab>\n                    <p-accordionTab *ngIf=\"commonService.session.style.widgets['polygons-show']\" style=\"color:#495057\" header=\"Labels\" id=\"polygons-controls-accordion\">\n                          <div id=\"polygons-controls-labels\" data-parent=\"#polygons-controls-accordion\">\n                            <div class=\"card-body\">\n                              <div class=\"form-group row\" title=\"Show group labels?\">\n                                <div class=\"col-4\">Groups Label</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton id=\"polygons-label-visibility\" [options]=\"hideShowOptions\" [(ngModel)]=\"commonService.session.style.widgets['polygons-label-show']\" (ngModelChange)=\"onPolygonLabelShowChange($event)\"></p-selectButton>\n                                </div>\n                              </div>\n                              <div *ngIf=\"commonService.session.style.widgets['polygons-label-show']\" class=\"form-group row polygons-label-row\" title=\"How big should group labels be?\">\n                                <div class=\"col-4\"><label for=\"polygons-label-size\">Label Size</label></div>\n                                <div class=\"col-8\">\n                                    <input type=\"range\" class=\"custom-range\" id=\"polygons-label-size\" min=\"6\" value=\"16\" step=\"1\" max=\"72\" [(ngModel)]=\"commonService.session.style.widgets['polygons-label-size']\" (ngModelChange)=\"onPolygonLabelSizeChange($event)\">\n                                </div>\n                              </div>\n                              <div *ngIf=\"commonService.session.style.widgets['polygons-label-show']\" class=\"form-group row polygons-label-row\" title=\"How should the labels be oriented relative to center of group?\">\n                                <div class=\"col-4\"><label for=\"polygon-label-orientation\">Orientation</label></div>\n                                <div class=\"col-8\">\n                                    <select id=\"polygon-label-orientation\" [(ngModel)]=\"SelectedPolygonLabelOrientationVariable\" (ngModelChange)=\"onPolygonLabelOrientationChange($event)\">\n                                        <option selected>top</option>\n                                        <option>middle</option>\n                                        <option>bottom</option>\n                                    </select>                                \n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        </p-accordionTab>\n                        <!-- style=\"display: none;\" -->\n                        <p-accordionTab *ngIf=\"commonService.session.style.widgets['polygons-show']\" style=\"color:#495057\" header=\"Colors\" id=\"polygons-controls-accordion\">  \n                          <div id=\"polygons-controls-colors\" data-parent=\"#polygons-controls-accordion\">\n                            <div class=\"card-body\">\n                              <div id=\"color-polygons\" class=\"form-group row\" title=\"Distinguish groups by color?\">\n                                <div class=\"col-4\">Color Groups</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton id=\"colorPolygons\" [options]=\"hideShowOptions\" [(ngModel)]=\"commonService.session.style.widgets['polygons-color-show']\" (ngModelChange)=\"polygonColorsToggle($event)\"></p-selectButton>\n                                </div>\n                              </div>\n                              <div *ngIf=\"commonService.session.style.widgets['polygons-color-show']\" id=\"polygon-color-table-row\" class=\"form-group row\" title=\"Should MicrobeTrace display the table of colors?\">\n                                <div class=\"col-4\">Group Color Table</div>\n                                <div class=\"col-8\">\n                                    <p-selectButton id=\"colorPolygonsTable\" [options]=\"hideShowOptions\" [(ngModel)]=\"commonService.session.style.widgets['polygon-color-table-visible']\" (ngModelChange)=\"polygonColorsTableToggle($event)\"></p-selectButton>\n                                </div>\n                              </div>\n                              <div *ngIf=\"!commonService.session.style.widgets['polygons-color-show']\" id=\"polygon-color-value-row\" class=\"form-group row\" title=\"What color should the groups be?\">\n                                <div class=\"col-4\"><label for=\"polygon-color\">Group Color</label></div>\n                                <div class=\"col-8\">\n                                  <input type=\"color\" id=\"polygon-color\" class=\"form-control form-control-sm\" value=\"#1f77b4\" [(ngModel)]=\"commonService.session.style.widgets['polygon-color']\" (ngModelChange)=\"onPolygonColorChanged($event)\">\n                                </div>\n                              </div>              \n                            </div>\n                          </div>\n                    </p-accordionTab>\n                </p-accordion>\n            </tab>\n        </tabset>\n\n    </p-dialog>\n\n\n\n</div>\n\n    <p-dialog id=\"node-symbol-table-wrapper\" \n      [position]=\"NodeSymbolTableWrapperDialogSettings.shapeRight\"\n      [(visible)]=\"NodeSymbolTableWrapperDialogSettings.isVisible\"  \n      [style]=\"{width: '50vw', maxWidth: '500px'}\"\n      (onHide)=\"onNodeSymbolTableChange('Hide')\"\n      (onShow)=\"onNodeSymbolTableChange('Show')\"\n    >\n      <ng-template pTemplate=\"header\">\n        <div style=\"display: flex; justify-content: space-between; width: 100%;\">\n            <span>Node Symbol Table</span>\n            <span style=\"overflow: visible; position: relative;\">\n              <button title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon-md\" style=\"float:left\" (click)=\"toggleColorTableSettings('node-shape')\"><i class=\"pi pi-cog\"></i></button>\n              <div id=\"nodeShapeTableSettings\" class=\"dropdown-menu\" style=\"display: none;\" (mouseleave)=\"closeSettingsPane('nodeShapeTableSettings')\">\n                    <button id=\"nodeShapeCounts\" class=\"dropdown-item\" (click)=\"toggleTableColumns('node-shape', 'tableCounts')\">\n                        <span>Show Counts</span>\n                        <i [className]=\"this.widgets['node-symbol-table-counts'] ? 'pi pi-check' : 'pi pi-times'\" style=\"line-height: 1.5\"></i>\n                    </button>\n                    <button id=\"nodeShapeFrequencies\" class=\"dropdown-item\" (click)=\"toggleTableColumns('node-shape', 'tableFreq')\">\n                        <span>Show Frequencies</span>\n                        <i [className]=\"this.widgets['node-symbol-table-frequencies'] ? 'pi pi-check' : 'pi pi-times'\" style=\"line-height: 1.5\"></i>\n                    </button>\n                </div>\n            </span>\n        </div>\n    </ng-template>\n        <div class=\"col-12\" style=\"width:100%;max-height:50vh;\" title=\"Node Shapes and Size Selection.\">          \n             <table #nodeSymbolTable id=\"nodeSymbolTable\" style=\"width:100%;height:100%;\">\n              <tr>\n                <th class=\"table-header-row\" contenteditable>\n                  <div class=\"header-content sortable\">Node {{ commonService.titleize(this.widgets['node-symbol-variable']) }}<a class=\"sort-button\" style=\"cursor: pointer;\" (click)=\"onNodeShapeSort('key')\"></a></div>\n                </th>\n                <th class=\"table-header-row tableCount\" *ngIf=\"widgets['node-symbol-table-counts']\" contenteditable>\n                  <div class=\"header-content sortable\">Count<a class=\"sort-button\" style=\"cursor: pointer;\" (click)=\"onNodeShapeSort('count')\"></a></div>\n                </th>\n                <th class=\"table-header-row tableFrequency\" *ngIf=\"widgets['node-symbol-table-frequencies']\" contenteditable>\n                  <div class=\"header-content sortable\">Frequency<a class=\"sort-button\" style=\"cursor: pointer;\" (click)=\"onNodeShapeSort('frequency')\"></a></div>\n                </th>\n                <th>Shape</th>\n              </tr>\n              <tr *ngFor=\"let group of shapeAggregates\">\n                <td contenteditable>{{commonService.titleize(group.key)}}</td>\n                <td class=\"tableCount\" *ngIf=\"widgets['node-symbol-table-counts']\">{{group.count}}</td>\n                <td class=\"tableFrequency\" *ngIf=\"widgets['node-symbol-table-frequencies']\">{{group.frequency}}</td>\n                <td>\n                  <p-dropdown [options]=\"symbolMapping\" optionValue=\"key\" [ngModel]=\"commonService.temp.style.nodeSymbolMap(group.key)\" (ngModelChange)=\"onNodeShapeTableChange($event, group.key)\" appendTo=\"body\" styleClass=\"shapeDropdown\">\n                    <ng-template let-symbol pTemplate=\"selectedItem\">\n                      <div>\n                        <a [ngClass]=\"{'rhombus': symbol.key === 'rhomboid', 'tag': symbol.key === 'tag', 'barrel': symbol.key === 'barrel'}\" [ngStyle]=\"{'font-weight': symbol.key==='vee' ? 'bold': 'normal'}\" style=\"color: black;\">{{ symbol.value}}</a>\n                        {{ symbol.name}}\n                      </div>\n                    </ng-template>\n                    <ng-template pTemplate=\"item\" let-symbol>\n                      <div *ngIf=\"symbol\">\n                        <a [ngClass]=\"{'rhombus': symbol.key === 'rhomboid', 'tag': symbol.key === 'tag', 'barrel': symbol.key === 'barrel'}\" [ngStyle]=\"{'font-weight': symbol.key==='vee' ? 'bold': 'normal'}\" style=\"color: black;\">{{ symbol.value}}</a>\n                        {{ symbol.name}}\n                      </div>\n                    </ng-template>\n                  </p-dropdown>\n                </td>\n              </tr>\n             </table>          \n        </div>\n    </p-dialog>\n\n    <p-dialog id=\"polygon-color-table-wrapper\" \n      [position]=\"PolygonColorTableWrapperDialogSettings.polygonRight\" \n      [(visible)]=\"PolygonColorTableWrapperDialogSettings.isVisible\"  \n      [style]=\"{width: '45vw', maxWidth: '450px'}\" \n      (onHide)=\"onPolygonColorTableChange(false)\"\n      (onShow)=\"onPolygonColorTableChange(true)\"\n    >\n          <ng-template pTemplate=\"header\">\n            <div style=\"display: flex; justify-content: space-between; width: 100%;\">\n                <span>Group Color Table</span>\n                <span style=\"overflow: visible; position: relative;\">\n                  <button title=\"Settings\" class=\"btn btn-sm btn-clean btn-icon-md\" style=\"float:left\" (click)=\"toggleColorTableSettings('polygon-color')\"><i class=\"pi pi-cog\"></i></button>\n                    <div id=\"polygonColorTableSettings\" class=\"dropdown-menu\" style=\"display: none;\" (mouseleave)=\"closeSettingsPane('polygonColorTableSettings')\">\n                        <button id=\"polygonColorCounts\" class=\"dropdown-item\" (click)=\"toggleTableColumns('polygon-color', 'tableCounts')\">\n                            <span>Show Counts</span>\n                            <i [className]=\"this.widgets['polygon-color-table-counts'] ? 'pi pi-check' : 'pi pi-times'\" style=\"line-height: 1.5\"></i>\n                        </button>\n                        <button id=\"polygonColorFrequencies\" class=\"dropdown-item\" (click)=\"toggleTableColumns('polygon-color', 'tableFreq')\">\n                            <span>Show Frequencies</span>\n                            <i [className]=\"this.widgets['polygon-color-table-frequencies'] ? 'pi pi-check' : 'pi pi-times'\" style=\"line-height: 1.5\"></i>\n                        </button>\n                    </div>\n                </span>\n            </div>\n        </ng-template>\n        <div class=\"col-12\" style=\"width:100%;max-height:50vh;\" title=\"Group Color Selection.\">          \n             <table #polygonColorTable id=\"polygon-color-table\" style=\"width:100%;height:100%;\"></table>          \n        </div>\n        <select id=\"polygon-color2\" [hidden]=\"'true'\" class=\"form-control form-control-sm\">\n\n            <option value=\"symbolCircle\" selected>&nbsp;&#11044; (Circle)</option>\n            <option value=\"symbolTriangle\">&nbsp;&#9650; (Up Triangle)</option>\n            <!-- <option value=\"symbolTriangleDown\">&nbsp;&#9660; (Down Triangle)</option>\n            <option value=\"symbolTriangleLeft\">&nbsp;&#9664; (Left Triangle)</option>\n            <option value=\"symbolTriangleRight\">&nbsp;&#9654; (Right Triangle)</option>\n            <option value=\"symbolDiamond\">&nbsp;&#10731; (Vertical Diamond)</option>\n            <option value=\"symbolDiamondAlt\">&nbsp;&#10731; (Horizontal Diamond)</option> -->\n            <option value=\"symbolSquare\">&nbsp;&#9632; (Square)</option>\n            <!-- <option value=\"symbolDiamondSquare\">&nbsp;&#9670; (Tilted Square)</option>\n            <option value=\"symbolPentagon\">&nbsp;&#11039; (Pentagon)</option> -->\n            <option value=\"symbolHexagon\">&nbsp;&#11042; (Hexagon)</option>\n            <!-- <option value=\"symbolHexagonAlt\">&nbsp;&#11043; (Tilted Hexagon)</option>\n            <option value=\"symbolOctagon\">&nbsp;&#11042; (Octagon)</option>\n            <option value=\"symbolOctagonAlt\">&nbsp;&#11043; (Tilted Octagon)</option>\n            <option value=\"symbolCross\">&nbsp;&#10010; (Addition Sign)</option>\n            <option value=\"symbolX\">&nbsp;&#10006; (Multiplication Sign)</option>\n            <option value=\"symbolWye\">&nbsp;&#120300; (Wye)</option>\n            <option value=\"symbolStar\">&nbsp;&#9733; (Star)</option> -->\n        </select>\n\n    </p-dialog>\n\n    <!-- <p-dialog id=\"polygon-color-table-wrapper\" class=\"floater\">\n        <div id=\"polygon-color-table-draghandle\"><span class=\"oi oi-move\"></span></div>\n        <table id=\"polygon-color-table\"></table>\n    </p-dialog> -->\n\n\n\n\n\n<div id=\"node-symbol-table-context\" class=\"dropdown-menu\">\n    <a href=\"#\" id=\"node-symbol-table-move\" class=\"dropdown-item\">Pin</a>\n    <a href=\"#\" id=\"node-symbol-table-context-hide\" class=\"dropdown-item\">Hide</a>\n    <a href=\"#\" id=\"node-symbol-table-expand\" class=\"dropdown-item\">Expand</a>\n    <a href=\"#\" id=\"node-symbol-table-counts\" class=\"dropdown-item\">Toggle Counts</a>\n    <a href=\"#\" id=\"node-symbol-table-frequencies\" class=\"dropdown-item\">Toggle Frequencies</a>\n</div>\n\n  \n  <div id=\"polygon-color-table-context\" class=\"dropdown-menu\">\n    <a href=\"#\" id=\"polygon-color-table-drag\" class=\"dropdown-item\">Drag/Arrow Keys</a>\n    <a href=\"#\" id=\"polygon-color-table-context-hide\" class=\"dropdown-item\">Hide</a>\n    <a href=\"#\" id=\"polygon-color-table-expand\" class=\"dropdown-item\">Expand</a>\n    <a href=\"#\" id=\"polygon-color-table-counts\" class=\"dropdown-item\">Toggle Counts</a>\n    <a href=\"#\" id=\"polygon-color-table-frequencies\" class=\"dropdown-item\">Toggle Frequencies</a>\n  </div>\n\n<div id=\"context-menu\" class=\"dropdown-menu\">\n    <a href=\"javascript:;\" id=\"pinNode\" class=\"dropdown-item\">Pin Node</a>\n    <button id=\"copyID\" class=\"dropdown-item\" (click)=\"copyID()\">Copy ID</button>\n    <button id=\"copySeq\" class=\"dropdown-item\" (click)=\"copySeq()\">Copy Sequence</button>\n    <a href=\"javascript:;\" id=\"viewAttributes\" class=\"dropdown-item\">View Attributes</a>\n</div>\n\n\n<p-dialog id=\"network-attribute-table-wrapper\" [(visible)]=\"ShowNetworkAttributes\" header=\"Node Attributes\" [style]=\"{width: '35vw'}\" >\n    <div class=\"col-12\" style=\"width:100%;\">        \n        <table id=\"network-attribute-table\" style=\"width:100%\">\n            <tr *ngFor=\"let item of ContextSelectedNodeAttributes\">\n                <td>\n                    <strong>\n                        {{item.attribute}}\n                    </strong>\n                </td>\n                <td>{{item.value}}</td>\n            </tr>\n        </table>\n    </div>\n</p-dialog>\n\n\n\n<p-dialog\n  *ngIf=\"viewActive\"\n  id=\"network-export-modal\"\n  [(visible)]=\"Show2DExportPane\"\n  header=\"Export Network Image\"\n  class=\"dialogSize\"\n  (onHide)=\"onCloseExport()\"\n  appendTo=\"body\"\n>\n  <div class=\"modal-dialog\" role=\"document\">\n    <div class=\"modal-content\">\n      <div class=\"modal-body\" style=\"min-width: 400px; height: 100%;\">\n        <div class=\"form-group row\">\n          <div class=\"col-8\">\n            <input\n              type=\"text\"\n              id=\"network-export-filename\"\n              class=\"form-control form-control-sm\"\n              placeholder=\"Filename\"\n              [(ngModel)]=\"SelectedNetworkExportFilenameVariable\"\n              (ngModelChange)=\"onDataChange($event)\"\n            />\n          </div>\n          <div class=\"col-4\">\n            <p-dropdown\n              id=\"network-export-filetype\"\n              [options]=\"NetworkExportFileTypeList\"\n              [(ngModel)]=\"SelectedNetworkExportFileTypeListVariable\"\n              (ngModelChange)=\"onNetworkExportFiletypeChange($event)\"\n            ></p-dropdown>\n          </div>\n        </div>\n        <div>\n          <!-- Toggle Advanced Export Options -->\n          <div [hidden]=\"SelectedNetworkExportFileTypeListVariable=='svg'\">\n            <p-accordion>\n              <p-accordionTab style=\"color:#495057\" header=\"Advanced\">\n                <div id=\"network-export-advanced\">\n                  <div class=\"form-group row\">\n                    <div class=\"col-3\">\n                      <label for=\"network-export-scale\">Scale</label>\n                    </div>\n                    <div class=\"col-9\">\n                      <input\n                        type=\"number\"\n                        id=\"network-export-scale\"\n                        class=\"form-control form-control-sm\"\n                        min=\"0\"\n                        max=\"2\"\n                        step=\"0.1\"\n                        [(ngModel)]=\"SelectedNetworkExportScaleVariable\"\n                        (ngModelChange)=\"updateCalculatedResolution()\"\n                      />\n                    </div>\n                  </div>\n                  <div class=\"form-group row\">\n                    <div class=\"col-3\">Resolution</div>\n                    <div id=\"network-export-dimensions\" class=\"col-9 text-right\">\n                      {{ CalculatedResolution }}\n                    </div>\n                  </div>\n                  <div class=\"row\">\n                    <div class=\"col-3\">\n                      <label for=\"network-export-quality\">Quality</label>\n                    </div>\n                    <div class=\"col-9\">\n                      <input\n                        type=\"range\"\n                        class=\"custom-range\"\n                        id=\"network-export-quality\"\n                        min=\"0\"\n                        max=\"1.0\"\n                        step=\"0.01\"\n                        [(ngModel)]=\"SelectedNetworkExportQualityVariable\"\n                      />\n                      <span>{{ SelectedNetworkExportQualityVariable }}</span>\n                    </div>\n                  </div>\n                </div>\n              </p-accordionTab>\n            </p-accordion>\n          </div>\n        </div>\n      </div>\n      <div class=\"modal-footer\">\n        <button\n          type=\"button\"\n          class=\"btn btn-error\"\n          (click)=\"Show2DExportPane = false\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          id=\"network-export\"\n          class=\"btn btn-primary\"\n          (click)=\"exportVisualization($event)\"\n        >\n          Export\n        </button>\n      </div>\n    </div>\n    <!-- /.modal-content -->\n  </div>\n  <!-- /.modal-dialog -->\n</p-dialog>\n";

/***/ }),

/***/ 19704:
/*!************************************************************************************************!*\
  !*** ./src/app/visualizationComponents/WaterfallComponent/waterfall.component.html?ngResource ***!
  \************************************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = "<div class=\"waterfall-wrapper\">\n\n    <div class=\"row\">\n        <div class=\"primeng-datatable-container col-4\" >\n            <p-table #clusterTable *ngIf=\"IsDataAvailable == true && clusterTableData\" \n                [value]=\"clusterTableData\"\n                dataKey=\"id\"\n                rowExpandMode=\"single\"\n                (onRowSelect)=\"onClusterRowSelect($event)\"\n                (onRowUnselect)=\"onClusterRowUnselect()\"\n                selectionMode=\"single\"\n                [scrollable]=\"true\"\n                [scrollHeight]=\"scrollHeight\"\n                [tableStyle]=\"{'border': '3px #e9ecef solid'}\">\n                <ng-template pTemplate=\"header\">\n                    <tr style=\"background-color: #d8dadd; font-size: 22px;\">\n                        <th>Cluster</th>\n                        <th style=\"text-align: end;\">Nodes</th>\n                    </tr>\n                </ng-template>\n                <ng-template pTemplate=\"body\" let-datarow>\n                    <tr class=\"ui-selectable-row\" [pSelectableRow]=\"datarow\" [pRowToggler]=\"datarow\">\n                        <td>{{datarow.id}}</td>\n                        <td style=\"text-align: end\">{{datarow.nodeCount}}</td>\n                    </tr>\n                </ng-template>\n                <ng-template pTemplate=\"rowexpansion\">\n                    <tr><td colspan=\"2\" class=\"rowExpansionContent\">\n                        <div *ngFor=\"let data of expandedClusterRowData\" [style.width.px]=\"clusterTableWidth\">{{data.key}}: {{data.value}}</div>\n                    </td></tr>\n                </ng-template>\n            </p-table>\n        </div>\n\n        <div class=\"primeng-datatable-container col-4\">\n            <p-table #nodeTable *ngIf=\"IsDataAvailable == true && nodeTableData\" \n                [value]=\"nodeTableData\"\n                dataKey=\"id\"\n                rowExpandMode=\"single\"\n                (onRowSelect)=\"onNodeRowSelect($event)\"\n                (onRowUnselect)=\"onNodeRowUnselect()\"\n                selectionMode=\"single\"\n                [(selection)]=\"selectedNodeRow\"\n                [scrollable]=\"true\"\n                [scrollHeight]=\"scrollHeight\"\n                [tableStyle]=\"{'border': '3px #e9ecef solid'}\">\n                <ng-template pTemplate=\"header\">\n                    <tr style=\"background-color: #d8dadd; font-size: 22px;\">\n                        <th>Nodes</th>\n                        <th style=\"text-align: end;\">Degree</th>\n                    </tr>\n                </ng-template>\n                <ng-template pTemplate=\"body\" let-datarow>\n                    <tr class=\"ui-selectable-row\" [pSelectableRow]=\"datarow\" [pRowToggler]=\"datarow\">\n                        <td>{{datarow.id}}</td>\n                        <td style=\"text-align: end\">{{datarow.degree}}</td>\n                    </tr>\n                </ng-template>\n                <ng-template pTemplate=\"rowexpansion\">\n                    <tr *ngIf=\"selectedNodeRow\"><td colspan=\"2\" class=\"rowExpansionContent\">\n                        <div *ngFor=\"let data of expandedNodeRowData\" [style.width.px]=\"nodeTableWidth\">{{data.key}}: {{data.value}}</div>\n                    </td></tr>\n                </ng-template>\n            </p-table>\n        </div>\n\n        <div class=\"primeng-datatable-container col-4\">\n            <p-table #linkTable *ngIf=\"IsDataAvailable == true && linkTableData\" \n                [value]=\"linkTableData\"\n                dataKey=\"index\"\n                rowExpandMode=\"single\"\n                (onRowSelect)=\"onLinkRowSelect($event)\"\n                (onRowUnselect)=\"onLinkRowUnselect()\"\n                selectionMode=\"single\"\n                [(selection)]=\"selectedLinkRow\"\n                [scrollable]=\"true\"\n                [scrollHeight]=\"scrollHeight\"\n                [tableStyle]=\"{'border': '3px #e9ecef solid'}\">\n                <ng-template pTemplate=\"header\">\n                    <tr style=\"background-color: #d8dadd; font-size: 22px;\">\n                        <th>Links</th>\n                        <th style=\"text-align: end;\">Distance</th>\n                    </tr>\n                </ng-template>\n                <ng-template pTemplate=\"body\" let-datarow>\n                    <tr class=\"ui-selectable-row\" [pSelectableRow]=\"datarow\" [pRowToggler]=\"datarow\">\n                        <td>{{datarow.id}}</td>\n                        <td style=\"text-align: end\">{{datarow.distance.toLocaleString()}}</td>\n                    </tr>\n                </ng-template>\n                <ng-template pTemplate=\"rowexpansion\" let-datarow>\n                    <tr *ngIf=\"selectedLinkRow\"><td colspan=\"2\" class=\"rowExpansionContent\">\n                        <div *ngFor=\"let data of expandedLinkRowData\" [style.width.px]=\"linkTableWidth\">{{data.key}}: {{data.value}}</div>\n                    </td></tr>\n                </ng-template>\n            </p-table>\n        </div>\n    </div>\n\n    <div class=\"m-content\" *ngIf=\"IsDataAvailable == false\">\n        <div id=\"file-panel\" class=\"container-fluid\" style=\"height:500px;\">\n            <div id=\"file-prompt\" class=\"d-flex justify-content-center\">\n                <h1><b>Please add data files to load...</b></h1>\n                <br />\n            </div>\n        </div>\n    </div>\n\n</div>\n";

/***/ })

},
/******/ __webpack_require__ => { // webpackRuntimeModules
/******/ var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
/******/ __webpack_require__.O(0, [502], () => (__webpack_exec__(84429)));
/******/ var __webpack_exports__ = __webpack_require__.O();
/******/ }
]);
//# sourceMappingURL=main.js.map